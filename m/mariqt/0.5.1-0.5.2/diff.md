# Comparing `tmp/mariqt-0.5.1-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.2-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 213367 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jun-23 14:17 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jun-23 14:17 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jun-23 14:17 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jun-23 14:17 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jun-23 14:17 mariqt/files.py
--rw-r--r--  2.0 unx    27845 b- defN 23-Jun-23 14:17 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jun-23 14:17 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jun-23 14:17 mariqt/misc.py
--rw-r--r--  2.0 unx    40059 b- defN 23-Jun-23 14:17 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jun-23 14:17 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jun-23 14:17 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jun-23 14:17 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jun-23 14:17 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jun-23 14:17 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jun-23 14:17 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jun-23 14:17 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jun-23 14:17 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4586 b- defN 23-Jun-23 14:17 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jun-23 14:17 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   112498 b- defN 23-Jun-23 14:17 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jun-23 14:17 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jun-23 14:17 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jun-23 14:17 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jun-23 14:19 mariqt-0.5.1.dist-info/RECORD
-31 files, 1074106 bytes uncompressed, 209341 bytes compressed:  80.5%
+Zip file size: 213532 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-10 14:54 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jul-10 14:54 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-10 14:54 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-10 14:54 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-10 14:54 mariqt/files.py
+-rw-r--r--  2.0 unx    27845 b- defN 23-Jul-10 14:54 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-10 14:54 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-10 14:54 mariqt/misc.py
+-rw-r--r--  2.0 unx    40059 b- defN 23-Jul-10 14:54 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-10 14:54 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-10 14:54 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-10 14:54 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-10 14:54 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-10 14:54 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-10 14:54 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-10 14:54 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-10 14:54 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4586 b- defN 23-Jul-10 14:54 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-10 14:54 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   113679 b- defN 23-Jul-10 14:54 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-10 14:54 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-10 14:54 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-10 14:54 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-10 14:56 mariqt-0.5.2.dist-info/RECORD
+31 files, 1075287 bytes uncompressed, 209506 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/AUTHORS.md
+Filename: mariqt-0.5.2.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/LICENSE
+Filename: mariqt-0.5.2.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/METADATA
+Filename: mariqt-0.5.2.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/WHEEL
+Filename: mariqt-0.5.2.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/top_level.txt
+Filename: mariqt-0.5.2.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.1.dist-info/RECORD
+Filename: mariqt-0.5.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.1'
+__version__ = '0.5.2'
```

## mariqt/sources/ifdo.py

```diff
@@ -2160,4873 +2160,4946 @@
 000086f0: 722e 7365 6e73 6f72 2829 0a0a 2020 2020  r.sensor()..    
 00008700: 2020 2020 6946 444f 6669 6c65 4e61 6d65      iFDOfileName
 00008710: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
 00008720: 616d 6528 7365 6c66 2e69 4644 4f66 696c  ame(self.iFDOfil
 00008730: 655f 290a 2020 2020 2020 2020 6966 206e  e_).        if n
 00008740: 6f74 2065 7665 6e74 2069 6e20 6946 444f  ot event in iFDO
 00008750: 6669 6c65 4e61 6d65 206f 7220 6e6f 7420  fileName or not 
-00008760: 7365 6e73 6f72 2069 6e20 6946 444f 6669  sensor in iFDOfi
-00008770: 6c65 4e61 6d65 3a0a 2020 2020 2020 2020  leName:.        
-00008780: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00008790: 6728 2243 6175 7469 6f6e 2120 6946 444f  g("Caution! iFDO
-000087a0: 2066 696c 6520 6e61 6d65 2064 6f65 7320   file name does 
-000087b0: 6e6f 7420 636f 6e74 6169 6e20 7072 6f6a  not contain proj
-000087c0: 6563 742c 2065 7665 6e74 2061 6e64 2073  ect, event and s
-000087d0: 656e 736f 7220 6e61 6d65 2061 7320 7265  ensor name as re
-000087e0: 636f 6d6d 656e 6465 642e 2043 6f6e 7369  commended. Consi
-000087f0: 6465 7220 7265 7365 7474 696e 6720 7769  der resetting wi
-00008800: 7468 2073 6574 6946 444f 4669 6c65 4e61  th setiFDOFileNa
-00008810: 6d65 2829 2e20 2220 2b20 6946 444f 6669  me(). " + iFDOfi
-00008820: 6c65 290a 0a0a 2020 2020 6465 6620 6765  le)...    def ge
-00008830: 7469 4644 4f46 696c 654e 616d 6528 7365  tiFDOFileName(se
-00008840: 6c66 2c6f 7665 7277 7269 7465 3d46 616c  lf,overwrite=Fal
-00008850: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-00008860: 2052 6574 7572 6e73 2074 6865 2063 7572   Returns the cur
-00008870: 7265 6e74 2069 4644 4f20 6669 6c65 2773  rent iFDO file's
-00008880: 206e 616d 6520 7769 7468 2070 6174 682e   name with path.
-00008890: 2049 6620 6e6f 7420 7365 7420 7965 7420   If not set yet 
-000088a0: 6f72 206f 7665 7277 7269 7465 3d3d 5472  or overwrite==Tr
-000088b0: 7565 2069 7420 7265 7475 726e 7320 7468  ue it returns th
-000088c0: 6520 6f6e 6520 6d61 7463 6869 6e67 2069  e one matching i
-000088d0: 6d61 6765 2d73 6574 2d6e 616d 652e 2022  mage-set-name. "
-000088e0: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-000088f0: 6c66 2e69 4644 4f66 696c 655f 203d 3d20  lf.iFDOfile_ == 
-00008900: 2222 206f 7220 6f76 6572 7772 6974 653a  "" or overwrite:
-00008910: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00008920: 655f 6e61 6d65 203d 2073 656c 662e 6669  e_name = self.fi
-00008930: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-00008940: 652d 7365 742d 6e61 6d65 2729 202b 2027  e-set-name') + '
-00008950: 5f69 4644 4f2e 6a73 6f6e 270a 2020 2020  _iFDO.json'.    
-00008960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00008970: 6946 444f 6669 6c65 5f20 213d 2022 223a  iFDOfile_ != "":
-00008980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008990: 2023 2072 656e 616d 6520 6669 6c65 2062   # rename file b
-000089a0: 7574 206b 6565 7020 6c6f 6361 7469 6f6e  ut keep location
-000089b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000089c0: 2069 6620 6669 6c65 5f6e 616d 6520 213d   if file_name !=
-000089d0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-000089e0: 6528 7365 6c66 2e69 4644 4f66 696c 655f  e(self.iFDOfile_
-000089f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00008a00: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00008a10: 2e6c 6f67 2822 4361 7574 696f 6e2c 2069  .log("Caution, i
-00008a20: 6664 6f20 6669 6c65 2072 656e 616d 6564  fdo file renamed
-00008a30: 2074 6f20 2220 2b20 6669 6c65 5f6e 616d   to " + file_nam
-00008a40: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00008a50: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
-00008a60: 5f20 3d20 6f73 2e70 6174 682e 6a6f 696e  _ = os.path.join
-00008a70: 286f 732e 7061 7468 2e64 6972 6e61 6d65  (os.path.dirname
-00008a80: 2873 656c 662e 6946 444f 6669 6c65 5f29  (self.iFDOfile_)
-00008a90: 2c66 696c 655f 6e61 6d65 290a 2020 2020  ,file_name).    
-00008aa0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00008ab0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008ac0: 6c66 2e69 4644 4f66 696c 655f 203d 206f  lf.iFDOfile_ = o
-00008ad0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00008ae0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
-00008af0: 2e64 742e 7072 6f64 7563 7473 292c 2066  .dt.products), f
-00008b00: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-00008b10: 2020 7265 7475 726e 2073 656c 662e 6946    return self.iF
-00008b20: 444f 6669 6c65 5f0a 0a0a 2020 2020 4073  DOfile_...    @s
-00008b30: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00008b40: 6465 6620 636f 6e73 7472 7563 7449 6d61  def constructIma
-00008b50: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-00008b60: 743a 7374 722c 6576 656e 743a 7374 722c  t:str,event:str,
-00008b70: 7365 6e73 6f72 3a73 7472 293a 0a20 2020  sensor:str):.   
-00008b80: 2020 2020 2022 2222 2072 6574 7572 6e73       """ returns
-00008b90: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
-00008ba0: 743e 5f3c 7365 6e73 6f72 3e2c 2077 6974  t>_<sensor>, wit
-00008bb0: 6820 7368 6f72 7420 7665 7273 696f 6e20  h short version 
-00008bc0: 6f66 203c 7365 6e73 6f72 3e20 286f 6e6c  of <sensor> (onl
-00008bd0: 7920 6964 292c 2070 7265 7665 6e74 696e  y id), preventin
-00008be0: 6720 706f 7465 6e74 6961 6c20 646f 7562  g potential doub
-00008bf0: 6c69 6e67 206f 6620 3c70 726f 6a65 6374  ling of <project
-00008c00: 3e20 2022 2222 0a20 2020 2020 2020 2073  >  """.        s
-00008c10: 656e 736f 725f 7368 6f72 7420 3d20 6946  ensor_short = iF
-00008c20: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
-00008c30: 6d65 6e74 4944 2873 656e 736f 7229 0a20  mentID(sensor). 
-00008c40: 2020 2020 2020 2069 6620 6c65 6e28 6576         if len(ev
-00008c50: 656e 7429 203e 206c 656e 2870 726f 6a65  ent) > len(proje
-00008c60: 6374 2920 616e 6420 6576 656e 745b 303a  ct) and event[0:
-00008c70: 6c65 6e28 7072 6f6a 6563 7429 5d20 3d3d  len(project)] ==
-00008c80: 2070 726f 6a65 6374 3a0a 2020 2020 2020   project:.      
-00008c90: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
-00008ca0: 6e61 6d65 5f20 3d20 6576 656e 7420 2b20  name_ = event + 
-00008cb0: 225f 2220 2b20 7365 6e73 6f72 5f73 686f  "_" + sensor_sho
-00008cc0: 7274 0a20 2020 2020 2020 2065 6c73 653a  rt.        else:
-00008cd0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00008ce0: 6765 5f73 6574 5f6e 616d 655f 203d 2070  ge_set_name_ = p
-00008cf0: 726f 6a65 6374 202b 2022 5f22 202b 2065  roject + "_" + e
-00008d00: 7665 6e74 202b 2022 5f22 202b 2073 656e  vent + "_" + sen
-00008d10: 736f 725f 7368 6f72 740a 2020 2020 2020  sor_short.      
-00008d20: 2020 7265 7475 726e 2069 6d61 6765 5f73    return image_s
-00008d30: 6574 5f6e 616d 655f 2023 2054 4f44 4f20  et_name_ # TODO 
-00008d40: 696e 636c 7564 6520 6461 7461 5479 7065  include dataType
-00008d50: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
-00008d60: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
-00008d70: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
-00008d80: 4428 6571 7569 706d 656e 7449 443a 7374  D(equipmentID:st
-00008d90: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00008da0: 7265 7475 726e 7320 6571 7569 706d 656e  returns equipmen
-00008db0: 7420 6964 2077 6974 686f 7574 2070 6f74  t id without pot
-00008dc0: 656e 7469 616c 6c20 6c6f 6e67 203c 6e61  entiall long <na
-00008dd0: 6d65 3e20 7061 7274 2c20 692e 652e 3a20  me> part, i.e.: 
-00008de0: 3c6f 776e 6572 3e5f 3c74 7970 653e 2d3c  <owner>_<type>-<
-00008df0: 7479 7065 2069 6e64 6578 5b5f 3c73 7562  type index[_<sub
-00008e00: 7479 7065 3e5d 2022 2222 0a20 2020 2020  type>] """.     
-00008e10: 2020 2072 6574 7572 6e20 275f 272e 6a6f     return '_'.jo
-00008e20: 696e 2865 7175 6970 6d65 6e74 4944 2e73  in(equipmentID.s
-00008e30: 706c 6974 2827 5f27 295b 303a 335d 290a  plit('_')[0:3]).
-00008e40: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00008e50: 6f64 0a20 2020 2064 6566 2063 6f6e 7374  od.    def const
-00008e60: 7275 6374 6946 444f 6669 6c65 4e61 6d65  ructiFDOfileName
-00008e70: 2870 726f 6a65 6374 3a73 7472 2c65 7665  (project:str,eve
-00008e80: 6e74 3a73 7472 2c73 656e 736f 723a 7374  nt:str,sensor:st
-00008e90: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00008ea0: 7265 7475 726e 7320 3c63 6f6e 7374 7275  returns <constru
-00008eb0: 6374 496d 6167 6553 6574 4e61 6d65 2829  ctImageSetName()
-00008ec0: 3e5f 6946 444f 2e6a 736f 6e20 2222 220a  >_iFDO.json """.
-00008ed0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-00008ee0: 4644 4f2e 636f 6e73 7472 7563 7449 6d61  FDO.constructIma
-00008ef0: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-00008f00: 742c 6576 656e 742c 7365 6e73 6f72 2920  t,event,sensor) 
-00008f10: 2b20 275f 6946 444f 2e6a 736f 6e27 200a  + '_iFDO.json' .
-00008f20: 0a20 2020 200a 2020 2020 4073 7461 7469  .    .    @stati
-00008f30: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00008f40: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
-00008f50: 6966 646f 3a64 6963 742c 6b65 7973 3a6c  ifdo:dict,keys:l
-00008f60: 6973 742c 6465 6661 756c 745f 6f6e 6c79  ist,default_only
-00008f70: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
-00008f80: 2020 2022 2222 2072 6574 7572 6e73 2063     """ returns c
-00008f90: 6f70 7920 6f66 2073 6574 206f 7220 6974  opy of set or it
-00008fa0: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
-00008fb0: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
-00008fc0: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
-00008fd0: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
-00008fe0: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
-00008ff0: 2061 7320 652e 672e 205b 3c69 7465 6d3e   as e.g. [<item>
-00009000: 2c3c 6b65 793e 2c2e 2e5d 2e20 4361 6e20  ,<key>,..]. Can 
-00009010: 6265 2075 7365 6420 666f 7220 6865 6164  be used for head
-00009020: 6572 2066 6965 6c64 7320 6173 2077 656c  er fields as wel
-00009030: 6c20 6173 2069 7465 6d20 6669 656c 6473  l as item fields
-00009040: 2e0a 2020 2020 2020 2020 2020 2020 4974  ..            It
-00009050: 656d 2069 6e64 6578 2063 616e 2062 6520  em index can be 
-00009060: 6e65 676c 6563 7465 642c 2069 6e20 6361  neglected, in ca
-00009070: 7365 206f 6620 7669 6465 6f20 6120 6469  se of video a di
-00009080: 6374 207b 3c69 6d61 6765 2d64 6174 6174  ct {<image-datat
-00009090: 696d 653e 3a3c 7661 6c75 653e 2c2e 2e2e  ime>:<value>,...
-000090a0: 7d20 6973 2072 6574 7572 6e65 640a 2020  } is returned.  
-000090b0: 2020 2020 2020 2020 2020 756e 6c65 7373            unless
-000090c0: 2064 6566 6175 6c74 5f6f 6e6c 7920 3d20   default_only = 
-000090d0: 4661 6c73 652c 2074 6865 6e20 6465 6661  False, then defa
-000090e0: 756c 7420 7661 6c75 6573 2061 7420 696e  ult values at in
-000090f0: 6465 7820 3020 6973 2072 6574 7572 6e65  dex 0 is returne
-00009100: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
-00009110: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
-00009120: 696f 6e20 6966 206b 6579 7320 646f 206e  ion if keys do n
-00009130: 6f74 2065 7869 7374 2e20 2222 220a 0a20  ot exist. """.. 
-00009140: 2020 2020 2020 2069 6620 6e6f 7420 6d69         if not mi
-00009150: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
-00009160: 656d 735f 6b65 7920 696e 2069 6664 6f20  ems_key in ifdo 
-00009170: 6f72 206e 6f74 206d 6971 7476 2e69 6d61  or not miqtv.ima
-00009180: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
-00009190: 7920 696e 2069 6664 6f3a 0a20 2020 2020  y in ifdo:.     
-000091a0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-000091b0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-000091c0: 2822 496e 7661 6c69 6420 6966 646f 2064  ("Invalid ifdo d
-000091d0: 6963 742c 206d 6973 7369 6e67 2069 7465  ict, missing ite
-000091e0: 6d73 206f 7220 6865 6164 6572 206b 6579  ms or header key
-000091f0: 3a20 2220 2b20 7374 7228 6966 646f 2929  : " + str(ifdo))
-00009200: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00009210: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-00009220: 6e63 6528 6b65 7973 2c6c 6973 7429 3a0a  nce(keys,list):.
-00009230: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-00009240: 203d 205b 6b65 7973 5d0a 0a20 2020 2020   = [keys]..     
-00009250: 2020 2023 2072 656d 6f76 6520 6865 6164     # remove head
-00009260: 6572 206f 7220 6974 656d 2070 7265 6669  er or item prefi
-00009270: 7865 7320 6966 2074 6865 7265 0a20 2020  xes if there.   
-00009280: 2020 2020 2069 6620 6b65 7973 5b30 5d20       if keys[0] 
-00009290: 3d3d 206d 6971 7476 2e69 6d61 6765 5f73  == miqtv.image_s
-000092a0: 6574 5f69 7465 6d73 5f6b 6579 206f 7220  et_items_key or 
-000092b0: 6b65 7973 5b30 5d20 3d3d 206d 6971 7476  keys[0] == miqtv
-000092c0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-000092d0: 725f 6b65 793a 0a20 2020 2020 2020 2020  r_key:.         
-000092e0: 2020 206b 6579 7320 3d20 6b65 7973 5b31     keys = keys[1
-000092f0: 3a3a 5d0a 0a20 2020 2020 2020 2068 6561  ::]..        hea
-00009300: 6465 7220 3d20 6966 646f 5b6d 6971 7476  der = ifdo[miqtv
-00009310: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-00009320: 725f 6b65 795d 0a20 2020 2020 2020 2069  r_key].        i
-00009330: 7465 6d73 203d 2069 6664 6f5b 6d69 7174  tems = ifdo[miqt
-00009340: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00009350: 735f 6b65 795d 0a20 2020 2020 2020 2023  s_key].        #
-00009360: 206c 6f6f 6b20 666f 7220 6465 6661 756c   look for defaul
-00009370: 7420 7661 6c75 650a 2020 2020 2020 2020  t value.        
-00009380: 666f 7220 736b 6970 7065 6449 6e48 6561  for skippedInHea
-00009390: 6465 7220 696e 2072 616e 6765 286c 656e  der in range(len
-000093a0: 286b 6579 7329 293a 0a20 2020 2020 2020  (keys)):.       
-000093b0: 2020 2020 2064 6566 6175 6c74 5661 6c20       defaultVal 
-000093c0: 3d20 6669 6e64 4669 656c 6428 6865 6164  = findField(head
-000093d0: 6572 2c6b 6579 735b 736b 6970 7065 6449  er,keys[skippedI
-000093e0: 6e48 6561 6465 723a 3a5d 290a 2020 2020  nHeader::]).    
-000093f0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
-00009400: 6c74 5661 6c20 213d 2022 223a 0a20 2020  ltVal != "":.   
-00009410: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00009420: 616b 0a0a 2020 2020 2020 2020 2323 206c  ak..        ## l
-00009430: 6f6f 6b20 666f 7220 6974 656d 2076 616c  ook for item val
-00009440: 7565 0a20 2020 2020 2020 2023 2068 6561  ue.        # hea
-00009450: 6465 7220 6f6e 6c79 2076 616c 7565 2c20  der only value, 
-00009460: 646f 6e27 7420 6368 6563 6b20 696e 2069  don't check in i
-00009470: 7465 6d73 0a20 2020 2020 2020 2069 6620  tems.        if 
-00009480: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
-00009490: 6b65 7973 5b30 3a31 5d29 203d 3d20 2222  keys[0:1]) == ""
-000094a0: 2061 6e64 2073 6b69 7070 6564 496e 4865   and skippedInHe
-000094b0: 6164 6572 203d 3d20 303a 0a20 2020 2020  ader == 0:.     
-000094c0: 2020 2020 2020 2072 6574 203d 2064 6566         ret = def
-000094d0: 6175 6c74 5661 6c0a 2020 2020 2020 2020  aultVal.        
-000094e0: 2020 2020 6966 2072 6574 203d 3d20 2222      if ret == ""
-000094f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009500: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00009510: 646f 4578 6365 7074 696f 6e28 226b 6579  doException("key
-00009520: 2064 6f65 7320 6e6f 7420 6578 6973 743a   does not exist:
-00009530: 2220 2b20 7374 7228 6b65 7973 2929 0a20  " + str(keys)). 
-00009540: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009550: 2020 2020 2020 2020 2023 2069 6620 6669           # if fi
-00009560: 7273 7420 6b65 7920 6e6f 7420 666f 756e  rst key not foun
-00009570: 6420 696e 2069 7465 6d73 2c20 692e 652e  d in items, i.e.
-00009580: 2069 7320 6e6f 7420 6120 696d 6167 6520   is not a image 
-00009590: 6e61 6d65 2c20 616e 6420 6669 7273 7420  name, and first 
-000095a0: 6b65 7920 6973 206e 6f74 2061 2068 6561  key is not a hea
-000095b0: 6465 7220 6b65 793a 0a20 2020 2020 2020  der key:.       
-000095c0: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
-000095d0: 6428 6974 656d 732c 6b65 7973 5b30 3a31  d(items,keys[0:1
-000095e0: 5d29 203d 3d20 2222 2061 6e64 2073 6b69  ]) == "" and ski
-000095f0: 7070 6564 496e 4865 6164 6572 2021 3d20  ppedInHeader != 
-00009600: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00009610: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-00009620: 6664 6f45 7863 6570 7469 6f6e 2822 6974  fdoException("it
-00009630: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
-00009640: 743a 2220 2b20 7374 7228 6b65 7973 5b30  t:" + str(keys[0
-00009650: 3a31 5d29 290a 0a20 2020 2020 2020 2020  :1]))..         
-00009660: 2020 2023 2063 6865 636b 2069 6620 696e     # check if in
-00009670: 6465 7820 7072 6f76 6964 6564 0a20 2020  dex provided.   
-00009680: 2020 2020 2020 2020 2069 6e64 6578 5072           indexPr
-00009690: 6f76 6964 6564 203d 2054 7275 650a 2020  ovided = True.  
-000096a0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-000096b0: 286b 6579 7329 203e 2031 3a0a 2020 2020  (keys) > 1:.    
-000096c0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-000096d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000096e0: 2020 2020 2069 6e64 6578 203d 2069 6e74       index = int
-000096f0: 286b 6579 735b 315d 290a 2020 2020 2020  (keys[1]).      
-00009700: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00009710: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00009720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009730: 696e 6465 7850 726f 7669 6465 6420 3d20  indexProvided = 
-00009740: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00009750: 2020 656c 6966 206c 656e 286b 6579 7329    elif len(keys)
-00009760: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00009770: 2020 2020 2020 2069 6e64 6578 5072 6f76         indexProv
-00009780: 6964 6564 203d 2046 616c 7365 0a20 2020  ided = False.   
-00009790: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-000097a0: 2020 2020 2020 2020 2020 696d 6167 6549            imageI
-000097b0: 7465 6d54 696d 6550 6f69 6e74 7320 3d20  temTimePoints = 
-000097c0: 6974 656d 735b 6b65 7973 5b30 5d5d 0a0a  items[keys[0]]..
-000097d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000097e0: 6e64 6578 5072 6f76 6964 6564 3a0a 2020  ndexProvided:.  
-000097f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009800: 6966 206b 6579 2069 7320 7768 6f6c 6520  if key is whole 
-00009810: 696d 6167 6520 6164 6420 616c 6c20 7661  image add all va
-00009820: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
-00009830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009840: 2069 6620 6c65 6e28 6b65 7973 2920 3d3d   if len(keys) ==
-00009850: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00009860: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
-00009870: 616c 203d 2068 6561 6465 720a 2020 2020  al = header.    
-00009880: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
-00009890: 6420 6465 6661 756c 7420 6672 6f6d 2069  d default from i
-000098a0: 6e64 6578 2030 0a20 2020 2020 2020 2020  ndex 0.         
-000098b0: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-000098c0: 7973 2920 3e20 3120 616e 6420 696e 6465  ys) > 1 and inde
-000098d0: 7820 213d 2030 3a0a 2020 2020 2020 2020  x != 0:.        
-000098e0: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-000098f0: 5f30 203d 2063 6f70 792e 6465 6570 636f  _0 = copy.deepco
-00009900: 7079 286b 6579 7329 0a20 2020 2020 2020  py(keys).       
-00009910: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00009920: 735f 305b 315d 203d 2030 0a20 2020 2020  s_0[1] = 0.     
-00009930: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009940: 6574 5f30 203d 2069 4644 4f2e 5f5f 6765  et_0 = iFDO.__ge
-00009950: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
-00009960: 2c6b 6579 735f 302c 736b 6970 7065 6449  ,keys_0,skippedI
-00009970: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
-00009980: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-00009990: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000099a0: 7461 6e63 6528 7265 745f 302c 6469 6374  tance(ret_0,dict
-000099b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000099c0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-000099d0: 6c74 5661 6c20 3d20 7b2a 2a64 6566 6175  ltVal = {**defau
-000099e0: 6c74 5661 6c2c 2a2a 7265 745f 307d 0a20  ltVal,**ret_0}. 
-000099f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009a00: 6574 203d 2069 4644 4f2e 5f5f 6765 7449  et = iFDO.__getI
-00009a10: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
-00009a20: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
-00009a30: 6465 722c 6465 6661 756c 7456 616c 290a  der,defaultVal).
-00009a40: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00009a50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00009a60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009a70: 2069 6620 6b65 7920 6973 2077 686f 6c65   if key is whole
-00009a80: 2069 6d61 6765 2061 6464 2061 6c6c 2076   image add all v
-00009a90: 616c 7565 7320 6672 6f6d 2068 6561 6465  alues from heade
-00009aa0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00009ab0: 2020 6966 206c 656e 286b 6579 7329 203d    if len(keys) =
-00009ac0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00009ad0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009ae0: 5661 6c20 3d20 6865 6164 6572 0a0a 2020  Val = header..  
-00009af0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009b00: 7069 6374 7572 6520 2d3e 206a 7573 7420  picture -> just 
-00009b10: 6f6e 6520 656e 7472 792c 2069 6e73 6572  one entry, inser
-00009b20: 7420 696e 6465 7820 300a 2020 2020 2020  t index 0.      
-00009b30: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00009b40: 2869 6d61 6765 4974 656d 5469 6d65 506f  (imageItemTimePo
-00009b50: 696e 7473 2920 3d3d 2031 3a0a 2020 2020  ints) == 1:.    
-00009b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b70: 6b65 7973 203d 206b 6579 735b 303a 315d  keys = keys[0:1]
-00009b80: 202b 205b 305d 202b 206b 6579 735b 313a   + [0] + keys[1:
-00009b90: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-00009ba0: 2020 2020 2020 2072 6574 203d 2069 4644         ret = iFD
-00009bb0: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
-00009bc0: 2869 7465 6d73 2c6b 6579 732c 736b 6970  (items,keys,skip
-00009bd0: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
-00009be0: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
-00009bf0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00009c00: 2020 2020 2020 2020 2020 2020 2023 2076               # v
-00009c10: 6964 656f 202d 3e20 7265 7475 726e 2076  ideo -> return v
-00009c20: 616c 7565 7320 666f 7220 6561 6368 2074  alues for each t
-00009c30: 696d 6520 7374 616d 700a 2020 2020 2020  ime stamp.      
-00009c40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 2020 2020 7265 7420 3d20 7b7d 0a20 2020      ret = {}.   
-00009c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c80: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00009c90: 6c65 6e28 696d 6167 6549 7465 6d54 696d  len(imageItemTim
-00009ca0: 6550 6f69 6e74 7329 293a 0a20 2020 2020  ePoints)):.     
-00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cc0: 2020 2074 696d 6550 6f69 6e74 4461 7461     timePointData
-00009cd0: 203d 2069 6d61 6765 4974 656d 5469 6d65   = imageItemTime
-00009ce0: 506f 696e 7473 5b69 5d0a 2020 2020 2020  Points[i].      
-00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d00: 2020 6b65 7973 5f69 203d 206b 6579 735b    keys_i = keys[
-00009d10: 303a 315d 202b 205b 695d 202b 206b 6579  0:1] + [i] + key
-00009d20: 735b 313a 3a5d 0a20 2020 2020 2020 2020  s[1::].         
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00009d40: 616c 5f69 203d 2069 4644 4f2e 5f5f 6765  al_i = iFDO.__ge
-00009d50: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
-00009d60: 2c6b 6579 735f 692c 736b 6970 7065 6449  ,keys_i,skippedI
-00009d70: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
-00009d80: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-00009d90: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-00009da0: 6661 756c 7420 6f6e 6c79 0a20 2020 2020  fault only.     
-00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dc0: 2020 2069 6620 6465 6661 756c 745f 6f6e     if default_on
-00009dd0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009df0: 7265 7420 3d20 7661 6c5f 690a 2020 2020  ret = val_i.    
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e10: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e30: 2020 2020 2020 7265 745b 7469 6d65 506f        ret[timePo
-00009e40: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-00009e50: 6174 6574 696d 6527 5d5d 203d 2076 616c  atetime']] = val
-00009e60: 5f69 0a20 2020 2020 2020 2020 2020 2020  _i.             
-00009e70: 2020 2020 2020 2020 2020 2023 2072 656d             # rem
-00009e80: 6f76 6520 696d 6167 652d 6461 7465 7469  ove image-dateti
-00009e90: 6d65 2069 6620 7468 6572 650a 2020 2020  me if there.    
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00009ec0: 6528 7265 745b 7469 6d65 506f 696e 7444  e(ret[timePointD
-00009ed0: 6174 615b 2769 6d61 6765 2d64 6174 6574  ata['image-datet
-00009ee0: 696d 6527 5d5d 2c64 6963 7429 2061 6e64  ime']],dict) and
-00009ef0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-00009f00: 2720 696e 2072 6574 5b74 696d 6550 6f69  ' in ret[timePoi
-00009f10: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
-00009f20: 7465 7469 6d65 275d 5d3a 0a20 2020 2020  tetime']]:.     
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f40: 2020 2020 2020 2064 656c 2072 6574 5b74         del ret[t
-00009f50: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
-00009f60: 6167 652d 6461 7465 7469 6d65 275d 5d5b  age-datetime']][
-00009f70: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-00009f80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00009f90: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
-00009fa0: 6f20 6465 6661 756c 7473 0a20 2020 2020  o defaults.     
-00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fc0: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+00008760: 6946 444f 2e67 6574 5368 6f72 7445 7175  iFDO.getShortEqu
+00008770: 6970 6d65 6e74 4944 2873 656e 736f 7229  ipmentID(sensor)
+00008780: 2069 6e20 6946 444f 6669 6c65 4e61 6d65   in iFDOfileName
+00008790: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000087a0: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
+000087b0: 7469 6f6e 2120 6946 444f 2066 696c 6520  tion! iFDO file 
+000087c0: 6e61 6d65 2064 6f65 7320 6e6f 7420 636f  name does not co
+000087d0: 6e74 6169 6e20 7072 6f6a 6563 742c 2065  ntain project, e
+000087e0: 7665 6e74 2061 6e64 2073 656e 736f 7220  vent and sensor 
+000087f0: 6e61 6d65 2061 7320 7265 636f 6d6d 656e  name as recommen
+00008800: 6465 642e 2043 6f6e 7369 6465 7220 7265  ded. Consider re
+00008810: 7365 7474 696e 6720 7769 7468 2073 6574  setting with set
+00008820: 6946 444f 4669 6c65 4e61 6d65 2829 2e20  iFDOFileName(). 
+00008830: 2220 2b20 6946 444f 6669 6c65 290a 0a0a  " + iFDOfile)...
+00008840: 2020 2020 6465 6620 6765 7469 4644 4f46      def getiFDOF
+00008850: 696c 654e 616d 6528 7365 6c66 2c6f 7665  ileName(self,ove
+00008860: 7277 7269 7465 3d46 616c 7365 293a 0a20  rwrite=False):. 
+00008870: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
+00008880: 6e73 2074 6865 2063 7572 7265 6e74 2069  ns the current i
+00008890: 4644 4f20 6669 6c65 2773 206e 616d 6520  FDO file's name 
+000088a0: 7769 7468 2070 6174 682e 2049 6620 6e6f  with path. If no
+000088b0: 7420 7365 7420 7965 7420 6f72 206f 7665  t set yet or ove
+000088c0: 7277 7269 7465 3d3d 5472 7565 2069 7420  rwrite==True it 
+000088d0: 7265 7475 726e 7320 7468 6520 6f6e 6520  returns the one 
+000088e0: 6d61 7463 6869 6e67 2069 6d61 6765 2d73  matching image-s
+000088f0: 6574 2d6e 616d 652e 2022 2222 0a20 2020  et-name. """.   
+00008900: 2020 2020 2069 6620 7365 6c66 2e69 4644       if self.iFD
+00008910: 4f66 696c 655f 203d 3d20 2222 206f 7220  Ofile_ == "" or 
+00008920: 6f76 6572 7772 6974 653a 0a20 2020 2020  overwrite:.     
+00008930: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+00008940: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+00008950: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
+00008960: 6e61 6d65 2729 202b 2027 5f69 4644 4f2e  name') + '_iFDO.
+00008970: 6a73 6f6e 270a 2020 2020 2020 2020 2020  json'.          
+00008980: 2020 6966 2073 656c 662e 6946 444f 6669    if self.iFDOfi
+00008990: 6c65 5f20 213d 2022 223a 0a20 2020 2020  le_ != "":.     
+000089a0: 2020 2020 2020 2020 2020 2023 2072 656e             # ren
+000089b0: 616d 6520 6669 6c65 2062 7574 206b 6565  ame file but kee
+000089c0: 7020 6c6f 6361 7469 6f6e 0a20 2020 2020  p location.     
+000089d0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+000089e0: 6c65 5f6e 616d 6520 213d 206f 732e 7061  le_name != os.pa
+000089f0: 7468 2e62 6173 656e 616d 6528 7365 6c66  th.basename(self
+00008a00: 2e69 4644 4f66 696c 655f 2920 616e 6420  .iFDOfile_) and 
+00008a10: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00008a20: 656c 662e 6946 444f 6669 6c65 5f29 3a0a  elf.iFDOfile_):.
+00008a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a40: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00008a50: 6728 2243 6175 7469 6f6e 2c20 6966 646f  g("Caution, ifdo
+00008a60: 2066 696c 6520 7265 6e61 6d65 6420 746f   file renamed to
+00008a70: 2022 202b 2066 696c 655f 6e61 6d65 290a   " + file_name).
+00008a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a90: 7365 6c66 2e69 4644 4f66 696c 655f 203d  self.iFDOfile_ =
+00008aa0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f73   os.path.join(os
+00008ab0: 2e70 6174 682e 6469 726e 616d 6528 7365  .path.dirname(se
+00008ac0: 6c66 2e69 4644 4f66 696c 655f 292c 6669  lf.iFDOfile_),fi
+00008ad0: 6c65 5f6e 616d 6529 0a20 2020 2020 2020  le_name).       
+00008ae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00008af0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008b00: 6946 444f 6669 6c65 5f20 3d20 6f73 2e70  iFDOfile_ = os.p
+00008b10: 6174 682e 6a6f 696e 2873 656c 662e 6469  ath.join(self.di
+00008b20: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
+00008b30: 2e70 726f 6475 6374 7329 2c20 6669 6c65  .products), file
+00008b40: 5f6e 616d 6529 0a20 2020 2020 2020 2072  _name).        r
+00008b50: 6574 7572 6e20 7365 6c66 2e69 4644 4f66  eturn self.iFDOf
+00008b60: 696c 655f 0a0a 0a20 2020 2064 6566 2073  ile_...    def s
+00008b70: 6574 5f69 6d61 6765 5f73 6574 5f6e 616d  et_image_set_nam
+00008b80: 655f 6669 656c 645f 6672 6f6d 5f70 726f  e_field_from_pro
+00008b90: 6a65 6374 5f65 7665 6e74 5f73 656e 736f  ject_event_senso
+00008ba0: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+00008bb0: 2022 2222 2053 6574 7320 6669 656c 6420   """ Sets field 
+00008bc0: 696d 6167 652d 7365 742d 6e61 6d65 2066  image-set-name f
+00008bd0: 726f 6d20 6375 7272 656e 7420 746d 7020  rom current tmp 
+00008be0: 6669 656c 6473 2066 6f72 2070 726f 6a65  fields for proje
+00008bf0: 6374 2c20 6576 656e 7420 616e 6420 7365  ct, event and se
+00008c00: 6e73 6f72 2e20 0a20 2020 2020 2020 2052  nsor. .        R
+00008c10: 6574 7572 6e73 2069 6d61 6765 2d73 6574  eturns image-set
+00008c20: 2d6e 616d 6520 7661 6c75 652e 2022 2222  -name value. """
+00008c30: 0a20 2020 2020 2020 206e 6577 5f69 6d61  .        new_ima
+00008c40: 6765 5f73 6574 5f6e 616d 6520 3d20 7365  ge_set_name = se
+00008c50: 6c66 2e63 6f6e 7374 7275 6374 496d 6167  lf.constructImag
+00008c60: 6553 6574 4e61 6d65 2873 656c 662e 6966  eSetName(self.if
+00008c70: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00008c80: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+00008c90: 696d 6167 652d 7072 6f6a 6563 7427 5d5b  image-project'][
+00008ca0: 276e 616d 6527 5d2c 0a20 2020 2020 2020  'name'],.       
+00008cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008ce0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+00008cf0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+00008d00: 795d 5b27 696d 6167 652d 6576 656e 7427  y]['image-event'
+00008d10: 5d5b 276e 616d 6527 5d2c 0a20 2020 2020  ]['name'],.     
+00008d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008d50: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00008d60: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+00008d70: 4b65 795d 5b27 696d 6167 652d 7365 6e73  Key]['image-sens
+00008d80: 6f72 275d 5b27 6e61 6d65 275d 290a 2020  or']['name']).  
+00008d90: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+00008da0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+00008db0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+00008dc0: 6765 2d73 6574 2d6e 616d 6527 5d20 3d20  ge-set-name'] = 
+00008dd0: 6e65 775f 696d 6167 655f 7365 745f 6e61  new_image_set_na
+00008de0: 6d65 0a20 2020 2020 2020 2072 6574 7572  me.        retur
+00008df0: 6e20 6e65 775f 696d 6167 655f 7365 745f  n new_image_set_
+00008e00: 6e61 6d65 0a20 2020 2020 2020 200a 0a20  name.        .. 
+00008e10: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00008e20: 0a20 2020 2064 6566 2063 6f6e 7374 7275  .    def constru
+00008e30: 6374 496d 6167 6553 6574 4e61 6d65 2870  ctImageSetName(p
+00008e40: 726f 6a65 6374 3a73 7472 2c65 7665 6e74  roject:str,event
+00008e50: 3a73 7472 2c73 656e 736f 723a 7374 7229  :str,sensor:str)
+00008e60: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
+00008e70: 7475 726e 7320 3c70 726f 6a65 6374 3e5f  turns <project>_
+00008e80: 3c65 7665 6e74 3e5f 3c73 656e 736f 723e  <event>_<sensor>
+00008e90: 2c20 7769 7468 2073 686f 7274 2076 6572  , with short ver
+00008ea0: 7369 6f6e 206f 6620 3c73 656e 736f 723e  sion of <sensor>
+00008eb0: 2028 6f6e 6c79 2069 6429 2c20 7072 6576   (only id), prev
+00008ec0: 656e 7469 6e67 2070 6f74 656e 7469 616c  enting potential
+00008ed0: 2064 6f75 626c 696e 6720 6f66 203c 7072   doubling of <pr
+00008ee0: 6f6a 6563 743e 2020 2222 220a 2020 2020  oject>  """.    
+00008ef0: 2020 2020 7365 6e73 6f72 5f73 686f 7274      sensor_short
+00008f00: 203d 2069 4644 4f2e 6765 7453 686f 7274   = iFDO.getShort
+00008f10: 4571 7569 706d 656e 7449 4428 7365 6e73  EquipmentID(sens
+00008f20: 6f72 290a 2020 2020 2020 2020 6966 206c  or).        if l
+00008f30: 656e 2865 7665 6e74 2920 3e20 6c65 6e28  en(event) > len(
+00008f40: 7072 6f6a 6563 7429 2061 6e64 2065 7665  project) and eve
+00008f50: 6e74 5b30 3a6c 656e 2870 726f 6a65 6374  nt[0:len(project
+00008f60: 295d 203d 3d20 7072 6f6a 6563 743a 0a20  )] == project:. 
+00008f70: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+00008f80: 5f73 6574 5f6e 616d 655f 203d 2065 7665  _set_name_ = eve
+00008f90: 6e74 202b 2022 5f22 202b 2073 656e 736f  nt + "_" + senso
+00008fa0: 725f 7368 6f72 740a 2020 2020 2020 2020  r_short.        
+00008fb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008fc0: 2020 696d 6167 655f 7365 745f 6e61 6d65    image_set_name
+00008fd0: 5f20 3d20 7072 6f6a 6563 7420 2b20 225f  _ = project + "_
+00008fe0: 2220 2b20 6576 656e 7420 2b20 225f 2220  " + event + "_" 
+00008ff0: 2b20 7365 6e73 6f72 5f73 686f 7274 0a20  + sensor_short. 
+00009000: 2020 2020 2020 2072 6574 7572 6e20 696d         return im
+00009010: 6167 655f 7365 745f 6e61 6d65 5f20 2320  age_set_name_ # 
+00009020: 544f 444f 2069 6e63 6c75 6465 2064 6174  TODO include dat
+00009030: 6154 7970 653f 0a0a 0a20 2020 2040 7374  aType?...    @st
+00009040: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00009050: 6566 2067 6574 5368 6f72 7445 7175 6970  ef getShortEquip
+00009060: 6d65 6e74 4944 2865 7175 6970 6d65 6e74  mentID(equipment
+00009070: 4944 3a73 7472 293a 0a20 2020 2020 2020  ID:str):.       
+00009080: 2022 2222 2072 6574 7572 6e73 2065 7175   """ returns equ
+00009090: 6970 6d65 6e74 2069 6420 7769 7468 6f75  ipment id withou
+000090a0: 7420 706f 7465 6e74 6961 6c6c 206c 6f6e  t potentiall lon
+000090b0: 6720 3c6e 616d 653e 2070 6172 742c 2069  g <name> part, i
+000090c0: 2e65 2e3a 203c 6f77 6e65 723e 5f3c 7479  .e.: <owner>_<ty
+000090d0: 7065 3e2d 3c74 7970 6520 696e 6465 785b  pe>-<type index[
+000090e0: 5f3c 7375 6274 7970 653e 5d20 2222 220a  _<subtype>] """.
+000090f0: 2020 2020 2020 2020 7265 7475 726e 2027          return '
+00009100: 5f27 2e6a 6f69 6e28 6571 7569 706d 656e  _'.join(equipmen
+00009110: 7449 442e 7370 6c69 7428 275f 2729 5b30  tID.split('_')[0
+00009120: 3a33 5d29 0a0a 2020 2020 4073 7461 7469  :3])..    @stati
+00009130: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00009140: 636f 6e73 7472 7563 7469 4644 4f66 696c  constructiFDOfil
+00009150: 654e 616d 6528 7072 6f6a 6563 743a 7374  eName(project:st
+00009160: 722c 6576 656e 743a 7374 722c 7365 6e73  r,event:str,sens
+00009170: 6f72 3a73 7472 293a 0a20 2020 2020 2020  or:str):.       
+00009180: 2022 2222 2072 6574 7572 6e73 203c 636f   """ returns <co
+00009190: 6e73 7472 7563 7449 6d61 6765 5365 744e  nstructImageSetN
+000091a0: 616d 6528 293e 5f69 4644 4f2e 6a73 6f6e  ame()>_iFDO.json
+000091b0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+000091c0: 7572 6e20 6946 444f 2e63 6f6e 7374 7275  urn iFDO.constru
+000091d0: 6374 496d 6167 6553 6574 4e61 6d65 2870  ctImageSetName(p
+000091e0: 726f 6a65 6374 2c65 7665 6e74 2c73 656e  roject,event,sen
+000091f0: 736f 7229 202b 2027 5f69 4644 4f2e 6a73  sor) + '_iFDO.js
+00009200: 6f6e 2720 0a0a 2020 2020 0a20 2020 2040  on' ..    .    @
+00009210: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+00009220: 2064 6566 205f 5f67 6574 4669 656c 6456   def __getFieldV
+00009230: 616c 7565 2869 6664 6f3a 6469 6374 2c6b  alue(ifdo:dict,k
+00009240: 6579 733a 6c69 7374 2c64 6566 6175 6c74  eys:list,default
+00009250: 5f6f 6e6c 7920 3d20 4661 6c73 6529 3a0a  _only = False):.
+00009260: 2020 2020 2020 2020 2222 2220 7265 7475          """ retu
+00009270: 726e 7320 636f 7079 206f 6620 7365 7420  rns copy of set 
+00009280: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
+00009290: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
+000092a0: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
+000092b0: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
+000092c0: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+000092d0: 206b 6579 7320 6173 2065 2e67 2e20 5b3c   keys as e.g. [<
+000092e0: 6974 656d 3e2c 3c6b 6579 3e2c 2e2e 5d2e  item>,<key>,..].
+000092f0: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
+00009300: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
+00009310: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
+00009320: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
+00009330: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
+00009340: 6e20 6265 206e 6567 6c65 6374 6564 2c20  n be neglected, 
+00009350: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
+00009360: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
+00009370: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
+00009380: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
+00009390: 6564 0a20 2020 2020 2020 2020 2020 2075  ed.            u
+000093a0: 6e6c 6573 7320 6465 6661 756c 745f 6f6e  nless default_on
+000093b0: 6c79 203d 2046 616c 7365 2c20 7468 656e  ly = False, then
+000093c0: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
+000093d0: 6174 2069 6e64 6578 2030 2069 7320 7265  at index 0 is re
+000093e0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+000093f0: 2020 2020 5261 6973 6573 2049 6664 6f45      Raises IfdoE
+00009400: 7863 6570 7469 6f6e 2069 6620 6b65 7973  xception if keys
+00009410: 2064 6f20 6e6f 7420 6578 6973 742e 2022   do not exist. "
+00009420: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+00009430: 6f74 206d 6971 7476 2e69 6d61 6765 5f73  ot miqtv.image_s
+00009440: 6574 5f69 7465 6d73 5f6b 6579 2069 6e20  et_items_key in 
+00009450: 6966 646f 206f 7220 6e6f 7420 6d69 7174  ifdo or not miqt
+00009460: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+00009470: 6572 5f6b 6579 2069 6e20 6966 646f 3a0a  er_key in ifdo:.
+00009480: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00009490: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+000094a0: 7074 696f 6e28 2249 6e76 616c 6964 2069  ption("Invalid i
+000094b0: 6664 6f20 6469 6374 2c20 6d69 7373 696e  fdo dict, missin
+000094c0: 6720 6974 656d 7320 6f72 2068 6561 6465  g items or heade
+000094d0: 7220 6b65 793a 2022 202b 2073 7472 2869  r key: " + str(i
+000094e0: 6664 6f29 290a 2020 2020 2020 2020 0a20  fdo)).        . 
+000094f0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00009500: 696e 7374 616e 6365 286b 6579 732c 6c69  instance(keys,li
+00009510: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+00009520: 206b 6579 7320 3d20 5b6b 6579 735d 0a0a   keys = [keys]..
+00009530: 2020 2020 2020 2020 2320 7265 6d6f 7665          # remove
+00009540: 2068 6561 6465 7220 6f72 2069 7465 6d20   header or item 
+00009550: 7072 6566 6978 6573 2069 6620 7468 6572  prefixes if ther
+00009560: 650a 2020 2020 2020 2020 6966 206b 6579  e.        if key
+00009570: 735b 305d 203d 3d20 6d69 7174 762e 696d  s[0] == miqtv.im
+00009580: 6167 655f 7365 745f 6974 656d 735f 6b65  age_set_items_ke
+00009590: 7920 6f72 206b 6579 735b 305d 203d 3d20  y or keys[0] == 
+000095a0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+000095b0: 6865 6164 6572 5f6b 6579 3a0a 2020 2020  header_key:.    
+000095c0: 2020 2020 2020 2020 6b65 7973 203d 206b          keys = k
+000095d0: 6579 735b 313a 3a5d 0a0a 2020 2020 2020  eys[1::]..      
+000095e0: 2020 6865 6164 6572 203d 2069 6664 6f5b    header = ifdo[
+000095f0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+00009600: 6865 6164 6572 5f6b 6579 5d0a 2020 2020  header_key].    
+00009610: 2020 2020 6974 656d 7320 3d20 6966 646f      items = ifdo
+00009620: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
+00009630: 5f69 7465 6d73 5f6b 6579 5d0a 2020 2020  _items_key].    
+00009640: 2020 2020 2320 6c6f 6f6b 2066 6f72 2064      # look for d
+00009650: 6566 6175 6c74 2076 616c 7565 0a20 2020  efault value.   
+00009660: 2020 2020 2066 6f72 2073 6b69 7070 6564       for skipped
+00009670: 496e 4865 6164 6572 2069 6e20 7261 6e67  InHeader in rang
+00009680: 6528 6c65 6e28 6b65 7973 2929 3a0a 2020  e(len(keys)):.  
+00009690: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+000096a0: 7456 616c 203d 2066 696e 6446 6965 6c64  tVal = findField
+000096b0: 2868 6561 6465 722c 6b65 7973 5b73 6b69  (header,keys[ski
+000096c0: 7070 6564 496e 4865 6164 6572 3a3a 5d29  ppedInHeader::])
+000096d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000096e0: 6465 6661 756c 7456 616c 2021 3d20 2222  defaultVal != ""
+000096f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009700: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+00009710: 2023 2320 6c6f 6f6b 2066 6f72 2069 7465   ## look for ite
+00009720: 6d20 7661 6c75 650a 2020 2020 2020 2020  m value.        
+00009730: 2320 6865 6164 6572 206f 6e6c 7920 7661  # header only va
+00009740: 6c75 652c 2064 6f6e 2774 2063 6865 636b  lue, don't check
+00009750: 2069 6e20 6974 656d 730a 2020 2020 2020   in items.      
+00009760: 2020 6966 2066 696e 6446 6965 6c64 2869    if findField(i
+00009770: 7465 6d73 2c6b 6579 735b 303a 315d 2920  tems,keys[0:1]) 
+00009780: 3d3d 2022 2220 616e 6420 736b 6970 7065  == "" and skippe
+00009790: 6449 6e48 6561 6465 7220 3d3d 2030 3a0a  dInHeader == 0:.
+000097a0: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+000097b0: 3d20 6465 6661 756c 7456 616c 0a20 2020  = defaultVal.   
+000097c0: 2020 2020 2020 2020 2069 6620 7265 7420           if ret 
+000097d0: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+000097e0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+000097f0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00009800: 2822 6b65 7920 646f 6573 206e 6f74 2065  ("key does not e
+00009810: 7869 7374 3a22 202b 2073 7472 286b 6579  xist:" + str(key
+00009820: 7329 290a 2020 2020 2020 2020 656c 7365  s)).        else
+00009830: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00009840: 6966 2066 6972 7374 206b 6579 206e 6f74  if first key not
+00009850: 2066 6f75 6e64 2069 6e20 6974 656d 732c   found in items,
+00009860: 2069 2e65 2e20 6973 206e 6f74 2061 2069   i.e. is not a i
+00009870: 6d61 6765 206e 616d 652c 2061 6e64 2066  mage name, and f
+00009880: 6972 7374 206b 6579 2069 7320 6e6f 7420  irst key is not 
+00009890: 6120 6865 6164 6572 206b 6579 3a0a 2020  a header key:.  
+000098a0: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
+000098b0: 6446 6965 6c64 2869 7465 6d73 2c6b 6579  dField(items,key
+000098c0: 735b 303a 315d 2920 3d3d 2022 2220 616e  s[0:1]) == "" an
+000098d0: 6420 736b 6970 7065 6449 6e48 6561 6465  d skippedInHeade
+000098e0: 7220 213d 2030 3a0a 2020 2020 2020 2020  r != 0:.        
+000098f0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00009900: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00009910: 6e28 2269 7465 6d20 646f 6573 206e 6f74  n("item does not
+00009920: 2065 7869 7374 3a22 202b 2073 7472 286b   exist:" + str(k
+00009930: 6579 735b 303a 315d 2929 0a0a 2020 2020  eys[0:1]))..    
+00009940: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00009950: 6966 2069 6e64 6578 2070 726f 7669 6465  if index provide
+00009960: 640a 2020 2020 2020 2020 2020 2020 696e  d.            in
+00009970: 6465 7850 726f 7669 6465 6420 3d20 5472  dexProvided = Tr
+00009980: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
+00009990: 6620 6c65 6e28 6b65 7973 2920 3e20 313a  f len(keys) > 1:
+000099a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000099b0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+000099c0: 2020 2020 2020 2020 2020 696e 6465 7820            index 
+000099d0: 3d20 696e 7428 6b65 7973 5b31 5d29 0a20  = int(keys[1]). 
+000099e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000099f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00009a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009a10: 2020 2020 2069 6e64 6578 5072 6f76 6964       indexProvid
+00009a20: 6564 203d 2046 616c 7365 0a20 2020 2020  ed = False.     
+00009a30: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
+00009a40: 6b65 7973 2920 3d3d 2031 3a0a 2020 2020  keys) == 1:.    
+00009a50: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00009a60: 7850 726f 7669 6465 6420 3d20 4661 6c73  xProvided = Fals
+00009a70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00009a80: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
+00009a90: 6d61 6765 4974 656d 5469 6d65 506f 696e  mageItemTimePoin
+00009aa0: 7473 203d 2069 7465 6d73 5b6b 6579 735b  ts = items[keys[
+00009ab0: 305d 5d0a 0a20 2020 2020 2020 2020 2020  0]]..           
+00009ac0: 2069 6620 696e 6465 7850 726f 7669 6465   if indexProvide
+00009ad0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00009ae0: 2020 2023 2069 6620 6b65 7920 6973 2077     # if key is w
+00009af0: 686f 6c65 2069 6d61 6765 2061 6464 2061  hole image add a
+00009b00: 6c6c 2076 616c 7565 7320 6672 6f6d 2068  ll values from h
+00009b10: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
+00009b20: 2020 2020 2020 6966 206c 656e 286b 6579        if len(key
+00009b30: 7329 203d 3d20 323a 0a20 2020 2020 2020  s) == 2:.       
+00009b40: 2020 2020 2020 2020 2020 2020 2064 6566               def
+00009b50: 6175 6c74 5661 6c20 3d20 6865 6164 6572  aultVal = header
+00009b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b70: 2023 2061 6464 2064 6566 6175 6c74 2066   # add default f
+00009b80: 726f 6d20 696e 6465 7820 300a 2020 2020  rom index 0.    
+00009b90: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00009ba0: 656e 286b 6579 7329 203e 2031 2061 6e64  en(keys) > 1 and
+00009bb0: 2069 6e64 6578 2021 3d20 303a 0a20 2020   index != 0:.   
+00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bd0: 206b 6579 735f 3020 3d20 636f 7079 2e64   keys_0 = copy.d
+00009be0: 6565 7063 6f70 7928 6b65 7973 290a 2020  eepcopy(keys).  
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 2020 6b65 7973 5f30 5b31 5d20 3d20 300a    keys_0[1] = 0.
+00009c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c20: 2020 2020 7265 745f 3020 3d20 6946 444f      ret_0 = iFDO
+00009c30: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
+00009c40: 6974 656d 732c 6b65 7973 5f30 2c73 6b69  items,keys_0,ski
+00009c50: 7070 6564 496e 4865 6164 6572 2c64 6566  ppedInHeader,def
+00009c60: 6175 6c74 5661 6c29 0a20 2020 2020 2020  aultVal).       
+00009c70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00009c80: 6973 696e 7374 616e 6365 2872 6574 5f30  isinstance(ret_0
+00009c90: 2c64 6963 7429 3a0a 2020 2020 2020 2020  ,dict):.        
+00009ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009cb0: 6465 6661 756c 7456 616c 203d 207b 2a2a  defaultVal = {**
+00009cc0: 6465 6661 756c 7456 616c 2c2a 2a72 6574  defaultVal,**ret
+00009cd0: 5f30 7d0a 2020 2020 2020 2020 2020 2020  _0}.            
+00009ce0: 2020 2020 7265 7420 3d20 6946 444f 2e5f      ret = iFDO._
+00009cf0: 5f67 6574 4974 656d 5661 6c75 6528 6974  _getItemValue(it
+00009d00: 656d 732c 6b65 7973 2c73 6b69 7070 6564  ems,keys,skipped
+00009d10: 496e 4865 6164 6572 2c64 6566 6175 6c74  InHeader,default
+00009d20: 5661 6c29 0a20 2020 2020 2020 2020 2020  Val).           
+00009d30: 200a 2020 2020 2020 2020 2020 2020 656c   .            el
+00009d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00009d50: 2020 2020 2320 6966 206b 6579 2069 7320      # if key is 
+00009d60: 7768 6f6c 6520 696d 6167 6520 6164 6420  whole image add 
+00009d70: 616c 6c20 7661 6c75 6573 2066 726f 6d20  all values from 
+00009d80: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+00009d90: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
+00009da0: 7973 2920 3d3d 2031 3a0a 2020 2020 2020  ys) == 1:.      
+00009db0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00009dc0: 6661 756c 7456 616c 203d 2068 6561 6465  faultVal = heade
+00009dd0: 720a 0a20 2020 2020 2020 2020 2020 2020  r..             
+00009de0: 2020 2023 2070 6963 7475 7265 202d 3e20     # picture -> 
+00009df0: 6a75 7374 206f 6e65 2065 6e74 7279 2c20  just one entry, 
+00009e00: 696e 7365 7274 2069 6e64 6578 2030 0a20  insert index 0. 
+00009e10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009e20: 6620 6c65 6e28 696d 6167 6549 7465 6d54  f len(imageItemT
+00009e30: 696d 6550 6f69 6e74 7329 203d 3d20 313a  imePoints) == 1:
+00009e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e50: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
+00009e60: 5b30 3a31 5d20 2b20 5b30 5d20 2b20 6b65  [0:1] + [0] + ke
+00009e70: 7973 5b31 3a3a 5d0a 2020 2020 2020 2020  ys[1::].        
+00009e80: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+00009e90: 3d20 6946 444f 2e5f 5f67 6574 4974 656d  = iFDO.__getItem
+00009ea0: 5661 6c75 6528 6974 656d 732c 6b65 7973  Value(items,keys
+00009eb0: 2c73 6b69 7070 6564 496e 4865 6164 6572  ,skippedInHeader
+00009ec0: 2c64 6566 6175 6c74 5661 6c29 0a20 2020  ,defaultVal).   
+00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ee0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00009ef0: 2020 2320 7669 6465 6f20 2d3e 2072 6574    # video -> ret
+00009f00: 7572 6e20 7661 6c75 6573 2066 6f72 2065  urn values for e
+00009f10: 6163 6820 7469 6d65 2073 7461 6d70 0a20  ach time stamp. 
+00009f20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00009f30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00009f40: 2020 2020 2020 2020 2072 6574 203d 207b           ret = {
+00009f50: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00009f60: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00009f70: 616e 6765 286c 656e 2869 6d61 6765 4974  ange(len(imageIt
+00009f80: 656d 5469 6d65 506f 696e 7473 2929 3a0a  emTimePoints)):.
+00009f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fa0: 2020 2020 2020 2020 7469 6d65 506f 696e          timePoin
+00009fb0: 7444 6174 6120 3d20 696d 6167 6549 7465  tData = imageIte
+00009fc0: 6d54 696d 6550 6f69 6e74 735b 695d 0a20  mTimePoints[i]. 
 00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fe0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-00009ff0: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
-0000a000: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
-0000a010: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
-0000a020: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
-0000a050: 207b 2a2a 6465 6661 756c 7456 616c 2c2a   {**defaultVal,*
-0000a060: 2a72 6574 5b74 696d 6550 6f69 6e74 4461  *ret[timePointDa
-0000a070: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
-0000a080: 6d65 275d 5d7d 0a20 2020 2020 2020 2020  me']]}.         
+00009fe0: 2020 2020 2020 206b 6579 735f 6920 3d20         keys_i = 
+00009ff0: 6b65 7973 5b30 3a31 5d20 2b20 5b69 5d20  keys[0:1] + [i] 
+0000a000: 2b20 6b65 7973 5b31 3a3a 5d0a 2020 2020  + keys[1::].    
+0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a020: 2020 2020 7661 6c5f 6920 3d20 6946 444f      val_i = iFDO
+0000a030: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
+0000a040: 6974 656d 732c 6b65 7973 5f69 2c73 6b69  items,keys_i,ski
+0000a050: 7070 6564 496e 4865 6164 6572 2c64 6566  ppedInHeader,def
+0000a060: 6175 6c74 5661 6c29 0a20 2020 2020 2020  aultVal).       
+0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a080: 2023 2064 6566 6175 6c74 206f 6e6c 790a   # default only.
 0000a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0a0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0c0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0000a0d0: 5661 6c20 3d20 7265 745b 7469 6d65 506f  Val = ret[timePo
-0000a0e0: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000a0f0: 6174 6574 696d 6527 5d5d 0a0a 2020 2020  atetime']]..    
-0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a110: 2020 2020 6920 2b3d 2031 0a0a 2020 2020      i += 1..    
-0000a120: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000a130: 6528 7265 742c 6469 6374 2920 6f72 2069  e(ret,dict) or i
-0000a140: 7369 6e73 7461 6e63 6528 7265 742c 6c69  sinstance(ret,li
-0000a150: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0000a160: 2072 6574 203d 2063 6f70 792e 6465 6570   ret = copy.deep
-0000a170: 636f 7079 2872 6574 290a 2020 2020 2020  copy(ret).      
-0000a180: 2020 6966 2072 6574 203d 3d20 2222 206f    if ret == "" o
-0000a190: 7220 7265 7420 3d3d 207b 7d3a 0a20 2020  r ret == {}:.   
-0000a1a0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000a1b0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000a1c0: 6f6e 2822 6b65 7973 2064 6f20 6e6f 7420  on("keys do not 
-0000a1d0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
-0000a1e0: 7973 2929 0a20 2020 2020 2020 2072 6574  ys)).        ret
-0000a1f0: 7572 6e20 7265 740a 0a0a 2020 2020 4073  urn ret...    @s
-0000a200: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-0000a210: 6465 6620 5f5f 6765 7449 7465 6d56 616c  def __getItemVal
-0000a220: 7565 2869 7465 6d73 2c6b 6579 732c 736b  ue(items,keys,sk
-0000a230: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
-0000a240: 6661 756c 7456 616c 293a 0a20 2020 2020  faultVal):.     
-0000a250: 2020 200a 2020 2020 2020 2020 2320 696e     .        # in
-0000a260: 2063 6173 6520 6974 656d 2069 7320 6e6f   case item is no
-0000a270: 7420 6120 6c69 7374 2028 7368 6f75 6c64  t a list (should
-0000a280: 206e 6f74 2062 6520 706f 7373 6962 6c65   not be possible
-0000a290: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0000a2a0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0000a2b0: 735b 6b65 7973 5b30 5d5d 2c6c 6973 7429  s[keys[0]],list)
-0000a2c0: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
-0000a2d0: 656d 735b 6b65 7973 5b30 5d5d 203d 205b  ems[keys[0]] = [
-0000a2e0: 6974 656d 735b 6b65 7973 5b30 5d5d 5d0a  items[keys[0]]].
-0000a2f0: 0a20 2020 2020 2020 2069 7465 6d56 616c  .        itemVal
-0000a300: 7565 203d 2066 696e 6446 6965 6c64 2869  ue = findField(i
-0000a310: 7465 6d73 2c6b 6579 7329 0a0a 2020 2020  tems,keys)..    
-0000a320: 2020 2020 6966 2069 7465 6d56 616c 7565      if itemValue
-0000a330: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000a340: 2020 2020 7265 7420 3d20 6465 6661 756c      ret = defaul
-0000a350: 7456 616c 0a20 2020 2020 2020 2023 2069  tVal.        # i
-0000a360: 6e20 6361 7365 206f 6620 6469 6374 7320  n case of dicts 
-0000a370: 6a6f 696e 7420 6865 6164 6572 2061 6e64  joint header and
-0000a380: 2069 7465 6d20 6669 656c 6473 0a20 2020   item fields.   
-0000a390: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0000a3a0: 616e 6365 2869 7465 6d56 616c 7565 2c64  ance(itemValue,d
-0000a3b0: 6963 7429 2061 6e64 2064 6566 6175 6c74  ict) and default
-0000a3c0: 5661 6c20 213d 2022 223a 0a20 2020 2020  Val != "":.     
-0000a3d0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0000a3e0: 696e 7374 616e 6365 2864 6566 6175 6c74  instance(default
-0000a3f0: 5661 6c2c 6469 6374 293a 0a20 2020 2020  Val,dict):.     
-0000a400: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000a410: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-0000a420: 7469 6f6e 2822 4974 656d 2066 6965 6c64  tion("Item field
-0000a430: 2069 7320 6469 6374 2062 7574 2064 6566   is dict but def
-0000a440: 6175 6c74 2076 616c 7565 2069 6e20 6865  ault value in he
-0000a450: 6164 6572 2069 7320 6e6f 743a 2022 202b  ader is not: " +
-0000a460: 2073 7472 286b 6579 7329 290a 2020 2020   str(keys)).    
-0000a470: 2020 2020 2020 2020 7265 7420 3d20 7b2a          ret = {*
-0000a480: 2a64 6566 6175 6c74 5661 6c2c 2a2a 6974  *defaultVal,**it
-0000a490: 656d 5661 6c75 657d 0a20 2020 2020 2020  emValue}.       
-0000a4a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a4b0: 2020 2072 6574 203d 2069 7465 6d56 616c     ret = itemVal
-0000a4c0: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
-0000a4d0: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
-0000a4e0: 5f5f 7374 725f 5f28 7365 6c66 2920 2d3e  __str__(self) ->
-0000a4f0: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-0000a500: 2220 5072 696e 7473 2063 7572 7265 6e74  " Prints current
-0000a510: 2069 4644 4f20 6669 6c65 2022 2222 0a20   iFDO file """. 
-0000a520: 2020 2020 2020 2072 6574 7572 6e20 7961         return ya
-0000a530: 6d6c 2e64 756d 7028 7365 6c66 2e69 6664  ml.dump(self.ifd
-0000a540: 6f5f 6368 6563 6b65 642c 2064 6566 6175  o_checked, defau
-0000a550: 6c74 5f73 7479 6c65 3d4e 6f6e 652c 2064  lt_style=None, d
-0000a560: 6566 6175 6c74 5f66 6c6f 775f 7374 796c  efault_flow_styl
-0000a570: 653d 4e6f 6e65 2c20 616c 6c6f 775f 756e  e=None, allow_un
-0000a580: 6963 6f64 653d 5472 7565 2c20 7769 6474  icode=True, widt
-0000a590: 683d 666c 6f61 7428 2269 6e66 2229 290a  h=float("inf")).
-0000a5a0: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
-0000a5b0: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7973  tem__(self, keys
-0000a5c0: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
-0000a5d0: 6574 7572 6e73 2063 6f70 7920 6f66 2063  eturns copy of c
-0000a5e0: 6865 636b 6564 2069 6664 6f20 7365 7420  hecked ifdo set 
-0000a5f0: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
-0000a600: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
-0000a610: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
-0000a620: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
-0000a630: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-0000a640: 206b 6579 7320 6173 2065 2e67 2e20 273c   keys as e.g. '<
-0000a650: 6974 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27  item>:<key>:...'
-0000a660: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
-0000a670: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
-0000a680: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
-0000a690: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
-0000a6a0: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
-0000a6b0: 616e 2062 6520 6c65 676c 6563 7465 642c  an be leglected,
-0000a6c0: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
-0000a6d0: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
-0000a6e0: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
-0000a6f0: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
-0000a700: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
-0000a710: 2052 6169 7365 7320 4966 646f 4578 6365   Raises IfdoExce
-0000a720: 7074 696f 6e20 6966 2069 7465 6d20 646f  ption if item do
-0000a730: 6573 206e 6f74 2065 7869 7374 2e20 2222  es not exist. ""
-0000a740: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
-0000a750: 206b 6579 732e 7370 6c69 7428 273a 2729   keys.split(':')
-0000a760: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000a770: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
-0000a780: 616c 7565 2873 656c 662e 6966 646f 5f63  alue(self.ifdo_c
-0000a790: 6865 636b 6564 2c6b 6579 7329 0a0a 0a20  hecked,keys)... 
-0000a7a0: 2020 2064 6566 2066 696e 6454 6d70 4669     def findTmpFi
-0000a7b0: 656c 6428 7365 6c66 2c6b 6579 7329 3a0a  eld(self,keys):.
-0000a7c0: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
-0000a7d0: 726e 7320 636f 7079 206f 6620 7465 6d70  rns copy of temp
-0000a7e0: 6f72 6172 7920 756e 6368 6563 6b65 6420  orary unchecked 
-0000a7f0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
-0000a800: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
-0000a810: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
-0000a820: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
-0000a830: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
-0000a840: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
-0000a850: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
-0000a860: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
-0000a870: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
-0000a880: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
-0000a890: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
-0000a8a0: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
-0000a8b0: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
-0000a8c0: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
-0000a8d0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
-0000a8e0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
-0000a8f0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
-0000a900: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-0000a910: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
-0000a920: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
-0000a930: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
-0000a940: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
-0000a950: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
-0000a960: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0000a970: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-0000a980: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
-0000a990: 6c66 2e69 6664 6f5f 746d 702c 6b65 7973  lf.ifdo_tmp,keys
-0000a9a0: 290a 2020 2020 0a0a 2020 2020 6465 6620  ).    ..    def 
-0000a9b0: 6669 6e64 546d 7046 6965 6c64 3228 7365  findTmpField2(se
-0000a9c0: 6c66 2c6b 6579 7329 3a0a 2020 2020 2020  lf,keys):.      
-0000a9d0: 2020 2222 2220 5361 6d65 2061 7320 6669    """ Same as fi
-0000a9e0: 6e64 546d 7046 6965 6c64 2069 6e73 7465  ndTmpField inste
-0000a9f0: 6164 206f 6620 7261 6973 696e 6720 6578  ad of raising ex
-0000aa00: 6365 7074 696f 6e20 6974 2072 6574 7572  ception it retur
-0000aa10: 6e20 656d 7074 7920 7374 7269 6e67 2e20  n empty string. 
-0000aa20: 2222 220a 2020 2020 2020 2020 6b65 7973  """.        keys
-0000aa30: 203d 206b 6579 732e 7370 6c69 7428 273a   = keys.split(':
-0000aa40: 2729 0a20 2020 2020 2020 2074 7279 3a0a  ').        try:.
-0000aa50: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-0000aa60: 3d20 7365 6c66 2e5f 5f67 6574 4669 656c  = self.__getFiel
-0000aa70: 6456 616c 7565 2873 656c 662e 6966 646f  dValue(self.ifdo
-0000aa80: 5f74 6d70 2c6b 6579 7329 0a20 2020 2020  _tmp,keys).     
-0000aa90: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
-0000aaa0: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
-0000aab0: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0000aac0: 2022 220a 2020 2020 2020 2020 7265 7475   "".        retu
-0000aad0: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
-0000aae0: 2073 6574 6946 444f 4865 6164 6572 4669   setiFDOHeaderFi
-0000aaf0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
-0000ab00: 723a 2064 6963 7429 3a0a 2020 2020 2020  r: dict):.      
-0000ab10: 2020 2222 2220 436c 6561 7273 2063 7572    """ Clears cur
-0000ab20: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
-0000ab30: 6473 2075 6e64 2073 6574 7320 7072 6f76  ds und sets prov
-0000ab40: 6964 6564 2066 6965 6c64 2076 616c 7565  ided field value
-0000ab50: 732e 2046 6f72 2075 7064 6174 696e 6720  s. For updating 
-0000ab60: 6578 6973 7469 6e67 206f 6e65 7320 7573  existing ones us
-0000ab70: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
-0000ab80: 6164 6572 5f66 6965 6c64 7328 2920 2222  ader_fields() ""
-0000ab90: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
-0000aba0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000abb0: 6765 5365 7448 6561 6465 724b 6579 5d20  geSetHeaderKey] 
-0000abc0: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-0000abd0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000abe0: 6465 724b 6579 2069 6e20 6865 6164 6572  derKey in header
-0000abf0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-0000ac00: 6164 6572 203d 2068 6561 6465 725b 7365  ader = header[se
-0000ac10: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000ac20: 724b 6579 5d0a 2020 2020 2020 2020 666f  rKey].        fo
-0000ac30: 7220 6669 656c 6420 696e 2068 6561 6465  r field in heade
-0000ac40: 723a 0a20 2020 2020 2020 2020 2020 2023  r:.            #
-0000ac50: 6966 2066 6965 6c64 206e 6f74 2069 6e20  if field not in 
-0000ac60: 6d69 7174 762e 6966 646f 5f68 6561 6465  miqtv.ifdo_heade
-0000ac70: 725f 636f 7265 5f66 6965 6c64 733a 0a20  r_core_fields:. 
-0000ac80: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000ac90: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000aca0: 6175 7469 6f6e 3a20 556e 6b6e 6f77 6e20  aution: Unknown 
-0000acb0: 6865 6164 6572 2066 6965 6c64 205c 2222  header field \""
-0000acc0: 202b 2066 6965 6c64 202b 2022 5c22 2e20   + field + "\". 
-0000acd0: 4d61 7962 6520 6120 7479 706f 3f20 4f74  Maybe a typo? Ot
-0000ace0: 6865 7277 6973 6520 6967 6e6f 7265 206d  herwise ignore m
-0000acf0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
-0000ad00: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000ad10: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000ad20: 6572 4b65 795d 5b66 6965 6c64 5d20 3d20  erKey][field] = 
-0000ad30: 6865 6164 6572 5b66 6965 6c64 5d0a 0a0a  header[field]...
-0000ad40: 2020 2020 6465 6620 7570 6461 7465 5f69      def update_i
-0000ad50: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
-0000ad60: 7328 7365 6c66 2c20 6865 6164 6572 3a20  s(self, header: 
-0000ad70: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
-0000ad80: 2222 2055 7064 6174 6573 2065 7869 7374  "" Updates exist
-0000ad90: 696e 6720 6865 6164 6572 2066 6965 6c64  ing header field
-0000ada0: 7320 2222 220a 2020 2020 2020 2020 6966  s """.        if
-0000adb0: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
-0000adc0: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
-0000add0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
-0000ade0: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
-0000adf0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000ae00: 6572 4b65 795d 0a20 2020 2020 2020 206c  erKey].        l
-0000ae10: 6f67 203d 206d 6971 7463 2e72 6563 7572  og = miqtc.recur
-0000ae20: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
-0000ae30: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
-0000ae40: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000ae50: 6465 724b 6579 5d2c 2068 6561 6465 7229  derKey], header)
-0000ae60: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-0000ae70: 6f76 2e6c 6f67 286c 6f67 2c64 6f6e 7453  ov.log(log,dontS
-0000ae80: 686f 773d 5472 7565 290a 0a20 2020 2064  how=True)..    d
-0000ae90: 6566 2075 7064 6174 6569 4644 4f48 6561  ef updateiFDOHea
-0000aea0: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
-0000aeb0: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
-0000aec0: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
-0000aed0: 6361 7465 6420 2d20 7573 6520 7570 6461  cated - use upda
-0000aee0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
-0000aef0: 6965 6c64 7320 2222 220a 2020 2020 2020  ields """.      
-0000af00: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
-0000af10: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
-0000af20: 2868 6561 6465 7229 0a0a 0a20 2020 2064  (header)...    d
-0000af30: 6566 205f 7472 795f 7570 6772 6164 655f  ef _try_upgrade_
-0000af40: 746f 5f69 6664 6f5f 7665 7273 696f 6e5f  to_ifdo_version_
-0000af50: 3278 2873 656c 6629 3a0a 2020 2020 2020  2x(self):.      
-0000af60: 2020 2222 2220 5472 7920 746f 2063 6f6e    """ Try to con
-0000af70: 7665 7274 2066 6965 6c64 7320 6672 6f6d  vert fields from
-0000af80: 2069 4644 4f20 7665 7273 696f 6e20 3c20   iFDO version < 
-0000af90: 322e 302e 3020 746f 2032 2e78 2022 2222  2.0.0 to 2.x """
-0000afa0: 0a20 2020 2020 2020 2072 6561 645f 7665  .        read_ve
-0000afb0: 7273 696f 6e5f 7374 7220 3d20 2276 312e  rsion_str = "v1.
-0000afc0: 302e 3022 2023 2064 6964 206e 6f74 2068  0.0" # did not h
-0000afd0: 6176 6520 7468 6520 2769 6d61 6765 2d73  ave the 'image-s
-0000afe0: 6574 2d69 6664 6f2d 7665 7273 696f 6e27  et-ifdo-version'
-0000aff0: 2066 6965 6c64 2079 6574 0a20 2020 2020   field yet.     
-0000b000: 2020 2074 7279 3a20 0a20 2020 2020 2020     try: .       
-0000b010: 2020 2020 2072 6561 645f 7665 7273 696f       read_versio
-0000b020: 6e5f 7374 7220 3d20 7365 6c66 2e66 696e  n_str = self.fin
-0000b030: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
-0000b040: 2d73 6574 2d69 6664 6f2d 7665 7273 696f  -set-ifdo-versio
-0000b050: 6e27 290a 2020 2020 2020 2020 6578 6365  n').        exce
-0000b060: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-0000b070: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-0000b080: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-0000b090: 2072 6561 645f 7665 7273 696f 6e20 3d20   read_version = 
-0000b0a0: 5665 7273 696f 6e28 7265 6164 5f76 6572  Version(read_ver
-0000b0b0: 7369 6f6e 5f73 7472 290a 0a20 2020 2020  sion_str)..     
-0000b0c0: 2020 2069 6620 7265 6164 5f76 6572 7369     if read_versi
-0000b0d0: 6f6e 203c 2056 6572 7369 6f6e 2822 322e  on < Version("2.
-0000b0e0: 302e 3022 293a 0a20 2020 2020 2020 2020  0.0"):.         
-0000b0f0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0000b100: 2320 6e65 7720 5552 4920 6f62 6a65 6374  # new URI object
-0000b110: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
-0000b120: 2020 2020 6e65 775f 7572 695f 6669 656c      new_uri_fiel
-0000b130: 6473 203d 205b 2769 6d61 6765 2d73 656e  ds = ['image-sen
-0000b140: 736f 7227 2c27 696d 6167 652d 6576 656e  sor','image-even
-0000b150: 7427 2c27 696d 6167 652d 7072 6f6a 6563  t','image-projec
-0000b160: 7427 2c27 696d 6167 652d 636f 6e74 6578  t','image-contex
-0000b170: 7427 2c27 696d 6167 652d 6c69 6365 6e73  t','image-licens
-0000b180: 6527 2c27 696d 6167 652d 706c 6174 666f  e','image-platfo
-0000b190: 726d 275d 0a20 2020 2020 2020 2020 2020  rm'].           
-0000b1a0: 2066 6f72 2075 7269 5f66 6965 6c64 2069   for uri_field i
-0000b1b0: 6e20 6e65 775f 7572 695f 6669 656c 6473  n new_uri_fields
-0000b1c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b1d0: 2020 6f6c 645f 7374 725f 7661 6c20 3d20    old_str_val = 
-0000b1e0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000b1f0: 6432 2875 7269 5f66 6965 6c64 290a 2020  d2(uri_field).  
-0000b200: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b210: 2069 7369 6e73 7461 6e63 6528 6f6c 645f   isinstance(old_
-0000b220: 7374 725f 7661 6c2c 7374 7229 2061 6e64  str_val,str) and
-0000b230: 206f 6c64 5f73 7472 5f76 616c 2021 3d20   old_str_val != 
-0000b240: 2222 3a20 2020 2020 2020 2020 2020 2020  "":             
-0000b250: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000b260: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000b270: 6f62 6a5f 7661 6c20 3d20 7b27 6e61 6d65  obj_val = {'name
-0000b280: 273a 206f 6c64 5f73 7472 5f76 616c 7d0a  ': old_str_val}.
-0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2a0: 2020 2020 6973 5f75 7269 2c20 6d73 6720      is_uri, msg 
-0000b2b0: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
-0000b2c0: 5f61 6761 696e 7374 5f73 6368 656d 6128  _against_schema(
-0000b2d0: 6f6c 645f 7374 725f 7661 6c2c 7b22 7479  old_str_val,{"ty
-0000b2e0: 7065 223a 2022 7374 7269 6e67 222c 2266  pe": "string","f
-0000b2f0: 6f72 6d61 7422 3a20 2275 7269 227d 290a  ormat": "uri"}).
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b310: 2020 2020 6966 2069 735f 7572 693a 0a20      if is_uri:. 
-0000b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b330: 2020 2020 2020 206e 6577 5f6f 626a 5f76         new_obj_v
-0000b340: 616c 5b27 7572 6927 5d20 3d20 6f6c 645f  al['uri'] = old_
-0000b350: 7374 725f 7661 6c0a 2020 2020 2020 2020  str_val.        
-0000b360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b370: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000b380: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000b390: 5d5b 7572 695f 6669 656c 645d 203d 206e  ][uri_field] = n
-0000b3a0: 6577 5f6f 626a 5f76 616c 0a20 2020 2020  ew_obj_val.     
-0000b3b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b3c0: 656c 662e 7072 6f76 2e6c 6f67 2822 4175  elf.prov.log("Au
-0000b3d0: 746f 2d75 7067 7261 6465 6420 2220 2b20  to-upgraded " + 
-0000b3e0: 7572 695f 6669 656c 6420 2b20 2220 6672  uri_field + " fr
-0000b3f0: 6f6d 2022 202b 206f 6c64 5f73 7472 5f76  om " + old_str_v
-0000b400: 616c 202b 2022 2074 6f20 2220 2b20 7374  al + " to " + st
-0000b410: 7228 6e65 775f 6f62 6a5f 7661 6c29 290a  r(new_obj_val)).
-0000b420: 0a0a 0a20 2020 2064 6566 2074 7279 4175  ...    def tryAu
-0000b430: 746f 5365 7448 6561 6465 7246 6965 6c64  toSetHeaderField
-0000b440: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000b450: 2022 2222 2053 6574 7320 6365 7274 6169   """ Sets certai
-0000b460: 6e20 6865 6164 6572 2066 6965 6c64 7320  n header fields 
-0000b470: 652e 672e 2066 726f 6d20 6469 7265 6374  e.g. from direct
-0000b480: 6f72 7920 6966 2074 6865 7920 6172 6520  ory if they are 
-0000b490: 6e6f 7420 7365 7420 7965 7420 2222 220a  not set yet """.
-0000b4a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000b4b0: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
-0000b4c0: 696d 6167 652d 7365 6e73 6f72 2729 203d  image-sensor') =
-0000b4d0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000b4e0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000b4f0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b500: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000b510: 656e 736f 7227 5d20 3d20 7b27 6e61 6d65  ensor'] = {'name
-0000b520: 273a 2073 656c 662e 6469 722e 7365 6e73  ': self.dir.sens
-0000b530: 6f72 2829 7d0a 2020 2020 2020 2020 656c  or()}.        el
-0000b540: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
-0000b550: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
-0000b560: 6f72 2729 5b27 6e61 6d65 275d 2021 3d20  or')['name'] != 
-0000b570: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
-0000b580: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000b590: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-0000b5a0: 7574 696f 6e3a 2027 696d 6167 652d 7365  ution: 'image-se
-0000b5b0: 6e73 6f72 2720 222b 2073 7472 2873 656c  nsor' "+ str(sel
-0000b5c0: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
-0000b5d0: 696d 6167 652d 7365 6e73 6f72 2729 2920  image-sensor')) 
-0000b5e0: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
-0000b5f0: 2073 656e 736f 7220 7061 7273 6564 2066   sensor parsed f
-0000b600: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
-0000b610: 202b 2073 656c 662e 6469 722e 7365 6e73   + self.dir.sens
-0000b620: 6f72 2829 290a 0a20 2020 2020 2020 2069  or())..        i
-0000b630: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
-0000b640: 656c 6432 2827 696d 6167 652d 6576 656e  eld2('image-even
-0000b650: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
-0000b660: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000b670: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000b680: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000b690: 6167 652d 6576 656e 7427 5d20 3d20 7b27  age-event'] = {'
-0000b6a0: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-0000b6b0: 6576 656e 7428 297d 0a20 2020 2020 2020  event()}.       
-0000b6c0: 2065 6c69 6620 7365 6c66 2e66 696e 6454   elif self.findT
-0000b6d0: 6d70 4669 656c 6428 2769 6d61 6765 2d65  mpField('image-e
-0000b6e0: 7665 6e74 2729 5b27 6e61 6d65 275d 2021  vent')['name'] !
-0000b6f0: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
-0000b700: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000b710: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000b720: 6175 7469 6f6e 3a20 2769 6d61 6765 2d65  aution: 'image-e
-0000b730: 7665 6e74 2720 2220 2b20 7374 7228 7365  vent' " + str(se
-0000b740: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000b750: 2769 6d61 6765 2d65 7665 6e74 2729 2920  'image-event')) 
-0000b760: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
-0000b770: 2065 7665 6e74 2070 6172 7365 6420 6672   event parsed fr
-0000b780: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
-0000b790: 2b20 7365 6c66 2e64 6972 2e65 7665 6e74  + self.dir.event
-0000b7a0: 2829 290a 0a20 2020 2020 2020 2069 6620  ())..        if 
-0000b7b0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000b7c0: 6432 2827 696d 6167 652d 7072 6f6a 6563  d2('image-projec
-0000b7d0: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
-0000b7e0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000b7f0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000b800: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000b810: 6167 652d 7072 6f6a 6563 7427 5d20 3d20  age-project'] = 
-0000b820: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
-0000b830: 6972 2e70 726f 6a65 6374 2829 7d0a 2020  ir.project()}.  
-0000b840: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0000b850: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-0000b860: 6167 652d 7072 6f6a 6563 7427 295b 276e  age-project')['n
-0000b870: 616d 6527 5d20 213d 2073 656c 662e 6469  ame'] != self.di
-0000b880: 722e 7072 6f6a 6563 7428 293a 0a20 2020  r.project():.   
-0000b890: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000b8a0: 6f76 2e6c 6f67 2822 4361 7574 696f 6e3a  ov.log("Caution:
-0000b8b0: 2027 696d 6167 652d 7072 6f6a 6563 7427   'image-project'
-0000b8c0: 2022 202b 2073 7472 2873 656c 662e 6669   " + str(self.fi
-0000b8d0: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000b8e0: 652d 7072 6f6a 6563 7427 2929 202b 2022  e-project')) + "
-0000b8f0: 2064 6966 6665 7273 2066 726f 6d20 7072   differs from pr
-0000b900: 6f6a 6563 7420 7061 7273 6564 2066 726f  oject parsed fro
-0000b910: 6d20 6469 7265 6374 6f72 793a 2022 202b  m directory: " +
-0000b920: 2073 656c 662e 6469 722e 7072 6f6a 6563   self.dir.projec
-0000b930: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
-0000b940: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000b950: 6c64 3228 2769 6d61 6765 2d70 6c61 7466  ld2('image-platf
-0000b960: 6f72 6d27 2920 3d3d 2022 2220 616e 6420  orm') == "" and 
-0000b970: 7365 6c66 2e64 6972 2e67 6561 7228 2920  self.dir.gear() 
-0000b980: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-0000b990: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000b9a0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000b9b0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000b9c0: 706c 6174 666f 726d 275d 203d 207b 276e  platform'] = {'n
-0000b9d0: 616d 6527 3a20 7365 6c66 2e64 6972 2e67  ame': self.dir.g
-0000b9e0: 6561 7228 297d 0a0a 2020 2020 2020 2020  ear()}..        
-0000b9f0: 6966 206e 6f74 2027 696d 6167 652d 7365  if not 'image-se
-0000ba00: 742d 7575 6964 2720 696e 2073 656c 662e  t-uuid' in self.
-0000ba10: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000ba20: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000ba30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000ba40: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000ba50: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000ba60: 6579 5d5b 2769 6d61 6765 2d73 6574 2d75  ey]['image-set-u
-0000ba70: 7569 6427 5d20 3d20 7374 7228 6d69 7174  uid'] = str(miqt
-0000ba80: 632e 7575 6964 3428 2929 0a20 2020 2020  c.uuid4()).     
-0000ba90: 2020 2069 6620 6e6f 7420 2769 6d61 6765     if not 'image
-0000baa0: 2d73 6574 2d68 616e 646c 6527 2069 6e20  -set-handle' in 
-0000bab0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000bac0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000bad0: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
-0000bae0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000baf0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000bb00: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000bb10: 7365 742d 6861 6e64 6c65 275d 203d 2073  set-handle'] = s
-0000bb20: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
-0000bb30: 7820 2b20 222f 2220 2b20 7365 6c66 2e66  x + "/" + self.f
-0000bb40: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
-0000bb50: 6765 2d73 6574 2d75 7569 6427 290a 2020  ge-set-uuid').  
-0000bb60: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
-0000bb70: 6167 652d 7365 742d 6e61 6d65 2720 696e  age-set-name' in
-0000bb80: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000bb90: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000bba0: 6572 4b65 795d 206f 7220 7365 6c66 2e66  erKey] or self.f
-0000bbb0: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
-0000bbc0: 6167 652d 7365 742d 6e61 6d65 2729 203d  age-set-name') =
-0000bbd0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000bbe0: 2020 2320 636f 6e73 7472 7563 7420 6173    # construct as
-0000bbf0: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
-0000bc00: 743e 5f3c 7365 6e73 6f72 3e0a 2020 2020  t>_<sensor>.    
-0000bc10: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
-0000bc20: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
-0000bc30: 6965 6c64 3228 2269 6d61 6765 2d70 726f  ield2("image-pro
-0000bc40: 6a65 6374 2229 5b27 6e61 6d65 275d 0a20  ject")['name']. 
-0000bc50: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-0000bc60: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
-0000bc70: 4669 656c 6432 2822 696d 6167 652d 6576  Field2("image-ev
-0000bc80: 656e 7422 295b 276e 616d 6527 5d0a 2020  ent")['name'].  
-0000bc90: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
-0000bca0: 6e74 5f20 3d3d 2022 223a 0a20 2020 2020  nt_ == "":.     
-0000bcb0: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-0000bcc0: 5f20 3d20 7365 6c66 2e64 6972 2e65 7665  _ = self.dir.eve
-0000bcd0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-0000bce0: 2073 656e 736f 725f 203d 2073 656c 662e   sensor_ = self.
-0000bcf0: 6669 6e64 546d 7046 6965 6c64 3228 2269  findTmpField2("i
-0000bd00: 6d61 6765 2d73 656e 736f 7222 295b 276e  mage-sensor")['n
-0000bd10: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-0000bd20: 2020 6966 2073 656e 736f 725f 203d 3d20    if sensor_ == 
-0000bd30: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-0000bd40: 2020 2020 7365 6e73 6f72 5f20 3d20 7365      sensor_ = se
-0000bd50: 6c66 2e64 6972 2e73 656e 736f 7228 290a  lf.dir.sensor().
-0000bd60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000bd70: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000bd80: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000bd90: 5d5b 2769 6d61 6765 2d73 6574 2d6e 616d  ]['image-set-nam
-0000bda0: 6527 5d20 3d20 6946 444f 2e63 6f6e 7374  e'] = iFDO.const
-0000bdb0: 7275 6374 496d 6167 6553 6574 4e61 6d65  ructImageSetName
-0000bdc0: 2870 726f 6a65 6374 5f2c 6576 656e 745f  (project_,event_
-0000bdd0: 2c73 656e 736f 725f 290a 0a20 2020 2020  ,sensor_)..     
-0000bde0: 2020 2023 2073 6574 2076 6572 7369 6f6e     # set version
-0000bdf0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
-0000be00: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000be10: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0000be20: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
-0000be30: 6572 7369 6f6e 275d 203d 206d 6971 7476  ersion'] = miqtv
-0000be40: 2e69 4644 4f5f 7665 7273 696f 6e0a 0a0a  .iFDO_version...
-0000be50: 2020 2020 6465 6620 7365 7448 6561 6465      def setHeade
-0000be60: 7249 6d61 6765 4c6f 6361 6c50 6174 6846  rImageLocalPathF
-0000be70: 6965 6c64 2873 656c 6629 3a0a 2020 2020  ield(self):.    
-0000be80: 2020 2020 2222 2220 5365 7473 2068 6561      """ Sets hea
-0000be90: 6465 7220 6669 656c 6420 2769 6d61 6765  der field 'image
-0000bea0: 2d6c 6f63 616c 2d70 6174 6827 2066 726f  -local-path' fro
-0000beb0: 6d20 696d 6167 6520 6469 7220 2222 220a  m image dir """.
-0000bec0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000bed0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000bee0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000bef0: 6d61 6765 2d6c 6f63 616c 2d70 6174 6827  mage-local-path'
-0000bf00: 5d20 3d20 6f73 2e70 6174 682e 7265 6c70  ] = os.path.relp
-0000bf10: 6174 6828 7365 6c66 2e69 6d61 6765 7344  ath(self.imagesD
-0000bf20: 6972 2c20 6f73 2e70 6174 682e 6469 726e  ir, os.path.dirn
-0000bf30: 616d 6528 7365 6c66 2e67 6574 6946 444f  ame(self.getiFDO
-0000bf40: 4669 6c65 4e61 6d65 2829 2929 0a0a 0a20  FileName()))... 
-0000bf50: 2020 2064 6566 2063 7265 6174 655f 6669     def create_fi
-0000bf60: 656c 6473 2873 656c 662c 2061 6c6c 6f77  elds(self, allow
-0000bf70: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-0000bf80: 643d 4661 6c73 6529 3a0a 2020 2020 2020  d=False):.      
-0000bf90: 2020 2222 2220 4372 6561 7465 2061 6e64    """ Create and
-0000bfa0: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
-0000bfb0: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
-0000bfc0: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
-0000bfd0: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
-0000bfe0: 6520 6669 6c65 732e 204f 7665 7277 7269  e files. Overwri
-0000bff0: 7465 7320 6578 6973 7469 6e67 2066 6965  tes existing fie
-0000c000: 6c64 732e 2022 2222 0a20 2020 2020 2020  lds. """.       
-0000c010: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
-0000c020: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
-0000c030: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000c040: 7465 5f66 696c 6573 2829 0a20 2020 2020  te_files().     
-0000c050: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
-0000c060: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
-0000c070: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000c080: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0000c090: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
-0000c0a0: 7328 292c 2061 6c6c 6f77 5f6d 6973 7369  s(), allow_missi
-0000c0b0: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
-0000c0c0: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-0000c0d0: 6564 290a 0a0a 2020 2020 6465 6620 7570  ed)...    def up
-0000c0e0: 6461 7465 5f66 6965 6c64 7328 7365 6c66  date_fields(self
-0000c0f0: 293a 0a20 2020 2020 2020 2022 2222 2055  ):.        """ U
-0000c100: 7064 6174 6520 616e 6420 7661 6c69 6461  pdate and valida
-0000c110: 7465 2063 7572 7265 6e74 2068 6561 6465  te current heade
-0000c120: 7220 6669 656c 6473 2061 6e64 2069 7465  r fields and ite
-0000c130: 6d20 6669 656c 6473 2066 726f 6d20 696e  m fields from in
-0000c140: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
-0000c150: 2e20 2222 220a 2020 2020 2020 2020 6974  . """.        it
-0000c160: 656d 5f64 6174 6120 3d20 7365 6c66 2e5f  em_data = self._
-0000c170: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
-0000c180: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
-0000c190: 6669 6c65 7328 290a 2020 2020 2020 2020  files().        
-0000c1a0: 7265 7475 726e 2073 656c 662e 7570 6461  return self.upda
-0000c1b0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
-0000c1c0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000c1d0: 6574 4865 6164 6572 4b65 795d 2c20 6974  etHeaderKey], it
-0000c1e0: 656d 5f64 6174 612e 7661 6c75 6573 2829  em_data.values()
-0000c1f0: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
-0000c200: 7465 436f 7265 4669 656c 6473 2873 656c  teCoreFields(sel
-0000c210: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-0000c220: 4445 5052 4543 4144 4554 2c20 7573 6520  DEPRECADET, use 
-0000c230: 6372 6561 7465 5f66 6965 6c64 7328 2920  create_fields() 
-0000c240: 6f72 2075 7064 6174 655f 6669 656c 6473  or update_fields
-0000c250: 2829 2069 6e73 7465 642e 0a20 2020 2020  () insted..     
-0000c260: 2020 2046 696c 6c73 2074 6865 2069 4644     Fills the iFD
-0000c270: 4f20 636f 7265 2066 6965 6c64 7320 6672  O core fields fr
-0000c280: 6f6d 2069 6e74 6572 6d65 6469 6174 6520  om intermediate 
-0000c290: 6669 6c65 732e 2057 6974 686f 7574 2074  files. Without t
-0000c2a0: 6865 6d20 6e6f 2076 616c 6964 2069 4644  hem no valid iFD
-0000c2b0: 4f20 6361 6e20 6265 2063 7265 6174 6564  O can be created
-0000c2c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000c2d0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
-0000c2e0: 3d20 7365 6c66 2e5f 6765 745f 6974 656d  = self._get_item
-0000c2f0: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
-0000c300: 6d65 6469 6174 655f 6669 6c65 735f 636f  mediate_files_co
-0000c310: 7265 2829 0a20 2020 2020 2020 2023 2063  re().        # c
-0000c320: 6865 636b 2066 6965 6c64 7320 666f 7220  heck fields for 
-0000c330: 7661 6c69 6469 7479 0a20 2020 2020 2020  validity.       
-0000c340: 2023 2069 7465 6d5f 6461 7461 2063 6f6e   # item_data con
-0000c350: 7461 696e 7320 6669 656c 6420 696d 6167  tains field imag
-0000c360: 652d 6669 6c65 6e61 6d65 2c20 7768 6963  e-filename, whic
-0000c370: 6820 7768 6963 6820 7769 6c6c 206e 6f74  h which will not
-0000c380: 2062 6520 7374 6f72 6564 2061 7320 616e   be stored as an
-0000c390: 2069 7465 6d20 6669 656c 6420 696e 2069   item field in i
-0000c3a0: 464f 4420 6275 7420 6173 2074 6865 2069  FOD but as the i
-0000c3b0: 7465 6d20 6e61 6d65 2069 7473 656c 660a  tem name itself.
-0000c3c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000c3d0: 656c 662e 7570 6461 7465 6946 444f 2873  elf.updateiFDO(s
-0000c3e0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000c3f0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000c400: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
-0000c410: 7661 6c75 6573 2829 290a 0a0a 2020 2020  values())...    
-0000c420: 6465 6620 6372 6561 7465 4361 7074 7572  def createCaptur
-0000c430: 6541 6e64 436f 6e74 656e 7446 6965 6c64  eAndContentField
-0000c440: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000c450: 2022 2222 2044 4550 5245 4341 4445 542c   """ DEPRECADET,
-0000c460: 2075 7365 2063 7265 6174 655f 6669 656c   use create_fiel
-0000c470: 6473 2829 206f 7220 7570 6461 7465 5f66  ds() or update_f
-0000c480: 6965 6c64 7328 2920 696e 7374 6564 2e0a  ields() insted..
-0000c490: 2020 2020 2020 2020 4669 6c6c 7320 7468          Fills th
-0000c4a0: 6520 6946 444f 2063 6170 7574 7265 2061  e iFDO caputre a
-0000c4b0: 6e64 2063 6f6e 7465 6e74 2066 6965 6473  nd content fieds
-0000c4c0: 2066 726f 6d20 7072 6f76 6964 6564 2064   from provided d
-0000c4d0: 6174 6120 6669 656c 6473 200a 2020 2020  ata fields .    
-0000c4e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c4f0: 6974 656d 5f64 6174 6120 3d20 7365 6c66  item_data = self
-0000c500: 2e5f 6765 745f 6974 656d 5f64 6174 615f  ._get_item_data_
-0000c510: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000c520: 655f 6669 6c65 735f 6e6f 6e65 5f63 6f72  e_files_none_cor
-0000c530: 6528 290a 2020 2020 2020 2020 2320 6368  e().        # ch
-0000c540: 6563 6b20 6669 656c 6473 2066 6f72 2076  eck fields for v
-0000c550: 616c 6964 6974 790a 2020 2020 2020 2020  alidity.        
-0000c560: 2320 6974 656d 5f64 6174 6120 636f 6e74  # item_data cont
-0000c570: 6169 6e73 2066 6965 6c64 2069 6d61 6765  ains field image
-0000c580: 2d66 696c 656e 616d 652c 2077 6869 6368  -filename, which
-0000c590: 2077 6869 6368 2077 696c 6c20 6e6f 7420   which will not 
-0000c5a0: 6265 2073 746f 7265 6420 6173 2061 6e20  be stored as an 
-0000c5b0: 6974 656d 2066 6965 6c64 2069 6e20 6946  item field in iF
-0000c5c0: 4f44 2062 7574 2061 7320 7468 6520 6974  OD but as the it
-0000c5d0: 656d 206e 616d 6520 6974 7365 6c66 0a20  em name itself. 
-0000c5e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000c5f0: 6c66 2e75 7064 6174 6569 4644 4f28 7365  lf.updateiFDO(se
-0000c600: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000c610: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000c620: 6579 5d2c 2069 7465 6d5f 6461 7461 2e76  ey], item_data.v
-0000c630: 616c 7565 7328 2929 0a0a 2020 2020 0a20  alues())..    . 
-0000c640: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
-0000c650: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
-0000c660: 6d65 6469 6174 655f 6669 6c65 7328 7365  mediate_files(se
-0000c670: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000c680: 2052 6561 6420 6461 7461 2066 726f 6d20   Read data from 
-0000c690: 636f 7265 2061 6e64 206e 6f6e 652d 636f  core and none-co
-0000c6a0: 7265 2069 6e74 6572 6d64 6561 7465 2066  re intermdeate f
-0000c6b0: 696c 6573 2c20 6368 6563 6b20 6669 6c65  iles, check file
-0000c6c0: 7320 6578 6973 742c 2061 6464 2027 696d  s exist, add 'im
-0000c6d0: 6167 652d 6861 6e64 6c65 272e 0a20 2020  age-handle'..   
-0000c6e0: 2020 2020 2052 6574 7572 6e73 2064 6963       Returns dic
-0000c6f0: 7420 6f66 2066 6f72 6d20 7b69 6d61 6765  t of form {image
-0000c700: 2d66 696c 652d 6e61 6d65 3a7b 6669 656c  -file-name:{fiel
-0000c710: 643a 7661 6c75 657d 2c2e 2e2e 7d20 0a20  d:value},...} . 
-0000c720: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000c730: 2020 2069 7465 6d5f 6461 7461 5f63 6f72     item_data_cor
-0000c740: 6520 3d20 7365 6c66 2e5f 6765 745f 6974  e = self._get_it
-0000c750: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
-0000c760: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
-0000c770: 636f 7265 2829 0a20 2020 2020 2020 2069  core().        i
-0000c780: 7465 6d5f 6461 7461 5f6e 6f6e 655f 636f  tem_data_none_co
-0000c790: 7265 203d 2073 656c 662e 5f67 6574 5f69  re = self._get_i
-0000c7a0: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
-0000c7b0: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
-0000c7c0: 5f6e 6f6e 655f 636f 7265 2829 0a20 2020  _none_core().   
-0000c7d0: 2020 2020 2023 7070 7269 6e74 2869 7465       #pprint(ite
-0000c7e0: 6d5f 6461 7461 5f6e 6f6e 655f 636f 7265  m_data_none_core
-0000c7f0: 290a 2020 2020 2020 2020 2370 7072 696e  ).        #pprin
-0000c800: 7428 6974 656d 5f64 6174 615f 636f 7265  t(item_data_core
-0000c810: 290a 2020 2020 2020 2020 6974 656d 5f64  ).        item_d
-0000c820: 6174 6120 3d20 6974 656d 5f64 6174 615f  ata = item_data_
-0000c830: 636f 7265 0a20 2020 2020 2020 206c 6f67  core.        log
-0000c840: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
-0000c850: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
-0000c860: 6974 656d 5f64 6174 612c 2069 7465 6d5f  item_data, item_
-0000c870: 6461 7461 5f6e 6f6e 655f 636f 7265 290a  data_none_core).
-0000c880: 2020 2020 2020 2020 2370 7072 696e 7428          #pprint(
-0000c890: 6974 656d 5f64 6174 6129 0a20 2020 2020  item_data).     
-0000c8a0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000c8b0: 286c 6f67 2c64 6f6e 7453 686f 773d 5472  (log,dontShow=Tr
-0000c8c0: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-0000c8d0: 726e 2069 7465 6d5f 6461 7461 0a0a 2020  rn item_data..  
-0000c8e0: 2020 6465 6620 5f67 6574 5f69 7465 6d5f    def _get_item_
-0000c8f0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
-0000c900: 6564 6961 7465 5f66 696c 6573 5f6e 6f6e  ediate_files_non
-0000c910: 655f 636f 7265 2873 656c 6629 3a0a 2020  e_core(self):.  
-0000c920: 2020 2020 2020 2222 2220 5265 6164 2064        """ Read d
-0000c930: 6174 6120 6672 6f6d 206e 6f6e 2d63 6f72  ata from non-cor
-0000c940: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000c950: 6c65 732e 0a20 2020 2020 2020 2052 6574  les..        Ret
-0000c960: 7572 6e73 2064 6963 7420 6f66 2066 6f72  urns dict of for
-0000c970: 6d20 7b69 6d61 6765 2d66 696c 652d 6e61  m {image-file-na
-0000c980: 6d65 3a7b 6669 656c 643a 7661 6c75 657d  me:{field:value}
-0000c990: 2c2e 2e2e 7d20 0a20 2020 2020 2020 2022  ,...} .        "
-0000c9a0: 2222 0a20 2020 2020 2020 2072 6571 203d  "".        req =
-0000c9b0: 2073 656c 662e 6e6f 6e43 6f72 6546 6965   self.nonCoreFie
-0000c9c0: 6c64 496e 7465 726d 6564 6961 7465 4974  ldIntermediateIt
-0000c9d0: 656d 496e 666f 4669 6c65 730a 0a20 2020  emInfoFiles..   
-0000c9e0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000c9f0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-0000ca00: 7220 696e 2072 6571 3a0a 2020 2020 2020  r in req:.      
-0000ca10: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0000ca20: 2e65 7869 7374 7328 722e 6669 6c65 4e61  .exists(r.fileNa
-0000ca30: 6d65 293a 0a20 2020 2020 2020 2020 2020  me):.           
-0000ca40: 2020 2020 2073 656c 662e 7072 6173 6549       self.praseI
-0000ca50: 7465 6d44 6174 6146 726f 6d46 696c 6528  temDataFromFile(
-0000ca60: 6974 656d 5f64 6174 612c 722e 6669 6c65  item_data,r.file
-0000ca70: 4e61 6d65 2c72 2e73 6570 6172 6174 6f72  Name,r.separator
-0000ca80: 2c72 2e68 6561 6465 722c 2072 2e64 6174  ,r.header, r.dat
-0000ca90: 6574 696d 655f 666f 726d 6174 290a 2020  etime_format).  
-0000caa0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000cab0: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
-0000cac0: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
-0000cad0: 6f6d 3a20 2220 2b20 722e 6669 6c65 4e61  om: " + r.fileNa
-0000cae0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000caf0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000cb00: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000cb10: 6c6f 6728 2246 696c 6520 646f 6573 206e  log("File does n
-0000cb20: 6f74 2065 7869 7374 733a 2022 202b 2072  ot exists: " + r
-0000cb30: 2e66 696c 654e 616d 6529 0a0a 2020 2020  .fileName)..    
-0000cb40: 2020 2020 7265 7475 726e 2069 7465 6d5f      return item_
-0000cb50: 6461 7461 0a0a 0a20 2020 2064 6566 205f  data...    def _
-0000cb60: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
-0000cb70: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
-0000cb80: 6669 6c65 735f 636f 7265 2873 656c 6629  files_core(self)
-0000cb90: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0000cba0: 6164 2064 6174 6120 6672 6f6d 2063 6f72  ad data from cor
-0000cbb0: 6520 696e 7465 726d 6465 6174 6520 6669  e intermdeate fi
-0000cbc0: 6c65 732c 2063 6865 636b 2066 696c 6573  les, check files
-0000cbd0: 2065 7869 7374 2c20 6164 6420 2769 6d61   exist, add 'ima
-0000cbe0: 6765 2d68 616e 646c 6527 2e0a 2020 2020  ge-handle'..    
-0000cbf0: 2020 2020 5265 7475 726e 7320 6469 6374      Returns dict
-0000cc00: 206f 6620 666f 726d 207b 696d 6167 652d   of form {image-
-0000cc10: 6669 6c65 2d6e 616d 653a 7b66 6965 6c64  file-name:{field
-0000cc20: 3a76 616c 7565 7d2c 2e2e 2e7d 200a 2020  :value},...} .  
-0000cc30: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000cc40: 2020 2023 2057 6869 6368 2066 696c 6573     # Which files
-0000cc50: 2063 6f6e 7461 696e 2074 6865 2069 6e66   contain the inf
-0000cc60: 6f72 6d61 7469 6f6e 206e 6565 6465 6420  ormation needed 
-0000cc70: 746f 2063 7265 6174 6520 7468 6520 6946  to create the iF
-0000cc80: 444f 2069 7465 6d73 2063 6f72 6520 696e  DO items core in
-0000cc90: 666f 726d 6174 696f 6e20 616e 6420 7768  formation and wh
-0000cca0: 6963 6820 636f 6c75 6d6e 7320 7368 616c  ich columns shal
-0000ccb0: 6c20 6265 2075 7365 640a 2020 2020 2020  l be used.      
-0000ccc0: 2020 7265 7120 3d20 7365 6c66 2e69 6e74    req = self.int
-0000ccd0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
-0000cce0: 665f 636f 7265 0a0a 2020 2020 2020 2020  f_core..        
-0000ccf0: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
-0000cd00: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
-0000cd10: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
-0000cd20: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
-0000cd30: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0000cd40: 6461 7461 222c 206c 656e 2872 6571 2929  data", len(req))
-0000cd50: 0a20 2020 2020 2020 2066 6f72 2072 2069  .        for r i
-0000cd60: 6e20 7265 713a 0a20 2020 2020 2020 2020  n req:.         
-0000cd70: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-0000cd80: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-0000cd90: 696c 6520 3d20 7365 6c66 2e5f 5f67 6574  ile = self.__get
-0000cda0: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-0000cdb0: 2829 202b 2072 6571 5b72 5d5b 2773 7566  () + req[r]['suf
-0000cdc0: 6669 7827 5d0a 2020 2020 2020 2020 2020  fix'].          
-0000cdd0: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-0000cde0: 2e65 7869 7374 7328 6669 6c65 293a 0a20  .exists(file):. 
-0000cdf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ce00: 656c 662e 7072 6f76 2e6c 6f67 2822 5741  elf.prov.log("WA
-0000ce10: 524e 494e 4721 2046 6f72 2061 6368 6965  RNING! For achie
-0000ce20: 7669 6e67 2046 4149 526e 6573 7320 616e  ving FAIRness an
-0000ce30: 2069 6e74 6572 6d65 6469 6174 6520 696d   intermediate im
-0000ce40: 6167 6520 696e 666f 2066 696c 6520 6973  age info file is
-0000ce50: 206d 6973 7369 6e67 3a20 222b 2073 656c   missing: "+ sel
-0000ce60: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-0000ce70: 5f70 7265 6669 7828 2920 2b20 7265 715b  _prefix() + req[
-0000ce80: 725d 5b27 7375 6666 6978 275d 2b20 2220  r]['suffix']+ " 
-0000ce90: 7275 6e20 6669 7273 743a 2022 202b 2072  run first: " + r
-0000cea0: 6571 5b72 5d5b 2763 7265 6174 696f 6e46  eq[r]['creationF
-0000ceb0: 6374 275d 290a 2020 2020 2020 2020 2020  ct']).          
-0000cec0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ced0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0000cee0: 7365 4974 656d 4461 7461 6672 6f6d 5461  seItemDatafromTa
-0000cef0: 6246 696c 6544 6174 6128 6974 656d 5f64  bFileData(item_d
-0000cf00: 6174 612c 2066 696c 652c 2072 6571 5b72  ata, file, req[r
-0000cf10: 5d5b 2763 6f6c 7327 5d2c 2072 6571 5b72  ]['cols'], req[r
-0000cf20: 5d5b 276f 7074 696f 6e61 6c27 5d29 0a20  ]['optional']). 
-0000cf30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000cf40: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
-0000cf50: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
-0000cf60: 726f 6d3a 2022 202b 2066 696c 6529 0a0a  rom: " + file)..
-0000cf70: 2020 2020 2020 2020 7072 6f67 2e63 6c65          prog.cle
-0000cf80: 6172 2829 0a20 2020 2020 2020 2069 6620  ar().        if 
-0000cf90: 6c65 6e28 6974 656d 5f64 6174 6129 203d  len(item_data) =
-0000cfa0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000cfb0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-0000cfc0: 2822 4e6f 2069 4644 4f20 6974 656d 7322  ("No iFDO items"
-0000cfd0: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
-0000cfe0: 636b 2066 696c 6573 2065 7869 7374 0a20  ck files exist. 
-0000cff0: 2020 2020 2020 2072 656d 6f76 6520 3d20         remove = 
-0000d000: 5b5d 0a20 2020 2020 2020 2066 6f72 2069  [].        for i
-0000d010: 6d67 2069 6e20 6974 656d 5f64 6174 613a  mg in item_data:
-0000d020: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d030: 6e6f 7420 696d 6720 696e 2073 656c 662e  not img in self.
-0000d040: 5f69 6d61 6765 4e61 6d65 7349 6d61 6765  _imageNamesImage
-0000d050: 7344 6972 3a0a 2020 2020 2020 2020 2020  sDir:.          
-0000d060: 2020 2020 2020 7265 6d6f 7665 2e61 7070        remove.app
-0000d070: 656e 6428 696d 6729 0a20 2020 2020 2020  end(img).       
-0000d080: 2066 6f72 2069 6d67 2069 6e20 7265 6d6f   for img in remo
-0000d090: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
-0000d0a0: 6465 6c20 6974 656d 5f64 6174 615b 696d  del item_data[im
-0000d0b0: 675d 0a0a 2020 2020 2020 2020 2320 6164  g]..        # ad
-0000d0c0: 6420 696d 6167 652d 7572 6c0a 2020 2020  d image-url.    
-0000d0d0: 2020 2020 666f 7220 696d 6720 696e 2069      for img in i
-0000d0e0: 7465 6d5f 6461 7461 3a0a 2020 2020 2020  tem_data:.      
-0000d0f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0000d100: 6e63 6528 6974 656d 5f64 6174 615b 696d  nce(item_data[im
-0000d110: 675d 2c6c 6973 7429 3a20 2320 6974 656d  g],list): # item
-0000d120: 2069 7320 616c 7265 6164 7920 6120 6c69   is already a li
-0000d130: 7374 2028 7669 6465 6f29 2062 7574 2070  st (video) but p
-0000d140: 6172 7365 6420 6461 7461 2069 7320 6e6f  arsed data is no
-0000d150: 742c 2069 2e65 2e20 7061 7273 6564 2064  t, i.e. parsed d
-0000d160: 6174 6120 7265 6665 7273 2074 6f20 7768  ata refers to wh
-0000d170: 6f6c 6520 7669 6465 6f20 2874 696d 6520  ole video (time 
-0000d180: 696e 6465 7065 6e64 656e 7429 2c20 692e  independent), i.
-0000d190: 652e 2077 7269 7465 2074 6f20 6669 7273  e. write to firs
-0000d1a0: 7420 656e 7472 790a 2020 2020 2020 2020  t entry.        
-0000d1b0: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
-0000d1c0: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
-0000d1d0: 7461 5b69 6d67 5d5b 305d 2c27 696d 6167  ta[img][0],'imag
-0000d1e0: 652d 7575 6964 2729 0a20 2020 2020 2020  e-uuid').       
-0000d1f0: 2020 2020 2020 2020 2069 6620 7575 6964           if uuid
-0000d200: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000d210: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000d220: 7428 6974 656d 5f64 6174 615b 696d 675d  t(item_data[img]
-0000d230: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d240: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-0000d250: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-0000d260: 2275 7569 6420 6e6f 7420 666f 756e 6420  "uuid not found 
-0000d270: 2861 2922 290a 2020 2020 2020 2020 2020  (a)").          
-0000d280: 2020 2020 2020 6974 656d 5f64 6174 615b        item_data[
-0000d290: 696d 675d 5b30 5d5b 2769 6d61 6765 2d68  img][0]['image-h
-0000d2a0: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
-0000d2b0: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
-0000d2c0: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
-0000d2d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000d2e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d2f0: 2020 7575 6964 203d 2066 696e 6446 6965    uuid = findFie
-0000d300: 6c64 2869 7465 6d5f 6461 7461 5b69 6d67  ld(item_data[img
-0000d310: 5d2c 2769 6d61 6765 2d75 7569 6427 290a  ],'image-uuid').
-0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d330: 6966 2075 7569 6420 3d3d 2022 223a 0a20  if uuid == "":. 
-0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d350: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-0000d360: 6664 6f45 7863 6570 7469 6f6e 2822 7575  fdoException("uu
-0000d370: 6964 206e 6f74 2066 6f75 6e64 2028 6229  id not found (b)
-0000d380: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000d390: 2020 2069 7465 6d5f 6461 7461 5b69 6d67     item_data[img
-0000d3a0: 5d5b 2769 6d61 6765 2d68 616e 646c 6527  ]['image-handle'
-0000d3b0: 5d20 3d20 7365 6c66 2e69 6d61 6765 5f68  ] = self.image_h
-0000d3c0: 616e 646c 655f 7072 6566 6978 202b 2027  andle_prefix + '
-0000d3d0: 4027 202b 2075 7569 640a 0a20 2020 2020  @' + uuid..     
-0000d3e0: 2020 2072 6574 7572 6e20 6974 656d 5f64     return item_d
-0000d3f0: 6174 610a 0a0a 2020 2020 6465 6620 6164  ata...    def ad
-0000d400: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-0000d410: 6669 6c65 2873 656c 662c 2066 696c 654e  file(self, fileN
-0000d420: 616d 653a 2073 7472 2c20 7365 7061 7261  ame: str, separa
-0000d430: 746f 723a 7374 722c 2068 6561 6465 723a  tor:str, header:
-0000d440: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
-0000d450: 6f72 6d61 7420 3d20 6d69 7174 762e 6461  ormat = miqtv.da
-0000d460: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0000d470: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
-0000d480: 2222 2041 6464 2061 2063 6f6c 756d 6e20  "" Add a column 
-0000d490: 7365 7065 7261 7465 6420 7465 7874 2066  seperated text f
-0000d4a0: 696c 6520 746f 2070 6172 7365 2069 7465  ile to parse ite
-0000d4b0: 6d20 6461 7461 2066 726f 6d20 6279 2063  m data from by c
-0000d4c0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
-0000d4d0: 6f6e 7465 6e74 4669 656c 6473 2829 2e20  ontentFields(). 
-0000d4e0: 0a20 2020 2020 2020 2043 6f6c 756d 6e73  .        Columns
-0000d4f0: 2068 6561 6465 7273 2077 696c 6c20 6265   headers will be
-0000d500: 2073 6574 2061 7320 6974 656d 2066 6965   set as item fie
-0000d510: 6c64 206e 616d 6573 2e20 4d75 7374 2063  ld names. Must c
-0000d520: 6f6e 7461 696e 2063 6f6c 756d 6e20 2769  ontain column 'i
-0000d530: 6d61 6765 2d66 696c 656e 616d 6527 2e0a  mage-filename'..
-0000d540: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d550: 2020 2020 6966 2066 696c 654e 616d 6520      if fileName 
-0000d560: 3d3d 204e 6f6e 6520 6f72 206e 6f74 206f  == None or not o
-0000d570: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
-0000d580: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
-0000d590: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-0000d5a0: 7469 6f6e 2822 4669 6c65 222c 6669 6c65  tion("File",file
-0000d5b0: 4e61 6d65 2c22 6e6f 7420 666f 756e 6422  Name,"not found"
-0000d5c0: 290a 0a20 2020 2020 2020 2066 6f72 2066  )..        for f
-0000d5d0: 6965 6c64 2069 6e20 6865 6164 6572 3a0a  ield in header:.
-0000d5e0: 2020 2020 2020 2020 2020 2020 6966 2068              if h
-0000d5f0: 6561 6465 725b 6669 656c 645d 206e 6f74  eader[field] not
-0000d600: 2069 6e20 6d69 7174 662e 7461 6246 696c   in miqtf.tabFil
-0000d610: 6543 6f6c 756d 6e4e 616d 6573 2866 696c  eColumnNames(fil
-0000d620: 654e 616d 652c 636f 6c5f 7365 7061 7261  eName,col_separa
-0000d630: 746f 723d 7365 7061 7261 746f 7229 3a0a  tor=separator):.
-0000d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d650: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000d660: 2243 6f6c 756d 6e22 2c20 6865 6164 6572  "Column", header
-0000d670: 5b66 6965 6c64 5d2c 2022 6e6f 7420 696e  [field], "not in
-0000d680: 2066 696c 6522 2c20 6669 6c65 4e61 6d65   file", fileName
-0000d690: 290a 0a20 2020 2020 2020 2069 6620 6d69  )..        if mi
-0000d6a0: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
-0000d6b0: 6f73 2e70 6174 682e 6469 726e 616d 6528  os.path.dirname(
-0000d6c0: 6669 6c65 4e61 6d65 2929 2021 3d20 6d69  fileName)) != mi
-0000d6d0: 7174 632e 6173 7365 7274 536c 6173 6828  qtc.assertSlash(
-0000d6e0: 7365 6c66 2e64 6972 2e74 6f28 7365 6c66  self.dir.to(self
-0000d6f0: 2e64 6972 2e64 742e 696e 7465 726d 6564  .dir.dt.intermed
-0000d700: 6961 7465 2929 3a0a 2020 2020 2020 2020  iate)):.        
-0000d710: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000d720: 6728 2022 4361 7574 696f 6e3a 2049 7420  g( "Caution: It 
-0000d730: 6973 2072 6563 6f6d 6d65 6e64 6564 2074  is recommended t
-0000d740: 6f20 7075 7420 6669 6c65 2069 6e20 7468  o put file in th
-0000d750: 6520 6469 7265 6374 6f72 7927 7320 2769  e directory's 'i
-0000d760: 6e74 6572 6d65 6469 6174 6527 2066 6f6c  ntermediate' fol
-0000d770: 6465 723a 2022 202b 2066 696c 654e 616d  der: " + fileNam
-0000d780: 6529 0a20 2020 2020 2020 206e 6366 6969  e).        ncfii
-0000d790: 6620 3d20 6e6f 6e43 6f72 6546 6965 6c64  f = nonCoreField
-0000d7a0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000d7b0: 496e 666f 4669 6c65 2866 696c 654e 616d  InfoFile(fileNam
-0000d7c0: 652c 2073 6570 6172 6174 6f72 2c20 6865  e, separator, he
-0000d7d0: 6164 6572 2c20 6461 7465 7469 6d65 5f66  ader, datetime_f
-0000d7e0: 6f72 6d61 7429 0a20 2020 2020 2020 2069  ormat).        i
-0000d7f0: 6620 6e63 6669 6966 206e 6f74 2069 6e20  f ncfiif not in 
-0000d800: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000d810: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000d820: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
-0000d830: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-0000d840: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000d850: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000d860: 6c65 732e 6170 7065 6e64 286e 6366 6969  les.append(ncfii
-0000d870: 6629 0a0a 2020 2020 6465 6620 6164 6449  f)..    def addI
-0000d880: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
-0000d890: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
-0000d8a0: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
-0000d8b0: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
-0000d8c0: 6461 7465 7469 6d65 5f66 6f72 6d61 7420  datetime_format 
-0000d8d0: 3d20 6d69 7174 762e 6461 7465 5f66 6f72  = miqtv.date_for
-0000d8e0: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
-0000d8f0: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-0000d900: 7265 6361 7465 6420 2d20 7573 6520 6164  recated - use ad
-0000d910: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-0000d920: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-0000d930: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
-0000d940: 6e66 6f5f 7461 625f 6669 6c65 2866 696c  nfo_tab_file(fil
-0000d950: 654e 616d 652c 7365 7061 7261 746f 722c  eName,separator,
-0000d960: 6865 6164 6572 2c64 6174 6574 696d 655f  header,datetime_
-0000d970: 666f 726d 6174 290a 0a20 2020 2020 2020  format)..       
-0000d980: 200a 2020 2020 6465 6620 7265 6d6f 7665   .    def remove
-0000d990: 4974 656d 496e 666f 5461 6246 696c 6528  ItemInfoTabFile(
-0000d9a0: 7365 6c66 2c20 6669 6c65 4e61 6d65 3a20  self, fileName: 
-0000d9b0: 7374 722c 2073 6570 6172 6174 6f72 3a73  str, separator:s
-0000d9c0: 7472 2c20 6865 6164 6572 3a64 6963 742c  tr, header:dict,
-0000d9d0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0000d9e0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
-0000d9f0: 2222 2072 656d 6f76 6573 2066 696c 6520  "" removes file 
-0000da00: 6974 656d 2066 726f 6d20 6c69 7374 206f  item from list o
-0000da10: 6620 6669 6c65 7320 746f 2070 6172 7365  f files to parse
-0000da20: 2069 7465 6d20 6461 7461 2066 726f 6d20   item data from 
-0000da30: 6279 2063 7265 6174 6543 6170 7475 7265  by createCapture
-0000da40: 416e 6443 6f6e 7465 6e74 4669 656c 6473  AndContentFields
-0000da50: 2829 2022 2222 0a20 2020 2020 2020 206e  () """.        n
-0000da60: 6366 6969 6620 3d20 6e6f 6e43 6f72 6546  cfiif = nonCoreF
-0000da70: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
-0000da80: 4974 656d 496e 666f 4669 6c65 2866 696c  ItemInfoFile(fil
-0000da90: 654e 616d 652c 2073 6570 6172 6174 6f72  eName, separator
-0000daa0: 2c20 6865 6164 6572 2c20 6461 7465 7469  , header, dateti
-0000dab0: 6d65 5f66 6f72 6d61 7429 0a20 2020 2020  me_format).     
-0000dac0: 2020 2069 6620 6e63 6669 6966 2069 6e20     if ncfiif in 
-0000dad0: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
-0000dae0: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
-0000daf0: 6d49 6e66 6f46 696c 6573 3a20 0a20 2020  mInfoFiles: .   
-0000db00: 2020 2020 2020 2020 2073 656c 662e 6e6f           self.no
-0000db10: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
-0000db20: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
-0000db30: 6c65 732e 7265 6d6f 7665 286e 6366 6969  les.remove(ncfii
-0000db40: 6629 0a0a 0a20 2020 2064 6566 2075 7064  f)...    def upd
-0000db50: 6174 6569 4644 4f28 7365 6c66 2c20 6865  ateiFDO(self, he
-0000db60: 6164 6572 3a20 6469 6374 2c20 6974 656d  ader: dict, item
-0000db70: 733a 206c 6973 7429 3a0a 2020 2020 2020  s: list):.      
-0000db80: 2020 2222 2220 5570 6461 7465 7320 7468    """ Updates th
-0000db90: 6520 6375 7272 656e 7420 7661 6c75 6573  e current values
-0000dba0: 2069 4644 4f20 7769 7468 2074 6865 2070   iFDO with the p
-0000dbb0: 726f 7669 6465 6420 6e65 7720 7661 6c75  rovided new valu
-0000dbc0: 6573 2022 2222 0a20 2020 2020 2020 2072  es """.        r
-0000dbd0: 6574 7572 6e20 7365 6c66 2e63 7265 6174  eturn self.creat
-0000dbe0: 6569 4644 4f28 6865 6164 6572 2c20 6974  eiFDO(header, it
-0000dbf0: 656d 732c 2075 7064 6174 6545 7869 7374  ems, updateExist
-0000dc00: 696e 673d 5472 7565 290a 0a0a 2020 2020  ing=True)...    
-0000dc10: 6465 6620 6372 6561 7465 6946 444f 2873  def createiFDO(s
-0000dc20: 656c 662c 2068 6561 6465 723a 2064 6963  elf, header: dic
-0000dc30: 742c 2069 7465 6d73 3a20 6c69 7374 2c20  t, items: list, 
-0000dc40: 7570 6461 7465 4578 6973 7469 6e67 3d46  updateExisting=F
-0000dc50: 616c 7365 2c68 6561 6465 724f 6e6c 793d  alse,headerOnly=
-0000dc60: 4661 6c73 652c 616c 6c6f 775f 6d69 7373  False,allow_miss
-0000dc70: 696e 675f 7265 7175 6972 6564 3d46 616c  ing_required=Fal
-0000dc80: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-0000dc90: 2043 7265 6174 6573 2046 4149 5220 6469   Creates FAIR di
-0000dca0: 6769 7461 6c20 6f62 6a65 6374 2066 6f72  gital object for
-0000dcb0: 2074 6865 2069 6d61 6765 2064 6174 6120   the image data 
-0000dcc0: 6974 7365 6c66 2e20 5468 6973 2063 6f6e  itself. This con
-0000dcd0: 7369 7374 7320 6f66 2068 6561 6465 7220  sists of header 
-0000dce0: 696e 666f 726d 6174 696f 6e20 616e 6420  information and 
-0000dcf0: 6974 656d 2069 6e66 6f72 6d61 7469 6f6e  item information
-0000dd00: 2e0a 2020 2020 2020 2020 7570 6461 7465  ..        update
-0000dd10: 4578 6973 7469 6e67 3a20 6966 2046 616c  Existing: if Fal
-0000dd20: 7365 206f 6c64 2076 616c 7565 7320 6172  se old values ar
-0000dd30: 6520 7265 6d6f 7665 642c 206f 7468 6572  e removed, other
-0000dd40: 7769 7365 2074 6865 7920 6172 6520 7570  wise they are up
-0000dd50: 6461 7465 642e 0a20 2020 2020 2020 2068  dated..        h
-0000dd60: 6561 6465 724f 6e6c 793a 2069 6620 5472  eaderOnly: if Tr
-0000dd70: 7565 2069 7465 6d73 206d 6179 2062 6520  ue items may be 
-0000dd80: 656d 7074 7920 6c69 7374 2e0a 2020 2020  empty list..    
-0000dd90: 2020 2020 616c 6c6f 775f 6d69 7373 696e      allow_missin
-0000dda0: 675f 7265 7175 6972 6564 3a20 6966 2054  g_required: if T
-0000ddb0: 7275 652c 206e 6f20 6578 6365 7074 696f  rue, no exceptio
-0000ddc0: 6e20 7269 7365 6e20 6966 2061 2072 6571  n risen if a req
-0000ddd0: 7569 7265 6420 6669 656c 6420 6973 206d  uired field is m
-0000dde0: 6973 7369 6e67 2e20 2022 2222 0a0a 2020  issing.  """..  
-0000ddf0: 2020 2020 2020 6966 206e 6f74 2075 7064        if not upd
-0000de00: 6174 6545 7869 7374 696e 6720 616e 6420  ateExisting and 
-0000de10: 6c65 6e28 6974 656d 7329 203d 3d20 3020  len(items) == 0 
-0000de20: 616e 6420 6e6f 7420 6865 6164 6572 4f6e  and not headerOn
-0000de30: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000de40: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000de50: 274e 6f20 6974 656d 2069 6e66 6f72 6d61  'No item informa
-0000de60: 7469 6f6e 2067 6976 656e 2729 0a0a 2020  tion given')..  
-0000de70: 2020 2020 2020 6966 2075 7064 6174 6545        if updateE
-0000de80: 7869 7374 696e 673a 0a20 2020 2020 2020  xisting:.       
-0000de90: 2020 2020 2023 2068 6561 6465 720a 2020       # header.  
-0000dea0: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-0000deb0: 7064 6174 655f 6966 646f 5f68 6561 6465  pdate_ifdo_heade
-0000dec0: 725f 6669 656c 6473 2868 6561 6465 7229  r_fields(header)
-0000ded0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-0000dee0: 7465 6d73 0a20 2020 2020 2020 2020 2020  tems.           
-0000def0: 2023 2075 7064 6174 6520 636f 7079 206f   # update copy o
-0000df00: 6620 6375 7272 656e 7420 6974 656d 7320  f current items 
-0000df10: 7769 7468 206e 6577 2069 7465 6d73 2066  with new items f
-0000df20: 6965 6c64 730a 2020 2020 2020 2020 2020  ields.          
-0000df30: 2020 6974 656d 7344 6963 7420 3d20 6d69    itemsDict = mi
-0000df40: 7174 692e 6372 6561 7465 496d 6167 6549  qti.createImageI
-0000df50: 7465 6d73 4469 6374 4672 6f6d 496d 6167  temsDictFromImag
-0000df60: 6549 7465 6d73 4c69 7374 2869 7465 6d73  eItemsList(items
-0000df70: 290a 2020 2020 2020 2020 2020 2020 7570  ).            up
-0000df80: 6461 7465 6449 7465 6d73 5f63 6f70 7920  datedItems_copy 
-0000df90: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-0000dfa0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000dfb0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0000dfc0: 4b65 795d 290a 2020 2020 2020 2020 2020  Key]).          
-0000dfd0: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
-0000dfe0: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
-0000dff0: 6963 7473 2875 7064 6174 6564 4974 656d  icts(updatedItem
-0000e000: 735f 636f 7079 2c20 6974 656d 7344 6963  s_copy, itemsDic
-0000e010: 7429 0a20 2020 2020 2020 2020 2020 2073  t).            s
-0000e020: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
-0000e030: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-0000e040: 2020 2020 2020 2020 2020 2020 6974 656d              item
-0000e050: 7320 3d20 6d69 7174 692e 6372 6561 7465  s = miqti.create
-0000e060: 496d 6167 6549 7465 6d73 4c69 7374 4672  ImageItemsListFr
-0000e070: 6f6d 496d 6167 6549 7465 6d73 4469 6374  omImageItemsDict
-0000e080: 2875 7064 6174 6564 4974 656d 735f 636f  (updatedItems_co
-0000e090: 7079 290a 0a20 2020 2020 2020 2065 6c73  py)..        els
-0000e0a0: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-0000e0b0: 206f 7665 7277 7269 7465 2068 6561 6465   overwrite heade
-0000e0c0: 720a 2020 2020 2020 2020 2020 2020 7365  r.            se
-0000e0d0: 6c66 2e73 6574 6946 444f 4865 6164 6572  lf.setiFDOHeader
-0000e0e0: 4669 656c 6473 2868 6561 6465 7229 0a20  Fields(header). 
-0000e0f0: 2020 2020 2020 2020 2020 2023 2063 6c65             # cle
-0000e100: 6172 2069 7465 6d73 2073 6563 7469 6f6e  ar items section
-0000e110: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000e120: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000e130: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-0000e140: 5d20 3d20 7b7d 0a0a 0a20 2020 2020 2020  ] = {}...       
-0000e150: 2023 2050 6172 7365 2069 6d61 6765 2d61   # Parse image-a
-0000e160: 6273 7472 6163 7420 616e 6420 6669 6c6c  bstract and fill
-0000e170: 2069 7473 2070 6c61 6365 686f 6c64 6572   its placeholder
-0000e180: 7320 7769 7468 2069 6e66 6f72 6d61 7469  s with informati
-0000e190: 6f6e 0a20 2020 2020 2020 2074 7279 3a0a  on.        try:.
-0000e1a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e1b0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000e1c0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000e1d0: 5d5b 2769 6d61 6765 2d61 6273 7472 6163  ]['image-abstrac
-0000e1e0: 7427 5d20 3d20 6d69 7174 732e 7061 7273  t'] = miqts.pars
-0000e1f0: 6552 6570 6c61 6365 5661 6c28 7365 6c66  eReplaceVal(self
-0000e200: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000e210: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000e220: 5d2c 2027 696d 6167 652d 6162 7374 7261  ], 'image-abstra
-0000e230: 6374 2729 0a20 2020 2020 2020 2065 7863  ct').        exc
-0000e240: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-0000e250: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
-0000e260: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000e270: 436f 756c 6420 6e6f 7420 7265 706c 6163  Could not replac
-0000e280: 6520 6b65 7973 2069 6e20 5c27 696d 6167  e keys in \'imag
-0000e290: 652d 6162 7374 7261 6374 5c27 3a20 2220  e-abstract\': " 
-0000e2a0: 2b20 7374 7228 6578 2929 0a0a 0a20 2020  + str(ex))...   
-0000e2b0: 2020 2020 2023 2073 6574 2076 6572 7369       # set versi
-0000e2c0: 6f6e 2028 736f 2069 7420 6361 6e6e 6f74  on (so it cannot
-0000e2d0: 2062 6520 6368 616e 6765 6420 6279 2075   be changed by u
-0000e2e0: 7365 7229 0a20 2020 2020 2020 2073 656c  ser).        sel
-0000e2f0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000e300: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000e310: 795d 5b27 696d 6167 652d 7365 742d 6966  y]['image-set-if
-0000e320: 646f 2d76 6572 7369 6f6e 275d 203d 206d  do-version'] = m
-0000e330: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
-0000e340: 6e0a 0a20 2020 2020 2020 2023 2056 616c  n..        # Val
-0000e350: 6964 6174 6520 6974 656d 2069 6e66 6f72  idate item infor
-0000e360: 6d61 7469 6f6e 0a20 2020 2020 2020 2069  mation.        i
-0000e370: 6e76 616c 6964 5f69 7465 6d73 203d 2030  nvalid_items = 0
-0000e380: 0a20 2020 2020 2020 2069 6d61 6765 5f73  .        image_s
-0000e390: 6574 5f69 7465 6d73 203d 207b 7d0a 0a20  et_items = {}.. 
-0000e3a0: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
-0000e3b0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
-0000e3c0: 6f67 7265 7373 4d73 6728 2243 6865 636b  ogressMsg("Check
-0000e3d0: 696e 6720 6974 656d 7322 2c20 6c65 6e28  ing items", len(
-0000e3e0: 6974 656d 7329 2c6d 6f64 756c 6f3d 3529  items),modulo=5)
-0000e3f0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-0000e400: 6d20 696e 2069 7465 6d73 3a0a 2020 2020  m in items:.    
-0000e410: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
-0000e420: 6772 6573 7328 290a 2020 2020 2020 2020  gress().        
-0000e430: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
-0000e440: 6c6c 2063 6f72 6520 6669 656c 6473 2061  ll core fields a
-0000e450: 7265 2066 696c 6c65 6420 616e 6420 6172  re filled and ar
-0000e460: 6520 6669 6c6c 6564 2076 616c 6964 6c79  e filled validly
-0000e470: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0000e480: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000e490: 2020 2023 2063 6865 636b 2069 7465 6d20     # check item 
-0000e4a0: 696d 6167 6520 6578 6973 7473 0a20 2020  image exists.   
-0000e4b0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-0000e4c0: 6620 6974 656d 2069 7320 6120 6c69 7374  f item is a list
-0000e4d0: 2028 7669 6465 6f29 2c20 6f6e 6520 776f   (video), one wo
-0000e4e0: 756c 6420 6861 7665 2074 6f20 6368 6563  uld have to chec
-0000e4f0: 6b20 6966 2065 6163 6820 656e 7472 7920  k if each entry 
-0000e500: 6973 2076 616c 6964 2067 6976 656e 2074  is valid given t
-0000e510: 6865 2064 6566 6175 6c74 2076 616c 7565  he default value
-0000e520: 7320 696e 2066 6972 7374 2065 6e74 7279  s in first entry
-0000e530: 2070 6c75 7320 6769 7665 6e20 6465 6661   plus given defa
-0000e540: 756c 7420 7661 6c75 6573 2069 6e20 6865  ult values in he
-0000e550: 6164 6572 0a20 2020 2020 2020 2020 2020  ader.           
-0000e560: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-0000e570: 7374 616e 6365 2869 7465 6d2c 6c69 7374  stance(item,list
-0000e580: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000e590: 2020 2020 2020 2069 7465 6d20 3d20 5b69         item = [i
-0000e5a0: 7465 6d5d 0a20 2020 2020 2020 2020 2020  tem].           
-0000e5b0: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
-0000e5c0: 756c 7420 3d20 6974 656d 5b30 5d20 0a20  ult = item[0] . 
-0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e5e0: 6f72 2073 7562 4974 656d 2069 6e20 6974  or subItem in it
-0000e5f0: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
-0000e600: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-0000e610: 6520 3d20 7375 6249 7465 6d5b 2769 6d61  e = subItem['ima
-0000e620: 6765 2d66 696c 656e 616d 6527 5d0a 2020  ge-filename'].  
-0000e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e640: 2020 6966 206e 6f74 2073 656c 662e 6967    if not self.ig
-0000e650: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-0000e660: 2061 6e64 2066 696c 655f 6e61 6d65 206e   and file_name n
-0000e670: 6f74 2069 6e20 7365 6c66 2e5f 696d 6167  ot in self._imag
-0000e680: 654e 616d 6573 496d 6167 6573 4469 723a  eNamesImagesDir:
-0000e690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e6a0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000e6b0: 7863 6570 7469 6f6e 2822 4974 656d 2027  xception("Item '
-0000e6c0: 2220 2b20 6669 6c65 5f6e 616d 6520 2b20  " + file_name + 
-0000e6d0: 2227 206e 6f74 2066 6f75 6e64 2069 6e20  "' not found in 
-0000e6e0: 2f72 6177 2064 6972 6563 746f 7279 2e22  /raw directory."
-0000e6f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000e700: 2020 2020 2020 206d 6971 7474 2e61 7265         miqtt.are
-0000e710: 5f76 616c 6964 5f69 6664 6f5f 6669 656c  _valid_ifdo_fiel
-0000e720: 6473 2873 7562 4974 656d 2920 2020 2020  ds(subItem)     
-0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e740: 2020 2020 0a0a 2020 2020 2020 2020 2020      ..          
-0000e750: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
-0000e760: 6974 656d 735b 7375 6249 7465 6d44 6566  items[subItemDef
-0000e770: 6175 6c74 5b27 696d 6167 652d 6669 6c65  ault['image-file
-0000e780: 6e61 6d65 275d 5d20 3d20 5b5d 2023 2063  name']] = [] # c
-0000e790: 6f75 6c64 206d 616b 6520 616e 2065 7874  ould make an ext
-0000e7a0: 7261 2063 6173 6520 666f 7220 696d 6167  ra case for imag
-0000e7b0: 6573 206f 6d69 7474 696e 6720 7468 6520  es omitting the 
-0000e7c0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-0000e7d0: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
-0000e7e0: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
-0000e7f0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0000e800: 6249 7465 6d44 6963 7420 3d20 7b7d 0a20  bItemDict = {}. 
-0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e820: 2020 2066 6f72 2069 7420 696e 2073 7562     for it in sub
-0000e830: 4974 656d 3a0a 2020 2020 2020 2020 2020  Item:.          
-0000e840: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000e850: 2069 7420 213d 2027 696d 6167 652d 6669   it != 'image-fi
-0000e860: 6c65 6e61 6d65 273a 0a20 2020 2020 2020  lename':.       
-0000e870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e880: 2020 2020 2073 7562 4974 656d 4469 6374       subItemDict
-0000e890: 5b69 745d 203d 2073 7562 4974 656d 5b69  [it] = subItem[i
-0000e8a0: 745d 0a20 2020 2020 2020 2020 2020 2020  t].             
-0000e8b0: 2020 2020 2020 2069 6d61 6765 5f73 6574         image_set
-0000e8c0: 5f69 7465 6d73 5b73 7562 4974 656d 4465  _items[subItemDe
-0000e8d0: 6661 756c 745b 2769 6d61 6765 2d66 696c  fault['image-fil
-0000e8e0: 656e 616d 6527 5d5d 2e61 7070 656e 6428  ename']].append(
-0000e8f0: 7375 6249 7465 6d44 6963 7429 0a20 2020  subItemDict).   
-0000e900: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0000e910: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
-0000e920: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0000e930: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000e940: 2020 2020 2020 2069 6e76 616c 6964 5f69         invalid_i
-0000e950: 7465 6d73 202b 3d20 310a 2020 2020 2020  tems += 1.      
-0000e960: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000e970: 726f 762e 6c6f 6728 2249 6e76 616c 6964  rov.log("Invalid
-0000e980: 2069 6d61 6765 2069 7465 6d3a 2022 2b20   image item: "+ 
-0000e990: 7374 7228 6974 656d 292c 646f 6e74 5368  str(item),dontSh
-0000e9a0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-0000e9b0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000e9c0: 6f76 2e6c 6f67 2822 4578 6365 7074 696f  ov.log("Exceptio
-0000e9d0: 6e3a 5c6e 222b 2073 7472 2865 2e61 7267  n:\n"+ str(e.arg
-0000e9e0: 7329 2c64 6f6e 7453 686f 773d 5472 7565  s),dontShow=True
-0000e9f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ea00: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-0000ea10: 646f 4578 6365 7074 696f 6e28 2249 6e76  doException("Inv
-0000ea20: 616c 6964 2069 6d61 6765 2069 7465 6d20  alid image item 
-0000ea30: 222b 2066 696c 655f 6e61 6d65 202b 2022  "+ file_name + "
-0000ea40: 3a5c 6e45 7863 6570 7469 6f6e 3a5c 6e22  :\nException:\n"
-0000ea50: 2b20 7374 7228 652e 6172 6773 2929 2023  + str(e.args)) #
-0000ea60: 206f 7468 6572 7769 7365 2c20 696e 2063   otherwise, in c
-0000ea70: 6173 6520 6f66 206d 616e 7920 696d 6167  ase of many imag
-0000ea80: 6573 2c20 6974 206d 6179 206b 6565 7020  es, it may keep 
-0000ea90: 7275 6e6e 696e 6720 616e 6420 7468 726f  running and thro
-0000eaa0: 7769 6e67 2065 7272 6f72 7320 666f 7220  wing errors for 
-0000eab0: 7175 6974 2073 6f6d 6520 7469 6d65 0a20  quit some time. 
-0000eac0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-0000ead0: 7228 290a 0a20 2020 2020 2020 2069 6620  r()..        if 
-0000eae0: 6c65 6e28 6974 656d 7329 2021 3d20 3020  len(items) != 0 
-0000eaf0: 616e 6420 696e 7661 6c69 645f 6974 656d  and invalid_item
-0000eb00: 7320 3d3d 206c 656e 2869 7465 6d73 293a  s == len(items):
-0000eb10: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000eb20: 7365 2045 7863 6570 7469 6f6e 2822 416c  se Exception("Al
-0000eb30: 6c20 6974 656d 7320 6172 6520 696e 7661  l items are inva
-0000eb40: 6c69 6422 290a 2020 2020 2020 2020 656c  lid").        el
-0000eb50: 6966 2069 6e76 616c 6964 5f69 7465 6d73  if invalid_items
-0000eb60: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0000eb70: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000eb80: 2241 7420 6c65 6173 7420 2220 2b20 7374  "At least " + st
-0000eb90: 7228 696e 7661 6c69 645f 6974 656d 7329  r(invalid_items)
-0000eba0: 202b 2022 2069 7465 6d73 2077 6572 6520   + " items were 
-0000ebb0: 696e 7661 6c69 6420 286f 6622 202b 2073  invalid (of" + s
-0000ebc0: 7472 286c 656e 2869 7465 6d73 2929 2b20  tr(len(items))+ 
-0000ebd0: 2229 2229 0a0a 2020 2020 2020 2020 2320  ")")..        # 
-0000ebe0: 5661 6c69 6461 7465 2068 6561 6465 7220  Validate header 
-0000ebf0: 696e 666f 726d 6174 696f 6e0a 2020 2020  information.    
-0000ec00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000ec10: 2020 2020 206d 6971 7474 2e61 7265 5f76       miqtt.are_v
-0000ec20: 616c 6964 5f69 6664 6f5f 6669 656c 6473  alid_ifdo_fields
-0000ec30: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
-0000ec40: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000ec50: 6572 4b65 795d 290a 2020 2020 2020 2020  erKey]).        
-0000ec60: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
-0000ec70: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
-0000ec80: 3a0a 2020 2020 2020 2020 2020 2020 6d73  :.            ms
-0000ec90: 6720 3d20 2249 6e76 616c 6964 2068 6561  g = "Invalid hea
-0000eca0: 6465 7220 6669 656c 643a 2022 202b 2073  der field: " + s
-0000ecb0: 7472 2865 7829 0a20 2020 2020 2020 2020  tr(ex).         
-0000ecc0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000ecd0: 2822 4578 6365 7074 696f 6e3a 2022 202b  ("Exception: " +
-0000ece0: 206d 7367 2c20 646f 6e74 5368 6f77 3d54   msg, dontShow=T
-0000ecf0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0000ed00: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-0000ed10: 6f45 7863 6570 7469 6f6e 286d 7367 290a  oException(msg).
-0000ed20: 0a20 2020 2020 2020 2023 2070 7574 2069  .        # put i
-0000ed30: 7465 6d20 696e 666f 2069 6e74 6f20 7365  tem info into se
-0000ed40: 6c66 2e69 6664 6f5f 746d 700a 2020 2020  lf.ifdo_tmp.    
-0000ed50: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
-0000ed60: 696e 744c 6f61 6469 6e67 4d73 6728 2255  intLoadingMsg("U
-0000ed70: 7064 6174 696e 6722 290a 2020 2020 2020  pdating").      
-0000ed80: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
-0000ed90: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
-0000eda0: 6963 7473 2873 656c 662e 6966 646f 5f74  icts(self.ifdo_t
-0000edb0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000edc0: 4974 656d 734b 6579 5d2c 2069 6d61 6765  ItemsKey], image
-0000edd0: 5f73 6574 5f69 7465 6d73 290a 2020 2020  _set_items).    
-0000ede0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-0000edf0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000ee00: 6f67 286c 6f67 290a 0a20 2020 2020 2020  og(log)..       
-0000ee10: 2023 2073 6574 206c 6174 206c 6f6e 2062   # set lat lon b
-0000ee20: 6f75 6e64 696e 6720 626f 780a 2020 2020  ounding box.    
-0000ee30: 2020 2020 7365 6c66 2e5f 7365 745f 6c61      self._set_la
-0000ee40: 745f 6c6f 6e5f 626f 756e 6469 6e67 5f62  t_lon_bounding_b
-0000ee50: 6f78 2873 656c 662e 6966 646f 5f74 6d70  ox(self.ifdo_tmp
-0000ee60: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
-0000ee70: 2072 6570 7265 7365 6e74 6174 6976 6520   representative 
-0000ee80: 6865 6164 6572 2066 6965 6c64 7320 6461  header fields da
-0000ee90: 7465 7469 6d65 2c20 6c61 742c 206c 6f6e  tetime, lat, lon
-0000eea0: 2c20 616c 740a 2020 2020 2020 2020 7365  , alt.        se
-0000eeb0: 6c66 2e5f 7365 745f 7265 705f 6865 6164  lf._set_rep_head
-0000eec0: 6572 5f66 6965 6c64 735f 6474 5f6c 6174  er_fields_dt_lat
-0000eed0: 5f6c 6f6e 5f61 6c74 2873 656c 662e 6966  _lon_alt(self.if
-0000eee0: 646f 5f74 6d70 290a 0a20 2020 2020 2020  do_tmp)..       
-0000eef0: 2073 656c 662e 5f73 6574 5f69 6d61 6765   self._set_image
-0000ef00: 5f69 7465 6d5f 6964 656e 7469 6669 6361  _item_identifica
-0000ef10: 7469 6f6e 5f73 6368 656d 6528 7365 6c66  tion_scheme(self
-0000ef20: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
-0000ef30: 2020 2020 2320 7265 6d6f 7665 2065 6d74      # remove emt
-0000ef40: 7079 2066 6965 6c64 730a 2020 2020 2020  py fields.      
-0000ef50: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
-0000ef60: 744c 6f61 6469 6e67 4d73 6728 2252 656d  tLoadingMsg("Rem
-0000ef70: 6f76 696e 6720 656d 7074 7920 6669 656c  oving empty fiel
-0000ef80: 6473 2229 0a20 2020 2020 2020 2073 656c  ds").        sel
-0000ef90: 662e 6966 646f 5f74 6d70 203d 206d 6971  f.ifdo_tmp = miq
-0000efa0: 7463 2e72 6563 7572 7369 7665 6c79 5265  tc.recursivelyRe
-0000efb0: 6d6f 7665 456d 7074 7946 6965 6c64 7328  moveEmptyFields(
-0000efc0: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
-0000efd0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0000efe0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0000eff0: 4b65 7920 696e 2073 656c 662e 6966 646f  Key in self.ifdo
-0000f000: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
-0000f010: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000f020: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-0000f030: 6d73 4b65 795d 203d 205b 5d0a 2020 2020  msKey] = [].    
-0000f040: 2020 2020 2320 7265 6d6f 7665 2066 6965      # remove fie
-0000f050: 6c64 7320 7468 6174 2063 6f6e 7461 696e  lds that contain
-0000f060: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-0000f070: 2720 6f6e 6c79 0a20 2020 2020 2020 2073  ' only.        s
-0000f080: 656c 662e 7265 6d6f 7665 4974 656d 4669  elf.removeItemFi
-0000f090: 656c 6473 5769 7468 4f6e 6c79 4461 7465  eldsWithOnlyDate
-0000f0a0: 5469 6d65 2829 0a20 2020 2020 2020 2073  Time().        s
-0000f0b0: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
-0000f0c0: 2069 6620 6e6f 7420 7365 6c66 2e69 676e   if not self.ign
-0000f0d0: 6f72 655f 696d 6167 655f 6669 6c65 733a  ore_image_files:
-0000f0e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000f0f0: 662e 6368 6563 6b41 6c6c 4974 656d 4861  f.checkAllItemHa
-0000f100: 7368 6573 2829 0a0a 2020 2020 2020 2020  shes()..        
-0000f110: 2320 6368 6563 6b20 6167 6169 6e73 7420  # check against 
-0000f120: 7363 6865 6d61 0a20 2020 2020 2020 2076  schema.        v
-0000f130: 616c 6964 2c20 6d73 6720 3d20 6d69 7174  alid, msg = miqt
-0000f140: 742e 7661 6c69 6461 7465 5f69 6664 6f28  t.validate_ifdo(
-0000f150: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
-0000f160: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-0000f170: 6c69 6420 616e 6420 6e6f 7420 616c 6c6f  lid and not allo
-0000f180: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-0000f190: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-0000f1a0: 7365 6c66 2e70 726f 762e 6c6f 6728 2257  self.prov.log("W
-0000f1b0: 6172 6e69 6e67 2120 6946 444f 206e 6f20  arning! iFDO no 
-0000f1c0: 7661 6c69 6420 7965 743a 2022 202b 206d  valid yet: " + m
-0000f1d0: 7367 290a 2020 2020 2020 2020 2020 2020  sg).            
-0000f1e0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0000f1f0: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
-0000f200: 2020 2020 2020 2020 2320 7365 7420 6669          # set fi
-0000f210: 6e61 6c20 6f6e 650a 2020 2020 2020 2020  nal one.        
-0000f220: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
-0000f230: 6420 3d20 636f 7079 2e64 6565 7063 6f70  d = copy.deepcop
-0000f240: 7928 7365 6c66 2e69 6664 6f5f 746d 7029  y(self.ifdo_tmp)
-0000f250: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000f260: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
-0000f270: 640a 0a0a 2020 2020 6465 6620 5f73 6574  d...    def _set
-0000f280: 5f69 6d61 6765 5f69 7465 6d5f 6964 656e  _image_item_iden
-0000f290: 7469 6669 6361 7469 6f6e 5f73 6368 656d  tification_schem
-0000f2a0: 6528 7365 6c66 2c69 6664 6f3a 6469 6374  e(self,ifdo:dict
-0000f2b0: 293a 0a20 2020 2020 2020 2022 2222 2053  ):.        """ S
-0000f2c0: 6574 2069 6d61 6765 2d69 7465 6d2d 6964  et image-item-id
-0000f2d0: 656e 7469 6669 6361 7469 6f6e 2d73 6368  entification-sch
-0000f2e0: 656d 6520 746f 2060 696d 6167 652d 7072  eme to `image-pr
-0000f2f0: 6f6a 6563 745f 696d 6167 652d 6576 656e  oject_image-even
-0000f300: 745f 696d 6167 652d 7365 6e73 6f72 5f69  t_image-sensor_i
-0000f310: 6d61 6765 2d64 6174 6574 696d 652e 6578  mage-datetime.ex
-0000f320: 7460 2069 6620 656d 7074 792e 2022 2222  t` if empty. """
-0000f330: 0a20 2020 2020 2020 2069 6620 6669 6e64  .        if find
-0000f340: 4669 656c 6428 6966 646f 5b73 656c 662e  Field(ifdo[self.
-0000f350: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000f360: 795d 2c27 696d 6167 652d 6974 656d 2d69  y],'image-item-i
-0000f370: 6465 6e74 6966 6963 6174 696f 6e2d 7363  dentification-sc
-0000f380: 6865 6d65 2729 203d 3d20 2222 3a0a 2020  heme') == "":.  
-0000f390: 2020 2020 2020 2020 2020 6966 646f 5b73            ifdo[s
-0000f3a0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000f3b0: 6572 4b65 795d 5b27 696d 6167 652d 6974  erKey]['image-it
-0000f3c0: 656d 2d69 6465 6e74 6966 6963 6174 696f  em-identificatio
-0000f3d0: 6e2d 7363 6865 6d65 275d 203d 2020 2769  n-scheme'] =  'i
-0000f3e0: 6d61 6765 2d70 726f 6a65 6374 5f69 6d61  mage-project_ima
-0000f3f0: 6765 2d65 7665 6e74 5f69 6d61 6765 2d73  ge-event_image-s
-0000f400: 656e 736f 725f 696d 6167 652d 6461 7465  ensor_image-date
-0000f410: 7469 6d65 2e65 7874 270a 0a0a 2020 2020  time.ext'...    
-0000f420: 6465 6620 5f73 6574 5f72 6570 5f68 6561  def _set_rep_hea
-0000f430: 6465 725f 6669 656c 6473 5f64 745f 6c61  der_fields_dt_la
-0000f440: 745f 6c6f 6e5f 616c 7428 7365 6c66 2c69  t_lon_alt(self,i
-0000f450: 6664 6f3a 6469 6374 293a 0a20 2020 2020  fdo:dict):.     
-0000f460: 2020 2022 2222 2046 696c 6c20 6865 6164     """ Fill head
-0000f470: 6572 2066 6965 6c64 7320 696d 6167 652d  er fields image-
-0000f480: 6461 7465 7469 6d65 2c20 2d6c 6174 6974  datetime, -latit
-0000f490: 7564 652c 202d 6c6f 6e67 6974 7565 6465  ude, -longituede
-0000f4a0: 2c20 2d61 6c74 6974 7564 652d 6d65 7465  , -altitude-mete
-0000f4b0: 7273 2c20 6966 2065 6d70 7479 2c0a 2020  rs, if empty,.  
-0000f4c0: 2020 2020 2020 7265 7072 6573 656e 7461        representa
-0000f4d0: 7469 7665 6c79 2077 6974 6820 7661 6c75  tively with valu
-0000f4e0: 6573 2066 726f 6d20 6669 7273 7420 6974  es from first it
-0000f4f0: 656d 2e20 2222 220a 2020 2020 2020 2020  em. """.        
-0000f500: 6669 7273 745f 696d 6167 6520 3d20 736f  first_image = so
-0000f510: 7274 6564 2869 6664 6f5b 7365 6c66 2e69  rted(ifdo[self.i
-0000f520: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-0000f530: 2e6b 6579 7328 2929 5b30 5d0a 2020 2020  .keys())[0].    
-0000f540: 2020 2020 7265 705f 6865 6164 6572 5f66      rep_header_f
-0000f550: 6965 6c64 7320 3d20 5b27 696d 6167 652d  ields = ['image-
-0000f560: 6461 7465 7469 6d65 272c 2769 6d61 6765  datetime','image
-0000f570: 2d6c 6174 6974 7564 6527 2c27 696d 6167  -latitude','imag
-0000f580: 652d 6c6f 6e67 6974 7564 6527 2c27 696d  e-longitude','im
-0000f590: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
-0000f5a0: 6572 7327 5d0a 2020 2020 2020 2020 666f  ers'].        fo
-0000f5b0: 7220 6669 656c 6420 696e 2072 6570 5f68  r field in rep_h
-0000f5c0: 6561 6465 725f 6669 656c 6473 3a0a 2020  eader_fields:.  
-0000f5d0: 2020 2020 2020 2020 2020 6966 2066 696e            if fin
-0000f5e0: 6446 6965 6c64 2869 6664 6f5b 7365 6c66  dField(ifdo[self
-0000f5f0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000f600: 6579 5d2c 6669 656c 6429 203d 3d20 2222  ey],field) == ""
-0000f610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f620: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000f630: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
-0000f640: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000f650: 6465 724b 6579 5d5b 6669 656c 645d 203d  derKey][field] =
-0000f660: 2073 656c 662e 5f5f 6765 7446 6965 6c64   self.__getField
-0000f670: 5661 6c75 6528 6966 646f 2c5b 6669 7273  Value(ifdo,[firs
-0000f680: 745f 696d 6167 652c 6669 656c 645d 2c64  t_image,field],d
-0000f690: 6566 6175 6c74 5f6f 6e6c 793d 5472 7565  efault_only=True
-0000f6a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000f6b0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000f6c0: 6c6f 6728 2253 6574 2072 6570 7265 7365  log("Set represe
-0000f6d0: 6e74 6174 6976 6520 6865 6164 6572 2066  ntative header f
-0000f6e0: 6965 6c64 2027 2220 2b20 6669 656c 6420  ield '" + field 
-0000f6f0: 2b20 2227 2074 6f20 2220 2b20 7374 7228  + "' to " + str(
-0000f700: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
-0000f710: 6574 4865 6164 6572 4b65 795d 5b66 6965  etHeaderKey][fie
-0000f720: 6c64 5d29 202b 2022 2066 726f 6d20 6669  ld]) + " from fi
-0000f730: 7273 7420 696d 6167 652e 2229 0a20 2020  rst image.").   
-0000f740: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0000f750: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
-0000f760: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
-0000f770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f780: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000f790: 2822 436f 756c 6420 6e6f 7420 7365 7420  ("Could not set 
-0000f7a0: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
-0000f7b0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
-0000f7c0: 2073 7472 2865 7829 290a 2020 2020 2020   str(ex)).      
-0000f7d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0000f7e0: 7373 0a0a 0a20 2020 2064 6566 205f 7365  ss...    def _se
-0000f7f0: 745f 6c61 745f 6c6f 6e5f 626f 756e 6469  t_lat_lon_boundi
-0000f800: 6e67 5f62 6f78 2873 656c 662c 6966 646f  ng_box(self,ifdo
-0000f810: 3a64 6963 7429 3a0a 2020 2020 2020 2020  :dict):.        
-0000f820: 2222 2220 5365 7420 696d 6167 652d 7365  """ Set image-se
-0000f830: 742d 5b6d 696e 2c6d 6178 5d2d 5b6c 6174  t-[min,max]-[lat
-0000f840: 6974 7564 652c 6c6f 6e67 6974 7564 655d  itude,longitude]
-0000f850: 2d64 6567 7265 6573 2022 2222 0a20 2020  -degrees """.   
-0000f860: 2020 2020 206c 6174 5f6d 696e 2c20 6c61       lat_min, la
-0000f870: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
-0000f880: 6c6f 6e5f 6d61 7820 3d20 7365 6c66 2e5f  lon_max = self._
-0000f890: 6765 745f 6c61 745f 6c6f 6e5f 626f 756e  get_lat_lon_boun
-0000f8a0: 6469 6e67 5f62 6f78 2869 6664 6f5b 7365  ding_box(ifdo[se
-0000f8b0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-0000f8c0: 4b65 795d 290a 2020 2020 2020 2020 6966  Key]).        if
-0000f8d0: 206e 6f74 204e 6f6e 6520 696e 205b 6c61   not None in [la
-0000f8e0: 745f 6d69 6e2c 206c 6174 5f6d 6178 2c20  t_min, lat_max, 
-0000f8f0: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
-0000f900: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
-0000f910: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000f920: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0000f930: 6765 2d73 6574 2d6d 696e 2d6c 6174 6974  ge-set-min-latit
-0000f940: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
-0000f950: 6c61 745f 6d69 6e0a 2020 2020 2020 2020  lat_min.        
-0000f960: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-0000f970: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000f980: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
-0000f990: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
-0000f9a0: 275d 203d 206c 6174 5f6d 6178 0a20 2020  '] = lat_max.   
-0000f9b0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-0000f9c0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000f9d0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
-0000f9e0: 2d6d 696e 2d6c 6f6e 6769 7475 6465 2d64  -min-longitude-d
-0000f9f0: 6567 7265 6573 275d 203d 206c 6f6e 5f6d  egrees'] = lon_m
-0000fa00: 696e 0a20 2020 2020 2020 2020 2020 2069  in.            i
-0000fa10: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
-0000fa20: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0000fa30: 6765 2d73 6574 2d6d 6178 2d6c 6f6e 6769  ge-set-max-longi
-0000fa40: 7475 6465 2d64 6567 7265 6573 275d 203d  tude-degrees'] =
-0000fa50: 206c 6f6e 5f6d 6178 0a0a 0a20 2020 2040   lon_max...    @
-0000fa60: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-0000fa70: 2064 6566 205f 6765 745f 6c61 745f 6c6f   def _get_lat_lo
-0000fa80: 6e5f 626f 756e 6469 6e67 5f62 6f78 2869  n_bounding_box(i
-0000fa90: 7465 6d73 3a64 6963 7429 3a0a 2020 2020  tems:dict):.    
-0000faa0: 2020 2020 2222 2220 5265 7475 726e 7320      """ Returns 
-0000fab0: 6c61 745f 6d69 6e2c 206c 6174 5f6d 6178  lat_min, lat_max
-0000fac0: 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d  , lon_min, lon_m
-0000fad0: 6178 2022 2222 0a20 2020 2020 2020 206c  ax """.        l
-0000fae0: 6174 5f6d 696e 2c20 6c61 745f 6d61 782c  at_min, lat_max,
-0000faf0: 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61   lon_min, lon_ma
-0000fb00: 7820 3d20 4e6f 6e65 2c20 4e6f 6e65 2c20  x = None, None, 
-0000fb10: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-0000fb20: 2020 2069 203d 2030 0a20 2020 2020 2020     i = 0.       
-0000fb30: 2066 6f72 2069 6d61 6765 2c20 6461 7461   for image, data
-0000fb40: 2069 6e20 6974 656d 732e 6974 656d 7328   in items.items(
-0000fb50: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
-0000fb60: 206d 616b 6520 696d 6167 6520 656e 7472   make image entr
-0000fb70: 7920 6c69 7374 2028 616c 736f 2069 6620  y list (also if 
-0000fb80: 6974 7320 6120 7069 6374 7572 6529 0a20  its a picture). 
-0000fb90: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000fba0: 7420 6973 696e 7374 616e 6365 2864 6174  t isinstance(dat
-0000fbb0: 612c 206c 6973 7429 3a0a 2020 2020 2020  a, list):.      
-0000fbc0: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0000fbd0: 205b 6461 7461 5d0a 2020 2020 2020 2020   [data].        
-0000fbe0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0000fbf0: 2066 6f72 2074 696d 6570 6f69 6e74 5f64   for timepoint_d
-0000fc00: 6174 6120 696e 2064 6174 613a 0a20 2020  ata in data:.   
-0000fc10: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0000fc20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000fc30: 2020 2020 2020 6c61 7420 3d20 7469 6d65        lat = time
-0000fc40: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
-0000fc50: 652d 6c61 7469 7475 6465 275d 0a20 2020  e-latitude'].   
-0000fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc70: 206c 6f6e 203d 2074 696d 6570 6f69 6e74   lon = timepoint
-0000fc80: 5f64 6174 615b 2769 6d61 6765 2d6c 6f6e  _data['image-lon
-0000fc90: 6769 7475 6465 275d 0a20 2020 2020 2020  gitude'].       
-0000fca0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000fcb0: 4b65 7945 7272 6f72 2061 7320 6578 3a0a  KeyError as ex:.
-0000fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fcd0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0000fce0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000fcf0: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
-0000fd00: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-0000fd10: 5f6d 696e 2c20 6c61 745f 6d61 7820 3d20  _min, lat_max = 
-0000fd20: 6c61 742c 206c 6174 0a20 2020 2020 2020  lat, lat.       
-0000fd30: 2020 2020 2020 2020 2020 2020 206c 6f6e               lon
-0000fd40: 5f6d 696e 2c20 6c6f 6e5f 6d61 7820 3d20  _min, lon_max = 
-0000fd50: 6c6f 6e2c 206c 6f6e 0a20 2020 2020 2020  lon, lon.       
-0000fd60: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd80: 2020 2069 6620 6c61 7420 3c20 6c61 745f     if lat < lat_
-0000fd90: 6d69 6e3a 0a20 2020 2020 2020 2020 2020  min:.           
-0000fda0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-0000fdb0: 5f6d 696e 203d 206c 6174 0a20 2020 2020  _min = lat.     
-0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000fdd0: 6620 6c61 7420 3e20 6c61 745f 6d61 783a  f lat > lat_max:
-0000fde0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fdf0: 2020 2020 2020 2020 206c 6174 5f6d 6178           lat_max
-0000fe00: 203d 206c 6174 0a20 2020 2020 2020 2020   = lat.         
-0000fe10: 2020 2020 2020 2020 2020 2069 6620 6c6f             if lo
-0000fe20: 6e20 3c20 6c6f 6e5f 6d69 6e3a 0a20 2020  n < lon_min:.   
-0000fe30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe40: 2020 2020 206c 6f6e 5f6d 696e 203d 206c       lon_min = l
-0000fe50: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-0000fe60: 2020 2020 2020 2069 6620 6c6f 6e20 3e20         if lon > 
-0000fe70: 6c6f 6e5f 6d61 783a 0a20 2020 2020 2020  lon_max:.       
-0000fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe90: 206c 6f6e 5f6d 6178 203d 206c 6f6e 0a20   lon_max = lon. 
-0000fea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000feb0: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
-0000fec0: 7475 726e 206c 6174 5f6d 696e 2c20 6c61  turn lat_min, la
-0000fed0: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
-0000fee0: 6c6f 6e5f 6d61 780a 0a0a 2020 2020 6465  lon_max...    de
-0000fef0: 6620 7265 6d6f 7665 4974 656d 4669 656c  f removeItemFiel
-0000ff00: 6473 5769 7468 4f6e 6c79 4461 7465 5469  dsWithOnlyDateTi
-0000ff10: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
-0000ff20: 2020 2222 2220 6974 2063 616e 2068 6170    """ it can hap
-0000ff30: 7065 6e20 7468 6174 2061 6e20 696d 6167  pen that an imag
-0000ff40: 6520 7469 6d65 7374 616d 7020 646f 6573  e timestamp does
-0000ff50: 206e 6f74 2063 6f6e 7461 696e 2061 6e79   not contain any
-0000ff60: 2066 6965 6c64 7320 6275 7420 7468 6520   fields but the 
-0000ff70: 7469 6d65 7374 616d 7020 616e 7920 6d6f  timestamp any mo
-0000ff80: 7265 2e20 5468 6f73 6520 6172 6520 7265  re. Those are re
-0000ff90: 6d6f 7665 6420 6865 7265 2e20 2222 2220  moved here. """ 
-0000ffa0: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-0000ffb0: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
-0000ffc0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000ffd0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
-0000ffe0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0000fff0: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
-00010000: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00010010: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
-00010020: 656d 5d2c 6c69 7374 293a 0a20 2020 2020  em],list):.     
-00010030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00010040: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-00010050: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
-00010060: 6974 656d 5d20 3d20 5b73 656c 662e 6966  item] = [self.if
-00010070: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00010080: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
-00010090: 656d 5d5d 0a20 2020 2020 2020 2020 2020  em]].           
-000100a0: 2074 6f42 6552 656d 6f76 6564 203d 205b   toBeRemoved = [
-000100b0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-000100c0: 7220 656e 7472 7920 696e 2073 656c 662e  r entry in self.
-000100d0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-000100e0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
-000100f0: 6974 656d 5d3a 0a20 2020 2020 2020 2020  item]:.         
-00010100: 2020 2020 2020 2023 7072 696e 7428 656e         #print(en
-00010110: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
-00010120: 2020 2020 2069 6620 6c65 6e28 656e 7472       if len(entr
-00010130: 7929 203d 3d20 3120 616e 6420 2769 6d61  y) == 1 and 'ima
-00010140: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
-00010150: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
-00010160: 2020 2020 2020 2020 2020 2074 6f42 6552             toBeR
-00010170: 656d 6f76 6564 2e61 7070 656e 6428 656e  emoved.append(en
-00010180: 7472 7929 0a20 2020 2020 2020 2020 2020  try).           
-00010190: 2066 6f72 2065 6e74 7279 2069 6e20 746f   for entry in to
-000101a0: 4265 5265 6d6f 7665 643a 0a20 2020 2020  BeRemoved:.     
-000101b0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000101c0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-000101d0: 6167 6553 6574 4974 656d 734b 6579 5d5b  ageSetItemsKey][
-000101e0: 6974 656d 5d2e 7265 6d6f 7665 2865 6e74  item].remove(ent
-000101f0: 7279 2920 0a0a 0a20 2020 2064 6566 2063  ry) ...    def c
-00010200: 6865 636b 416c 6c49 7465 6d48 6173 6865  heckAllItemHashe
-00010210: 7328 7365 6c66 2c20 6861 7264 3d46 616c  s(self, hard=Fal
-00010220: 7365 2c20 7261 6973 6545 7863 6570 7469  se, raiseExcepti
-00010230: 6f6e 203d 2054 7275 6529 3a0a 2020 2020  on = True):.    
-00010240: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
-00010250: 2043 6865 636b 7320 6966 2068 6173 6865   Checks if hashe
-00010260: 7320 696e 2069 4644 4f20 6d61 7463 6820  s in iFDO match 
-00010270: 6861 7368 6573 2069 6e20 696e 7465 726d  hashes in interm
-00010280: 6569 6461 7465 2068 6173 6820 6669 6c65  eidate hash file
-00010290: 2069 6620 7468 6520 6c61 7474 6572 2077   if the latter w
-000102a0: 6173 2063 6861 6e67 6564 206c 6173 7420  as changed last 
-000102b0: 6166 7465 7220 7468 6520 696d 6167 6573  after the images
-000102c0: 2068 6173 2063 6861 6e67 6564 2e0a 2020   has changed..  
-000102d0: 2020 2020 2020 4f74 6865 7277 6973 6520        Otherwise 
-000102e0: 6f72 2069 6620 6861 7264 3d3d 5472 7565  or if hard==True
-000102f0: 2069 7420 7265 6465 7465 726d 696e 6573   it redetermines
-00010300: 2074 6865 2061 6374 7561 6c6c 2066 696c   the actuall fil
-00010310: 6527 7320 6861 7368 2061 6e64 2063 6f6d  e's hash and com
-00010320: 7061 7265 7320 7468 6520 6946 444f 2069  pares the iFDO i
-00010330: 7465 6d27 7320 6861 7368 2077 6974 6820  tem's hash with 
-00010340: 7468 6174 2e0a 2020 2020 2020 2020 4966  that..        If
-00010350: 2068 6173 6865 7320 646f 206e 6f74 206d   hashes do not m
-00010360: 6174 6368 2061 206d 6172 6971 742e 636f  atch a mariqt.co
-00010370: 7265 2e49 6664 6f45 7863 6570 7469 6f6e  re.IfdoException
-00010380: 2069 7320 7269 7365 6e20 756e 736c 6573   is risen unsles
-00010390: 7320 7261 6973 6545 7863 6570 7469 6f6e  s raiseException
-000103a0: 203d 3d20 4661 6c73 652c 2074 6865 6e20   == False, then 
-000103b0: 6120 6c69 7374 206f 6620 6c69 7374 7320  a list of lists 
-000103c0: 5b3c 6669 6c65 3e2c 3c65 7863 6570 7469  [<file>,<excepti
-000103d0: 6f6e 3e5d 2069 7320 7265 7475 726e 6564  on>] is returned
-000103e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000103f0: 2020 2020 2020 6861 7368 6573 203d 207b        hashes = {
-00010400: 7d0a 2020 2020 2020 2020 6861 7368 4669  }.        hashFi
-00010410: 6c65 4d6f 6454 696d 6520 3d20 3130 652b  leModTime = 10e+
-00010420: 3130 300a 2020 2020 2020 2020 6966 206f  100.        if o
-00010430: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00010440: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
-00010450: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-00010460: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
-00010470: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
-00010480: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
-00010490: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
-000104a0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000104b0: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
-000104c0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000104d0: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
-000104e0: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
-000104f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00010500: 6971 7427 5d5b 2769 6d67 275d 290a 2020  iqt']['img']).  
-00010510: 2020 2020 2020 2020 2020 6861 7368 4669            hashFi
-00010520: 6c65 4d6f 6454 696d 6520 3d20 6f73 2e70  leModTime = os.p
-00010530: 6174 682e 6765 746d 7469 6d65 2873 656c  ath.getmtime(sel
-00010540: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
-00010550: 696c 6528 2929 0a0a 2020 2020 2020 2020  ile())..        
-00010560: 6578 6365 7074 696f 6e4c 6973 7420 3d20  exceptionList = 
-00010570: 5b5d 0a0a 2020 2020 2020 2020 6861 7368  []..        hash
-00010580: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
-00010590: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
-000105a0: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
-000105b0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-000105c0: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-000105d0: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
-000105e0: 6e67 2069 7465 6d20 6861 7368 6573 222c  ng item hashes",
-000105f0: 206c 656e 2873 656c 662e 6966 646f 5f74   len(self.ifdo_t
-00010600: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00010610: 4974 656d 734b 6579 5d29 290a 2020 2020  ItemsKey])).    
-00010620: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
-00010630: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00010640: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00010650: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
-00010660: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
-00010670: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00010680: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-00010690: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
-000106a0: 6765 2069 6e20 6861 7368 556e 6368 6563  ge in hashUnchec
-000106b0: 6b49 6d61 6765 7349 6e52 6177 3a0a 2020  kImagesInRaw:.  
-000106c0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-000106d0: 6c65 4e61 6d65 203d 206f 732e 7061 7468  leName = os.path
-000106e0: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
-000106f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010700: 2069 6620 6669 6c65 4e61 6d65 203d 3d20   if fileName == 
-00010710: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
-00010720: 2020 2020 2020 2020 2020 666f 756e 6420            found 
-00010730: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-00010740: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00010750: 696e 7374 616e 6365 2873 656c 662e 6966  instance(self.if
-00010760: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00010770: 6553 6574 4974 656d 734b 6579 5d5b 6974  eSetItemsKey][it
-00010780: 656d 5d2c 6c69 7374 293a 2023 2069 6e20  em],list): # in 
-00010790: 6361 7365 206f 6620 7669 6465 6f20 7769  case of video wi
-000107a0: 7468 2069 7465 6d20 6173 206c 6973 7420  th item as list 
-000107b0: 7468 6520 6669 7273 7420 656e 7472 7920  the first entry 
-000107c0: 686f 6c64 7320 7468 6520 6465 6661 756c  holds the defaul
-000107d0: 7420 616e 6420 7468 6520 6861 7368 2063  t and the hash c
-000107e0: 616e 6e6f 7420 7661 7279 2066 6f72 2074  annot vary for t
-000107f0: 6865 2073 616d 6520 696d 6167 650a 2020  he same image.  
-00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010810: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
-00010820: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
-00010830: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-00010840: 6d73 4b65 795d 5b69 7465 6d5d 5b30 5d20  msKey][item][0] 
-00010850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010860: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00010870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010880: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
-00010890: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-000108a0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-000108b0: 6579 5d5b 6974 656d 5d0a 0a20 2020 2020  ey][item]..     
-000108c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000108d0: 6d61 6765 4d6f 6454 696d 6520 3d20 6f73  mageModTime = os
-000108e0: 2e70 6174 682e 6765 746d 7469 6d65 2869  .path.getmtime(i
-000108f0: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
-00010900: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00010910: 2068 6172 6420 616e 6420 696d 6167 654d   hard and imageM
-00010920: 6f64 5469 6d65 203c 2068 6173 6846 696c  odTime < hashFil
-00010930: 654d 6f64 5469 6d65 3a0a 2020 2020 2020  eModTime:.      
-00010940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010950: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00010960: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
-00010970: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
-00010980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010990: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
-000109a0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-000109b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000109c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000109d0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-000109e0: 7469 6f6e 2869 7465 6d2c 2022 6e6f 7420  tion(item, "not 
-000109f0: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
-00010a00: 6964 6174 6520 6861 7368 2066 696c 6522  idate hash file"
-00010a10: 2c73 656c 662e 6765 745f 696e 745f 6861  ,self.get_int_ha
-00010a20: 7368 5f66 696c 6528 292c 2220 7275 6e20  sh_file()," run 
-00010a30: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
-00010a40: 3235 365f 6669 6c65 2829 2066 6972 7374  256_file() first
-00010a50: 2229 200a 2020 2020 2020 2020 2020 2020  ") .            
-00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a90: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
-00010aa0: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
-00010ab0: 4e61 6d65 2c22 6e6f 7420 666f 756e 6420  Name,"not found 
-00010ac0: 696e 2069 6e74 6572 6d65 6964 6174 6520  in intermeidate 
-00010ad0: 6861 7368 2066 696c 6520 2220 2b20 7374  hash file " + st
-00010ae0: 7228 7365 6c66 2e67 6574 5f69 6e74 5f68  r(self.get_int_h
-00010af0: 6173 685f 6669 6c65 2829 295d 290a 2020  ash_file())]).  
+0000a0a0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
+0000a0b0: 6c74 5f6f 6e6c 793a 0a20 2020 2020 2020  lt_only:.       
+0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0d0: 2020 2020 2072 6574 203d 2076 616c 5f69       ret = val_i
+0000a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0000a100: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+0000a110: 2020 2020 2020 2020 2020 2072 6574 5b74             ret[t
+0000a120: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+0000a130: 6167 652d 6461 7465 7469 6d65 275d 5d20  age-datetime']] 
+0000a140: 3d20 7661 6c5f 690a 2020 2020 2020 2020  = val_i.        
+0000a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a160: 2320 7265 6d6f 7665 2069 6d61 6765 2d64  # remove image-d
+0000a170: 6174 6574 696d 6520 6966 2074 6865 7265  atetime if there
+0000a180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a190: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000a1a0: 7374 616e 6365 2872 6574 5b74 696d 6550  stance(ret[timeP
+0000a1b0: 6f69 6e74 4461 7461 5b27 696d 6167 652d  ointData['image-
+0000a1c0: 6461 7465 7469 6d65 275d 5d2c 6469 6374  datetime']],dict
+0000a1d0: 2920 616e 6420 2769 6d61 6765 2d64 6174  ) and 'image-dat
+0000a1e0: 6574 696d 6527 2069 6e20 7265 745b 7469  etime' in ret[ti
+0000a1f0: 6d65 506f 696e 7444 6174 615b 2769 6d61  mePointData['ima
+0000a200: 6765 2d64 6174 6574 696d 6527 5d5d 3a0a  ge-datetime']]:.
+0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a220: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+0000a230: 7265 745b 7469 6d65 506f 696e 7444 6174  ret[timePointDat
+0000a240: 615b 2769 6d61 6765 2d64 6174 6574 696d  a['image-datetim
+0000a250: 6527 5d5d 5b27 696d 6167 652d 6461 7465  e']]['image-date
+0000a260: 7469 6d65 275d 0a20 2020 2020 2020 2020  time'].         
+0000a270: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000a280: 2076 6964 656f 2064 6566 6175 6c74 730a   video defaults.
+0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2a0: 2020 2020 2020 2020 6966 2069 203d 3d20          if i == 
+0000a2b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000a2d0: 6620 6973 696e 7374 616e 6365 2872 6574  f isinstance(ret
+0000a2e0: 5b74 696d 6550 6f69 6e74 4461 7461 5b27  [timePointData['
+0000a2f0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0000a300: 5d2c 6469 6374 293a 0a20 2020 2020 2020  ],dict):.       
+0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a320: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0000a330: 5661 6c20 3d20 7b2a 2a64 6566 6175 6c74  Val = {**default
+0000a340: 5661 6c2c 2a2a 7265 745b 7469 6d65 506f  Val,**ret[timePo
+0000a350: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+0000a360: 6174 6574 696d 6527 5d5d 7d0a 2020 2020  atetime']]}.    
+0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a380: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0000a3b0: 6661 756c 7456 616c 203d 2072 6574 5b74  faultVal = ret[t
+0000a3c0: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+0000a3d0: 6167 652d 6461 7465 7469 6d65 275d 5d0a  age-datetime']].
+0000a3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a3f0: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
+0000a400: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0000a410: 7374 616e 6365 2872 6574 2c64 6963 7429  stance(ret,dict)
+0000a420: 206f 7220 6973 696e 7374 616e 6365 2872   or isinstance(r
+0000a430: 6574 2c6c 6973 7429 3a0a 2020 2020 2020  et,list):.      
+0000a440: 2020 2020 2020 7265 7420 3d20 636f 7079        ret = copy
+0000a450: 2e64 6565 7063 6f70 7928 7265 7429 0a20  .deepcopy(ret). 
+0000a460: 2020 2020 2020 2069 6620 7265 7420 3d3d         if ret ==
+0000a470: 2022 2220 6f72 2072 6574 203d 3d20 7b7d   "" or ret == {}
+0000a480: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000a490: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+0000a4a0: 6365 7074 696f 6e28 226b 6579 7320 646f  ception("keys do
+0000a4b0: 206e 6f74 2065 7869 7374 3a22 202b 2073   not exist:" + s
+0000a4c0: 7472 286b 6579 7329 290a 2020 2020 2020  tr(keys)).      
+0000a4d0: 2020 7265 7475 726e 2072 6574 0a0a 0a20    return ret... 
+0000a4e0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+0000a4f0: 0a20 2020 2064 6566 205f 5f67 6574 4974  .    def __getIt
+0000a500: 656d 5661 6c75 6528 6974 656d 732c 6b65  emValue(items,ke
+0000a510: 7973 2c73 6b69 7070 6564 496e 4865 6164  ys,skippedInHead
+0000a520: 6572 2c64 6566 6175 6c74 5661 6c29 3a0a  er,defaultVal):.
+0000a530: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000a540: 2023 2069 6e20 6361 7365 2069 7465 6d20   # in case item 
+0000a550: 6973 206e 6f74 2061 206c 6973 7420 2873  is not a list (s
+0000a560: 686f 756c 6420 6e6f 7420 6265 2070 6f73  hould not be pos
+0000a570: 7369 626c 6529 0a20 2020 2020 2020 2069  sible).        i
+0000a580: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0000a590: 2869 7465 6d73 5b6b 6579 735b 305d 5d2c  (items[keys[0]],
+0000a5a0: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+0000a5b0: 2020 2069 7465 6d73 5b6b 6579 735b 305d     items[keys[0]
+0000a5c0: 5d20 3d20 5b69 7465 6d73 5b6b 6579 735b  ] = [items[keys[
+0000a5d0: 305d 5d5d 0a0a 2020 2020 2020 2020 6974  0]]]..        it
+0000a5e0: 656d 5661 6c75 6520 3d20 6669 6e64 4669  emValue = findFi
+0000a5f0: 656c 6428 6974 656d 732c 6b65 7973 290a  eld(items,keys).
+0000a600: 0a20 2020 2020 2020 2069 6620 6974 656d  .        if item
+0000a610: 5661 6c75 6520 3d3d 2022 223a 0a20 2020  Value == "":.   
+0000a620: 2020 2020 2020 2020 2072 6574 203d 2064           ret = d
+0000a630: 6566 6175 6c74 5661 6c0a 2020 2020 2020  efaultVal.      
+0000a640: 2020 2320 696e 2063 6173 6520 6f66 2064    # in case of d
+0000a650: 6963 7473 206a 6f69 6e74 2068 6561 6465  icts joint heade
+0000a660: 7220 616e 6420 6974 656d 2066 6965 6c64  r and item field
+0000a670: 730a 2020 2020 2020 2020 656c 6966 2069  s.        elif i
+0000a680: 7369 6e73 7461 6e63 6528 6974 656d 5661  sinstance(itemVa
+0000a690: 6c75 652c 6469 6374 2920 616e 6420 6465  lue,dict) and de
+0000a6a0: 6661 756c 7456 616c 2021 3d20 2222 3a0a  faultVal != "":.
+0000a6b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000a6c0: 6f74 2069 7369 6e73 7461 6e63 6528 6465  ot isinstance(de
+0000a6d0: 6661 756c 7456 616c 2c64 6963 7429 3a0a  faultVal,dict):.
+0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6f0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0000a700: 4578 6365 7074 696f 6e28 2249 7465 6d20  Exception("Item 
+0000a710: 6669 656c 6420 6973 2064 6963 7420 6275  field is dict bu
+0000a720: 7420 6465 6661 756c 7420 7661 6c75 6520  t default value 
+0000a730: 696e 2068 6561 6465 7220 6973 206e 6f74  in header is not
+0000a740: 3a20 2220 2b20 7374 7228 6b65 7973 2929  : " + str(keys))
+0000a750: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a760: 203d 207b 2a2a 6465 6661 756c 7456 616c   = {**defaultVal
+0000a770: 2c2a 2a69 7465 6d56 616c 7565 7d0a 2020  ,**itemValue}.  
+0000a780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a790: 2020 2020 2020 2020 7265 7420 3d20 6974          ret = it
+0000a7a0: 656d 5661 6c75 650a 2020 2020 2020 2020  emValue.        
+0000a7b0: 7265 7475 726e 2072 6574 0a0a 0a20 2020  return ret...   
+0000a7c0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
+0000a7d0: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
+0000a7e0: 2020 2022 2222 2050 7269 6e74 7320 6375     """ Prints cu
+0000a7f0: 7272 656e 7420 6946 444f 2066 696c 6520  rrent iFDO file 
+0000a800: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000a810: 726e 2079 616d 6c2e 6475 6d70 2873 656c  rn yaml.dump(sel
+0000a820: 662e 6966 646f 5f63 6865 636b 6564 2c20  f.ifdo_checked, 
+0000a830: 6465 6661 756c 745f 7374 796c 653d 4e6f  default_style=No
+0000a840: 6e65 2c20 6465 6661 756c 745f 666c 6f77  ne, default_flow
+0000a850: 5f73 7479 6c65 3d4e 6f6e 652c 2061 6c6c  _style=None, all
+0000a860: 6f77 5f75 6e69 636f 6465 3d54 7275 652c  ow_unicode=True,
+0000a870: 2077 6964 7468 3d66 6c6f 6174 2822 696e   width=float("in
+0000a880: 6622 2929 0a0a 0a20 2020 2064 6566 205f  f"))...    def _
+0000a890: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+0000a8a0: 206b 6579 7329 3a0a 2020 2020 2020 2020   keys):.        
+0000a8b0: 2222 2220 5265 7475 726e 7320 636f 7079  """ Returns copy
+0000a8c0: 206f 6620 6368 6563 6b65 6420 6966 646f   of checked ifdo
+0000a8d0: 2073 6574 206f 7220 6974 656d 2066 6965   set or item fie
+0000a8e0: 6c64 2076 616c 7565 2c20 616c 736f 2063  ld value, also c
+0000a8f0: 6f6e 7369 6465 726e 6720 6465 6661 756c  onsiderng defaul
+0000a900: 7420 7661 6c75 6573 2066 726f 6d20 6865  t values from he
+0000a910: 6164 6572 2e0a 2020 2020 2020 2020 2020  ader..          
+0000a920: 2020 5573 6520 6b65 7973 2061 7320 652e    Use keys as e.
+0000a930: 672e 2027 3c69 7465 6d3e 3a3c 6b65 793e  g. '<item>:<key>
+0000a940: 3a2e 2e2e 272e 2043 616e 2062 6520 7573  :...'. Can be us
+0000a950: 6564 2066 6f72 2068 6561 6465 7220 6669  ed for header fi
+0000a960: 656c 6473 2061 7320 7765 6c6c 2061 7320  elds as well as 
+0000a970: 6974 656d 2066 6965 6c64 732e 0a20 2020  item fields..   
+0000a980: 2020 2020 2020 2020 2049 7465 6d20 696e           Item in
+0000a990: 6465 7820 6361 6e20 6265 206c 6567 6c65  dex can be legle
+0000a9a0: 6374 6564 2c20 696e 2063 6173 6520 6f66  cted, in case of
+0000a9b0: 2076 6964 656f 2061 2064 6963 7420 7b3c   video a dict {<
+0000a9c0: 696d 6167 652d 6461 7461 7469 6d65 3e3a  image-datatime>:
+0000a9d0: 3c76 616c 7565 3e2c 2e2e 2e7d 2069 7320  <value>,...} is 
+0000a9e0: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0000a9f0: 2020 2020 2020 5261 6973 6573 2049 6664        Raises Ifd
+0000aa00: 6f45 7863 6570 7469 6f6e 2069 6620 6974  oException if it
+0000aa10: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
+0000aa20: 742e 2022 2222 0a20 2020 2020 2020 206b  t. """.        k
+0000aa30: 6579 7320 3d20 6b65 7973 2e73 706c 6974  eys = keys.split
+0000aa40: 2827 3a27 290a 2020 2020 2020 2020 7265  (':').        re
+0000aa50: 7475 726e 2073 656c 662e 5f5f 6765 7446  turn self.__getF
+0000aa60: 6965 6c64 5661 6c75 6528 7365 6c66 2e69  ieldValue(self.i
+0000aa70: 6664 6f5f 6368 6563 6b65 642c 6b65 7973  fdo_checked,keys
+0000aa80: 290a 0a0a 2020 2020 6465 6620 6669 6e64  )...    def find
+0000aa90: 546d 7046 6965 6c64 2873 656c 662c 6b65  TmpField(self,ke
+0000aaa0: 7973 293a 0a20 2020 2020 2020 2022 2222  ys):.        """
+0000aab0: 2052 6574 7572 6e73 2063 6f70 7920 6f66   Returns copy of
+0000aac0: 2074 656d 706f 7261 7279 2075 6e63 6865   temporary unche
+0000aad0: 636b 6564 2069 6664 6f20 7365 7420 6f72  cked ifdo set or
+0000aae0: 2069 7465 6d20 6669 656c 6420 7661 6c75   item field valu
+0000aaf0: 652c 2061 6c73 6f20 636f 6e73 6964 6572  e, also consider
+0000ab00: 6e67 2064 6566 6175 6c74 2076 616c 7565  ng default value
+0000ab10: 7320 6672 6f6d 2068 6561 6465 722e 0a20  s from header.. 
+0000ab20: 2020 2020 2020 2020 2020 2055 7365 206b             Use k
+0000ab30: 6579 7320 6173 2065 2e67 2e20 273c 6974  eys as e.g. '<it
+0000ab40: 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27 2e20  em>:<key>:...'. 
+0000ab50: 4361 6e20 6265 2075 7365 6420 666f 7220  Can be used for 
+0000ab60: 6865 6164 6572 2066 6965 6c64 7320 6173  header fields as
+0000ab70: 2077 656c 6c20 6173 2069 7465 6d20 6669   well as item fi
+0000ab80: 656c 6473 2e0a 2020 2020 2020 2020 2020  elds..          
+0000ab90: 2020 4974 656d 2069 6e64 6578 2063 616e    Item index can
+0000aba0: 2062 6520 6c65 676c 6563 7465 642c 2069   be leglected, i
+0000abb0: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
+0000abc0: 6120 6469 6374 207b 3c69 6d61 6765 2d64  a dict {<image-d
+0000abd0: 6174 6174 696d 653e 3a3c 7661 6c75 653e  atatime>:<value>
+0000abe0: 2c2e 2e2e 7d20 6973 2072 6574 7572 6e65  ,...} is returne
+0000abf0: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
+0000ac00: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
+0000ac10: 696f 6e20 6966 2069 7465 6d20 646f 6573  ion if item does
+0000ac20: 206e 6f74 2065 7869 7374 2e20 2222 220a   not exist. """.
+0000ac30: 2020 2020 2020 2020 6b65 7973 203d 206b          keys = k
+0000ac40: 6579 732e 7370 6c69 7428 273a 2729 0a20  eys.split(':'). 
+0000ac50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000ac60: 6c66 2e5f 5f67 6574 4669 656c 6456 616c  lf.__getFieldVal
+0000ac70: 7565 2873 656c 662e 6966 646f 5f74 6d70  ue(self.ifdo_tmp
+0000ac80: 2c6b 6579 7329 0a20 2020 200a 0a20 2020  ,keys).    ..   
+0000ac90: 2064 6566 2066 696e 6454 6d70 4669 656c   def findTmpFiel
+0000aca0: 6432 2873 656c 662c 6b65 7973 293a 0a20  d2(self,keys):. 
+0000acb0: 2020 2020 2020 2022 2222 2053 616d 6520         """ Same 
+0000acc0: 6173 2066 696e 6454 6d70 4669 656c 6420  as findTmpField 
+0000acd0: 696e 7374 6561 6420 6f66 2072 6169 7369  instead of raisi
+0000ace0: 6e67 2065 7863 6570 7469 6f6e 2069 7420  ng exception it 
+0000acf0: 7265 7475 726e 2065 6d70 7479 2073 7472  return empty str
+0000ad00: 696e 672e 2022 2222 0a20 2020 2020 2020  ing. """.       
+0000ad10: 206b 6579 7320 3d20 6b65 7973 2e73 706c   keys = keys.spl
+0000ad20: 6974 2827 3a27 290a 2020 2020 2020 2020  it(':').        
+0000ad30: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000ad40: 2072 6574 203d 2073 656c 662e 5f5f 6765   ret = self.__ge
+0000ad50: 7446 6965 6c64 5661 6c75 6528 7365 6c66  tFieldValue(self
+0000ad60: 2e69 6664 6f5f 746d 702c 6b65 7973 290a  .ifdo_tmp,keys).
+0000ad70: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+0000ad80: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0000ad90: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+0000ada0: 7265 7420 3d20 2222 0a20 2020 2020 2020  ret = "".       
+0000adb0: 2072 6574 7572 6e20 7265 740a 0a0a 2020   return ret...  
+0000adc0: 2020 6465 6620 7365 7469 4644 4f48 6561    def setiFDOHea
+0000add0: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
+0000ade0: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
+0000adf0: 2020 2020 2020 2022 2222 2043 6c65 6172         """ Clear
+0000ae00: 7320 6375 7272 656e 7420 6865 6164 6572  s current header
+0000ae10: 2066 6965 6c64 7320 756e 6420 7365 7473   fields und sets
+0000ae20: 2070 726f 7669 6465 6420 6669 656c 6420   provided field 
+0000ae30: 7661 6c75 6573 2e20 466f 7220 7570 6461  values. For upda
+0000ae40: 7469 6e67 2065 7869 7374 696e 6720 6f6e  ting existing on
+0000ae50: 6573 2075 7365 2075 7064 6174 655f 6966  es use update_if
+0000ae60: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
+0000ae70: 2829 2022 2222 0a20 2020 2020 2020 2073  () """.        s
+0000ae80: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000ae90: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000aea0: 4b65 795d 203d 207b 7d0a 2020 2020 2020  Key] = {}.      
+0000aeb0: 2020 6966 2073 656c 662e 696d 6167 6553    if self.imageS
+0000aec0: 6574 4865 6164 6572 4b65 7920 696e 2068  etHeaderKey in h
+0000aed0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
+0000aee0: 2020 2068 6561 6465 7220 3d20 6865 6164     header = head
+0000aef0: 6572 5b73 656c 662e 696d 6167 6553 6574  er[self.imageSet
+0000af00: 4865 6164 6572 4b65 795d 0a20 2020 2020  HeaderKey].     
+0000af10: 2020 2066 6f72 2066 6965 6c64 2069 6e20     for field in 
+0000af20: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+0000af30: 2020 2020 2369 6620 6669 656c 6420 6e6f      #if field no
+0000af40: 7420 696e 206d 6971 7476 2e69 6664 6f5f  t in miqtv.ifdo_
+0000af50: 6865 6164 6572 5f63 6f72 655f 6669 656c  header_core_fiel
+0000af60: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+0000af70: 2320 2020 2073 656c 662e 7072 6f76 2e6c  #    self.prov.l
+0000af80: 6f67 2822 4361 7574 696f 6e3a 2055 6e6b  og("Caution: Unk
+0000af90: 6e6f 776e 2068 6561 6465 7220 6669 656c  nown header fiel
+0000afa0: 6420 5c22 2220 2b20 6669 656c 6420 2b20  d \"" + field + 
+0000afb0: 225c 222e 204d 6179 6265 2061 2074 7970  "\". Maybe a typ
+0000afc0: 6f3f 204f 7468 6572 7769 7365 2069 676e  o? Otherwise ign
+0000afd0: 6f72 6520 6d65 2e22 290a 2020 2020 2020  ore me.").      
+0000afe0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000aff0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000b000: 7448 6561 6465 724b 6579 5d5b 6669 656c  tHeaderKey][fiel
+0000b010: 645d 203d 2068 6561 6465 725b 6669 656c  d] = header[fiel
+0000b020: 645d 0a0a 0a20 2020 2064 6566 2075 7064  d]...    def upd
+0000b030: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
+0000b040: 6669 656c 6473 2873 656c 662c 2068 6561  fields(self, hea
+0000b050: 6465 723a 2064 6963 7429 3a0a 2020 2020  der: dict):.    
+0000b060: 2020 2020 2222 2220 5570 6461 7465 7320      """ Updates 
+0000b070: 6578 6973 7469 6e67 2068 6561 6465 7220  existing header 
+0000b080: 6669 656c 6473 2022 2222 0a20 2020 2020  fields """.     
+0000b090: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
+0000b0a0: 5365 7448 6561 6465 724b 6579 2069 6e20  SetHeaderKey in 
+0000b0b0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+0000b0c0: 2020 2020 6865 6164 6572 203d 2068 6561      header = hea
+0000b0d0: 6465 725b 7365 6c66 2e69 6d61 6765 5365  der[self.imageSe
+0000b0e0: 7448 6561 6465 724b 6579 5d0a 2020 2020  tHeaderKey].    
+0000b0f0: 2020 2020 6c6f 6720 3d20 6d69 7174 632e      log = miqtc.
+0000b100: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+0000b110: 6544 6963 7473 2873 656c 662e 6966 646f  eDicts(self.ifdo
+0000b120: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000b130: 6574 4865 6164 6572 4b65 795d 2c20 6865  etHeaderKey], he
+0000b140: 6164 6572 290a 2020 2020 2020 2020 7365  ader).        se
+0000b150: 6c66 2e70 726f 762e 6c6f 6728 6c6f 672c  lf.prov.log(log,
+0000b160: 646f 6e74 5368 6f77 3d54 7275 6529 0a0a  dontShow=True)..
+0000b170: 2020 2020 6465 6620 7570 6461 7465 6946      def updateiF
+0000b180: 444f 4865 6164 6572 4669 656c 6473 2873  DOHeaderFields(s
+0000b190: 656c 662c 2068 6561 6465 723a 2064 6963  elf, header: dic
+0000b1a0: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
+0000b1b0: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
+0000b1c0: 2075 7064 6174 655f 6966 646f 5f68 6561   update_ifdo_hea
+0000b1d0: 6465 725f 6669 656c 6473 2022 2222 0a20  der_fields """. 
+0000b1e0: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
+0000b1f0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
+0000b200: 6965 6c64 7328 6865 6164 6572 290a 0a0a  ields(header)...
+0000b210: 2020 2020 6465 6620 5f74 7279 5f75 7067      def _try_upg
+0000b220: 7261 6465 5f74 6f5f 6966 646f 5f76 6572  rade_to_ifdo_ver
+0000b230: 7369 6f6e 5f32 7828 7365 6c66 293a 0a20  sion_2x(self):. 
+0000b240: 2020 2020 2020 2022 2222 2054 7279 2074         """ Try t
+0000b250: 6f20 636f 6e76 6572 7420 6669 656c 6473  o convert fields
+0000b260: 2066 726f 6d20 6946 444f 2076 6572 7369   from iFDO versi
+0000b270: 6f6e 203c 2032 2e30 2e30 2074 6f20 322e  on < 2.0.0 to 2.
+0000b280: 7820 2222 220a 2020 2020 2020 2020 7265  x """.        re
+0000b290: 6164 5f76 6572 7369 6f6e 5f73 7472 203d  ad_version_str =
+0000b2a0: 2022 7631 2e30 2e30 2220 2320 6469 6420   "v1.0.0" # did 
+0000b2b0: 6e6f 7420 6861 7665 2074 6865 2027 696d  not have the 'im
+0000b2c0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
+0000b2d0: 7369 6f6e 2720 6669 656c 6420 7965 740a  sion' field yet.
+0000b2e0: 2020 2020 2020 2020 7472 793a 200a 2020          try: .  
+0000b2f0: 2020 2020 2020 2020 2020 7265 6164 5f76            read_v
+0000b300: 6572 7369 6f6e 5f73 7472 203d 2073 656c  ersion_str = sel
+0000b310: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0000b320: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
+0000b330: 6572 7369 6f6e 2729 0a20 2020 2020 2020  ersion').       
+0000b340: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+0000b350: 646f 4578 6365 7074 696f 6e3a 0a20 2020  doException:.   
+0000b360: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+0000b370: 2020 2020 2020 7265 6164 5f76 6572 7369        read_versi
+0000b380: 6f6e 203d 2056 6572 7369 6f6e 2872 6561  on = Version(rea
+0000b390: 645f 7665 7273 696f 6e5f 7374 7229 0a0a  d_version_str)..
+0000b3a0: 2020 2020 2020 2020 6966 2072 6561 645f          if read_
+0000b3b0: 7665 7273 696f 6e20 3c20 5665 7273 696f  version < Versio
+0000b3c0: 6e28 2232 2e30 2e30 2229 3a0a 2020 2020  n("2.0.0"):.    
+0000b3d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+0000b3e0: 2020 2020 2023 206e 6577 2055 5249 206f       # new URI o
+0000b3f0: 626a 6563 7420 6669 656c 6473 0a20 2020  bject fields.   
+0000b400: 2020 2020 2020 2020 206e 6577 5f75 7269           new_uri
+0000b410: 5f66 6965 6c64 7320 3d20 5b27 696d 6167  _fields = ['imag
+0000b420: 652d 7365 6e73 6f72 272c 2769 6d61 6765  e-sensor','image
+0000b430: 2d65 7665 6e74 272c 2769 6d61 6765 2d70  -event','image-p
+0000b440: 726f 6a65 6374 272c 2769 6d61 6765 2d63  roject','image-c
+0000b450: 6f6e 7465 7874 272c 2769 6d61 6765 2d6c  ontext','image-l
+0000b460: 6963 656e 7365 272c 2769 6d61 6765 2d70  icense','image-p
+0000b470: 6c61 7466 6f72 6d27 5d0a 2020 2020 2020  latform'].      
+0000b480: 2020 2020 2020 666f 7220 7572 695f 6669        for uri_fi
+0000b490: 656c 6420 696e 206e 6577 5f75 7269 5f66  eld in new_uri_f
+0000b4a0: 6965 6c64 733a 0a20 2020 2020 2020 2020  ields:.         
+0000b4b0: 2020 2020 2020 206f 6c64 5f73 7472 5f76         old_str_v
+0000b4c0: 616c 203d 2073 656c 662e 6669 6e64 546d  al = self.findTm
+0000b4d0: 7046 6965 6c64 3228 7572 695f 6669 656c  pField2(uri_fiel
+0000b4e0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0000b4f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000b500: 286f 6c64 5f73 7472 5f76 616c 2c73 7472  (old_str_val,str
+0000b510: 2920 616e 6420 6f6c 645f 7374 725f 7661  ) and old_str_va
+0000b520: 6c20 213d 2022 223a 2020 2020 2020 2020  l != "":        
+0000b530: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b550: 206e 6577 5f6f 626a 5f76 616c 203d 207b   new_obj_val = {
+0000b560: 276e 616d 6527 3a20 6f6c 645f 7374 725f  'name': old_str_
+0000b570: 7661 6c7d 0a20 2020 2020 2020 2020 2020  val}.           
+0000b580: 2020 2020 2020 2020 2069 735f 7572 692c           is_uri,
+0000b590: 206d 7367 203d 206d 6971 7474 2e76 616c   msg = miqtt.val
+0000b5a0: 6964 6174 655f 6167 6169 6e73 745f 7363  idate_against_sc
+0000b5b0: 6865 6d61 286f 6c64 5f73 7472 5f76 616c  hema(old_str_val
+0000b5c0: 2c7b 2274 7970 6522 3a20 2273 7472 696e  ,{"type": "strin
+0000b5d0: 6722 2c22 666f 726d 6174 223a 2022 7572  g","format": "ur
+0000b5e0: 6922 7d29 0a20 2020 2020 2020 2020 2020  i"}).           
+0000b5f0: 2020 2020 2020 2020 2069 6620 6973 5f75           if is_u
+0000b600: 7269 3a0a 2020 2020 2020 2020 2020 2020  ri:.            
+0000b610: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000b620: 6f62 6a5f 7661 6c5b 2775 7269 275d 203d  obj_val['uri'] =
+0000b630: 206f 6c64 5f73 7472 5f76 616c 0a20 2020   old_str_val.   
+0000b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b650: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000b660: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000b670: 6572 4b65 795d 5b75 7269 5f66 6965 6c64  erKey][uri_field
+0000b680: 5d20 3d20 6e65 775f 6f62 6a5f 7661 6c0a  ] = new_obj_val.
+0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6a0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000b6b0: 6728 2241 7574 6f2d 7570 6772 6164 6564  g("Auto-upgraded
+0000b6c0: 2022 202b 2075 7269 5f66 6965 6c64 202b   " + uri_field +
+0000b6d0: 2022 2066 726f 6d20 2220 2b20 6f6c 645f   " from " + old_
+0000b6e0: 7374 725f 7661 6c20 2b20 2220 746f 2022  str_val + " to "
+0000b6f0: 202b 2073 7472 286e 6577 5f6f 626a 5f76   + str(new_obj_v
+0000b700: 616c 2929 0a0a 0a0a 2020 2020 6465 6620  al))....    def 
+0000b710: 7472 7941 7574 6f53 6574 4865 6164 6572  tryAutoSetHeader
+0000b720: 4669 656c 6473 2873 656c 6629 3a0a 2020  Fields(self):.  
+0000b730: 2020 2020 2020 2222 2220 5365 7473 2063        """ Sets c
+0000b740: 6572 7461 696e 2068 6561 6465 7220 6669  ertain header fi
+0000b750: 656c 6473 2065 2e67 2e20 6672 6f6d 2064  elds e.g. from d
+0000b760: 6972 6563 746f 7279 2069 6620 7468 6579  irectory if they
+0000b770: 2061 7265 206e 6f74 2073 6574 2079 6574   are not set yet
+0000b780: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+0000b790: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000b7a0: 6c64 3228 2769 6d61 6765 2d73 656e 736f  ld2('image-senso
+0000b7b0: 7227 2920 3d3d 2022 223a 0a20 2020 2020  r') == "":.     
+0000b7c0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000b7d0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000b7e0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000b7f0: 6167 652d 7365 6e73 6f72 275d 203d 207b  age-sensor'] = {
+0000b800: 276e 616d 6527 3a20 7365 6c66 2e64 6972  'name': self.dir
+0000b810: 2e73 656e 736f 7228 297d 0a20 2020 2020  .sensor()}.     
+0000b820: 2020 2065 6c69 6620 7365 6c66 2e66 696e     elif self.fin
+0000b830: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
+0000b840: 2d73 656e 736f 7227 295b 276e 616d 6527  -sensor')['name'
+0000b850: 5d20 213d 2073 656c 662e 6469 722e 7365  ] != self.dir.se
+0000b860: 6e73 6f72 2829 3a0a 2020 2020 2020 2020  nsor():.        
+0000b870: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000b880: 6728 2243 6175 7469 6f6e 3a20 2769 6d61  g("Caution: 'ima
+0000b890: 6765 2d73 656e 736f 7227 2022 2b20 7374  ge-sensor' "+ st
+0000b8a0: 7228 7365 6c66 2e66 696e 6454 6d70 4669  r(self.findTmpFi
+0000b8b0: 656c 6428 2769 6d61 6765 2d73 656e 736f  eld('image-senso
+0000b8c0: 7227 2929 202b 2022 2064 6966 6665 7273  r')) + " differs
+0000b8d0: 2066 726f 6d20 7365 6e73 6f72 2070 6172   from sensor par
+0000b8e0: 7365 6420 6672 6f6d 2064 6972 6563 746f  sed from directo
+0000b8f0: 7279 3a20 2220 2b20 7365 6c66 2e64 6972  ry: " + self.dir
+0000b900: 2e73 656e 736f 7228 2929 0a0a 2020 2020  .sensor())..    
+0000b910: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
+0000b920: 546d 7046 6965 6c64 3228 2769 6d61 6765  TmpField2('image
+0000b930: 2d65 7665 6e74 2729 203d 3d20 2222 3a0a  -event') == "":.
+0000b940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b950: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000b960: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000b970: 5d5b 2769 6d61 6765 2d65 7665 6e74 275d  ]['image-event']
+0000b980: 203d 207b 276e 616d 6527 3a20 7365 6c66   = {'name': self
+0000b990: 2e64 6972 2e65 7665 6e74 2829 7d0a 2020  .dir.event()}.  
+0000b9a0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+0000b9b0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0000b9c0: 6167 652d 6576 656e 7427 295b 276e 616d  age-event')['nam
+0000b9d0: 6527 5d20 213d 2073 656c 662e 6469 722e  e'] != self.dir.
+0000b9e0: 6576 656e 7428 293a 0a20 2020 2020 2020  event():.       
+0000b9f0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000ba00: 6f67 2822 4361 7574 696f 6e3a 2027 696d  og("Caution: 'im
+0000ba10: 6167 652d 6576 656e 7427 2022 202b 2073  age-event' " + s
+0000ba20: 7472 2873 656c 662e 6669 6e64 546d 7046  tr(self.findTmpF
+0000ba30: 6965 6c64 2827 696d 6167 652d 6576 656e  ield('image-even
+0000ba40: 7427 2929 202b 2022 2064 6966 6665 7273  t')) + " differs
+0000ba50: 2066 726f 6d20 6576 656e 7420 7061 7273   from event pars
+0000ba60: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
+0000ba70: 793a 2022 202b 2073 656c 662e 6469 722e  y: " + self.dir.
+0000ba80: 6576 656e 7428 2929 0a0a 2020 2020 2020  event())..      
+0000ba90: 2020 6966 2073 656c 662e 6669 6e64 546d    if self.findTm
+0000baa0: 7046 6965 6c64 3228 2769 6d61 6765 2d70  pField2('image-p
+0000bab0: 726f 6a65 6374 2729 203d 3d20 2222 3a0a  roject') == "":.
+0000bac0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bad0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000bae0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000baf0: 5d5b 2769 6d61 6765 2d70 726f 6a65 6374  ]['image-project
+0000bb00: 275d 203d 2020 7b27 6e61 6d65 273a 2073  '] =  {'name': s
+0000bb10: 656c 662e 6469 722e 7072 6f6a 6563 7428  elf.dir.project(
+0000bb20: 297d 0a20 2020 2020 2020 2065 6c69 6620  )}.        elif 
+0000bb30: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000bb40: 6428 2769 6d61 6765 2d70 726f 6a65 6374  d('image-project
+0000bb50: 2729 5b27 6e61 6d65 275d 2021 3d20 7365  ')['name'] != se
+0000bb60: 6c66 2e64 6972 2e70 726f 6a65 6374 2829  lf.dir.project()
+0000bb70: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000bb80: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
+0000bb90: 7469 6f6e 3a20 2769 6d61 6765 2d70 726f  tion: 'image-pro
+0000bba0: 6a65 6374 2720 2220 2b20 7374 7228 7365  ject' " + str(se
+0000bbb0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000bbc0: 2769 6d61 6765 2d70 726f 6a65 6374 2729  'image-project')
+0000bbd0: 2920 2b20 2220 6469 6666 6572 7320 6672  ) + " differs fr
+0000bbe0: 6f6d 2070 726f 6a65 6374 2070 6172 7365  om project parse
+0000bbf0: 6420 6672 6f6d 2064 6972 6563 746f 7279  d from directory
+0000bc00: 3a20 2220 2b20 7365 6c66 2e64 6972 2e70  : " + self.dir.p
+0000bc10: 726f 6a65 6374 2829 290a 0a20 2020 2020  roject())..     
+0000bc20: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
+0000bc30: 6d70 4669 656c 6432 2827 696d 6167 652d  mpField2('image-
+0000bc40: 706c 6174 666f 726d 2729 203d 3d20 2222  platform') == ""
+0000bc50: 2061 6e64 2073 656c 662e 6469 722e 6765   and self.dir.ge
+0000bc60: 6172 2829 2021 3d20 2222 3a0a 2020 2020  ar() != "":.    
+0000bc70: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000bc80: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000bc90: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000bca0: 6d61 6765 2d70 6c61 7466 6f72 6d27 5d20  mage-platform'] 
+0000bcb0: 3d20 7b27 6e61 6d65 273a 2073 656c 662e  = {'name': self.
+0000bcc0: 6469 722e 6765 6172 2829 7d0a 0a20 2020  dir.gear()}..   
+0000bcd0: 2020 2020 2069 6620 6e6f 7420 2769 6d61       if not 'ima
+0000bce0: 6765 2d73 6574 2d75 7569 6427 2069 6e20  ge-set-uuid' in 
+0000bcf0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000bd00: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000bd10: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
+0000bd20: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000bd30: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000bd40: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000bd50: 7365 742d 7575 6964 275d 203d 2073 7472  set-uuid'] = str
+0000bd60: 286d 6971 7463 2e75 7569 6434 2829 290a  (miqtc.uuid4()).
+0000bd70: 2020 2020 2020 2020 6966 206e 6f74 2027          if not '
+0000bd80: 696d 6167 652d 7365 742d 6861 6e64 6c65  image-set-handle
+0000bd90: 2720 696e 2073 656c 662e 6966 646f 5f74  ' in self.ifdo_t
+0000bda0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+0000bdb0: 4865 6164 6572 4b65 795d 3a0a 2020 2020  HeaderKey]:.    
+0000bdc0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000bdd0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000bde0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000bdf0: 6d61 6765 2d73 6574 2d68 616e 646c 6527  mage-set-handle'
+0000be00: 5d20 3d20 7365 6c66 2e68 616e 646c 655f  ] = self.handle_
+0000be10: 7072 6566 6978 202b 2022 2f22 202b 2073  prefix + "/" + s
+0000be20: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000be30: 2827 696d 6167 652d 7365 742d 7575 6964  ('image-set-uuid
+0000be40: 2729 0a20 2020 2020 2020 2069 6620 6e6f  ').        if no
+0000be50: 7420 2769 6d61 6765 2d73 6574 2d6e 616d  t 'image-set-nam
+0000be60: 6527 2069 6e20 7365 6c66 2e69 6664 6f5f  e' in self.ifdo_
+0000be70: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000be80: 7448 6561 6465 724b 6579 5d20 6f72 2073  tHeaderKey] or s
+0000be90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000bea0: 3228 2769 6d61 6765 2d73 6574 2d6e 616d  2('image-set-nam
+0000beb0: 6527 2920 3d3d 2022 223a 0a20 2020 2020  e') == "":.     
+0000bec0: 2020 2020 2020 2023 2063 6f6e 7374 7275         # constru
+0000bed0: 6374 2061 7320 3c70 726f 6a65 6374 3e5f  ct as <project>_
+0000bee0: 3c65 7665 6e74 3e5f 3c73 656e 736f 723e  <event>_<sensor>
+0000bef0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0000bf00: 6a65 6374 5f20 3d20 7365 6c66 2e66 696e  ject_ = self.fin
+0000bf10: 6454 6d70 4669 656c 6432 2822 696d 6167  dTmpField2("imag
+0000bf20: 652d 7072 6f6a 6563 7422 295b 276e 616d  e-project")['nam
+0000bf30: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0000bf40: 6576 656e 745f 203d 2073 656c 662e 6669  event_ = self.fi
+0000bf50: 6e64 546d 7046 6965 6c64 3228 2269 6d61  ndTmpField2("ima
+0000bf60: 6765 2d65 7665 6e74 2229 5b27 6e61 6d65  ge-event")['name
+0000bf70: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+0000bf80: 6620 6576 656e 745f 203d 3d20 2222 3a0a  f event_ == "":.
+0000bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfa0: 6576 656e 745f 203d 2073 656c 662e 6469  event_ = self.di
+0000bfb0: 722e 6576 656e 7428 290a 2020 2020 2020  r.event().      
+0000bfc0: 2020 2020 2020 7365 6e73 6f72 5f20 3d20        sensor_ = 
+0000bfd0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000bfe0: 6432 2822 696d 6167 652d 7365 6e73 6f72  d2("image-sensor
+0000bff0: 2229 5b27 6e61 6d65 275d 0a20 2020 2020  ")['name'].     
+0000c000: 2020 2020 2020 2069 6620 7365 6e73 6f72         if sensor
+0000c010: 5f20 3d3d 2022 223a 0a20 2020 2020 2020  _ == "":.       
+0000c020: 2020 2020 2020 2020 2073 656e 736f 725f           sensor_
+0000c030: 203d 2073 656c 662e 6469 722e 7365 6e73   = self.dir.sens
+0000c040: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
+0000c050: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000c060: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000c070: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
+0000c080: 742d 6e61 6d65 275d 203d 2069 4644 4f2e  t-name'] = iFDO.
+0000c090: 636f 6e73 7472 7563 7449 6d61 6765 5365  constructImageSe
+0000c0a0: 744e 616d 6528 7072 6f6a 6563 745f 2c65  tName(project_,e
+0000c0b0: 7665 6e74 5f2c 7365 6e73 6f72 5f29 0a0a  vent_,sensor_)..
+0000c0c0: 2020 2020 2020 2020 2320 7365 7420 7665          # set ve
+0000c0d0: 7273 696f 6e0a 2020 2020 2020 2020 7365  rsion.        se
+0000c0e0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000c0f0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000c100: 6579 5d5b 2769 6d61 6765 2d73 6574 2d69  ey]['image-set-i
+0000c110: 6664 6f2d 7665 7273 696f 6e27 5d20 3d20  fdo-version'] = 
+0000c120: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
+0000c130: 6f6e 0a0a 0a20 2020 2064 6566 2073 6574  on...    def set
+0000c140: 4865 6164 6572 496d 6167 654c 6f63 616c  HeaderImageLocal
+0000c150: 5061 7468 4669 656c 6428 7365 6c66 293a  PathField(self):
+0000c160: 0a20 2020 2020 2020 2022 2222 2053 6574  .        """ Set
+0000c170: 7320 6865 6164 6572 2066 6965 6c64 2027  s header field '
+0000c180: 696d 6167 652d 6c6f 6361 6c2d 7061 7468  image-local-path
+0000c190: 2720 6672 6f6d 2069 6d61 6765 2064 6972  ' from image dir
+0000c1a0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0000c1b0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000c1c0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000c1d0: 795d 5b27 696d 6167 652d 6c6f 6361 6c2d  y]['image-local-
+0000c1e0: 7061 7468 275d 203d 206f 732e 7061 7468  path'] = os.path
+0000c1f0: 2e72 656c 7061 7468 2873 656c 662e 696d  .relpath(self.im
+0000c200: 6167 6573 4469 722c 206f 732e 7061 7468  agesDir, os.path
+0000c210: 2e64 6972 6e61 6d65 2873 656c 662e 6765  .dirname(self.ge
+0000c220: 7469 4644 4f46 696c 654e 616d 6528 2929  tiFDOFileName())
+0000c230: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
+0000c240: 7465 5f66 6965 6c64 7328 7365 6c66 2c20  te_fields(self, 
+0000c250: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
+0000c260: 7175 6972 6564 3d46 616c 7365 293a 0a20  quired=False):. 
+0000c270: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+0000c280: 6520 616e 6420 7661 6c69 6461 7465 2063  e and validate c
+0000c290: 7572 7265 6e74 2068 6561 6465 7220 6669  urrent header fi
+0000c2a0: 656c 6473 2061 6e64 2069 7465 6d20 6669  elds and item fi
+0000c2b0: 656c 6473 2066 726f 6d20 696e 7465 726d  elds from interm
+0000c2c0: 6564 6961 7465 2066 696c 6573 2e20 4f76  ediate files. Ov
+0000c2d0: 6572 7772 6974 6573 2065 7869 7374 696e  erwrites existin
+0000c2e0: 6720 6669 656c 6473 2e20 2222 220a 2020  g fields. """.  
+0000c2f0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
+0000c300: 3d20 7365 6c66 2e5f 6765 745f 6974 656d  = self._get_item
+0000c310: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
+0000c320: 6d65 6469 6174 655f 6669 6c65 7328 290a  mediate_files().
+0000c330: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000c340: 656c 662e 6372 6561 7465 6946 444f 2873  elf.createiFDO(s
+0000c350: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000c360: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000c370: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
+0000c380: 7661 6c75 6573 2829 2c20 616c 6c6f 775f  values(), allow_
+0000c390: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+0000c3a0: 3d61 6c6c 6f77 5f6d 6973 7369 6e67 5f72  =allow_missing_r
+0000c3b0: 6571 7569 7265 6429 0a0a 0a20 2020 2064  equired)...    d
+0000c3c0: 6566 2075 7064 6174 655f 6669 656c 6473  ef update_fields
+0000c3d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000c3e0: 2222 2220 5570 6461 7465 2061 6e64 2076  """ Update and v
+0000c3f0: 616c 6964 6174 6520 6375 7272 656e 7420  alidate current 
+0000c400: 6865 6164 6572 2066 6965 6c64 7320 616e  header fields an
+0000c410: 6420 6974 656d 2066 6965 6c64 7320 6672  d item fields fr
+0000c420: 6f6d 2069 6e74 6572 6d65 6469 6174 6520  om intermediate 
+0000c430: 6669 6c65 732e 2022 2222 0a20 2020 2020  files. """.     
+0000c440: 2020 2069 7465 6d5f 6461 7461 203d 2073     item_data = s
+0000c450: 656c 662e 5f67 6574 5f69 7465 6d5f 6461  elf._get_item_da
+0000c460: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
+0000c470: 6961 7465 5f66 696c 6573 2829 0a20 2020  iate_files().   
+0000c480: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000c490: 2e75 7064 6174 6569 4644 4f28 7365 6c66  .updateiFDO(self
+0000c4a0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000c4b0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000c4c0: 5d2c 2069 7465 6d5f 6461 7461 2e76 616c  ], item_data.val
+0000c4d0: 7565 7328 2929 0a0a 0a20 2020 2064 6566  ues())...    def
+0000c4e0: 2063 7265 6174 6543 6f72 6546 6965 6c64   createCoreField
+0000c4f0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000c500: 2022 2222 2044 4550 5245 4341 4445 542c   """ DEPRECADET,
+0000c510: 2075 7365 2063 7265 6174 655f 6669 656c   use create_fiel
+0000c520: 6473 2829 206f 7220 7570 6461 7465 5f66  ds() or update_f
+0000c530: 6965 6c64 7328 2920 696e 7374 6564 2e0a  ields() insted..
+0000c540: 2020 2020 2020 2020 4669 6c6c 7320 7468          Fills th
+0000c550: 6520 6946 444f 2063 6f72 6520 6669 656c  e iFDO core fiel
+0000c560: 6473 2066 726f 6d20 696e 7465 726d 6564  ds from intermed
+0000c570: 6961 7465 2066 696c 6573 2e20 5769 7468  iate files. With
+0000c580: 6f75 7420 7468 656d 206e 6f20 7661 6c69  out them no vali
+0000c590: 6420 6946 444f 2063 616e 2062 6520 6372  d iFDO can be cr
+0000c5a0: 6561 7465 642e 0a20 2020 2020 2020 2022  eated..        "
+0000c5b0: 2222 0a20 2020 2020 2020 2069 7465 6d5f  "".        item_
+0000c5c0: 6461 7461 203d 2073 656c 662e 5f67 6574  data = self._get
+0000c5d0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
+0000c5e0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
+0000c5f0: 6573 5f63 6f72 6528 290a 2020 2020 2020  es_core().      
+0000c600: 2020 2320 6368 6563 6b20 6669 656c 6473    # check fields
+0000c610: 2066 6f72 2076 616c 6964 6974 790a 2020   for validity.  
+0000c620: 2020 2020 2020 2320 6974 656d 5f64 6174        # item_dat
+0000c630: 6120 636f 6e74 6169 6e73 2066 6965 6c64  a contains field
+0000c640: 2069 6d61 6765 2d66 696c 656e 616d 652c   image-filename,
+0000c650: 2077 6869 6368 2077 6869 6368 2077 696c   which which wil
+0000c660: 6c20 6e6f 7420 6265 2073 746f 7265 6420  l not be stored 
+0000c670: 6173 2061 6e20 6974 656d 2066 6965 6c64  as an item field
+0000c680: 2069 6e20 6946 4f44 2062 7574 2061 7320   in iFOD but as 
+0000c690: 7468 6520 6974 656d 206e 616d 6520 6974  the item name it
+0000c6a0: 7365 6c66 0a20 2020 2020 2020 2072 6574  self.        ret
+0000c6b0: 7572 6e20 7365 6c66 2e75 7064 6174 6569  urn self.updatei
+0000c6c0: 4644 4f28 7365 6c66 2e69 6664 6f5f 746d  FDO(self.ifdo_tm
+0000c6d0: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000c6e0: 6561 6465 724b 6579 5d2c 2069 7465 6d5f  eaderKey], item_
+0000c6f0: 6461 7461 2e76 616c 7565 7328 2929 0a0a  data.values())..
+0000c700: 0a20 2020 2064 6566 2063 7265 6174 6543  .    def createC
+0000c710: 6170 7475 7265 416e 6443 6f6e 7465 6e74  aptureAndContent
+0000c720: 4669 656c 6473 2873 656c 6629 3a0a 2020  Fields(self):.  
+0000c730: 2020 2020 2020 2222 2220 4445 5052 4543        """ DEPREC
+0000c740: 4144 4554 2c20 7573 6520 6372 6561 7465  ADET, use create
+0000c750: 5f66 6965 6c64 7328 2920 6f72 2075 7064  _fields() or upd
+0000c760: 6174 655f 6669 656c 6473 2829 2069 6e73  ate_fields() ins
+0000c770: 7465 642e 0a20 2020 2020 2020 2046 696c  ted..        Fil
+0000c780: 6c73 2074 6865 2069 4644 4f20 6361 7075  ls the iFDO capu
+0000c790: 7472 6520 616e 6420 636f 6e74 656e 7420  tre and content 
+0000c7a0: 6669 6564 7320 6672 6f6d 2070 726f 7669  fieds from provi
+0000c7b0: 6465 6420 6461 7461 2066 6965 6c64 7320  ded data fields 
+0000c7c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000c7d0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
+0000c7e0: 2073 656c 662e 5f67 6574 5f69 7465 6d5f   self._get_item_
+0000c7f0: 6461 7461 5f66 726f 6d5f 696e 7465 726d  data_from_interm
+0000c800: 6564 6961 7465 5f66 696c 6573 5f6e 6f6e  ediate_files_non
+0000c810: 655f 636f 7265 2829 0a20 2020 2020 2020  e_core().       
+0000c820: 2023 2063 6865 636b 2066 6965 6c64 7320   # check fields 
+0000c830: 666f 7220 7661 6c69 6469 7479 0a20 2020  for validity.   
+0000c840: 2020 2020 2023 2069 7465 6d5f 6461 7461       # item_data
+0000c850: 2063 6f6e 7461 696e 7320 6669 656c 6420   contains field 
+0000c860: 696d 6167 652d 6669 6c65 6e61 6d65 2c20  image-filename, 
+0000c870: 7768 6963 6820 7768 6963 6820 7769 6c6c  which which will
+0000c880: 206e 6f74 2062 6520 7374 6f72 6564 2061   not be stored a
+0000c890: 7320 616e 2069 7465 6d20 6669 656c 6420  s an item field 
+0000c8a0: 696e 2069 464f 4420 6275 7420 6173 2074  in iFOD but as t
+0000c8b0: 6865 2069 7465 6d20 6e61 6d65 2069 7473  he item name its
+0000c8c0: 656c 660a 2020 2020 2020 2020 7265 7475  elf.        retu
+0000c8d0: 726e 2073 656c 662e 7570 6461 7465 6946  rn self.updateiF
+0000c8e0: 444f 2873 656c 662e 6966 646f 5f74 6d70  DO(self.ifdo_tmp
+0000c8f0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000c900: 6164 6572 4b65 795d 2c20 6974 656d 5f64  aderKey], item_d
+0000c910: 6174 612e 7661 6c75 6573 2829 290a 0a20  ata.values()).. 
+0000c920: 2020 200a 2020 2020 6465 6620 5f67 6574     .    def _get
+0000c930: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
+0000c940: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
+0000c950: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
+0000c960: 2020 2222 2220 5265 6164 2064 6174 6120    """ Read data 
+0000c970: 6672 6f6d 2063 6f72 6520 616e 6420 6e6f  from core and no
+0000c980: 6e65 2d63 6f72 6520 696e 7465 726d 6465  ne-core intermde
+0000c990: 6174 6520 6669 6c65 732c 2063 6865 636b  ate files, check
+0000c9a0: 2066 696c 6573 2065 7869 7374 2c20 6164   files exist, ad
+0000c9b0: 6420 2769 6d61 6765 2d68 616e 646c 6527  d 'image-handle'
+0000c9c0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0000c9d0: 7320 6469 6374 206f 6620 666f 726d 207b  s dict of form {
+0000c9e0: 696d 6167 652d 6669 6c65 2d6e 616d 653a  image-file-name:
+0000c9f0: 7b66 6965 6c64 3a76 616c 7565 7d2c 2e2e  {field:value},..
+0000ca00: 2e7d 200a 2020 2020 2020 2020 2222 220a  .} .        """.
+0000ca10: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000ca20: 615f 636f 7265 203d 2073 656c 662e 5f67  a_core = self._g
+0000ca30: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
+0000ca40: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
+0000ca50: 696c 6573 5f63 6f72 6528 290a 2020 2020  iles_core().    
+0000ca60: 2020 2020 6974 656d 5f64 6174 615f 6e6f      item_data_no
+0000ca70: 6e65 5f63 6f72 6520 3d20 7365 6c66 2e5f  ne_core = self._
+0000ca80: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
+0000ca90: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
+0000caa0: 6669 6c65 735f 6e6f 6e65 5f63 6f72 6528  files_none_core(
+0000cab0: 290a 2020 2020 2020 2020 2370 7072 696e  ).        #pprin
+0000cac0: 7428 6974 656d 5f64 6174 615f 6e6f 6e65  t(item_data_none
+0000cad0: 5f63 6f72 6529 0a20 2020 2020 2020 2023  _core).        #
+0000cae0: 7070 7269 6e74 2869 7465 6d5f 6461 7461  pprint(item_data
+0000caf0: 5f63 6f72 6529 0a20 2020 2020 2020 2069  _core).        i
+0000cb00: 7465 6d5f 6461 7461 203d 2069 7465 6d5f  tem_data = item_
+0000cb10: 6461 7461 5f63 6f72 650a 2020 2020 2020  data_core.      
+0000cb20: 2020 6c6f 6720 3d20 6d69 7174 632e 7265    log = miqtc.re
+0000cb30: 6375 7273 6976 656c 7955 7064 6174 6544  cursivelyUpdateD
+0000cb40: 6963 7473 2869 7465 6d5f 6461 7461 2c20  icts(item_data, 
+0000cb50: 6974 656d 5f64 6174 615f 6e6f 6e65 5f63  item_data_none_c
+0000cb60: 6f72 6529 0a20 2020 2020 2020 2023 7070  ore).        #pp
+0000cb70: 7269 6e74 2869 7465 6d5f 6461 7461 290a  rint(item_data).
+0000cb80: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0000cb90: 762e 6c6f 6728 6c6f 672c 646f 6e74 5368  v.log(log,dontSh
+0000cba0: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+0000cbb0: 2072 6574 7572 6e20 6974 656d 5f64 6174   return item_dat
+0000cbc0: 610a 0a20 2020 2064 6566 205f 6765 745f  a..    def _get_
+0000cbd0: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000cbe0: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000cbf0: 735f 6e6f 6e65 5f63 6f72 6528 7365 6c66  s_none_core(self
+0000cc00: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000cc10: 6561 6420 6461 7461 2066 726f 6d20 6e6f  ead data from no
+0000cc20: 6e2d 636f 7265 2069 6e74 6572 6d64 6561  n-core intermdea
+0000cc30: 7465 2066 696c 6573 2e0a 2020 2020 2020  te files..      
+0000cc40: 2020 5265 7475 726e 7320 6469 6374 206f    Returns dict o
+0000cc50: 6620 666f 726d 207b 696d 6167 652d 6669  f form {image-fi
+0000cc60: 6c65 2d6e 616d 653a 7b66 6965 6c64 3a76  le-name:{field:v
+0000cc70: 616c 7565 7d2c 2e2e 2e7d 200a 2020 2020  alue},...} .    
+0000cc80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000cc90: 7265 7120 3d20 7365 6c66 2e6e 6f6e 436f  req = self.nonCo
+0000cca0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
+0000ccb0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
+0000ccc0: 0a0a 2020 2020 2020 2020 6974 656d 5f64  ..        item_d
+0000ccd0: 6174 6120 3d20 7b7d 0a20 2020 2020 2020  ata = {}.       
+0000cce0: 2066 6f72 2072 2069 6e20 7265 713a 0a20   for r in req:. 
+0000ccf0: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+0000cd00: 2e70 6174 682e 6578 6973 7473 2872 2e66  .path.exists(r.f
+0000cd10: 696c 654e 616d 6529 3a0a 2020 2020 2020  ileName):.      
+0000cd20: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000cd30: 7261 7365 4974 656d 4461 7461 4672 6f6d  raseItemDataFrom
+0000cd40: 4669 6c65 2869 7465 6d5f 6461 7461 2c72  File(item_data,r
+0000cd50: 2e66 696c 654e 616d 652c 722e 7365 7061  .fileName,r.sepa
+0000cd60: 7261 746f 722c 722e 6865 6164 6572 2c20  rator,r.header, 
+0000cd70: 722e 6461 7465 7469 6d65 5f66 6f72 6d61  r.datetime_forma
+0000cd80: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0000cd90: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000cda0: 2822 5061 7273 6564 2069 7465 6d20 6461  ("Parsed item da
+0000cdb0: 7461 2066 726f 6d3a 2022 202b 2072 2e66  ta from: " + r.f
+0000cdc0: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
+0000cdd0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000cde0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000cdf0: 7072 6f76 2e6c 6f67 2822 4669 6c65 2064  prov.log("File d
+0000ce00: 6f65 7320 6e6f 7420 6578 6973 7473 3a20  oes not exists: 
+0000ce10: 2220 2b20 722e 6669 6c65 4e61 6d65 290a  " + r.fileName).
+0000ce20: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+0000ce30: 2066 696c 6573 2065 7869 7374 0a20 2020   files exist.   
+0000ce40: 2020 2020 2072 656d 6f76 6520 3d20 5b5d       remove = []
+0000ce50: 0a20 2020 2020 2020 2066 6f72 2069 6d67  .        for img
+0000ce60: 2069 6e20 6974 656d 5f64 6174 613a 0a20   in item_data:. 
+0000ce70: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000ce80: 7420 696d 6720 696e 2073 656c 662e 5f69  t img in self._i
+0000ce90: 6d61 6765 4e61 6d65 7349 6d61 6765 7344  mageNamesImagesD
+0000cea0: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
+0000ceb0: 2020 2020 7265 6d6f 7665 2e61 7070 656e      remove.appen
+0000cec0: 6428 696d 6729 0a20 2020 2020 2020 2066  d(img).        f
+0000ced0: 6f72 2069 6d67 2069 6e20 7265 6d6f 7665  or img in remove
+0000cee0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
+0000cef0: 6c20 6974 656d 5f64 6174 615b 696d 675d  l item_data[img]
+0000cf00: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000cf10: 2069 7465 6d5f 6461 7461 0a0a 0a20 2020   item_data...   
+0000cf20: 2064 6566 205f 6765 745f 6974 656d 5f64   def _get_item_d
+0000cf30: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000cf40: 6469 6174 655f 6669 6c65 735f 636f 7265  diate_files_core
+0000cf50: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000cf60: 2222 2220 5265 6164 2064 6174 6120 6672  """ Read data fr
+0000cf70: 6f6d 2063 6f72 6520 696e 7465 726d 6465  om core intermde
+0000cf80: 6174 6520 6669 6c65 732c 2063 6865 636b  ate files, check
+0000cf90: 2066 696c 6573 2065 7869 7374 2c20 6164   files exist, ad
+0000cfa0: 6420 2769 6d61 6765 2d68 616e 646c 6527  d 'image-handle'
+0000cfb0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+0000cfc0: 7320 6469 6374 206f 6620 666f 726d 207b  s dict of form {
+0000cfd0: 696d 6167 652d 6669 6c65 2d6e 616d 653a  image-file-name:
+0000cfe0: 7b66 6965 6c64 3a76 616c 7565 7d2c 2e2e  {field:value},..
+0000cff0: 2e7d 200a 2020 2020 2020 2020 2222 220a  .} .        """.
+0000d000: 0a20 2020 2020 2020 2023 2057 6869 6368  .        # Which
+0000d010: 2066 696c 6573 2063 6f6e 7461 696e 2074   files contain t
+0000d020: 6865 2069 6e66 6f72 6d61 7469 6f6e 206e  he information n
+0000d030: 6565 6465 6420 746f 2063 7265 6174 6520  eeded to create 
+0000d040: 7468 6520 6946 444f 2069 7465 6d73 2063  the iFDO items c
+0000d050: 6f72 6520 696e 666f 726d 6174 696f 6e20  ore information 
+0000d060: 616e 6420 7768 6963 6820 636f 6c75 6d6e  and which column
+0000d070: 7320 7368 616c 6c20 6265 2075 7365 640a  s shall be used.
+0000d080: 2020 2020 2020 2020 7265 7120 3d20 7365          req = se
+0000d090: 6c66 2e69 6e74 6572 6d65 6469 6174 6546  lf.intermediateF
+0000d0a0: 696c 6573 4465 665f 636f 7265 0a0a 2020  ilesDef_core..  
+0000d0b0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
+0000d0c0: 3d20 7b7d 0a20 2020 2020 2020 2070 726f  = {}.        pro
+0000d0d0: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
+0000d0e0: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
+0000d0f0: 2250 6172 7369 6e67 2069 6e74 6572 6d65  "Parsing interme
+0000d100: 6469 6174 6520 6461 7461 222c 206c 656e  diate data", len
+0000d110: 2872 6571 2929 0a20 2020 2020 2020 2066  (req)).        f
+0000d120: 6f72 2072 2069 6e20 7265 713a 0a20 2020  or r in req:.   
+0000d130: 2020 2020 2020 2020 2070 726f 672e 7072           prog.pr
+0000d140: 6f67 7265 7373 2829 0a20 2020 2020 2020  ogress().       
+0000d150: 2020 2020 2066 696c 6520 3d20 7365 6c66       file = self
+0000d160: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0000d170: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
+0000d180: 5d5b 2773 7566 6669 7827 5d0a 2020 2020  ]['suffix'].    
+0000d190: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0000d1a0: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
+0000d1b0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0000d1c0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000d1d0: 6f67 2822 5741 524e 494e 4721 2046 6f72  og("WARNING! For
+0000d1e0: 2061 6368 6965 7669 6e67 2046 4149 526e   achieving FAIRn
+0000d1f0: 6573 7320 616e 2069 6e74 6572 6d65 6469  ess an intermedi
+0000d200: 6174 6520 696d 6167 6520 696e 666f 2066  ate image info f
+0000d210: 696c 6520 6973 206d 6973 7369 6e67 3a20  ile is missing: 
+0000d220: 222b 2073 656c 662e 5f5f 6765 745f 696e  "+ self.__get_in
+0000d230: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
+0000d240: 2b20 7265 715b 725d 5b27 7375 6666 6978  + req[r]['suffix
+0000d250: 275d 2b20 2220 7275 6e20 6669 7273 743a  ']+ " run first:
+0000d260: 2022 202b 2072 6571 5b72 5d5b 2763 7265   " + req[r]['cre
+0000d270: 6174 696f 6e46 6374 275d 290a 2020 2020  ationFct']).    
+0000d280: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000d290: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d2a0: 6c66 2e70 6172 7365 4974 656d 4461 7461  lf.parseItemData
+0000d2b0: 6672 6f6d 5461 6246 696c 6544 6174 6128  fromTabFileData(
+0000d2c0: 6974 656d 5f64 6174 612c 2066 696c 652c  item_data, file,
+0000d2d0: 2072 6571 5b72 5d5b 2763 6f6c 7327 5d2c   req[r]['cols'],
+0000d2e0: 2072 6571 5b72 5d5b 276f 7074 696f 6e61   req[r]['optiona
+0000d2f0: 6c27 5d29 0a20 2020 2020 2020 2020 2020  l']).           
+0000d300: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000d310: 6f67 2822 5061 7273 6564 2069 7465 6d20  og("Parsed item 
+0000d320: 6461 7461 2066 726f 6d3a 2022 202b 2066  data from: " + f
+0000d330: 696c 6529 0a0a 2020 2020 2020 2020 7072  ile)..        pr
+0000d340: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
+0000d350: 2020 2069 6620 6c65 6e28 6974 656d 5f64     if len(item_d
+0000d360: 6174 6129 203d 3d20 303a 0a20 2020 2020  ata) == 0:.     
+0000d370: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000d380: 6570 7469 6f6e 2822 4e6f 2069 4644 4f20  eption("No iFDO 
+0000d390: 6974 656d 7322 290a 0a20 2020 2020 2020  items")..       
+0000d3a0: 2023 2063 6865 636b 2066 696c 6573 2065   # check files e
+0000d3b0: 7869 7374 0a20 2020 2020 2020 2072 656d  xist.        rem
+0000d3c0: 6f76 6520 3d20 5b5d 0a20 2020 2020 2020  ove = [].       
+0000d3d0: 2066 6f72 2069 6d67 2069 6e20 6974 656d   for img in item
+0000d3e0: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
+0000d3f0: 2020 2069 6620 6e6f 7420 696d 6720 696e     if not img in
+0000d400: 2073 656c 662e 5f69 6d61 6765 4e61 6d65   self._imageName
+0000d410: 7349 6d61 6765 7344 6972 3a0a 2020 2020  sImagesDir:.    
+0000d420: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+0000d430: 7665 2e61 7070 656e 6428 696d 6729 0a20  ve.append(img). 
+0000d440: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
+0000d450: 6e20 7265 6d6f 7665 3a0a 2020 2020 2020  n remove:.      
+0000d460: 2020 2020 2020 6465 6c20 6974 656d 5f64        del item_d
+0000d470: 6174 615b 696d 675d 0a0a 2020 2020 2020  ata[img]..      
+0000d480: 2020 2320 6164 6420 696d 6167 652d 7572    # add image-ur
+0000d490: 6c0a 2020 2020 2020 2020 666f 7220 696d  l.        for im
+0000d4a0: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
+0000d4b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000d4c0: 7369 6e73 7461 6e63 6528 6974 656d 5f64  sinstance(item_d
+0000d4d0: 6174 615b 696d 675d 2c6c 6973 7429 3a20  ata[img],list): 
+0000d4e0: 2320 6974 656d 2069 7320 616c 7265 6164  # item is alread
+0000d4f0: 7920 6120 6c69 7374 2028 7669 6465 6f29  y a list (video)
+0000d500: 2062 7574 2070 6172 7365 6420 6461 7461   but parsed data
+0000d510: 2069 7320 6e6f 742c 2069 2e65 2e20 7061   is not, i.e. pa
+0000d520: 7273 6564 2064 6174 6120 7265 6665 7273  rsed data refers
+0000d530: 2074 6f20 7768 6f6c 6520 7669 6465 6f20   to whole video 
+0000d540: 2874 696d 6520 696e 6465 7065 6e64 656e  (time independen
+0000d550: 7429 2c20 692e 652e 2077 7269 7465 2074  t), i.e. write t
+0000d560: 6f20 6669 7273 7420 656e 7472 790a 2020  o first entry.  
+0000d570: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+0000d580: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
+0000d590: 7465 6d5f 6461 7461 5b69 6d67 5d5b 305d  tem_data[img][0]
+0000d5a0: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d5c0: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
+0000d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5e0: 2020 7072 696e 7428 6974 656d 5f64 6174    print(item_dat
+0000d5f0: 615b 696d 675d 290a 2020 2020 2020 2020  a[img]).        
+0000d600: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d610: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+0000d620: 7074 696f 6e28 2275 7569 6420 6e6f 7420  ption("uuid not 
+0000d630: 666f 756e 6420 2861 2922 290a 2020 2020  found (a)").    
+0000d640: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0000d650: 5f64 6174 615b 696d 675d 5b30 5d5b 2769  _data[img][0]['i
+0000d660: 6d61 6765 2d68 616e 646c 6527 5d20 3d20  mage-handle'] = 
+0000d670: 7365 6c66 2e69 6d61 6765 5f68 616e 646c  self.image_handl
+0000d680: 655f 7072 6566 6978 202b 2027 4027 202b  e_prefix + '@' +
+0000d690: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
+0000d6a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000d6b0: 2020 2020 2020 2020 7575 6964 203d 2066          uuid = f
+0000d6c0: 696e 6446 6965 6c64 2869 7465 6d5f 6461  indField(item_da
+0000d6d0: 7461 5b69 6d67 5d2c 2769 6d61 6765 2d75  ta[img],'image-u
+0000d6e0: 7569 6427 290a 2020 2020 2020 2020 2020  uid').          
+0000d6f0: 2020 2020 2020 6966 2075 7569 6420 3d3d        if uuid ==
+0000d700: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+0000d710: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0000d720: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0000d730: 6f6e 2822 7575 6964 206e 6f74 2066 6f75  on("uuid not fou
+0000d740: 6e64 2028 6229 2229 0a20 2020 2020 2020  nd (b)").       
+0000d750: 2020 2020 2020 2020 2069 7465 6d5f 6461           item_da
+0000d760: 7461 5b69 6d67 5d5b 2769 6d61 6765 2d68  ta[img]['image-h
+0000d770: 616e 646c 6527 5d20 3d20 7365 6c66 2e69  andle'] = self.i
+0000d780: 6d61 6765 5f68 616e 646c 655f 7072 6566  mage_handle_pref
+0000d790: 6978 202b 2027 4027 202b 2075 7569 640a  ix + '@' + uuid.
+0000d7a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000d7b0: 6974 656d 5f64 6174 610a 0a0a 2020 2020  item_data...    
+0000d7c0: 6465 6620 6164 645f 6974 656d 5f69 6e66  def add_item_inf
+0000d7d0: 6f5f 7461 625f 6669 6c65 2873 656c 662c  o_tab_file(self,
+0000d7e0: 2066 696c 654e 616d 653a 2073 7472 2c20   fileName: str, 
+0000d7f0: 7365 7061 7261 746f 723a 7374 722c 2068  separator:str, h
+0000d800: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
+0000d810: 7469 6d65 5f66 6f72 6d61 7420 3d20 6d69  time_format = mi
+0000d820: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+0000d830: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
+0000d840: 2020 2020 2022 2222 2041 6464 2061 2063       """ Add a c
+0000d850: 6f6c 756d 6e20 7365 7065 7261 7465 6420  olumn seperated 
+0000d860: 7465 7874 2066 696c 6520 746f 2070 6172  text file to par
+0000d870: 7365 2069 7465 6d20 6461 7461 2066 726f  se item data fro
+0000d880: 6d20 6279 2063 7265 6174 6543 6170 7475  m by createCaptu
+0000d890: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
+0000d8a0: 6473 2829 2e20 0a20 2020 2020 2020 2043  ds(). .        C
+0000d8b0: 6f6c 756d 6e73 2068 6561 6465 7273 2077  olumns headers w
+0000d8c0: 696c 6c20 6265 2073 6574 2061 7320 6974  ill be set as it
+0000d8d0: 656d 2066 6965 6c64 206e 616d 6573 2e20  em field names. 
+0000d8e0: 4d75 7374 2063 6f6e 7461 696e 2063 6f6c  Must contain col
+0000d8f0: 756d 6e20 2769 6d61 6765 2d66 696c 656e  umn 'image-filen
+0000d900: 616d 6527 2e0a 2020 2020 2020 2020 2222  ame'..        ""
+0000d910: 220a 2020 2020 2020 2020 6966 2066 696c  ".        if fil
+0000d920: 654e 616d 6520 3d3d 204e 6f6e 6520 6f72  eName == None or
+0000d930: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
+0000d940: 7374 7328 6669 6c65 4e61 6d65 293a 0a20  sts(fileName):. 
+0000d950: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000d960: 2045 7863 6570 7469 6f6e 2822 4669 6c65   Exception("File
+0000d970: 222c 6669 6c65 4e61 6d65 2c22 6e6f 7420  ",fileName,"not 
+0000d980: 666f 756e 6422 290a 0a20 2020 2020 2020  found")..       
+0000d990: 2066 6f72 2066 6965 6c64 2069 6e20 6865   for field in he
+0000d9a0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
+0000d9b0: 2020 6966 2068 6561 6465 725b 6669 656c    if header[fiel
+0000d9c0: 645d 206e 6f74 2069 6e20 6d69 7174 662e  d] not in miqtf.
+0000d9d0: 7461 6246 696c 6543 6f6c 756d 6e4e 616d  tabFileColumnNam
+0000d9e0: 6573 2866 696c 654e 616d 652c 636f 6c5f  es(fileName,col_
+0000d9f0: 7365 7061 7261 746f 723d 7365 7061 7261  separator=separa
+0000da00: 746f 7229 3a0a 2020 2020 2020 2020 2020  tor):.          
+0000da10: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0000da20: 7074 696f 6e28 2243 6f6c 756d 6e22 2c20  ption("Column", 
+0000da30: 6865 6164 6572 5b66 6965 6c64 5d2c 2022  header[field], "
+0000da40: 6e6f 7420 696e 2066 696c 6522 2c20 6669  not in file", fi
+0000da50: 6c65 4e61 6d65 290a 0a20 2020 2020 2020  leName)..       
+0000da60: 2069 6620 6d69 7174 632e 6173 7365 7274   if miqtc.assert
+0000da70: 536c 6173 6828 6f73 2e70 6174 682e 6469  Slash(os.path.di
+0000da80: 726e 616d 6528 6669 6c65 4e61 6d65 2929  rname(fileName))
+0000da90: 2021 3d20 6d69 7174 632e 6173 7365 7274   != miqtc.assert
+0000daa0: 536c 6173 6828 7365 6c66 2e64 6972 2e74  Slash(self.dir.t
+0000dab0: 6f28 7365 6c66 2e64 6972 2e64 742e 696e  o(self.dir.dt.in
+0000dac0: 7465 726d 6564 6961 7465 2929 3a0a 2020  termediate)):.  
+0000dad0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000dae0: 726f 762e 6c6f 6728 2022 4361 7574 696f  rov.log( "Cautio
+0000daf0: 6e3a 2049 7420 6973 2072 6563 6f6d 6d65  n: It is recomme
+0000db00: 6e64 6564 2074 6f20 7075 7420 6669 6c65  nded to put file
+0000db10: 2069 6e20 7468 6520 6469 7265 6374 6f72   in the director
+0000db20: 7927 7320 2769 6e74 6572 6d65 6469 6174  y's 'intermediat
+0000db30: 6527 2066 6f6c 6465 723a 2022 202b 2066  e' folder: " + f
+0000db40: 696c 654e 616d 6529 0a20 2020 2020 2020  ileName).       
+0000db50: 206e 6366 6969 6620 3d20 6e6f 6e43 6f72   ncfiif = nonCor
+0000db60: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
+0000db70: 7465 4974 656d 496e 666f 4669 6c65 2866  teItemInfoFile(f
+0000db80: 696c 654e 616d 652c 2073 6570 6172 6174  ileName, separat
+0000db90: 6f72 2c20 6865 6164 6572 2c20 6461 7465  or, header, date
+0000dba0: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
+0000dbb0: 2020 2020 2069 6620 6e63 6669 6966 206e       if ncfiif n
+0000dbc0: 6f74 2069 6e20 7365 6c66 2e6e 6f6e 436f  ot in self.nonCo
+0000dbd0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
+0000dbe0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
+0000dbf0: 3a20 0a20 2020 2020 2020 2020 2020 2073  : .            s
+0000dc00: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000dc10: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000dc20: 496e 666f 4669 6c65 732e 6170 7065 6e64  InfoFiles.append
+0000dc30: 286e 6366 6969 6629 0a0a 2020 2020 6465  (ncfiif)..    de
+0000dc40: 6620 6164 6449 7465 6d49 6e66 6f54 6162  f addItemInfoTab
+0000dc50: 4669 6c65 2873 656c 662c 2066 696c 654e  File(self, fileN
+0000dc60: 616d 653a 2073 7472 2c20 7365 7061 7261  ame: str, separa
+0000dc70: 746f 723a 7374 722c 2068 6561 6465 723a  tor:str, header:
+0000dc80: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
+0000dc90: 6f72 6d61 7420 3d20 6d69 7174 762e 6461  ormat = miqtv.da
+0000dca0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0000dcb0: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
+0000dcc0: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+0000dcd0: 7573 6520 6164 645f 6974 656d 5f69 6e66  use add_item_inf
+0000dce0: 6f5f 7461 625f 6669 6c65 2022 2222 0a20  o_tab_file """. 
+0000dcf0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+0000dd00: 6974 656d 5f69 6e66 6f5f 7461 625f 6669  item_info_tab_fi
+0000dd10: 6c65 2866 696c 654e 616d 652c 7365 7061  le(fileName,sepa
+0000dd20: 7261 746f 722c 6865 6164 6572 2c64 6174  rator,header,dat
+0000dd30: 6574 696d 655f 666f 726d 6174 290a 0a20  etime_format).. 
+0000dd40: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
+0000dd50: 7265 6d6f 7665 4974 656d 496e 666f 5461  removeItemInfoTa
+0000dd60: 6246 696c 6528 7365 6c66 2c20 6669 6c65  bFile(self, file
+0000dd70: 4e61 6d65 3a20 7374 722c 2073 6570 6172  Name: str, separ
+0000dd80: 6174 6f72 3a73 7472 2c20 6865 6164 6572  ator:str, header
+0000dd90: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
+0000dda0: 666f 726d 6174 3a73 7472 293a 0a20 2020  format:str):.   
+0000ddb0: 2020 2020 2022 2222 2072 656d 6f76 6573       """ removes
+0000ddc0: 2066 696c 6520 6974 656d 2066 726f 6d20   file item from 
+0000ddd0: 6c69 7374 206f 6620 6669 6c65 7320 746f  list of files to
+0000dde0: 2070 6172 7365 2069 7465 6d20 6461 7461   parse item data
+0000ddf0: 2066 726f 6d20 6279 2063 7265 6174 6543   from by createC
+0000de00: 6170 7475 7265 416e 6443 6f6e 7465 6e74  aptureAndContent
+0000de10: 4669 656c 6473 2829 2022 2222 0a20 2020  Fields() """.   
+0000de20: 2020 2020 206e 6366 6969 6620 3d20 6e6f       ncfiif = no
+0000de30: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
+0000de40: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
+0000de50: 6c65 2866 696c 654e 616d 652c 2073 6570  le(fileName, sep
+0000de60: 6172 6174 6f72 2c20 6865 6164 6572 2c20  arator, header, 
+0000de70: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
+0000de80: 0a20 2020 2020 2020 2069 6620 6e63 6669  .        if ncfi
+0000de90: 6966 2069 6e20 7365 6c66 2e6e 6f6e 436f  if in self.nonCo
+0000dea0: 7265 4669 656c 6449 6e74 6572 6d65 6469  reFieldIntermedi
+0000deb0: 6174 6549 7465 6d49 6e66 6f46 696c 6573  ateItemInfoFiles
+0000dec0: 3a20 0a20 2020 2020 2020 2020 2020 2073  : .            s
+0000ded0: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000dee0: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000def0: 496e 666f 4669 6c65 732e 7265 6d6f 7665  InfoFiles.remove
+0000df00: 286e 6366 6969 6629 0a0a 0a20 2020 2064  (ncfiif)...    d
+0000df10: 6566 2075 7064 6174 6569 4644 4f28 7365  ef updateiFDO(se
+0000df20: 6c66 2c20 6865 6164 6572 3a20 6469 6374  lf, header: dict
+0000df30: 2c20 6974 656d 733a 206c 6973 7429 3a0a  , items: list):.
+0000df40: 2020 2020 2020 2020 2222 2220 5570 6461          """ Upda
+0000df50: 7465 7320 7468 6520 6375 7272 656e 7420  tes the current 
+0000df60: 7661 6c75 6573 2069 4644 4f20 7769 7468  values iFDO with
+0000df70: 2074 6865 2070 726f 7669 6465 6420 6e65   the provided ne
+0000df80: 7720 7661 6c75 6573 2022 2222 0a20 2020  w values """.   
+0000df90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000dfa0: 2e63 7265 6174 6569 4644 4f28 6865 6164  .createiFDO(head
+0000dfb0: 6572 2c20 6974 656d 732c 2075 7064 6174  er, items, updat
+0000dfc0: 6545 7869 7374 696e 673d 5472 7565 290a  eExisting=True).
+0000dfd0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0000dfe0: 6946 444f 2873 656c 662c 2068 6561 6465  iFDO(self, heade
+0000dff0: 723a 2064 6963 742c 2069 7465 6d73 3a20  r: dict, items: 
+0000e000: 6c69 7374 2c20 7570 6461 7465 4578 6973  list, updateExis
+0000e010: 7469 6e67 3d46 616c 7365 2c68 6561 6465  ting=False,heade
+0000e020: 724f 6e6c 793d 4661 6c73 652c 616c 6c6f  rOnly=False,allo
+0000e030: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+0000e040: 6564 3d46 616c 7365 293a 0a20 2020 2020  ed=False):.     
+0000e050: 2020 2022 2222 2043 7265 6174 6573 2046     """ Creates F
+0000e060: 4149 5220 6469 6769 7461 6c20 6f62 6a65  AIR digital obje
+0000e070: 6374 2066 6f72 2074 6865 2069 6d61 6765  ct for the image
+0000e080: 2064 6174 6120 6974 7365 6c66 2e20 5468   data itself. Th
+0000e090: 6973 2063 6f6e 7369 7374 7320 6f66 2068  is consists of h
+0000e0a0: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
+0000e0b0: 6e20 616e 6420 6974 656d 2069 6e66 6f72  n and item infor
+0000e0c0: 6d61 7469 6f6e 2e0a 2020 2020 2020 2020  mation..        
+0000e0d0: 7570 6461 7465 4578 6973 7469 6e67 3a20  updateExisting: 
+0000e0e0: 6966 2046 616c 7365 206f 6c64 2076 616c  if False old val
+0000e0f0: 7565 7320 6172 6520 7265 6d6f 7665 642c  ues are removed,
+0000e100: 206f 7468 6572 7769 7365 2074 6865 7920   otherwise they 
+0000e110: 6172 6520 7570 6461 7465 642e 0a20 2020  are updated..   
+0000e120: 2020 2020 2068 6561 6465 724f 6e6c 793a       headerOnly:
+0000e130: 2069 6620 5472 7565 2069 7465 6d73 206d   if True items m
+0000e140: 6179 2062 6520 656d 7074 7920 6c69 7374  ay be empty list
+0000e150: 2e0a 2020 2020 2020 2020 616c 6c6f 775f  ..        allow_
+0000e160: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+0000e170: 3a20 6966 2054 7275 652c 206e 6f20 6578  : if True, no ex
+0000e180: 6365 7074 696f 6e20 7269 7365 6e20 6966  ception risen if
+0000e190: 2061 2072 6571 7569 7265 6420 6669 656c   a required fiel
+0000e1a0: 6420 6973 206d 6973 7369 6e67 2e20 2022  d is missing.  "
+0000e1b0: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+0000e1c0: 6f74 2075 7064 6174 6545 7869 7374 696e  ot updateExistin
+0000e1d0: 6720 616e 6420 6c65 6e28 6974 656d 7329  g and len(items)
+0000e1e0: 203d 3d20 3020 616e 6420 6e6f 7420 6865   == 0 and not he
+0000e1f0: 6164 6572 4f6e 6c79 3a0a 2020 2020 2020  aderOnly:.      
+0000e200: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0000e210: 7074 696f 6e28 274e 6f20 6974 656d 2069  ption('No item i
+0000e220: 6e66 6f72 6d61 7469 6f6e 2067 6976 656e  nformation given
+0000e230: 2729 0a0a 2020 2020 2020 2020 6966 2075  ')..        if u
+0000e240: 7064 6174 6545 7869 7374 696e 673a 0a20  pdateExisting:. 
+0000e250: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
+0000e260: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+0000e270: 7365 6c66 2e75 7064 6174 655f 6966 646f  self.update_ifdo
+0000e280: 5f68 6561 6465 725f 6669 656c 6473 2868  _header_fields(h
+0000e290: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
+0000e2a0: 2020 2023 2069 7465 6d73 0a20 2020 2020     # items.     
+0000e2b0: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
+0000e2c0: 636f 7079 206f 6620 6375 7272 656e 7420  copy of current 
+0000e2d0: 6974 656d 7320 7769 7468 206e 6577 2069  items with new i
+0000e2e0: 7465 6d73 2066 6965 6c64 730a 2020 2020  tems fields.    
+0000e2f0: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
+0000e300: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
+0000e310: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
+0000e320: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
+0000e330: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
+0000e340: 2020 2020 7570 6461 7465 6449 7465 6d73      updatedItems
+0000e350: 5f63 6f70 7920 3d20 636f 7079 2e64 6565  _copy = copy.dee
+0000e360: 7063 6f70 7928 7365 6c66 2e69 6664 6f5f  pcopy(self.ifdo_
+0000e370: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e380: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
+0000e390: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
+0000e3a0: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
+0000e3b0: 7064 6174 6544 6963 7473 2875 7064 6174  pdateDicts(updat
+0000e3c0: 6564 4974 656d 735f 636f 7079 2c20 6974  edItems_copy, it
+0000e3d0: 656d 7344 6963 7429 0a20 2020 2020 2020  emsDict).       
+0000e3e0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000e3f0: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
+0000e400: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000e410: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
+0000e420: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
+0000e430: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
+0000e440: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
+0000e450: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
+0000e460: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000e470: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
+0000e480: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+0000e490: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
+0000e4a0: 4865 6164 6572 4669 656c 6473 2868 6561  HeaderFields(hea
+0000e4b0: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000e4c0: 2023 2063 6c65 6172 2069 7465 6d73 2073   # clear items s
+0000e4d0: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+0000e4e0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000e4f0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+0000e500: 656d 734b 6579 5d20 3d20 7b7d 0a0a 0a20  emsKey] = {}... 
+0000e510: 2020 2020 2020 2023 2050 6172 7365 2069         # Parse i
+0000e520: 6d61 6765 2d61 6273 7472 6163 7420 616e  mage-abstract an
+0000e530: 6420 6669 6c6c 2069 7473 2070 6c61 6365  d fill its place
+0000e540: 686f 6c64 6572 7320 7769 7468 2069 6e66  holders with inf
+0000e550: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
+0000e560: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000e570: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000e580: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000e590: 6465 724b 6579 5d5b 2769 6d61 6765 2d61  derKey]['image-a
+0000e5a0: 6273 7472 6163 7427 5d20 3d20 6d69 7174  bstract'] = miqt
+0000e5b0: 732e 7061 7273 6552 6570 6c61 6365 5661  s.parseReplaceVa
+0000e5c0: 6c28 7365 6c66 2e69 6664 6f5f 746d 705b  l(self.ifdo_tmp[
+0000e5d0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000e5e0: 6465 724b 6579 5d2c 2027 696d 6167 652d  derKey], 'image-
+0000e5f0: 6162 7374 7261 6374 2729 0a20 2020 2020  abstract').     
+0000e600: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0000e610: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+0000e620: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000e630: 2e6c 6f67 2822 436f 756c 6420 6e6f 7420  .log("Could not 
+0000e640: 7265 706c 6163 6520 6b65 7973 2069 6e20  replace keys in 
+0000e650: 5c27 696d 6167 652d 6162 7374 7261 6374  \'image-abstract
+0000e660: 5c27 3a20 2220 2b20 7374 7228 6578 2929  \': " + str(ex))
+0000e670: 0a0a 0a20 2020 2020 2020 2023 2073 6574  ...        # set
+0000e680: 2076 6572 7369 6f6e 2028 736f 2069 7420   version (so it 
+0000e690: 6361 6e6e 6f74 2062 6520 6368 616e 6765  cannot be change
+0000e6a0: 6420 6279 2075 7365 7229 0a20 2020 2020  d by user).     
+0000e6b0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000e6c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000e6d0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000e6e0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
+0000e6f0: 275d 203d 206d 6971 7476 2e69 4644 4f5f  '] = miqtv.iFDO_
+0000e700: 7665 7273 696f 6e0a 0a20 2020 2020 2020  version..       
+0000e710: 2023 2056 616c 6964 6174 6520 6974 656d   # Validate item
+0000e720: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+0000e730: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
+0000e740: 6d73 203d 2030 0a20 2020 2020 2020 2069  ms = 0.        i
+0000e750: 6d61 6765 5f73 6574 5f69 7465 6d73 203d  mage_set_items =
+0000e760: 207b 7d0a 0a20 2020 2020 2020 2070 726f   {}..        pro
+0000e770: 6720 3d20 6d69 7174 632e 5072 696e 744b  g = miqtc.PrintK
+0000e780: 6e6f 776e 5072 6f67 7265 7373 4d73 6728  nownProgressMsg(
+0000e790: 2243 6865 636b 696e 6720 6974 656d 7322  "Checking items"
+0000e7a0: 2c20 6c65 6e28 6974 656d 7329 2c6d 6f64  , len(items),mod
+0000e7b0: 756c 6f3d 3529 0a20 2020 2020 2020 2066  ulo=5).        f
+0000e7c0: 6f72 2069 7465 6d20 696e 2069 7465 6d73  or item in items
+0000e7d0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000e7e0: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
+0000e7f0: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
+0000e800: 6b20 6966 2061 6c6c 2063 6f72 6520 6669  k if all core fi
+0000e810: 656c 6473 2061 7265 2066 696c 6c65 6420  elds are filled 
+0000e820: 616e 6420 6172 6520 6669 6c6c 6564 2076  and are filled v
+0000e830: 616c 6964 6c79 0a20 2020 2020 2020 2020  alidly.         
+0000e840: 2020 2074 7279 3a0a 0a20 2020 2020 2020     try:..       
+0000e850: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+0000e860: 2069 7465 6d20 696d 6167 6520 6578 6973   item image exis
+0000e870: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+0000e880: 2020 2023 2069 6620 6974 656d 2069 7320     # if item is 
+0000e890: 6120 6c69 7374 2028 7669 6465 6f29 2c20  a list (video), 
+0000e8a0: 6f6e 6520 776f 756c 6420 6861 7665 2074  one would have t
+0000e8b0: 6f20 6368 6563 6b20 6966 2065 6163 6820  o check if each 
+0000e8c0: 656e 7472 7920 6973 2076 616c 6964 2067  entry is valid g
+0000e8d0: 6976 656e 2074 6865 2064 6566 6175 6c74  iven the default
+0000e8e0: 2076 616c 7565 7320 696e 2066 6972 7374   values in first
+0000e8f0: 2065 6e74 7279 2070 6c75 7320 6769 7665   entry plus give
+0000e900: 6e20 6465 6661 756c 7420 7661 6c75 6573  n default values
+0000e910: 2069 6e20 6865 6164 6572 0a20 2020 2020   in header.     
+0000e920: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000e930: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
+0000e940: 6d2c 6c69 7374 293a 0a20 2020 2020 2020  m,list):.       
+0000e950: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0000e960: 6d20 3d20 5b69 7465 6d5d 0a20 2020 2020  m = [item].     
+0000e970: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
+0000e980: 656d 4465 6661 756c 7420 3d20 6974 656d  emDefault = item
+0000e990: 5b30 5d20 0a20 2020 2020 2020 2020 2020  [0] .           
+0000e9a0: 2020 2020 2066 6f72 2073 7562 4974 656d       for subItem
+0000e9b0: 2069 6e20 6974 656d 3a0a 2020 2020 2020   in item:.      
+0000e9c0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000e9d0: 6c65 5f6e 616d 6520 3d20 7375 6249 7465  le_name = subIte
+0000e9e0: 6d5b 2769 6d61 6765 2d66 696c 656e 616d  m['image-filenam
+0000e9f0: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0000ea00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0000ea10: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
+0000ea20: 5f66 696c 6573 2061 6e64 2066 696c 655f  _files and file_
+0000ea30: 6e61 6d65 206e 6f74 2069 6e20 7365 6c66  name not in self
+0000ea40: 2e5f 696d 6167 654e 616d 6573 496d 6167  ._imageNamesImag
+0000ea50: 6573 4469 723a 0a20 2020 2020 2020 2020  esDir:.         
+0000ea60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ea70: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+0000ea80: 4974 656d 2027 2220 2b20 6669 6c65 5f6e  Item '" + file_n
+0000ea90: 616d 6520 2b20 2227 206e 6f74 2066 6f75  ame + "' not fou
+0000eaa0: 6e64 2069 6e20 2f72 6177 2064 6972 6563  nd in /raw direc
+0000eab0: 746f 7279 2e22 290a 0a20 2020 2020 2020  tory.")..       
+0000eac0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+0000ead0: 7474 2e61 7265 5f76 616c 6964 5f69 6664  tt.are_valid_ifd
+0000eae0: 6f5f 6669 656c 6473 2873 7562 4974 656d  o_fields(subItem
+0000eaf0: 2920 2020 2020 2020 2020 2020 2020 2020  )               
+0000eb00: 2020 2020 2020 2020 2020 0a0a 2020 2020            ..    
+0000eb10: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+0000eb20: 655f 7365 745f 6974 656d 735b 7375 6249  e_set_items[subI
+0000eb30: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
+0000eb40: 652d 6669 6c65 6e61 6d65 275d 5d20 3d20  e-filename']] = 
+0000eb50: 5b5d 2023 2063 6f75 6c64 206d 616b 6520  [] # could make 
+0000eb60: 616e 2065 7874 7261 2063 6173 6520 666f  an extra case fo
+0000eb70: 7220 696d 6167 6573 206f 6d69 7474 696e  r images omittin
+0000eb80: 6720 7468 6520 6c69 7374 0a20 2020 2020  g the list.     
+0000eb90: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+0000eba0: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
+0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebc0: 2020 2020 7375 6249 7465 6d44 6963 7420      subItemDict 
+0000ebd0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0000ebe0: 2020 2020 2020 2020 2066 6f72 2069 7420           for it 
+0000ebf0: 696e 2073 7562 4974 656d 3a0a 2020 2020  in subItem:.    
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 2020 2020 6966 2069 7420 213d 2027 696d      if it != 'im
+0000ec20: 6167 652d 6669 6c65 6e61 6d65 273a 0a20  age-filename':. 
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
+0000ec50: 656d 4469 6374 5b69 745d 203d 2073 7562  emDict[it] = sub
+0000ec60: 4974 656d 5b69 745d 0a20 2020 2020 2020  Item[it].       
+0000ec70: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+0000ec80: 6765 5f73 6574 5f69 7465 6d73 5b73 7562  ge_set_items[sub
+0000ec90: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
+0000eca0: 6765 2d66 696c 656e 616d 6527 5d5d 2e61  ge-filename']].a
+0000ecb0: 7070 656e 6428 7375 6249 7465 6d44 6963  ppend(subItemDic
+0000ecc0: 7429 0a20 2020 2020 2020 2020 2020 200a  t).            .
+0000ecd0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000ece0: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
+0000ecf0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0000ed00: 2020 2020 2020 2020 2020 2020 2069 6e76               inv
+0000ed10: 616c 6964 5f69 7465 6d73 202b 3d20 310a  alid_items += 1.
+0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed30: 7365 6c66 2e70 726f 762e 6c6f 6728 2249  self.prov.log("I
+0000ed40: 6e76 616c 6964 2069 6d61 6765 2069 7465  nvalid image ite
+0000ed50: 6d3a 2022 2b20 7374 7228 6974 656d 292c  m: "+ str(item),
+0000ed60: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+0000ed70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ed80: 656c 662e 7072 6f76 2e6c 6f67 2822 4578  elf.prov.log("Ex
+0000ed90: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
+0000eda0: 2865 2e61 7267 7329 2c64 6f6e 7453 686f  (e.args),dontSho
+0000edb0: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+0000edc0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+0000edd0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+0000ede0: 6e28 2249 6e76 616c 6964 2069 6d61 6765  n("Invalid image
+0000edf0: 2069 7465 6d20 222b 2066 696c 655f 6e61   item "+ file_na
+0000ee00: 6d65 202b 2022 3a5c 6e45 7863 6570 7469  me + ":\nExcepti
+0000ee10: 6f6e 3a5c 6e22 2b20 7374 7228 652e 6172  on:\n"+ str(e.ar
+0000ee20: 6773 2929 2023 206f 7468 6572 7769 7365  gs)) # otherwise
+0000ee30: 2c20 696e 2063 6173 6520 6f66 206d 616e  , in case of man
+0000ee40: 7920 696d 6167 6573 2c20 6974 206d 6179  y images, it may
+0000ee50: 206b 6565 7020 7275 6e6e 696e 6720 616e   keep running an
+0000ee60: 6420 7468 726f 7769 6e67 2065 7272 6f72  d throwing error
+0000ee70: 7320 666f 7220 7175 6974 2073 6f6d 6520  s for quit some 
+0000ee80: 7469 6d65 0a20 2020 2020 2020 2070 726f  time.        pro
+0000ee90: 672e 636c 6561 7228 290a 0a20 2020 2020  g.clear()..     
+0000eea0: 2020 2069 6620 6c65 6e28 6974 656d 7329     if len(items)
+0000eeb0: 2021 3d20 3020 616e 6420 696e 7661 6c69   != 0 and invali
+0000eec0: 645f 6974 656d 7320 3d3d 206c 656e 2869  d_items == len(i
+0000eed0: 7465 6d73 293a 0a20 2020 2020 2020 2020  tems):.         
+0000eee0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+0000eef0: 6f6e 2822 416c 6c20 6974 656d 7320 6172  on("All items ar
+0000ef00: 6520 696e 7661 6c69 6422 290a 2020 2020  e invalid").    
+0000ef10: 2020 2020 656c 6966 2069 6e76 616c 6964      elif invalid
+0000ef20: 5f69 7465 6d73 203e 2030 3a0a 2020 2020  _items > 0:.    
+0000ef30: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0000ef40: 762e 6c6f 6728 2241 7420 6c65 6173 7420  v.log("At least 
+0000ef50: 2220 2b20 7374 7228 696e 7661 6c69 645f  " + str(invalid_
+0000ef60: 6974 656d 7329 202b 2022 2069 7465 6d73  items) + " items
+0000ef70: 2077 6572 6520 696e 7661 6c69 6420 286f   were invalid (o
+0000ef80: 6622 202b 2073 7472 286c 656e 2869 7465  f" + str(len(ite
+0000ef90: 6d73 2929 2b20 2229 2229 0a0a 2020 2020  ms))+ ")")..    
+0000efa0: 2020 2020 2320 5661 6c69 6461 7465 2068      # Validate h
+0000efb0: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
+0000efc0: 6e0a 2020 2020 2020 2020 7472 793a 0a20  n.        try:. 
+0000efd0: 2020 2020 2020 2020 2020 206d 6971 7474             miqtt
+0000efe0: 2e61 7265 5f76 616c 6964 5f69 6664 6f5f  .are_valid_ifdo_
+0000eff0: 6669 656c 6473 2873 656c 662e 6966 646f  fields(self.ifdo
+0000f000: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000f010: 6574 4865 6164 6572 4b65 795d 290a 2020  etHeaderKey]).  
+0000f020: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+0000f030: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0000f040: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
+0000f050: 2020 2020 6d73 6720 3d20 2249 6e76 616c      msg = "Inval
+0000f060: 6964 2068 6561 6465 7220 6669 656c 643a  id header field:
+0000f070: 2022 202b 2073 7472 2865 7829 0a20 2020   " + str(ex).   
+0000f080: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000f090: 6f76 2e6c 6f67 2822 4578 6365 7074 696f  ov.log("Exceptio
+0000f0a0: 6e3a 2022 202b 206d 7367 2c20 646f 6e74  n: " + msg, dont
+0000f0b0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+0000f0c0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+0000f0d0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0000f0e0: 286d 7367 290a 0a20 2020 2020 2020 2023  (msg)..        #
+0000f0f0: 2070 7574 2069 7465 6d20 696e 666f 2069   put item info i
+0000f100: 6e74 6f20 7365 6c66 2e69 6664 6f5f 746d  nto self.ifdo_tm
+0000f110: 700a 2020 2020 2020 2020 7320 3d20 6d69  p.        s = mi
+0000f120: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
+0000f130: 4d73 6728 2255 7064 6174 696e 6722 290a  Msg("Updating").
+0000f140: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
+0000f150: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
+0000f160: 7064 6174 6544 6963 7473 2873 656c 662e  pdateDicts(self.
+0000f170: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000f180: 6167 6553 6574 4974 656d 734b 6579 5d2c  ageSetItemsKey],
+0000f190: 2069 6d61 6765 5f73 6574 5f69 7465 6d73   image_set_items
+0000f1a0: 290a 2020 2020 2020 2020 732e 7374 6f70  ).        s.stop
+0000f1b0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+0000f1c0: 7072 6f76 2e6c 6f67 286c 6f67 290a 0a20  prov.log(log).. 
+0000f1d0: 2020 2020 2020 2023 2073 6574 206c 6174         # set lat
+0000f1e0: 206c 6f6e 2062 6f75 6e64 696e 6720 626f   lon bounding bo
+0000f1f0: 780a 2020 2020 2020 2020 7365 6c66 2e5f  x.        self._
+0000f200: 7365 745f 6c61 745f 6c6f 6e5f 626f 756e  set_lat_lon_boun
+0000f210: 6469 6e67 5f62 6f78 2873 656c 662e 6966  ding_box(self.if
+0000f220: 646f 5f74 6d70 290a 0a20 2020 2020 2020  do_tmp)..       
+0000f230: 2023 2073 6574 2072 6570 7265 7365 6e74   # set represent
+0000f240: 6174 6976 6520 6865 6164 6572 2066 6965  ative header fie
+0000f250: 6c64 7320 6461 7465 7469 6d65 2c20 6c61  lds datetime, la
+0000f260: 742c 206c 6f6e 2c20 616c 740a 2020 2020  t, lon, alt.    
+0000f270: 2020 2020 7365 6c66 2e5f 7365 745f 7265      self._set_re
+0000f280: 705f 6865 6164 6572 5f66 6965 6c64 735f  p_header_fields_
+0000f290: 6474 5f6c 6174 5f6c 6f6e 5f61 6c74 2873  dt_lat_lon_alt(s
+0000f2a0: 656c 662e 6966 646f 5f74 6d70 290a 0a20  elf.ifdo_tmp).. 
+0000f2b0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+0000f2c0: 5f69 6d61 6765 5f69 7465 6d5f 6964 656e  _image_item_iden
+0000f2d0: 7469 6669 6361 7469 6f6e 5f73 6368 656d  tification_schem
+0000f2e0: 6528 7365 6c66 2e69 6664 6f5f 746d 7029  e(self.ifdo_tmp)
+0000f2f0: 0a0a 2020 2020 2020 2020 2320 7265 6d6f  ..        # remo
+0000f300: 7665 2065 6d74 7079 2066 6965 6c64 730a  ve emtpy fields.
+0000f310: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
+0000f320: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
+0000f330: 6728 2252 656d 6f76 696e 6720 656d 7074  g("Removing empt
+0000f340: 7920 6669 656c 6473 2229 0a20 2020 2020  y fields").     
+0000f350: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000f360: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
+0000f370: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
+0000f380: 6965 6c64 7328 7365 6c66 2e69 6664 6f5f  ields(self.ifdo_
+0000f390: 746d 7029 0a20 2020 2020 2020 2069 6620  tmp).        if 
+0000f3a0: 6e6f 7420 7365 6c66 2e69 6d61 6765 5365  not self.imageSe
+0000f3b0: 7449 7465 6d73 4b65 7920 696e 2073 656c  tItemsKey in sel
+0000f3c0: 662e 6966 646f 5f74 6d70 3a0a 2020 2020  f.ifdo_tmp:.    
+0000f3d0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000f3e0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000f3f0: 5365 7449 7465 6d73 4b65 795d 203d 205b  SetItemsKey] = [
+0000f400: 5d0a 2020 2020 2020 2020 2320 7265 6d6f  ].        # remo
+0000f410: 7665 2066 6965 6c64 7320 7468 6174 2063  ve fields that c
+0000f420: 6f6e 7461 696e 2027 696d 6167 652d 6461  ontain 'image-da
+0000f430: 7465 7469 6d65 2720 6f6e 6c79 0a20 2020  tetime' only.   
+0000f440: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+0000f450: 4974 656d 4669 656c 6473 5769 7468 4f6e  ItemFieldsWithOn
+0000f460: 6c79 4461 7465 5469 6d65 2829 0a20 2020  lyDateTime().   
+0000f470: 2020 2020 2073 2e73 746f 7028 290a 0a20       s.stop().. 
+0000f480: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0000f490: 6c66 2e69 676e 6f72 655f 696d 6167 655f  lf.ignore_image_
+0000f4a0: 6669 6c65 733a 0a20 2020 2020 2020 2020  files:.         
+0000f4b0: 2020 2073 656c 662e 6368 6563 6b41 6c6c     self.checkAll
+0000f4c0: 4974 656d 4861 7368 6573 2829 0a0a 2020  ItemHashes()..  
+0000f4d0: 2020 2020 2020 2320 6368 6563 6b20 6167        # check ag
+0000f4e0: 6169 6e73 7420 7363 6865 6d61 0a20 2020  ainst schema.   
+0000f4f0: 2020 2020 2076 616c 6964 2c20 6d73 6720       valid, msg 
+0000f500: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
+0000f510: 5f69 6664 6f28 7365 6c66 2e69 6664 6f5f  _ifdo(self.ifdo_
+0000f520: 746d 7029 0a20 2020 2020 2020 2069 6620  tmp).        if 
+0000f530: 6e6f 7420 7661 6c69 6420 616e 6420 6e6f  not valid and no
+0000f540: 7420 616c 6c6f 775f 6d69 7373 696e 675f  t allow_missing_
+0000f550: 7265 7175 6972 6564 3a0a 2020 2020 2020  required:.      
+0000f560: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+0000f570: 6c6f 6728 2257 6172 6e69 6e67 2120 6946  log("Warning! iF
+0000f580: 444f 206e 6f20 7661 6c69 6420 7965 743a  DO no valid yet:
+0000f590: 2022 202b 206d 7367 290a 2020 2020 2020   " + msg).      
+0000f5a0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+0000f5b0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+0000f5c0: 6d73 6729 0a0a 2020 2020 2020 2020 2320  msg)..        # 
+0000f5d0: 7365 7420 6669 6e61 6c20 6f6e 650a 2020  set final one.  
+0000f5e0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000f5f0: 6368 6563 6b65 6420 3d20 636f 7079 2e64  checked = copy.d
+0000f600: 6565 7063 6f70 7928 7365 6c66 2e69 6664  eepcopy(self.ifd
+0000f610: 6f5f 746d 7029 0a20 2020 2020 2020 2072  o_tmp).        r
+0000f620: 6574 7572 6e20 7365 6c66 2e69 6664 6f5f  eturn self.ifdo_
+0000f630: 6368 6563 6b65 640a 0a0a 2020 2020 6465  checked...    de
+0000f640: 6620 5f73 6574 5f69 6d61 6765 5f69 7465  f _set_image_ite
+0000f650: 6d5f 6964 656e 7469 6669 6361 7469 6f6e  m_identification
+0000f660: 5f73 6368 656d 6528 7365 6c66 2c69 6664  _scheme(self,ifd
+0000f670: 6f3a 6469 6374 293a 0a20 2020 2020 2020  o:dict):.       
+0000f680: 2022 2222 2053 6574 2069 6d61 6765 2d69   """ Set image-i
+0000f690: 7465 6d2d 6964 656e 7469 6669 6361 7469  tem-identificati
+0000f6a0: 6f6e 2d73 6368 656d 6520 746f 2060 696d  on-scheme to `im
+0000f6b0: 6167 652d 7072 6f6a 6563 745f 696d 6167  age-project_imag
+0000f6c0: 652d 6576 656e 745f 696d 6167 652d 7365  e-event_image-se
+0000f6d0: 6e73 6f72 5f69 6d61 6765 2d64 6174 6574  nsor_image-datet
+0000f6e0: 696d 652e 6578 7460 2069 6620 656d 7074  ime.ext` if empt
+0000f6f0: 792e 2022 2222 0a20 2020 2020 2020 2069  y. """.        i
+0000f700: 6620 6669 6e64 4669 656c 6428 6966 646f  f findField(ifdo
+0000f710: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000f720: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
+0000f730: 6974 656d 2d69 6465 6e74 6966 6963 6174  item-identificat
+0000f740: 696f 6e2d 7363 6865 6d65 2729 203d 3d20  ion-scheme') == 
+0000f750: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+0000f760: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
+0000f770: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000f780: 6167 652d 6974 656d 2d69 6465 6e74 6966  age-item-identif
+0000f790: 6963 6174 696f 6e2d 7363 6865 6d65 275d  ication-scheme']
+0000f7a0: 203d 2020 2769 6d61 6765 2d70 726f 6a65   =  'image-proje
+0000f7b0: 6374 5f69 6d61 6765 2d65 7665 6e74 5f69  ct_image-event_i
+0000f7c0: 6d61 6765 2d73 656e 736f 725f 696d 6167  mage-sensor_imag
+0000f7d0: 652d 6461 7465 7469 6d65 2e65 7874 270a  e-datetime.ext'.
+0000f7e0: 0a0a 2020 2020 6465 6620 5f73 6574 5f72  ..    def _set_r
+0000f7f0: 6570 5f68 6561 6465 725f 6669 656c 6473  ep_header_fields
+0000f800: 5f64 745f 6c61 745f 6c6f 6e5f 616c 7428  _dt_lat_lon_alt(
+0000f810: 7365 6c66 2c69 6664 6f3a 6469 6374 293a  self,ifdo:dict):
+0000f820: 0a20 2020 2020 2020 2022 2222 2046 696c  .        """ Fil
+0000f830: 6c20 6865 6164 6572 2066 6965 6c64 7320  l header fields 
+0000f840: 696d 6167 652d 6461 7465 7469 6d65 2c20  image-datetime, 
+0000f850: 2d6c 6174 6974 7564 652c 202d 6c6f 6e67  -latitude, -long
+0000f860: 6974 7565 6465 2c20 2d61 6c74 6974 7564  ituede, -altitud
+0000f870: 652d 6d65 7465 7273 2c20 6966 2065 6d70  e-meters, if emp
+0000f880: 7479 2c0a 2020 2020 2020 2020 7265 7072  ty,.        repr
+0000f890: 6573 656e 7461 7469 7665 6c79 2077 6974  esentatively wit
+0000f8a0: 6820 7661 6c75 6573 2066 726f 6d20 6669  h values from fi
+0000f8b0: 7273 7420 6974 656d 2e20 2222 220a 2020  rst item. """.  
+0000f8c0: 2020 2020 2020 6669 7273 745f 696d 6167        first_imag
+0000f8d0: 6520 3d20 736f 7274 6564 2869 6664 6f5b  e = sorted(ifdo[
+0000f8e0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+0000f8f0: 6d73 4b65 795d 2e6b 6579 7328 2929 5b30  msKey].keys())[0
+0000f900: 5d0a 2020 2020 2020 2020 7265 705f 6865  ].        rep_he
+0000f910: 6164 6572 5f66 6965 6c64 7320 3d20 5b27  ader_fields = ['
+0000f920: 696d 6167 652d 6461 7465 7469 6d65 272c  image-datetime',
+0000f930: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+0000f940: 2c27 696d 6167 652d 6c6f 6e67 6974 7564  ,'image-longitud
+0000f950: 6527 2c27 696d 6167 652d 616c 7469 7475  e','image-altitu
+0000f960: 6465 2d6d 6574 6572 7327 5d0a 2020 2020  de-meters'].    
+0000f970: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
+0000f980: 2072 6570 5f68 6561 6465 725f 6669 656c   rep_header_fiel
+0000f990: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+0000f9a0: 6966 2066 696e 6446 6965 6c64 2869 6664  if findField(ifd
+0000f9b0: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
+0000f9c0: 6561 6465 724b 6579 5d2c 6669 656c 6429  eaderKey],field)
+0000f9d0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+0000f9e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa00: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
+0000fa10: 5365 7448 6561 6465 724b 6579 5d5b 6669  SetHeaderKey][fi
+0000fa20: 656c 645d 203d 2073 656c 662e 5f5f 6765  eld] = self.__ge
+0000fa30: 7446 6965 6c64 5661 6c75 6528 6966 646f  tFieldValue(ifdo
+0000fa40: 2c5b 6669 7273 745f 696d 6167 652c 6669  ,[first_image,fi
+0000fa50: 656c 645d 2c64 6566 6175 6c74 5f6f 6e6c  eld],default_onl
+0000fa60: 793d 5472 7565 290a 2020 2020 2020 2020  y=True).        
+0000fa70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000fa80: 2e70 726f 762e 6c6f 6728 2253 6574 2072  .prov.log("Set r
+0000fa90: 6570 7265 7365 6e74 6174 6976 6520 6865  epresentative he
+0000faa0: 6164 6572 2066 6965 6c64 2027 2220 2b20  ader field '" + 
+0000fab0: 6669 656c 6420 2b20 2227 2074 6f20 2220  field + "' to " 
+0000fac0: 2b20 7374 7228 6966 646f 5b73 656c 662e  + str(ifdo[self.
+0000fad0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000fae0: 795d 5b66 6965 6c64 5d29 202b 2022 2066  y][field]) + " f
+0000faf0: 726f 6d20 6669 7273 7420 696d 6167 652e  rom first image.
+0000fb00: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000fb10: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
+0000fb20: 4966 646f 4578 6365 7074 696f 6e20 6173  IfdoException as
+0000fb30: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+0000fb40: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000fb50: 6f76 2e6c 6f67 2822 436f 756c 6420 6e6f  ov.log("Could no
+0000fb60: 7420 7365 7420 7265 7072 6573 656e 7461  t set representa
+0000fb70: 7469 7665 2068 6561 6465 7220 6669 656c  tive header fiel
+0000fb80: 643a 2022 202b 2073 7472 2865 7829 290a  d: " + str(ex)).
+0000fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fba0: 2020 2020 7061 7373 0a0a 0a20 2020 2064      pass...    d
+0000fbb0: 6566 205f 7365 745f 6c61 745f 6c6f 6e5f  ef _set_lat_lon_
+0000fbc0: 626f 756e 6469 6e67 5f62 6f78 2873 656c  bounding_box(sel
+0000fbd0: 662c 6966 646f 3a64 6963 7429 3a0a 2020  f,ifdo:dict):.  
+0000fbe0: 2020 2020 2020 2222 2220 5365 7420 696d        """ Set im
+0000fbf0: 6167 652d 7365 742d 5b6d 696e 2c6d 6178  age-set-[min,max
+0000fc00: 5d2d 5b6c 6174 6974 7564 652c 6c6f 6e67  ]-[latitude,long
+0000fc10: 6974 7564 655d 2d64 6567 7265 6573 2022  itude]-degrees "
+0000fc20: 2222 0a20 2020 2020 2020 206c 6174 5f6d  "".        lat_m
+0000fc30: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
+0000fc40: 5f6d 696e 2c20 6c6f 6e5f 6d61 7820 3d20  _min, lon_max = 
+0000fc50: 7365 6c66 2e5f 6765 745f 6c61 745f 6c6f  self._get_lat_lo
+0000fc60: 6e5f 626f 756e 6469 6e67 5f62 6f78 2869  n_bounding_box(i
+0000fc70: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0000fc80: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
+0000fc90: 2020 2020 6966 206e 6f74 204e 6f6e 6520      if not None 
+0000fca0: 696e 205b 6c61 745f 6d69 6e2c 206c 6174  in [lat_min, lat
+0000fcb0: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
+0000fcc0: 6f6e 5f6d 6178 5d3a 0a20 2020 2020 2020  on_max]:.       
+0000fcd0: 2020 2020 2069 6664 6f5b 7365 6c66 2e69       ifdo[self.i
+0000fce0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000fcf0: 5d5b 2769 6d61 6765 2d73 6574 2d6d 696e  ]['image-set-min
+0000fd00: 2d6c 6174 6974 7564 652d 6465 6772 6565  -latitude-degree
+0000fd10: 7327 5d20 3d20 6c61 745f 6d69 6e0a 2020  s'] = lat_min.  
+0000fd20: 2020 2020 2020 2020 2020 6966 646f 5b73            ifdo[s
+0000fd30: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000fd40: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
+0000fd50: 742d 6d61 782d 6c61 7469 7475 6465 2d64  t-max-latitude-d
+0000fd60: 6567 7265 6573 275d 203d 206c 6174 5f6d  egrees'] = lat_m
+0000fd70: 6178 0a20 2020 2020 2020 2020 2020 2069  ax.            i
+0000fd80: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0000fd90: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000fda0: 6765 2d73 6574 2d6d 696e 2d6c 6f6e 6769  ge-set-min-longi
+0000fdb0: 7475 6465 2d64 6567 7265 6573 275d 203d  tude-degrees'] =
+0000fdc0: 206c 6f6e 5f6d 696e 0a20 2020 2020 2020   lon_min.       
+0000fdd0: 2020 2020 2069 6664 6f5b 7365 6c66 2e69       ifdo[self.i
+0000fde0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000fdf0: 5d5b 2769 6d61 6765 2d73 6574 2d6d 6178  ]['image-set-max
+0000fe00: 2d6c 6f6e 6769 7475 6465 2d64 6567 7265  -longitude-degre
+0000fe10: 6573 275d 203d 206c 6f6e 5f6d 6178 0a0a  es'] = lon_max..
+0000fe20: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+0000fe30: 6f64 0a20 2020 2064 6566 205f 6765 745f  od.    def _get_
+0000fe40: 6c61 745f 6c6f 6e5f 626f 756e 6469 6e67  lat_lon_bounding
+0000fe50: 5f62 6f78 2869 7465 6d73 3a64 6963 7429  _box(items:dict)
+0000fe60: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0000fe70: 7475 726e 7320 6c61 745f 6d69 6e2c 206c  turns lat_min, l
+0000fe80: 6174 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c  at_max, lon_min,
+0000fe90: 206c 6f6e 5f6d 6178 2022 2222 0a20 2020   lon_max """.   
+0000fea0: 2020 2020 206c 6174 5f6d 696e 2c20 6c61       lat_min, la
+0000feb0: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
+0000fec0: 6c6f 6e5f 6d61 7820 3d20 4e6f 6e65 2c20  lon_max = None, 
+0000fed0: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
+0000fee0: 0a20 2020 2020 2020 2069 203d 2030 0a20  .        i = 0. 
+0000fef0: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
+0000ff00: 2c20 6461 7461 2069 6e20 6974 656d 732e  , data in items.
+0000ff10: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000ff20: 2020 2020 2023 206d 616b 6520 696d 6167       # make imag
+0000ff30: 6520 656e 7472 7920 6c69 7374 2028 616c  e entry list (al
+0000ff40: 736f 2069 6620 6974 7320 6120 7069 6374  so if its a pict
+0000ff50: 7572 6529 0a20 2020 2020 2020 2020 2020  ure).           
+0000ff60: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0000ff70: 6365 2864 6174 612c 206c 6973 7429 3a0a  ce(data, list):.
+0000ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff90: 6461 7461 203d 205b 6461 7461 5d0a 2020  data = [data].  
+0000ffa0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0000ffb0: 2020 2020 2020 2066 6f72 2074 696d 6570         for timep
+0000ffc0: 6f69 6e74 5f64 6174 6120 696e 2064 6174  oint_data in dat
+0000ffd0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+0000ffe0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000fff0: 2020 2020 2020 2020 2020 2020 6c61 7420              lat 
+00010000: 3d20 7469 6d65 706f 696e 745f 6461 7461  = timepoint_data
+00010010: 5b27 696d 6167 652d 6c61 7469 7475 6465  ['image-latitude
+00010020: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00010030: 2020 2020 2020 206c 6f6e 203d 2074 696d         lon = tim
+00010040: 6570 6f69 6e74 5f64 6174 615b 2769 6d61  epoint_data['ima
+00010050: 6765 2d6c 6f6e 6769 7475 6465 275d 0a20  ge-longitude']. 
+00010060: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010070: 7863 6570 7420 4b65 7945 7272 6f72 2061  xcept KeyError a
+00010080: 7320 6578 3a0a 2020 2020 2020 2020 2020  s ex:.          
+00010090: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+000100a0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+000100b0: 2020 2020 6966 2069 203d 3d20 303a 0a20      if i == 0:. 
+000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000100d0: 2020 206c 6174 5f6d 696e 2c20 6c61 745f     lat_min, lat_
+000100e0: 6d61 7820 3d20 6c61 742c 206c 6174 0a20  max = lat, lat. 
+000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010100: 2020 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f     lon_min, lon_
+00010110: 6d61 7820 3d20 6c6f 6e2c 206c 6f6e 0a20  max = lon, lon. 
+00010120: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010130: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010140: 2020 2020 2020 2020 2069 6620 6c61 7420           if lat 
+00010150: 3c20 6c61 745f 6d69 6e3a 0a20 2020 2020  < lat_min:.     
+00010160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010170: 2020 206c 6174 5f6d 696e 203d 206c 6174     lat_min = lat
+00010180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010190: 2020 2020 2069 6620 6c61 7420 3e20 6c61       if lat > la
+000101a0: 745f 6d61 783a 0a20 2020 2020 2020 2020  t_max:.         
+000101b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000101c0: 6174 5f6d 6178 203d 206c 6174 0a20 2020  at_max = lat.   
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2069 6620 6c6f 6e20 3c20 6c6f 6e5f 6d69   if lon < lon_mi
+000101f0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00010200: 2020 2020 2020 2020 2020 206c 6f6e 5f6d             lon_m
+00010210: 696e 203d 206c 6f6e 0a20 2020 2020 2020  in = lon.       
+00010220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00010230: 6c6f 6e20 3e20 6c6f 6e5f 6d61 783a 0a20  lon > lon_max:. 
+00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010250: 2020 2020 2020 206c 6f6e 5f6d 6178 203d         lon_max =
+00010260: 206c 6f6e 0a20 2020 2020 2020 2020 2020   lon.           
+00010270: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
+00010280: 2020 2020 7265 7475 726e 206c 6174 5f6d      return lat_m
+00010290: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
+000102a0: 5f6d 696e 2c20 6c6f 6e5f 6d61 780a 0a0a  _min, lon_max...
+000102b0: 2020 2020 6465 6620 7265 6d6f 7665 4974      def removeIt
+000102c0: 656d 4669 656c 6473 5769 7468 4f6e 6c79  emFieldsWithOnly
+000102d0: 4461 7465 5469 6d65 2873 656c 6629 3a0a  DateTime(self):.
+000102e0: 2020 2020 2020 2020 2222 2220 6974 2063          """ it c
+000102f0: 616e 2068 6170 7065 6e20 7468 6174 2061  an happen that a
+00010300: 6e20 696d 6167 6520 7469 6d65 7374 616d  n image timestam
+00010310: 7020 646f 6573 206e 6f74 2063 6f6e 7461  p does not conta
+00010320: 696e 2061 6e79 2066 6965 6c64 7320 6275  in any fields bu
+00010330: 7420 7468 6520 7469 6d65 7374 616d 7020  t the timestamp 
+00010340: 616e 7920 6d6f 7265 2e20 5468 6f73 6520  any more. Those 
+00010350: 6172 6520 7265 6d6f 7665 6420 6865 7265  are removed here
+00010360: 2e20 2222 2220 0a20 2020 2020 2020 2066  . """ .        f
+00010370: 6f72 2069 7465 6d20 696e 2073 656c 662e  or item in self.
+00010380: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00010390: 6167 6553 6574 4974 656d 734b 6579 5d3a  ageSetItemsKey]:
+000103a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000103b0: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
+000103c0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+000103d0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+000103e0: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
+000103f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010400: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+00010410: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+00010420: 734b 6579 5d5b 6974 656d 5d20 3d20 5b73  sKey][item] = [s
+00010430: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00010440: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+00010450: 6579 5d5b 6974 656d 5d5d 0a20 2020 2020  ey][item]].     
+00010460: 2020 2020 2020 2074 6f42 6552 656d 6f76         toBeRemov
+00010470: 6564 203d 205b 5d0a 2020 2020 2020 2020  ed = [].        
+00010480: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+00010490: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+000104a0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+000104b0: 734b 6579 5d5b 6974 656d 5d3a 0a20 2020  sKey][item]:.   
+000104c0: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
+000104d0: 696e 7428 656e 7472 7929 0a20 2020 2020  int(entry).     
+000104e0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000104f0: 6e28 656e 7472 7929 203d 3d20 3120 616e  n(entry) == 1 an
+00010500: 6420 2769 6d61 6765 2d64 6174 6574 696d  d 'image-datetim
+00010510: 6527 2069 6e20 656e 7472 793a 0a20 2020  e' in entry:.   
+00010520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010530: 2074 6f42 6552 656d 6f76 6564 2e61 7070   toBeRemoved.app
+00010540: 656e 6428 656e 7472 7929 0a20 2020 2020  end(entry).     
+00010550: 2020 2020 2020 2066 6f72 2065 6e74 7279         for entry
+00010560: 2069 6e20 746f 4265 5265 6d6f 7665 643a   in toBeRemoved:
+00010570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010580: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+00010590: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+000105a0: 734b 6579 5d5b 6974 656d 5d2e 7265 6d6f  sKey][item].remo
+000105b0: 7665 2865 6e74 7279 2920 0a0a 0a20 2020  ve(entry) ...   
+000105c0: 2064 6566 2063 6865 636b 416c 6c49 7465   def checkAllIte
+000105d0: 6d48 6173 6865 7328 7365 6c66 2c20 6861  mHashes(self, ha
+000105e0: 7264 3d46 616c 7365 2c20 7261 6973 6545  rd=False, raiseE
+000105f0: 7863 6570 7469 6f6e 203d 2054 7275 6529  xception = True)
+00010600: 3a0a 2020 2020 2020 2020 2222 2220 0a20  :.        """ . 
+00010610: 2020 2020 2020 2043 6865 636b 7320 6966         Checks if
+00010620: 2068 6173 6865 7320 696e 2069 4644 4f20   hashes in iFDO 
+00010630: 6d61 7463 6820 6861 7368 6573 2069 6e20  match hashes in 
+00010640: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
+00010650: 6820 6669 6c65 2069 6620 7468 6520 6c61  h file if the la
+00010660: 7474 6572 2077 6173 2063 6861 6e67 6564  tter was changed
+00010670: 206c 6173 7420 6166 7465 7220 7468 6520   last after the 
+00010680: 696d 6167 6573 2068 6173 2063 6861 6e67  images has chang
+00010690: 6564 2e0a 2020 2020 2020 2020 4f74 6865  ed..        Othe
+000106a0: 7277 6973 6520 6f72 2069 6620 6861 7264  rwise or if hard
+000106b0: 3d3d 5472 7565 2069 7420 7265 6465 7465  ==True it redete
+000106c0: 726d 696e 6573 2074 6865 2061 6374 7561  rmines the actua
+000106d0: 6c6c 2066 696c 6527 7320 6861 7368 2061  ll file's hash a
+000106e0: 6e64 2063 6f6d 7061 7265 7320 7468 6520  nd compares the 
+000106f0: 6946 444f 2069 7465 6d27 7320 6861 7368  iFDO item's hash
+00010700: 2077 6974 6820 7468 6174 2e0a 2020 2020   with that..    
+00010710: 2020 2020 4966 2068 6173 6865 7320 646f      If hashes do
+00010720: 206e 6f74 206d 6174 6368 2061 206d 6172   not match a mar
+00010730: 6971 742e 636f 7265 2e49 6664 6f45 7863  iqt.core.IfdoExc
+00010740: 6570 7469 6f6e 2069 7320 7269 7365 6e20  eption is risen 
+00010750: 756e 736c 6573 7320 7261 6973 6545 7863  unsless raiseExc
+00010760: 6570 7469 6f6e 203d 3d20 4661 6c73 652c  eption == False,
+00010770: 2074 6865 6e20 6120 6c69 7374 206f 6620   then a list of 
+00010780: 6c69 7374 7320 5b3c 6669 6c65 3e2c 3c65  lists [<file>,<e
+00010790: 7863 6570 7469 6f6e 3e5d 2069 7320 7265  xception>] is re
+000107a0: 7475 726e 6564 2e0a 2020 2020 2020 2020  turned..        
+000107b0: 2222 220a 2020 2020 2020 2020 6861 7368  """.        hash
+000107c0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+000107d0: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
+000107e0: 3d20 3130 652b 3130 300a 2020 2020 2020  = 10e+100.      
+000107f0: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00010800: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
+00010810: 5f68 6173 685f 6669 6c65 2829 293a 0a20  _hash_file()):. 
+00010820: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
+00010830: 7320 3d20 6d69 7174 662e 7461 6246 696c  s = miqtf.tabFil
+00010840: 6544 6174 6128 7365 6c66 2e67 6574 5f69  eData(self.get_i
+00010850: 6e74 5f68 6173 685f 6669 6c65 2829 2c20  nt_hash_file(), 
+00010860: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
+00010870: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00010880: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
+00010890: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+000108a0: 6861 7368 275d 5d2c 206b 6579 5f63 6f6c  hash']], key_col
+000108b0: 3d6d 6971 7476 2e63 6f6c 5f68 6561 6465  =miqtv.col_heade
+000108c0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000108d0: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+000108e0: 6861 7368 4669 6c65 4d6f 6454 696d 6520  hashFileModTime 
+000108f0: 3d20 6f73 2e70 6174 682e 6765 746d 7469  = os.path.getmti
+00010900: 6d65 2873 656c 662e 6765 745f 696e 745f  me(self.get_int_
+00010910: 6861 7368 5f66 696c 6528 2929 0a0a 2020  hash_file())..  
+00010920: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
+00010930: 6973 7420 3d20 5b5d 0a0a 2020 2020 2020  ist = []..      
+00010940: 2020 6861 7368 556e 6368 6563 6b49 6d61    hashUncheckIma
+00010950: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
+00010960: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+00010970: 7228 290a 2020 2020 2020 2020 7072 6f67  r().        prog
+00010980: 203d 206d 6971 7463 2e50 7269 6e74 4b6e   = miqtc.PrintKn
+00010990: 6f77 6e50 726f 6772 6573 734d 7367 2822  ownProgressMsg("
+000109a0: 4368 6563 6b69 6e67 2069 7465 6d20 6861  Checking item ha
+000109b0: 7368 6573 222c 206c 656e 2873 656c 662e  shes", len(self.
+000109c0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+000109d0: 6167 6553 6574 4974 656d 734b 6579 5d29  ageSetItemsKey])
+000109e0: 290a 2020 2020 2020 2020 666f 7220 6974  ).        for it
+000109f0: 656d 2069 6e20 7365 6c66 2e69 6664 6f5f  em in self.ifdo_
+00010a00: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+00010a10: 7449 7465 6d73 4b65 795d 3a0a 2020 2020  tItemsKey]:.    
+00010a20: 2020 2020 2020 2020 7072 6f67 2e70 726f          prog.pro
+00010a30: 6772 6573 7328 290a 0a20 2020 2020 2020  gress()..       
+00010a40: 2020 2020 2066 6f75 6e64 203d 2046 616c       found = Fal
+00010a50: 7365 0a20 2020 2020 2020 2020 2020 2066  se.            f
+00010a60: 6f72 2069 6d61 6765 2069 6e20 6861 7368  or image in hash
+00010a70: 556e 6368 6563 6b49 6d61 6765 7349 6e52  UncheckImagesInR
+00010a80: 6177 3a0a 2020 2020 2020 2020 2020 2020  aw:.            
+00010a90: 2020 2020 6669 6c65 4e61 6d65 203d 206f      fileName = o
+00010aa0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00010ab0: 696d 6167 6529 0a20 2020 2020 2020 2020  image).         
+00010ac0: 2020 2020 2020 2069 6620 6669 6c65 4e61         if fileNa
+00010ad0: 6d65 203d 3d20 6974 656d 3a0a 2020 2020  me == item:.    
+00010ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010af0: 666f 756e 6420 3d20 5472 7565 0a20 2020  found = True.   
 00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b10: 2020 2020 2020 6966 206e 6f74 2069 7465        if not ite
-00010b20: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
-00010b30: 7368 2d73 6861 3235 3627 5d20 3d3d 2068  sh-sha256'] == h
-00010b40: 6173 6865 735b 6f73 2e70 6174 682e 6261  ashes[os.path.ba
-00010b50: 7365 6e61 6d65 2869 6d61 6765 295d 5b27  sename(image)]['
-00010b60: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
-00010b70: 3627 5d3a 0a20 2020 2020 2020 2020 2020  6']:.           
-00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b90: 2069 6620 7261 6973 6545 7863 6570 7469   if raiseExcepti
-00010ba0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00010bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bc0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
-00010bd0: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
-00010be0: 656d 2c20 2269 6e63 6f72 7265 6374 2073  em, "incorrect s
-00010bf0: 6861 3235 3620 6861 7368 222c 2069 7465  ha256 hash", ite
-00010c00: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
-00010c10: 7368 2d73 6861 3235 3627 5d2c 2266 6f72  sh-sha256'],"for
-00010c20: 2066 696c 6522 2c66 696c 654e 616d 652c   file",fileName,
-00010c30: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
-00010c40: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
-00010c50: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
-00010c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00010ca0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00010cb0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
-00010cc0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-00010cd0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-00010ce0: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
-00010cf0: 2069 7465 6d45 6e74 7279 5b27 696d 6167   itemEntry['imag
-00010d00: 652d 6861 7368 2d73 6861 3235 3627 5d20  e-hash-sha256'] 
-00010d10: 3d3d 206d 6971 7463 2e73 6861 3235 3648  == miqtc.sha256H
-00010d20: 6173 6846 696c 6528 696d 6167 6529 3a0a  ashFile(image):.
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d40: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
-00010d50: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00010d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d70: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00010d80: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00010d90: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
-00010da0: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
-00010db0: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-00010dc0: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
-00010dd0: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
-00010de0: 6d65 2c22 2072 756e 2063 7265 6174 655f  me," run create_
-00010df0: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
-00010e00: 6528 2920 6669 7273 7422 290a 2020 2020  e() first").    
-00010e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e40: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
-00010e50: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
-00010e60: 4e61 6d65 2c22 696e 636f 7272 6563 7420  Name,"incorrect 
-00010e70: 7368 6132 3536 2068 6173 6822 5d29 0a20  sha256 hash"]). 
-00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e90: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00010ea0: 2020 2020 2069 6620 666f 756e 643a 0a20       if found:. 
-00010eb0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00010ec0: 656c 2068 6173 6855 6e63 6865 636b 496d  el hashUncheckIm
-00010ed0: 6167 6573 496e 5261 775b 696d 6167 655d  agesInRaw[image]
-00010ee0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00010ef0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00010f00: 2020 2069 6620 7261 6973 6545 7863 6570     if raiseExcep
-00010f10: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00010f20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010f30: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00010f40: 696f 6e28 2022 696d 6167 6522 2c20 6974  ion( "image", it
-00010f50: 656d 2c20 226e 6f74 2066 6f75 6e64 2069  em, "not found i
-00010f60: 6e20 6469 7265 6374 6f72 7927 7320 7261  n directory's ra
-00010f70: 7720 666f 6c64 6572 2122 290a 2020 2020  w folder!").    
-00010f80: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00010f90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010fa0: 2020 2020 2020 6578 6365 7074 696f 6e4c        exceptionL
-00010fb0: 6973 742e 6170 7065 6e64 285b 6669 6c65  ist.append([file
-00010fc0: 4e61 6d65 2c22 6669 6c65 206e 6f74 2066  Name,"file not f
-00010fd0: 6f75 6e64 225d 290a 2020 2020 2020 2020  ound"]).        
-00010fe0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
-00010ff0: 2020 2020 2069 6620 6e6f 7420 7261 6973       if not rais
-00011000: 6545 7863 6570 7469 6f6e 3a0a 2020 2020  eException:.    
-00011010: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00011020: 7863 6570 7469 6f6e 4c69 7374 0a0a 0a20  xceptionList... 
-00011030: 2020 2064 6566 2063 7265 6174 655f 7575     def create_uu
-00011040: 6964 5f66 696c 6528 7365 6c66 2c63 6c65  id_file(self,cle
-00011050: 616e 3d54 7275 6529 3a0a 2020 2020 2020  an=True):.      
-00011060: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
-00011070: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
-00011080: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
-00011090: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
-000110a0: 6120 6372 6561 7465 6420 7575 6964 2028  a created uuid (
-000110b0: 7665 7273 696f 6e20 3429 2e0a 0a20 2020  version 4)...   
-000110c0: 2020 2020 2054 6865 2055 5549 4420 6973       The UUID is
-000110d0: 206f 6e6c 7920 2a74 616b 656e 2a20 6672   only *taken* fr
-000110e0: 6f6d 2074 6865 206d 6574 6164 6174 6120  om the metadata 
-000110f0: 6f66 2074 6865 2069 6d61 6765 732e 2049  of the images. I
-00011100: 7420 646f 6573 206e 6f74 2077 7269 7465  t does not write
-00011110: 2055 5549 4473 2074 6f20 7468 6520 6d65   UUIDs to the me
-00011120: 7461 6461 7461 2069 6e20 6361 7365 2073  tadata in case s
-00011130: 6f6d 6520 6669 6c65 7320 6172 6520 6d69  ome files are mi
-00011140: 7373 696e 6720 6974 2e0a 2020 2020 2020  ssing it..      
-00011150: 2020 4275 742c 2069 7420 6372 6561 7465    But, it create
-00011160: 7320 6120 4353 5620 6669 6c65 2069 6e20  s a CSV file in 
-00011170: 7468 6174 2063 6173 6520 7468 6174 2079  that case that y
-00011180: 6f75 2063 616e 2075 7365 2074 6f67 6574  ou can use toget
-00011190: 6865 7220 7769 7468 2065 7869 6674 6f6f  her with exiftoo
-000111a0: 6c20 746f 2061 6464 2074 6865 2055 5549  l to add the UUI
-000111b0: 4420 746f 2079 6f75 7220 6461 7461 2e20  D to your data. 
-000111c0: 4265 7761 7265 2120 7468 6973 2063 616e  Beware! this can
-000111d0: 2064 6573 7472 6f79 2079 6f75 7220 696d   destroy your im
-000111e0: 6167 6573 0a20 2020 2020 2020 2069 6620  ages.        if 
-000111f0: 6e6f 7420 646f 6e65 2070 726f 7065 726c  not done properl
-00011200: 7921 204e 6f20 6775 6172 616e 7465 6520  y! No guarantee 
-00011210: 6973 2067 6976 656e 2069 7420 7769 6c6c  is given it will
-00011220: 2077 6f72 6b2e 2042 6520 6361 7265 6675   work. Be carefu
-00011230: 6c21 0a0a 2020 2020 2020 2020 5573 6520  l!..        Use 
-00011240: 636c 6561 6e3d 4661 6c73 6520 746f 206e  clean=False to n
-00011250: 6f74 2063 6865 636b 2074 686f 7365 2066  ot check those f
-00011260: 696c 6573 2061 6761 696e 2077 6869 6368  iles again which
-00011270: 2061 7265 2061 6c72 6561 6479 2066 6f75   are already fou
-00011280: 6e64 2069 6e20 696e 7465 726d 6564 6961  nd in intermedia
-00011290: 7465 2075 7569 6420 6669 6c65 0a20 2020  te uuid file.   
-000112a0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000112b0: 2020 7575 6964 7320 3d20 7b7d 0a20 2020    uuids = {}.   
-000112c0: 2020 2020 2023 2043 6865 636b 2077 6865       # Check whe
-000112d0: 7468 6572 2061 2066 696c 6520 7769 7468  ther a file with
-000112e0: 2055 5549 4473 2065 7869 7374 732c 2074   UUIDs exists, t
-000112f0: 6865 6e20 7265 6164 2069 740a 2020 2020  hen read it.    
-00011300: 2020 2020 6966 206e 6f74 2063 6c65 616e      if not clean
-00011310: 2061 6e64 206f 732e 7061 7468 2e65 7869   and os.path.exi
-00011320: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
-00011330: 5f75 7569 645f 6669 6c65 2829 293a 0a20  _uuid_file()):. 
-00011340: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
-00011350: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
-00011360: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
-00011370: 745f 7575 6964 5f66 696c 6528 292c 205b  t_uuid_file(), [
-00011380: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011390: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-000113a0: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-000113b0: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-000113c0: 7569 6427 5d5d 2c20 6b65 795f 636f 6c3d  uid']], key_col=
-000113d0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000113e0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-000113f0: 5d29 0a20 2020 2020 2020 2020 2020 200a  ]).            .
-00011400: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00011410: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
-00011420: 6d61 6765 7344 6972 293a 0a0a 2020 2020  magesDir):..    
-00011430: 2020 2020 2020 2020 6d69 7373 696e 675f          missing_
-00011440: 7575 6964 7320 3d20 7b7d 0a20 2020 2020  uuids = {}.     
-00011450: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
-00011460: 6473 203d 2030 0a0a 2020 2020 2020 2020  ds = 0..        
-00011470: 2020 2020 756e 6b6e 6f77 6e46 696c 6573      unknownFiles
-00011480: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00011490: 2020 666f 7220 6669 6c65 2069 6e20 7365    for file in se
-000114a0: 6c66 2e69 6d61 6765 7349 6e49 6d61 6765  lf.imagesInImage
-000114b0: 7344 6972 2829 3a0a 2020 2020 2020 2020  sDir():.        
-000114c0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-000114d0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-000114e0: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
-000114f0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00011500: 6c65 5f6e 616d 6520 6e6f 7420 696e 2075  le_name not in u
-00011510: 7569 6473 3a0a 2020 2020 2020 2020 2020  uids:.          
-00011520: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
-00011530: 6e46 696c 6573 2e61 7070 656e 6428 6669  nFiles.append(fi
-00011540: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00011550: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00011560: 2020 2020 2020 2020 2020 2020 2020 7575                uu
-00011570: 6964 735b 6669 6c65 5f6e 616d 655d 203d  ids[file_name] =
-00011580: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
-00011590: 5d5b 6d69 7174 762e 636f 6c5f 6865 6164  ][miqtv.col_head
-000115a0: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
-000115b0: 6964 275d 5d0a 0a20 2020 2020 2020 2020  id']]..         
-000115c0: 2020 2075 6e6b 6e6f 776e 4669 6c65 7355     unknownFilesU
-000115d0: 5549 4473 203d 206d 6971 7469 2e69 6d61  UIDs = miqti.ima
-000115e0: 6765 7343 6f6e 7461 696e 5661 6c69 6455  gesContainValidU
-000115f0: 5549 4428 756e 6b6e 6f77 6e46 696c 6573  UID(unknownFiles
-00011600: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00011610: 7220 6669 6c65 2069 6e20 756e 6b6e 6f77  r file in unknow
-00011620: 6e46 696c 6573 5555 4944 733a 0a20 2020  nFilesUUIDs:.   
-00011630: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00011640: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00011650: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011670: 6966 206e 6f74 2075 6e6b 6e6f 776e 4669  if not unknownFi
-00011680: 6c65 7355 5549 4473 5b66 696c 655d 5b27  lesUUIDs[file]['
-00011690: 7661 6c69 6427 5d3a 0a20 2020 2020 2020  valid']:.       
-000116a0: 2020 2020 2020 2020 2020 2020 2075 7569               uui
-000116b0: 6420 3d20 6d69 7174 632e 7575 6964 3428  d = miqtc.uuid4(
-000116c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000116d0: 2020 2020 2020 6d69 7373 696e 675f 7575        missing_uu
-000116e0: 6964 735b 6669 6c65 5d20 3d20 7575 6964  ids[file] = uuid
-000116f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011700: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011710: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
-00011720: 5b66 696c 655f 6e61 6d65 5d20 3d20 756e  [file_name] = un
-00011730: 6b6e 6f77 6e46 696c 6573 5555 4944 735b  knownFilesUUIDs[
-00011740: 6669 6c65 5d5b 2775 7569 6427 5d0a 2020  file]['uuid'].  
-00011750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011760: 2020 6164 6465 645f 7575 6964 7320 2b3d    added_uuids +=
-00011770: 2031 0a0a 2020 2020 2020 2020 2020 2020   1..            
-00011780: 2320 4966 2070 7265 7669 6f75 736c 7920  # If previously 
-00011790: 756e 6b6e 6f77 6e20 5555 4944 7320 7765  unknown UUIDs we
-000117a0: 7265 2066 6f75 6e64 2069 6e20 7468 6520  re found in the 
-000117b0: 6669 6c65 2068 6561 6465 7273 2c20 6164  file headers, ad
-000117c0: 6420 7468 656d 2074 6f20 7468 6520 5555  d them to the UU
-000117d0: 4944 2066 696c 650a 2020 2020 2020 2020  ID file.        
-000117e0: 2020 2020 6966 2061 6464 6564 5f75 7569      if added_uui
-000117f0: 6473 203e 2030 3a0a 2020 2020 2020 2020  ds > 0:.        
-00011800: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-00011810: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-00011820: 7575 6964 5f66 696c 6528 292c 2022 7722  uuid_file(), "w"
-00011830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011840: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
-00011850: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00011860: 7269 7174 275d 5b27 696d 6727 5d20 2b22  riqt']['img'] +"
-00011870: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00011880: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00011890: 7575 6964 275d 2b22 5c6e 2229 0a20 2020  uuid']+"\n").   
-000118a0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000118b0: 2066 696c 6520 696e 2075 7569 6473 3a0a   file in uuids:.
-000118c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118d0: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
-000118e0: 6c65 2b22 5c74 222b 7374 7228 7575 6964  le+"\t"+str(uuid
-000118f0: 735b 6669 6c65 5d29 2b22 5c6e 2229 0a20  s[file])+"\n"). 
-00011900: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011910: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
-00011920: 2020 2020 2020 2020 6966 206c 656e 286d          if len(m
-00011930: 6973 7369 6e67 5f75 7569 6473 2920 3e20  issing_uuids) > 
-00011940: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00011950: 2020 2065 6373 765f 7061 7468 203d 2073     ecsv_path = s
-00011960: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
-00011970: 6c65 5f70 7265 6669 7828 2920 2b20 225f  le_prefix() + "_
-00011980: 6578 6966 2d61 6464 2d75 7569 642e 6373  exif-add-uuid.cs
-00011990: 7622 0a20 2020 2020 2020 2020 2020 2020  v".             
-000119a0: 2020 2063 7376 203d 206f 7065 6e28 6563     csv = open(ec
-000119b0: 7376 5f70 6174 682c 2022 7722 290a 2020  sv_path, "w").  
-000119c0: 2020 2020 2020 2020 2020 2020 2020 6373                cs
-000119d0: 762e 7772 6974 6528 6d69 7174 762e 636f  v.write(miqtv.co
-000119e0: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
-000119f0: 5b27 696d 6727 5d20 2b0a 2020 2020 2020  ['img'] +.      
-00011a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a10: 2020 2020 222c 222b 6d69 7174 762e 636f      ","+miqtv.co
-00011a20: 6c5f 6865 6164 6572 5b27 6578 6966 275d  l_header['exif']
-00011a30: 5b27 7575 6964 275d 2b22 5c6e 2229 0a20  ['uuid']+"\n"). 
-00011a40: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00011a50: 6966 6665 7265 6e74 5f70 6174 6873 203d  ifferent_paths =
-00011a60: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00011a70: 2020 2020 666f 7220 696d 6720 696e 206d      for img in m
-00011a80: 6973 7369 6e67 5f75 7569 6473 3a0a 2020  issing_uuids:.  
-00011a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011aa0: 2020 6966 206f 732e 7061 7468 2e62 6173    if os.path.bas
-00011ab0: 656e 616d 6528 696d 6729 206e 6f74 2069  ename(img) not i
-00011ac0: 6e20 6469 6666 6572 656e 745f 7061 7468  n different_path
-00011ad0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00011ae0: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
-00011af0: 7265 6e74 5f70 6174 6873 2e61 7070 656e  rent_paths.appen
-00011b00: 6428 6f73 2e70 6174 682e 6261 7365 6e61  d(os.path.basena
-00011b10: 6d65 2869 6d67 2929 0a20 2020 2020 2020  me(img)).       
-00011b20: 2020 2020 2020 2020 2020 2020 2063 7376               csv
-00011b30: 2e77 7269 7465 2869 6d67 2b22 2c22 2b73  .write(img+","+s
-00011b40: 7472 286d 6973 7369 6e67 5f75 7569 6473  tr(missing_uuids
-00011b50: 5b69 6d67 5d29 2b22 5c6e 2229 0a20 2020  [img])+"\n").   
-00011b60: 2020 2020 2020 2020 2020 2020 2023 7265               #re
-00011b70: 7475 726e 2046 616c 7365 2c20 2265 7869  turn False, "exi
-00011b80: 6674 6f6f 6c20 2d63 7376 3d22 2b65 6373  ftool -csv="+ecs
-00011b90: 765f 7061 7468 2b22 2022 2b22 2022 2e6a  v_path+" "+" ".j
-00011ba0: 6f69 6e28 6469 6666 6572 656e 745f 7061  oin(different_pa
-00011bb0: 7468 7329 0a20 2020 2020 2020 2020 2020  ths).           
-00011bc0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00011bd0: 652c 2022 4e6f 7420 616c 6c20 696d 6167  e, "Not all imag
-00011be0: 6573 2068 6176 6520 7661 6c69 6420 5555  es have valid UU
-00011bf0: 4944 732e 204d 6973 7369 6e67 2066 6f72  IDs. Missing for
-00011c00: 2066 6f6c 6c6f 7769 6e67 2066 696c 6573   following files
-00011c10: 3a5c 6e22 2b22 5cc5 8622 2e6a 6f69 6e28  :\n"+"\..".join(
-00011c20: 6469 6666 6572 656e 745f 7061 7468 7329  different_paths)
-00011c30: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00011c40: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00011c50: 5f61 6c6c 5555 4944 7343 6865 636b 6564  _allUUIDsChecked
-00011c60: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00011c70: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
-00011c80: 2022 416c 6c20 696d 6167 6573 2068 6176   "All images hav
-00011c90: 6520 6120 5555 4944 220a 2020 2020 2020  e a UUID".      
-00011ca0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00011cb0: 2250 6174 6820 222b 7365 6c66 2e69 6d61  "Path "+self.ima
-00011cc0: 6765 7344 6972 202b 2022 206e 6f74 2066  gesDir + " not f
-00011cd0: 6f75 6e64 2e22 0a0a 2020 2020 6465 6620  ound."..    def 
-00011ce0: 6372 6561 7465 5555 4944 4669 6c65 2873  createUUIDFile(s
-00011cf0: 656c 662c 636c 6561 6e3d 5472 7565 293a  elf,clean=True):
-00011d00: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-00011d10: 7265 6361 7465 6420 2d20 7573 6520 6372  recated - use cr
-00011d20: 6561 7465 5f75 7569 645f 6669 6c65 2022  eate_uuid_file "
-00011d30: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00011d40: 6e20 7365 6c66 2e63 7265 6174 655f 7575  n self.create_uu
-00011d50: 6964 5f66 696c 6528 636c 6561 6e29 0a0a  id_file(clean)..
-00011d60: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
-00011d70: 6765 5f73 6574 5f61 7474 6974 7564 6528  ge_set_attitude(
-00011d80: 7365 6c66 2c79 6177 5f66 7261 6d65 3a66  self,yaw_frame:f
-00011d90: 6c6f 6174 2c70 6974 6368 5f66 7261 6d65  loat,pitch_frame
-00011da0: 3a66 6c6f 6174 2c72 6f6c 6c5f 6672 616d  :float,roll_fram
-00011db0: 653a 666c 6f61 742c 7961 775f 6361 6d32  e:float,yaw_cam2
-00011dc0: 6672 616d 653a 666c 6f61 742c 7069 7463  frame:float,pitc
-00011dd0: 685f 6361 6d32 6672 616d 653a 666c 6f61  h_cam2frame:floa
-00011de0: 742c 726f 6c6c 5f63 616d 3266 7261 6d65  t,roll_cam2frame
-00011df0: 3a66 6c6f 6174 293a 0a20 2020 2020 2020  :float):.       
-00011e00: 2022 2222 2063 616c 6375 6c61 7465 7320   """ calculates 
-00011e10: 7468 6520 7468 6520 6361 6d65 7261 7320  the the cameras 
-00011e20: 6162 736f 6c75 7465 2061 7474 6974 7564  absolute attitud
-00011e30: 6520 616e 6420 7365 7473 2069 7420 746f  e and sets it to
-00011e40: 2069 6d61 6765 2073 6574 2068 6561 6465   image set heade
-00011e50: 722e 2041 6c6c 2061 6e67 6c65 7320 6172  r. All angles ar
-00011e60: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
-00011e70: 6772 6565 732e 200a 2020 2020 2020 2020  grees. .        
-00011e80: 6361 6d65 7261 3266 7261 6d65 2061 6e67  camera2frame ang
-00011e90: 6c65 733a 2072 6f74 6174 696f 6e20 6f66  les: rotation of
-00011ea0: 2063 616d 6572 6120 636f 6f72 6469 6e61   camera coordina
-00011eb0: 7465 7320 2878 2c79 2c7a 203d 2074 6f70  tes (x,y,z = top
-00011ec0: 2c20 7269 6768 742c 206c 696e 6520 6f66  , right, line of
-00011ed0: 2073 6967 6874 2920 7769 7468 2072 6573   sight) with res
-00011ee0: 7065 6374 2074 6f20 7665 6869 636c 6520  pect to vehicle 
-00011ef0: 636f 6f72 6469 6e61 7465 7320 2878 2c79  coordinates (x,y
-00011f00: 2c7a 203d 2066 6f72 7761 7264 2c72 6967  ,z = forward,rig
-00011f10: 6874 2c64 6f77 6e29 200a 2020 2020 2020  ht,down) .      
-00011f20: 2020 696e 2061 6363 6f72 6461 6e63 6520    in accordance 
-00011f30: 7769 7468 2074 6865 2079 6177 2c70 6974  with the yaw,pit
-00011f40: 6368 2c72 6f6c 6c20 726f 7461 7469 6f6e  ch,roll rotation
-00011f50: 206f 7264 6572 2063 6f6e 7665 6e74 696f   order conventio
-00011f60: 6e3a 0a0a 2020 2020 2020 2020 312e 2079  n:..        1. y
-00011f70: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
-00011f80: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
-00011f90: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
-00011fa0: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
-00011fb0: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
-00011fc0: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
-00011fd0: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
-00011fe0: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
-00011ff0: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
-00012000: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
-00012010: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
-00012020: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
-00012030: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
-00012040: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
-00012050: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
-00012060: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
-00012070: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
-00012080: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
-00012090: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-000120a0: 6368 526f 6c6c 2879 6177 5f66 7261 6d65  chRoll(yaw_frame
-000120b0: 2c70 6974 6368 5f66 7261 6d65 2c72 6f6c  ,pitch_frame,rol
-000120c0: 6c5f 6672 616d 6529 0a20 2020 2020 2020  l_frame).       
-000120d0: 2052 5f63 616d 3266 7261 6d65 203d 206d   R_cam2frame = m
-000120e0: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
-000120f0: 6f6c 6c28 7961 775f 6361 6d32 6672 616d  oll(yaw_cam2fram
-00012100: 652c 7069 7463 685f 6361 6d32 6672 616d  e,pitch_cam2fram
-00012110: 652c 726f 6c6c 5f63 616d 3266 7261 6d65  e,roll_cam2frame
-00012120: 290a 2020 2020 2020 2020 525f 6361 6d32  ).        R_cam2
-00012130: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
-00012140: 642e 646f 7428 525f 6361 6d32 6672 616d  d.dot(R_cam2fram
-00012150: 6529 0a20 2020 2020 2020 2079 6177 2c70  e).        yaw,p
-00012160: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
-00012170: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
-00012180: 5f63 616d 326e 6564 290a 0a20 2020 2020  _cam2ned)..     
-00012190: 2020 2023 2070 6f73 6520 6d61 7472 6978     # pose matrix
-000121a0: 2063 616d 3275 746d 0a20 2020 2020 2020   cam2utm.       
-000121b0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
-000121c0: 7365 6c66 2e67 6574 5f52 5f63 616d 5374  self.get_R_camSt
-000121d0: 6432 7574 6d28 525f 6361 6d32 6672 616d  d2utm(R_cam2fram
-000121e0: 652c 525f 6672 616d 6532 6e65 6429 0a0a  e,R_frame2ned)..
-000121f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012200: 2020 2020 7820 3d20 6e70 2e61 7272 6179      x = np.array
-00012210: 285b 312c 302c 305d 290a 2020 2020 2020  ([1,0,0]).      
-00012220: 2020 7920 3d20 6e70 2e61 7272 6179 285b    y = np.array([
-00012230: 302c 312c 305d 290a 2020 2020 2020 2020  0,1,0]).        
-00012240: 7a20 3d20 6e70 2e61 7272 6179 285b 302c  z = np.array([0,
-00012250: 302c 315d 290a 2020 2020 2020 2020 7072  0,1]).        pr
-00012260: 696e 7428 2778 272c 525f 6361 6d53 7464  int('x',R_camStd
-00012270: 3275 746d 2e64 6f74 2878 292e 726f 756e  2utm.dot(x).roun
-00012280: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
-00012290: 696e 7428 2779 272c 525f 6361 6d53 7464  int('y',R_camStd
-000122a0: 3275 746d 2e64 6f74 2879 292e 726f 756e  2utm.dot(y).roun
-000122b0: 6428 3529 290a 2020 2020 2020 2020 7072  d(5)).        pr
-000122c0: 696e 7428 277a 272c 525f 6361 6d53 7464  int('z',R_camStd
-000122d0: 3275 746d 2e64 6f74 287a 292e 726f 756e  2utm.dot(z).roun
-000122e0: 6428 3529 290a 2020 2020 2020 2020 2222  d(5)).        ""
-000122f0: 220a 0a20 2020 2020 2020 2068 6561 6465  "..        heade
-00012300: 7255 7064 6174 6520 3d20 7b0a 2020 2020  rUpdate = {.    
-00012310: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-00012320: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00012330: 275d 5b27 7961 7727 5d3a 7961 772c 0a20  ']['yaw']:yaw,. 
-00012340: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00012350: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00012360: 6971 7427 5d5b 2770 6974 6368 275d 3a70  iqt']['pitch']:p
-00012370: 6974 6368 2c0a 2020 2020 2020 2020 2020  itch,.          
-00012380: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-00012390: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
-000123a0: 6c6c 275d 3a72 6f6c 6c2c 0a20 2020 2020  ll']:roll,.     
-000123b0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-000123c0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-000123d0: 5d5b 2770 6f73 6527 5d3a 7b27 706f 7365  ]['pose']:{'pose
-000123e0: 2d61 6273 6f6c 7574 652d 6f72 6965 6e74  -absolute-orient
-000123f0: 6174 696f 6e2d 7574 6d2d 6d61 7472 6978  ation-utm-matrix
-00012400: 273a 525f 6361 6d53 7464 3275 746d 2e66  ':R_camStd2utm.f
-00012410: 6c61 7474 656e 2829 2e74 6f6c 6973 7428  latten().tolist(
-00012420: 297d 0a20 2020 2020 2020 207d 0a20 2020  )}.        }.   
-00012430: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
-00012440: 5f69 6664 6f5f 6865 6164 6572 5f66 6965  _ifdo_header_fie
-00012450: 6c64 7328 6865 6164 6572 5570 6461 7465  lds(headerUpdate
-00012460: 290a 0a20 2020 2064 6566 2073 6574 496d  )..    def setIm
-00012470: 6167 6553 6574 4174 7469 7475 6465 2873  ageSetAttitude(s
-00012480: 656c 662c 7961 775f 6672 616d 653a 666c  elf,yaw_frame:fl
-00012490: 6f61 742c 7069 7463 685f 6672 616d 653a  oat,pitch_frame:
-000124a0: 666c 6f61 742c 726f 6c6c 5f66 7261 6d65  float,roll_frame
-000124b0: 3a66 6c6f 6174 2c79 6177 5f63 616d 3266  :float,yaw_cam2f
-000124c0: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
-000124d0: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
-000124e0: 2c72 6f6c 6c5f 6361 6d32 6672 616d 653a  ,roll_cam2frame:
-000124f0: 666c 6f61 7429 3a0a 2020 2020 2020 2020  float):.        
-00012500: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
-00012510: 2075 7365 2073 6574 5f69 6d61 6765 5f73   use set_image_s
-00012520: 6574 5f61 7474 6974 7564 6520 2222 220a  et_attitude """.
-00012530: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-00012540: 5f69 6d61 6765 5f73 6574 5f61 7474 6974  _image_set_attit
-00012550: 7564 6528 7961 775f 6672 616d 652c 2070  ude(yaw_frame, p
-00012560: 6974 6368 5f66 7261 6d65 2c20 726f 6c6c  itch_frame, roll
-00012570: 5f66 7261 6d65 2c20 7961 775f 6361 6d32  _frame, yaw_cam2
-00012580: 6672 616d 652c 2070 6974 6368 5f63 616d  frame, pitch_cam
-00012590: 3266 7261 6d65 2c20 726f 6c6c 5f63 616d  2frame, roll_cam
-000125a0: 3266 7261 6d65 290a 0a0a 2020 2020 6465  2frame)...    de
-000125b0: 6620 6372 6561 7465 5f69 6d61 6765 5f61  f create_image_a
-000125c0: 7474 6974 7564 655f 6669 6c65 2873 656c  ttitude_file(sel
-000125d0: 662c 2061 7474 5f70 6174 683a 7374 722c  f, att_path:str,
-000125e0: 2066 7261 6d65 5f61 7474 5f68 6561 6465   frame_att_heade
-000125f0: 723a 6469 6374 2c20 6361 6d65 7261 3246  r:dict, camera2F
-00012600: 7261 6d65 5f79 6177 3a66 6c6f 6174 2c63  rame_yaw:float,c
-00012610: 616d 6572 6132 4672 616d 655f 7069 7463  amera2Frame_pitc
-00012620: 683a 666c 6f61 742c 6361 6d65 7261 3246  h:float,camera2F
-00012630: 7261 6d65 5f72 6f6c 6c3a 666c 6f61 742c  rame_roll:float,
-00012640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012660: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
-00012670: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-00012680: 2770 616e 6761 6561 275d 2c20 636f 6e73  'pangaea'], cons
-00012690: 745f 7661 6c75 6573 203d 207b 7d2c 206f  t_values = {}, o
-000126a0: 7665 7277 7269 7465 3d46 616c 7365 2c20  verwrite=False, 
-000126b0: 636f 6c5f 7365 7061 7261 746f 7220 3d20  col_separator = 
-000126c0: 225c 7422 2c0a 2020 2020 2020 2020 2020  "\t",.          
-000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126e0: 2020 2020 2020 6174 745f 7061 7468 5f61        att_path_a
-000126f0: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
-00012700: 616c 7365 2c20 7669 6465 6f53 616d 706c  alse, videoSampl
-00012710: 6553 6563 6f6e 6473 3d31 2c72 6563 6f72  eSeconds=1,recor
-00012720: 6473 3262 6549 6e76 6572 7465 643d 5b5d  ds2beInverted=[]
-00012730: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
-00012740: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
-00012750: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
-00012760: 696c 6520 7769 7468 2063 616d 6572 6120  ile with camera 
-00012770: 6174 7469 7475 6465 2064 6174 6120 666f  attitude data fo
-00012780: 7220 6561 6368 2069 6d61 6765 2e20 416c  r each image. Al
-00012790: 6c20 616e 676c 6573 2061 7265 2065 7870  l angles are exp
-000127a0: 6563 7465 6420 696e 2064 6567 7265 6573  ected in degrees
-000127b0: 2e20 5573 6520 6174 745f 7061 7468 5f61  . Use att_path_a
-000127c0: 6e67 6c65 735f 696e 5f72 6164 2069 6620  ngles_in_rad if 
-000127d0: 6e65 6365 7373 6172 792e 200a 2020 2020  necessary. .    
-000127e0: 2020 2020 6361 6d65 7261 3246 7261 6d65      camera2Frame
-000127f0: 2061 6e67 6c65 733a 2072 6f74 6174 696f   angles: rotatio
-00012800: 6e20 6f66 2063 616d 6572 6120 636f 6f72  n of camera coor
-00012810: 6469 6e61 7465 7320 2878 2c79 2c7a 203d  dinates (x,y,z =
-00012820: 2074 6f70 2c20 7269 6768 742c 206c 696e   top, right, lin
-00012830: 6520 6f66 2073 6967 6874 2920 7769 7468  e of sight) with
-00012840: 2072 6573 7065 6374 2074 6f20 7665 6869   respect to vehi
-00012850: 636c 6520 636f 6f72 6469 6e61 7465 7320  cle coordinates 
-00012860: 2878 2c79 2c7a 203d 2066 6f72 7761 7264  (x,y,z = forward
-00012870: 2c72 6967 6874 2c64 6f77 6e29 200a 2020  ,right,down) .  
-00012880: 2020 2020 2020 696e 2061 6363 6f72 6461        in accorda
-00012890: 6e63 6520 7769 7468 2074 6865 2079 6177  nce with the yaw
-000128a0: 2c70 6974 6368 2c72 6f6c 6c20 726f 7461  ,pitch,roll rota
-000128b0: 7469 6f6e 206f 7264 6572 2063 6f6e 7665  tion order conve
-000128c0: 6e74 696f 6e3a 0a20 2020 2020 2020 2031  ntion:.        1
-000128d0: 2e20 7961 7720 6172 6f75 6e64 207a 2c0a  . yaw around z,.
-000128e0: 2020 2020 2020 2020 322e 2070 6974 6368          2. pitch
-000128f0: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
-00012900: 792c 0a20 2020 2020 2020 2033 2e20 726f  y,.        3. ro
-00012910: 6c6c 2061 726f 756e 6420 726f 7461 7465  ll around rotate
-00012920: 6420 780a 0a20 2020 2020 2020 2052 6f74  d x..        Rot
-00012930: 6174 696f 6e20 6469 7265 6374 696f 6e73  ation directions
-00012940: 2061 6363 6f72 6469 6e67 2074 6f20 5c27   according to \'
-00012950: 7269 6768 742d 6861 6e64 2072 756c 655c  right-hand rule\
-00012960: 272e 0a0a 2020 2020 2020 2020 492e 652e  '...        I.e.
-00012970: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
-00012980: 676c 6573 203d 2030 2c30 2c30 2063 616d  gles = 0,0,0 cam
-00012990: 6572 6120 6973 2066 6163 696e 6720 646f  era is facing do
-000129a0: 776e 7761 7264 2077 6974 6820 746f 7020  wnward with top 
-000129b0: 7369 6465 2074 6f77 6172 6473 2076 6568  side towards veh
-000129c0: 6963 6c65 2773 2066 6f72 7761 7264 2064  icle's forward d
-000129d0: 6972 6563 7469 6f6e 2720 2222 220a 0a20  irection' """.. 
-000129e0: 2020 2020 2020 2069 6e74 5f61 7474 7574         int_attut
-000129f0: 7564 655f 6669 6c65 203d 2073 656c 662e  ude_file = self.
-00012a00: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
-00012a10: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
-00012a20: 652d 6174 7469 7475 6465 2e74 7874 270a  e-attitude.txt'.
-00012a30: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
-00012a40: 6561 6465 725f 6174 7420 3d20 7b20 2020  eader_att = {   
-00012a50: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00012a60: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00012a70: 5d3a 2020 6d69 7174 762e 636f 6c5f 6865  ]:  miqtv.col_he
-00012a80: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00012a90: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
-00012aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ab0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-00012ac0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012ad0: 5d5b 2775 7463 275d 3a6d 6971 7476 2e63  ]['utc']:miqtv.c
-00012ae0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00012af0: 7427 5d5b 2775 7463 275d 2c0a 2020 2020  t']['utc'],.    
-00012b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b10: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-00012b20: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00012b30: 7269 7174 275d 5b27 7961 7727 5d3a 6d69  riqt']['yaw']:mi
-00012b40: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00012b50: 6d61 7269 7174 275d 5b27 7961 7727 5d2c  mariqt']['yaw'],
-00012b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b80: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00012b90: 725b 276d 6172 6971 7427 5d5b 2770 6974  r['mariqt']['pit
-00012ba0: 6368 275d 3a6d 6971 7476 2e63 6f6c 5f68  ch']:miqtv.col_h
-00012bb0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012bc0: 2770 6974 6368 275d 2c0a 2020 2020 2020  'pitch'],.      
-00012bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012be0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00012bf0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00012c00: 7174 275d 5b27 726f 6c6c 275d 3a6d 6971  qt']['roll']:miq
-00012c10: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00012c20: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d2c  ariqt']['roll'],
-00012c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012c40: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-00012c50: 2020 2020 2020 2020 696e 745f 706f 7365          int_pose
-00012c60: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
-00012c70: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-00012c80: 6978 2829 202b 2027 5f69 6d61 6765 2d63  ix() + '_image-c
-00012c90: 616d 6572 612d 706f 7365 2e74 7874 270a  amera-pose.txt'.
-00012ca0: 2020 2020 2020 2020 6f75 7470 7574 5f68          output_h
-00012cb0: 6561 6465 725f 706f 7365 203d 207b 2020  eader_pose = {  
-00012cc0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00012cd0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00012ce0: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
-00012cf0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00012d00: 6727 5d2c 0a20 2020 2020 2020 2020 2020  g'],.           
-00012d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d20: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
-00012d30: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012d40: 2775 7463 275d 3a6d 6971 7476 2e63 6f6c  'utc']:miqtv.col
-00012d50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012d60: 5d5b 2775 7463 275d 2c0a 2020 2020 2020  ]['utc'],.      
-00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d80: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00012d90: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00012da0: 7174 275d 5b27 706f 7365 275d 3a6d 6971  qt']['pose']:miq
-00012db0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00012dc0: 6172 6971 7427 5d5b 2770 6f73 6527 5d2c  ariqt']['pose'],
-00012dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012de0: 2020 2020 2020 2020 2020 2020 207d 0a0a               }..
-00012df0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-00012e00: 7468 2e65 7869 7374 7328 696e 745f 6174  th.exists(int_at
-00012e10: 7475 7475 6465 5f66 696c 6529 2061 6e64  tutude_file) and
-00012e20: 206e 6f74 206f 7665 7277 7269 7465 3a0a   not overwrite:.
-00012e30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012e40: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
-00012e50: 6162 5f66 696c 6528 696e 745f 6174 7475  ab_file(int_attu
-00012e60: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
-00012e70: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
-00012e80: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00012e90: 7475 726e 2054 7275 652c 2022 4f75 7470  turn True, "Outp
-00012ea0: 7574 2066 696c 6520 6578 6973 7473 3a20  ut file exists: 
-00012eb0: 222b 696e 745f 6174 7475 7475 6465 5f66  "+int_attutude_f
-00012ec0: 696c 650a 0a20 2020 2020 2020 2069 6620  ile..        if 
-00012ed0: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
-00012ee0: 7473 2861 7474 5f70 6174 6829 3a0a 2020  ts(att_path):.  
-00012ef0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012f00: 2046 616c 7365 2c20 224e 6176 6967 6174   False, "Navigat
-00012f10: 696f 6e20 6669 6c65 206e 6f74 2066 6f75  ion file not fou
-00012f20: 6e64 3a20 222b 6174 745f 7061 7468 0a0a  nd: "+att_path..
-00012f30: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
-00012f40: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00012f50: 6c66 2e69 6d61 6765 7344 6972 293a 0a20  lf.imagesDir):. 
-00012f60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012f70: 6e20 4661 6c73 652c 2022 496d 6167 6520  n False, "Image 
-00012f80: 666f 6c64 6572 206e 6f74 2066 6f75 6e64  folder not found
-00012f90: 3a20 222b 2073 656c 662e 696d 6167 6573  : "+ self.images
-00012fa0: 4469 720a 0a20 2020 2020 2020 2073 203d  Dir..        s =
-00012fb0: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
-00012fc0: 696e 674d 7367 2822 4372 6561 7469 6e67  ingMsg("Creating
-00012fd0: 2069 7465 6d73 2720 6174 7469 7475 6465   items' attitude
-00012fe0: 2064 6174 6122 290a 0a20 2020 2020 2020   data")..       
-00012ff0: 2023 206c 6f61 6420 6672 616d 6520 6174   # load frame at
-00013000: 7469 7475 6465 2064 6174 6120 6672 6f6d  titude data from
-00013010: 2066 696c 650a 2020 2020 2020 2020 6174   file.        at
-00013020: 745f 6461 7461 2c20 7061 7273 654d 7367  t_data, parseMsg
-00013030: 203d 206d 6971 746e 2e72 6561 6441 6c6c   = miqtn.readAll
-00013040: 4174 7469 7475 6465 7346 726f 6d46 696c  AttitudesFromFil
-00013050: 6550 6174 6828 6174 745f 7061 7468 2c20  ePath(att_path, 
-00013060: 6672 616d 655f 6174 745f 6865 6164 6572  frame_att_header
-00013070: 2c20 6461 7465 5f66 6f72 6d61 742c 636f  , date_format,co
-00013080: 6c5f 7365 7061 7261 746f 723d 636f 6c5f  l_separator=col_
-00013090: 7365 7061 7261 746f 722c 636f 6e73 745f  separator,const_
-000130a0: 7661 6c75 6573 3d63 6f6e 7374 5f76 616c  values=const_val
-000130b0: 7565 732c 616e 676c 6573 496e 5261 643d  ues,anglesInRad=
-000130c0: 6174 745f 7061 7468 5f61 6e67 6c65 735f  att_path_angles_
-000130d0: 696e 5f72 6164 290a 2020 2020 2020 2020  in_rad).        
-000130e0: 6966 2070 6172 7365 4d73 6720 213d 2022  if parseMsg != "
-000130f0: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
-00013100: 656c 662e 7072 6f76 2e6c 6f67 2870 6172  elf.prov.log(par
-00013110: 7365 4d73 672c 646f 6e74 5368 6f77 3d54  seMsg,dontShow=T
-00013120: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-00013130: 2070 6172 7365 4d73 6720 3d20 225c 6e22   parseMsg = "\n"
-00013140: 202b 2070 6172 7365 4d73 670a 0a20 2020   + parseMsg..   
-00013150: 2020 2020 2023 2066 696e 6420 666f 7220       # find for 
-00013160: 6561 6368 2069 6d61 6765 2074 6865 2072  each image the r
-00013170: 6573 7065 6374 6976 6520 6e61 7669 6761  espective naviga
-00013180: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
-00013190: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
-000131a0: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
-000131b0: 655f 6474 732c 206d 7367 203d 2073 656c  e_dts, msg = sel
-000131c0: 662e 6669 6e64 4e61 7644 6174 6146 6f72  f.findNavDataFor
-000131d0: 496d 6167 6528 6174 745f 6461 7461 2c76  Image(att_data,v
-000131e0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-000131f0: 7329 0a20 2020 2020 2020 2069 6620 6e6f  s).        if no
-00013200: 7420 7375 6363 6573 733a 0a20 2020 2020  t success:.     
-00013210: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00013220: 6c73 652c 206d 7367 202b 2070 6172 7365  lse, msg + parse
-00013230: 4d73 670a 2020 2020 2020 2020 7320 3d20  Msg.        s = 
-00013240: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
-00013250: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
-00013260: 6974 656d 7327 2061 7474 6974 7564 6520  items' attitude 
-00013270: 6461 7461 2229 0a0a 2020 2020 2020 2020  data")..        
-00013280: 2320 6164 6420 6361 6d65 7261 3246 7261  # add camera2Fra
-00013290: 6d65 2061 6e67 6c65 730a 2020 2020 2020  me angles.      
-000132a0: 2020 525f 6361 6d32 6672 616d 6520 3d20    R_cam2frame = 
-000132b0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
-000132c0: 526f 6c6c 2863 616d 6572 6132 4672 616d  Roll(camera2Fram
-000132d0: 655f 7961 772c 6361 6d65 7261 3246 7261  e_yaw,camera2Fra
-000132e0: 6d65 5f70 6974 6368 2c63 616d 6572 6132  me_pitch,camera2
-000132f0: 4672 616d 655f 726f 6c6c 290a 2020 2020  Frame_roll).    
-00013300: 2020 2020 525f 6361 6d32 7574 6d5f 6c69      R_cam2utm_li
-00013310: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
-00013320: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00013330: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00013340: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
-00013350: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00013360: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-00013370: 2020 2020 2061 7474 6974 7564 6520 3d20       attitude = 
-00013380: 7469 6d65 706f 696e 740a 2020 2020 2020  timepoint.      
-00013390: 2020 2020 2020 2020 2020 6966 2061 7474            if att
-000133a0: 6974 7564 652e 7961 7720 6973 204e 6f6e  itude.yaw is Non
-000133b0: 6520 6f72 2061 7474 6974 7564 652e 7069  e or attitude.pi
-000133c0: 7463 6820 6973 204e 6f6e 6520 6f72 2061  tch is None or a
-000133d0: 7474 6974 7564 652e 726f 6c6c 2069 7320  ttitude.roll is 
-000133e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000133f0: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
-00013400: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
-00013410: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
-00013420: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00013430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013440: 2052 5f66 7261 6d65 326e 6564 203d 206d   R_frame2ned = m
-00013450: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
-00013460: 6f6c 6c28 6174 7469 7475 6465 2e79 6177  oll(attitude.yaw
-00013470: 2c61 7474 6974 7564 652e 7069 7463 682c  ,attitude.pitch,
-00013480: 6174 7469 7475 6465 2e72 6f6c 6c29 0a20  attitude.roll). 
-00013490: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-000134a0: 5f63 616d 326e 6564 203d 2052 5f66 7261  _cam2ned = R_fra
-000134b0: 6d65 326e 6564 2e64 6f74 2852 5f63 616d  me2ned.dot(R_cam
-000134c0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-000134d0: 2020 2020 2020 2020 7961 772c 7069 7463          yaw,pitc
-000134e0: 682c 726f 6c6c 203d 206d 6971 7467 2e79  h,roll = miqtg.y
-000134f0: 6177 5069 7463 6852 6f6c 6c28 525f 6361  awPitchRoll(R_ca
-00013500: 6d32 6e65 6429 0a20 2020 2020 2020 2020  m2ned).         
-00013510: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
-00013520: 7961 7720 3d20 7961 770a 2020 2020 2020  yaw = yaw.      
-00013530: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
-00013540: 6465 2e70 6974 6368 203d 2070 6974 6368  de.pitch = pitch
-00013550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013560: 2061 7474 6974 7564 652e 726f 6c6c 203d   attitude.roll =
-00013570: 2072 6f6c 6c0a 0a20 2020 2020 2020 2020   roll..         
-00013580: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
-00013590: 7574 6d20 3d20 7365 6c66 2e67 6574 5f52  utm = self.get_R
-000135a0: 5f63 616d 5374 6432 7574 6d28 525f 6361  _camStd2utm(R_ca
-000135b0: 6d32 6672 616d 652c 525f 6672 616d 6532  m2frame,R_frame2
-000135c0: 6e65 6429 0a20 2020 2020 2020 2020 2020  ned).           
-000135d0: 2020 2020 2052 5f63 616d 3275 746d 5f6c       R_cam2utm_l
-000135e0: 6973 742e 6170 7065 6e64 2852 5f63 616d  ist.append(R_cam
-000135f0: 5374 6432 7574 6d2e 666c 6174 7465 6e28  Std2utm.flatten(
-00013600: 292e 746f 6c69 7374 2829 290a 0a20 2020  ).tolist())..   
-00013610: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00013620: 6f67 2822 6170 706c 6965 6420 6672 616d  og("applied fram
-00013630: 6520 746f 2063 616d 6572 6120 726f 7461  e to camera rota
-00013640: 7469 6f6e 2079 6177 2c70 6974 6368 2c72  tion yaw,pitch,r
-00013650: 6f6c 6c20 3d20 2220 2b20 7374 7228 6361  oll = " + str(ca
-00013660: 6d65 7261 3246 7261 6d65 5f79 6177 2920  mera2Frame_yaw) 
-00013670: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
-00013680: 7261 3246 7261 6d65 5f70 6974 6368 2920  ra2Frame_pitch) 
-00013690: 2b20 222c 2220 2b20 7374 7228 6361 6d65  + "," + str(came
-000136a0: 7261 3246 7261 6d65 5f72 6f6c 6c29 2c64  ra2Frame_roll),d
-000136b0: 6f6e 7453 686f 773d 5472 7565 290a 0a20  ontShow=True).. 
-000136c0: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
-000136d0: 6167 655f 6474 7329 203e 2030 3a0a 0a20  age_dts) > 0:.. 
-000136e0: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
-000136f0: 7465 2074 6f20 6e61 7669 6761 7469 6f6e  te to navigation
-00013700: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
-00013710: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-00013720: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00013730: 206f 7065 6e28 696e 745f 6174 7475 7475   open(int_attutu
-00013740: 6465 5f66 696c 652c 2022 7722 290a 2020  de_file, "w").  
-00013750: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00013760: 6974 6528 6d69 7174 762e 636f 6c5f 6865  ite(miqtv.col_he
-00013770: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013780: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
-00013790: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-000137a0: 6971 7427 5d5b 2775 7463 275d 290a 2020  iqt']['utc']).  
-000137b0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-000137c0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-000137d0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000137e0: 7427 5d5b 2779 6177 275d 290a 2020 2020  t']['yaw']).    
-000137f0: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00013800: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
-00013810: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013820: 5d5b 2770 6974 6368 275d 290a 2020 2020  ]['pitch']).    
-00013830: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00013840: 6528 225c 7422 2b6d 6971 7476 2e63 6f6c  e("\t"+miqtv.col
-00013850: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013860: 5d5b 2772 6f6c 6c27 5d29 0a0a 2020 2020  ]['roll'])..    
-00013870: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00013880: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
-00013890: 2020 2020 2320 6461 7461 206c 696e 6573      # data lines
-000138a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000138b0: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
-000138c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000138d0: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
-000138e0: 7420 696e 2069 6d61 6765 5f64 7473 5b66  t in image_dts[f
-000138f0: 696c 655d 3a0a 2020 2020 2020 2020 2020  ile]:.          
-00013900: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00013910: 6974 6528 6669 6c65 2b22 5c74 222b 7469  ite(file+"\t"+ti
-00013920: 6d65 706f 696e 742e 6461 7465 5469 6d65  mepoint.dateTime
-00013930: 2829 2e73 7472 6674 696d 6528 6d69 7174  ().strftime(miqt
-00013940: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00013950: 6d61 7269 7174 275d 2929 200a 2020 2020  mariqt'])) .    
-00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013970: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
-00013980: 7961 770a 2020 2020 2020 2020 2020 2020  yaw.            
-00013990: 2020 2020 2020 2020 6966 2027 7961 7727          if 'yaw'
-000139a0: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
-000139b0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-000139c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139d0: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
-000139e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000139f0: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00013a00: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00013a10: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00013a20: 2074 696d 6570 6f69 6e74 2e70 6974 6368   timepoint.pitch
-00013a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013a40: 2020 2020 2069 6620 2770 6974 6368 2720       if 'pitch' 
-00013a50: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
-00013a60: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-00013a70: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00013a80: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
-00013a90: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00013aa0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
-00013ab0: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
-00013ac0: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-00013ad0: 7469 6d65 706f 696e 742e 726f 6c6c 0a20  timepoint.roll. 
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013af0: 2020 2069 6620 2772 6f6c 6c27 2069 6e20     if 'roll' in 
-00013b00: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00013b10: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00013b20: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-00013b30: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
-00013b40: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00013b50: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
-00013b60: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00013b70: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00013b80: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
-00013b90: 2020 2072 6573 2e63 6c6f 7365 2829 0a0a     res.close()..
-00013ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013bb0: 2e70 726f 762e 6164 6441 7267 756d 656e  .prov.addArgumen
-00013bc0: 7428 2269 6e70 7574 4174 7469 7475 6465  t("inputAttitude
-00013bd0: 4669 6c65 222c 6174 745f 7061 7468 2c6f  File",att_path,o
-00013be0: 7665 7277 7269 7465 3d54 7275 6529 0a20  verwrite=True). 
-00013bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013c00: 7072 6f76 2e6c 6f67 2822 7061 7273 6564  prov.log("parsed
-00013c10: 2066 726f 6d20 696e 7075 7441 7474 6974   from inputAttit
-00013c20: 7564 6546 696c 653a 2022 202b 2073 7472  udeFile: " + str
-00013c30: 2866 7261 6d65 5f61 7474 5f68 6561 6465  (frame_att_heade
-00013c40: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
-00013c50: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00013c60: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
-00013c70: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
-00013c80: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
-00013c90: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
-00013ca0: 7474 290a 0a20 2020 2020 2020 2020 2020  tt)..           
-00013cb0: 2023 2057 7269 7465 2074 6f20 706f 7365   # Write to pose
-00013cc0: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
-00013cd0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-00013ce0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00013cf0: 206f 7065 6e28 696e 745f 706f 7365 5f66   open(int_pose_f
-00013d00: 696c 652c 2022 7722 290a 2020 2020 2020  ile, "w").      
-00013d10: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00013d20: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00013d30: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00013d40: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
-00013d50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013d60: 5d5b 2775 7463 275d 290a 2020 2020 2020  ]['utc']).      
-00013d70: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00013d80: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00013d90: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00013da0: 2770 6f73 6527 5d29 0a20 2020 2020 2020  'pose']).       
-00013db0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00013dc0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00013dd0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00013de0: 2020 2020 2020 2020 2020 6920 3d20 300a            i = 0.
-00013df0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00013e00: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
-00013e10: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00013e20: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
-00013e30: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00013e40: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-00013e50: 2020 2020 2020 2020 2069 6620 525f 6361           if R_ca
-00013e60: 6d32 7574 6d5f 6c69 7374 5b69 5d20 3d3d  m2utm_list[i] ==
-00013e70: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00013e80: 2020 2020 2020 2020 2020 2020 2069 202b               i +
-00013e90: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00013ea0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00013eb0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00013ec0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00013ed0: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
-00013ee0: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
-00013ef0: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
-00013f00: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-00013f10: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
-00013f20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00013f30: 6e74 7279 203d 2073 7472 287b 2770 6f73  ntry = str({'pos
-00013f40: 652d 6162 736f 6c75 7465 2d6f 7269 656e  e-absolute-orien
-00013f50: 7461 7469 6f6e 2d75 746d 2d6d 6174 7269  tation-utm-matri
-00013f60: 7827 3a52 5f63 616d 3275 746d 5f6c 6973  x':R_cam2utm_lis
-00013f70: 745b 695d 7d29 2e72 6570 6c61 6365 2827  t[i]}).replace('
-00013f80: 5c6e 272c 2727 290a 2020 2020 2020 2020  \n','').        
-00013f90: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00013fa0: 7772 6974 6528 225c 7422 2b65 6e74 7279  write("\t"+entry
-00013fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013fc0: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
-00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013fe0: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
-00013ff0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014000: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00014010: 2020 2020 2073 656c 662e 6164 645f 6974       self.add_it
-00014020: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
-00014030: 2869 6e74 5f70 6f73 655f 6669 6c65 2c22  (int_pose_file,"
-00014040: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
-00014050: 725f 706f 7365 290a 2020 2020 2020 2020  r_pose).        
-00014060: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00014070: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014080: 5472 7565 2c20 2241 7474 6974 7564 6520  True, "Attitude 
-00014090: 6461 7461 2063 7265 6174 6564 2220 2b20  data created" + 
-000140a0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
-000140b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000140c0: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-000140d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000140e0: 616c 7365 2c20 224e 6f20 696d 6167 6520  alse, "No image 
-000140f0: 6174 7469 7475 6465 7320 666f 756e 6422  attitudes found"
-00014100: 202b 2070 6172 7365 4d73 670a 2020 2020   + parseMsg.    
-00014110: 2020 2020 0a20 2020 2020 2020 200a 2020      .        .  
-00014120: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
-00014130: 6541 7474 6974 7564 6546 696c 6528 7365  eAttitudeFile(se
-00014140: 6c66 2c20 6174 745f 7061 7468 3a73 7472  lf, att_path:str
-00014150: 2c20 6672 616d 655f 6174 745f 6865 6164  , frame_att_head
-00014160: 6572 3a64 6963 742c 2063 616d 6572 6132  er:dict, camera2
-00014170: 4672 616d 655f 7961 773a 666c 6f61 742c  Frame_yaw:float,
-00014180: 6361 6d65 7261 3246 7261 6d65 5f70 6974  camera2Frame_pit
-00014190: 6368 3a66 6c6f 6174 2c63 616d 6572 6132  ch:float,camera2
-000141a0: 4672 616d 655f 726f 6c6c 3a66 6c6f 6174  Frame_roll:float
-000141b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000141c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141d0: 2020 6461 7465 5f66 6f72 6d61 743d 6d69    date_format=mi
-000141e0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-000141f0: 5b27 7061 6e67 6165 6127 5d2c 2063 6f6e  ['pangaea'], con
-00014200: 7374 5f76 616c 7565 7320 3d20 7b7d 2c20  st_values = {}, 
-00014210: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
-00014220: 2063 6f6c 5f73 6570 6172 6174 6f72 203d   col_separator =
-00014230: 2022 5c74 222c 0a20 2020 2020 2020 2020   "\t",.         
-00014240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014250: 2020 2020 2020 2061 7474 5f70 6174 685f         att_path_
-00014260: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
-00014270: 4661 6c73 652c 2076 6964 656f 5361 6d70  False, videoSamp
-00014280: 6c65 5365 636f 6e64 733d 312c 7265 636f  leSeconds=1,reco
-00014290: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
-000142a0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
-000142b0: 4465 7072 6563 6174 6465 202d 2075 7365  Deprecatde - use
-000142c0: 2063 7265 6174 655f 696d 6167 655f 6174   create_image_at
-000142d0: 7469 7475 6465 5f66 696c 6520 2222 220a  titude_file """.
-000142e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000142f0: 656c 662e 6372 6561 7465 5f69 6d61 6765  elf.create_image
-00014300: 5f61 7474 6974 7564 655f 6669 6c65 2861  _attitude_file(a
-00014310: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
-00014320: 7474 5f68 6561 6465 722c 2063 616d 6572  tt_header, camer
-00014330: 6132 4672 616d 655f 7961 772c 2063 616d  a2Frame_yaw, cam
-00014340: 6572 6132 4672 616d 655f 7069 7463 682c  era2Frame_pitch,
-00014350: 2063 616d 6572 6132 4672 616d 655f 726f   camera2Frame_ro
-00014360: 6c6c 2c20 0a20 2020 2020 2020 2020 2020  ll, .           
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014390: 2020 2020 6461 7465 5f66 6f72 6d61 742c      date_format,
-000143a0: 2063 6f6e 7374 5f76 616c 7565 732c 206f   const_values, o
-000143b0: 7665 7277 7269 7465 2c20 636f 6c5f 7365  verwrite, col_se
-000143c0: 7061 7261 746f 722c 2061 7474 5f70 6174  parator, att_pat
-000143d0: 685f 616e 676c 6573 5f69 6e5f 7261 642c  h_angles_in_rad,
-000143e0: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
-000143f0: 6e64 732c 0a20 2020 2020 2020 2020 2020  nds,.           
-00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014420: 2020 2020 7265 636f 7264 7332 6265 496e      records2beIn
-00014430: 7665 7274 6564 290a 2020 2020 2020 2020  verted).        
-00014440: 0a0a 2020 2020 6465 6620 6765 745f 525f  ..    def get_R_
-00014450: 6361 6d53 7464 3275 746d 2873 656c 662c  camStd2utm(self,
-00014460: 525f 6361 6d32 6672 616d 653a 6e70 2e61  R_cam2frame:np.a
-00014470: 7272 6179 2c52 5f66 7261 6d65 326e 6564  rray,R_frame2ned
-00014480: 3a6e 702e 6172 7261 7929 3a0a 2020 2020  :np.array):.    
-00014490: 2020 2020 2222 2220 7265 7472 756e 2072      """ retrun r
-000144a0: 6f74 6174 696f 6e20 6d61 7472 6978 2052  otation matrix R
-000144b0: 2074 7261 6e66 6f72 6d69 6e67 2066 726f   tranforming fro
-000144c0: 6d20 6361 6d53 7464 3a20 2878 2c79 2c7a  m camStd: (x,y,z
-000144d0: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
-000144e0: 6c69 6e65 206f 6620 7369 6768 7429 2074  line of sight) t
-000144f0: 6f20 7574 6d20 2878 2c79 2c7a 203d 2065  o utm (x,y,z = e
-00014500: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
-00014510: 7570 2920 2222 220a 2020 2020 2020 2020  up) """.        
-00014520: 525f 6361 6d69 4644 4f32 6361 6d53 7464  R_camiFDO2camStd
-00014530: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
-00014540: 7463 6852 6f6c 6c28 3930 2c30 2c30 2920  tchRoll(90,0,0) 
-00014550: 2320 696e 2069 4644 4f20 6361 6d3a 2028  # in iFDO cam: (
-00014560: 782c 792c 7a20 3d20 746f 702c 7269 6768  x,y,z = top,righ
-00014570: 742c 6c69 6e65 206f 6620 7369 6768 7429  t,line of sight)
-00014580: 2062 7574 2066 6f72 2070 6f73 6520 7468   but for pose th
-00014590: 6520 2773 7461 6e64 6172 6427 2063 616d  e 'standard' cam
-000145a0: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
-000145b0: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
-000145c0: 6f66 2073 6967 6874 2920 6973 2065 7870  of sight) is exp
-000145d0: 6563 7465 640a 2020 2020 2020 2020 525f  ected.        R_
-000145e0: 6361 6d53 7464 3266 7261 6d65 203d 2052  camStd2frame = R
-000145f0: 5f63 616d 3266 7261 6d65 2e64 6f74 2852  _cam2frame.dot(R
-00014600: 5f63 616d 6946 444f 3263 616d 5374 6429  _camiFDO2camStd)
-00014610: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
-00014620: 6432 6e65 6420 3d20 525f 6672 616d 6532  d2ned = R_frame2
-00014630: 6e65 642e 646f 7428 525f 6361 6d53 7464  ned.dot(R_camStd
-00014640: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-00014650: 525f 6e65 6432 7574 6d20 3d20 6d69 7174  R_ned2utm = miqt
-00014660: 672e 525f 5859 5a28 3138 302c 302c 3930  g.R_XYZ(180,0,90
-00014670: 2920 2320 7769 7468 2075 746d 2078 2c79  ) # with utm x,y
-00014680: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
-00014690: 7468 696e 672c 7570 0a20 2020 2020 2020  thing,up.       
-000146a0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
-000146b0: 525f 6e65 6432 7574 6d2e 646f 7428 525f  R_ned2utm.dot(R_
-000146c0: 6361 6d53 7464 326e 6564 292e 726f 756e  camStd2ned).roun
-000146d0: 6428 3529 0a20 2020 2020 2020 2072 6574  d(5).        ret
-000146e0: 7572 6e20 525f 6361 6d53 7464 3275 746d  urn R_camStd2utm
-000146f0: 0a0a 0a20 2020 2064 6566 2066 696e 644e  ...    def findN
-00014700: 6176 4461 7461 466f 7249 6d61 6765 2873  avDataForImage(s
-00014710: 656c 662c 6461 7461 3a6d 6971 7467 2e4e  elf,data:miqtg.N
-00014720: 756d 4461 7461 5469 6d65 5374 616d 7065  umDataTimeStampe
-00014730: 642c 7669 6465 6f53 616d 706c 6553 6563  d,videoSampleSec
-00014740: 6f6e 6473 3d31 293a 0a20 2020 2020 2020  onds=1):.       
-00014750: 2022 2222 2063 7265 6174 6573 2061 2064   """ creates a d
-00014760: 6963 7420 2869 6d61 6765 5f64 7473 2920  ict (image_dts) 
-00014770: 7769 7468 2066 696c 6520 6e61 6d65 2061  with file name a
-00014780: 7320 6b65 7920 616e 6420 6120 6c69 7374  s key and a list
-00014790: 206f 6620 6461 7461 2065 6c65 6d65 6e74   of data element
-000147a0: 7320 6173 2076 616c 7565 2e20 0a20 2020  s as value. .   
-000147b0: 2020 2020 2020 2020 2049 6e20 6361 7365           In case
-000147c0: 206f 6620 7068 6f74 6f73 2074 6865 206c   of photos the l
-000147d0: 6973 7420 6861 7320 6f6e 6c79 2061 2073  ist has only a s
-000147e0: 696e 676c 6520 656e 7472 792c 2066 6f72  ingle entry, for
-000147f0: 2076 6964 656f 7320 6974 2068 6173 2076   videos it has v
-00014800: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
-00014810: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
-00014820: 6553 6563 6f6e 6473 2065 6e74 7269 6573  eSeconds entries
-00014830: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
-00014840: 7475 726e 7320 7375 6363 6573 732c 2069  turns success, i
-00014850: 6d61 6765 5f64 7473 2c20 6d73 6720 2222  mage_dts, msg ""
-00014860: 220a 0a20 2020 2020 2020 2069 6620 7669  "..        if vi
-00014870: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00014880: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
-00014890: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000148a0: 6f6e 2822 6669 6e64 4e61 7644 6174 6146  on("findNavDataF
-000148b0: 6f72 496d 6167 653a 2076 6964 656f 5361  orImage: videoSa
-000148c0: 6d70 6c65 5365 636f 6e64 7320 6d75 7374  mpleSeconds must
-000148d0: 2062 6520 6772 6561 7465 7220 3022 290a   be greater 0").
-000148e0: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-000148f0: 6520 736f 7274 6564 2074 696d 6520 706f  e sorted time po
-00014900: 696e 7473 0a20 2020 2020 2020 2074 696d  ints.        tim
-00014910: 655f 706f 696e 7473 203d 206c 6973 7428  e_points = list(
-00014920: 6461 7461 2e6b 6579 7328 2929 0a20 2020  data.keys()).   
-00014930: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
-00014940: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
-00014950: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-00014960: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
-00014970: 2069 6d61 6765 5f64 7473 203d 207b 7d0a   image_dts = {}.
-00014980: 2020 2020 2020 2020 7374 6172 7453 6561          startSea
-00014990: 7263 6849 6e64 6578 203d 2030 0a20 2020  rchIndex = 0.   
-000149a0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-000149b0: 203d 2020 7365 6c66 2e69 6d61 6765 7349   =  self.imagesI
-000149c0: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-000149d0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-000149e0: 536f 7274 6564 4c69 7374 203d 2073 656c  SortedList = sel
-000149f0: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-00014a00: 4469 7253 6f72 7465 644c 6973 7428 290a  DirSortedList().
-00014a10: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00014a20: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00014a30: 726f 6772 6573 734d 7367 2822 496e 7465  rogressMsg("Inte
-00014a40: 7270 6f6c 6174 696e 6720 6e61 7669 6761  rpolating naviga
-00014a50: 7469 6f6e 2066 6f72 2069 6d61 6765 222c  tion for image",
-00014a60: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-00014a70: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
-00014a80: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00014a90: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
-00014aa0: 644c 6973 743a 0a20 2020 2020 2020 2020  dList:.         
-00014ab0: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-00014ac0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-00014ad0: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-00014ae0: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
-00014af0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00014b00: 745f 696d 6167 6520 3d20 6d69 7174 632e  t_image = miqtc.
-00014b10: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
-00014b20: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
-00014b30: 290a 2020 2020 2020 2020 2020 2020 6474  ).            dt
-00014b40: 5f69 6d61 6765 5f74 7320 3d20 696e 7428  _image_ts = int(
-00014b50: 6474 5f69 6d61 6765 2e74 696d 6573 7461  dt_image.timesta
-00014b60: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
-00014b70: 2020 2020 2020 2020 2020 7275 6e54 696d            runTim
-00014b80: 6520 3d20 696d 6167 6573 496e 5261 775b  e = imagesInRaw[
-00014b90: 6669 6c65 5d5b 315d 2023 202d 3120 666f  file][1] # -1 fo
-00014ba0: 7220 7068 6f74 6f73 0a20 2020 2020 2020  r photos.       
-00014bb0: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
-00014bc0: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-00014bd0: 6573 496e 5261 775b 6669 6c65 5d5b 325d  esInRaw[file][2]
-00014be0: 2069 6e20 6d69 7174 762e 7669 6465 6f5f   in miqtv.video_
-00014bf0: 7479 7065 7320 616e 6420 7275 6e54 696d  types and runTim
-00014c00: 6520 3c3d 2030 3a20 2320 6578 740a 2020  e <= 0: # ext.  
-00014c10: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00014c20: 696e 7428 2243 6175 7469 6f6e 2120 436f  int("Caution! Co
-00014c30: 756c 6420 6e6f 7420 7265 6164 2076 6964  uld not read vid
-00014c40: 656f 2072 756e 2074 696d 6520 6672 6f6d  eo run time from
-00014c50: 2066 696c 6522 2c66 696c 6529 2023 2054   file",file) # T
-00014c60: 4f44 4f20 646f 6573 2074 6869 7320 6861  ODO does this ha
-00014c70: 7070 656e 3f20 4861 6e64 6c65 2062 6574  ppen? Handle bet
-00014c80: 7465 723f 0a0a 2020 2020 2020 2020 2020  ter?..          
-00014c90: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
-00014ca0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00014cb0: 2070 6f73 5f6c 6973 7420 3d20 5b5d 0a20   pos_list = []. 
-00014cc0: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-00014cd0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00014ce0: 2077 6869 6c65 2067 6f3a 0a20 2020 2020   while go:.     
-00014cf0: 2020 2020 2020 2020 2020 2074 7279 3a20             try: 
-00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d10: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00014d20: 2020 2020 2020 2020 706f 732c 2073 7461          pos, sta
-00014d30: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
-00014d40: 6461 7461 2e69 6e74 6572 706f 6c61 7465  data.interpolate
-00014d50: 4174 5469 6d65 2864 745f 696d 6167 655f  AtTime(dt_image_
-00014d60: 7473 202b 2073 616d 706c 6554 696d 6553  ts + sampleTimeS
-00014d70: 6563 7320 2a20 3130 3030 2c74 696d 655f  ecs * 1000,time_
-00014d80: 706f 696e 7473 2c73 7461 7274 5365 6172  points,startSear
-00014d90: 6368 496e 6465 7829 0a20 2020 2020 2020  chIndex).       
-00014da0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dc0: 2020 2320 696e 7465 7270 6f6c 6174 6541    # interpolateA
-00014dd0: 7454 696d 6520 7265 7475 726e 7320 4e6f  tTime returns No
-00014de0: 6e65 2076 616c 7565 7320 6966 2074 696d  ne values if tim
-00014df0: 6520 6f75 7420 6f66 2072 616e 6765 0a20  e out of range. 
-00014e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e10: 2020 2069 6620 706f 732e 636f 7461 696e     if pos.cotain
-00014e20: 734e 6f6e 6556 616c 7565 7349 6e52 6571  sNoneValuesInReq
-00014e30: 7569 7265 6446 6965 6c64 7328 293a 0a20  uiredFields():. 
-00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
-00014e60: 5469 6d65 506f 696e 7473 2e61 7070 656e  TimePoints.appen
-00014e70: 6428 2864 745f 696d 6167 655f 7473 202b  d((dt_image_ts +
-00014e80: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
-00014e90: 2a20 3130 3030 292f 3130 3030 290a 2020  * 1000)/1000).  
-00014ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014eb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ed0: 706f 735f 6c69 7374 2e61 7070 656e 6428  pos_list.append(
-00014ee0: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
-00014ef0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00014f00: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00014f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f20: 7265 7475 726e 2046 616c 7365 2c20 696d  return False, im
-00014f30: 6167 655f 6474 732c 2022 436f 756c 6420  age_dts, "Could 
-00014f40: 6e6f 7420 6669 6e64 2069 6d61 6765 2074  not find image t
-00014f50: 696d 6520 222b 2064 6174 6574 696d 652e  ime "+ datetime.
-00014f60: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
-00014f70: 7469 6d65 7374 616d 7028 2864 745f 696d  timestamp((dt_im
-00014f80: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
-00014f90: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
-00014fa0: 3130 3030 292e 7374 7266 7469 6d65 286d  1000).strftime(m
-00014fb0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00014fc0: 735b 276d 6172 6971 7427 5d29 202b 2220  s['mariqt']) +" 
-00014fd0: 696e 2022 2b73 7472 2864 6174 612e 6c65  in "+str(data.le
-00014fe0: 6e28 2929 2b22 2064 6174 6120 706f 7369  n())+" data posi
-00014ff0: 7469 6f6e 7322 202b 2073 7472 2865 2e61  tions" + str(e.a
-00015000: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00015010: 2020 2020 2073 616d 706c 6554 696d 6553       sampleTimeS
-00015020: 6563 7320 2b3d 2076 6964 656f 5361 6d70  ecs += videoSamp
-00015030: 6c65 5365 636f 6e64 730a 2020 2020 2020  leSeconds.      
-00015040: 2020 2020 2020 2020 2020 6966 2073 616d            if sam
-00015050: 706c 6554 696d 6553 6563 7320 3e20 7275  pleTimeSecs > ru
-00015060: 6e54 696d 653a 0a20 2020 2020 2020 2020  nTime:.         
-00015070: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-00015080: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00015090: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-000150a0: 6d61 6765 5f64 7473 5b66 696c 655f 6e61  mage_dts[file_na
-000150b0: 6d65 5d20 3d20 706f 735f 6c69 7374 0a20  me] = pos_list. 
-000150c0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-000150d0: 7228 290a 2020 2020 2020 2020 7265 7475  r().        retu
-000150e0: 726e 4d73 6720 3d20 2222 0a20 2020 2020  rnMsg = "".     
-000150f0: 2020 2069 6620 6c65 6e28 756e 6d61 7463     if len(unmatc
-00015100: 6865 6454 696d 6550 6f69 6e74 7329 2021  hedTimePoints) !
-00015110: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00015120: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
-00015130: 696e 7473 2e73 6f72 7428 290a 2020 2020  ints.sort().    
-00015140: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
-00015150: 6454 696d 6550 6f69 6e74 7320 3d20 5b64  dTimePoints = [d
-00015160: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00015170: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
-00015180: 7028 7473 292e 7374 7266 7469 6d65 286d  p(ts).strftime(m
-00015190: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-000151a0: 735b 276d 6172 6971 7427 5d29 2066 6f72  s['mariqt']) for
-000151b0: 2074 7320 696e 2075 6e6d 6174 6368 6564   ts in unmatched
-000151c0: 5469 6d65 506f 696e 7473 5d0a 2020 2020  TimePoints].    
-000151d0: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-000151e0: 6720 3d20 2243 4155 5449 4f4e 2120 4e61  g = "CAUTION! Na
-000151f0: 7669 6761 7469 6f6e 206e 6f74 2066 6f75  vigation not fou
-00015200: 6e64 2066 6f72 2074 6865 2066 6f6c 6c6f  nd for the follo
-00015210: 7769 6e67 2069 6d61 6765 2074 696d 6520  wing image time 
-00015220: 706f 696e 7473 2e20 446f 7562 6c65 2063  points. Double c
-00015230: 6865 636b 206f 7220 7072 6f76 6964 6520  heck or provide 
-00015240: 6174 206c 6561 7374 2073 7461 7469 6320  at least static 
-00015250: 6465 6661 756c 7420 6e61 7669 6761 7469  default navigati
-00015260: 6f6e 2069 6e20 6865 6164 6572 2066 6965  on in header fie
-00015270: 6c64 732e 220a 2020 2020 2020 2020 2020  lds.".          
-00015280: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
-00015290: 5c6e 2220 2b20 225c 6e22 2e6a 6f69 6e28  \n" + "\n".join(
-000152a0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-000152b0: 6e74 7329 0a20 2020 2020 2020 2072 6574  nts).        ret
-000152c0: 7572 6e20 5472 7565 2c20 696d 6167 655f  urn True, image_
-000152d0: 6474 732c 2072 6574 7572 6e4d 7367 0a0a  dts, returnMsg..
-000152e0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-000152f0: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
-00015300: 5f66 696c 6528 7365 6c66 2c20 6e61 765f  _file(self, nav_
-00015310: 7061 7468 3a20 7374 722c 206e 6176 5f68  path: str, nav_h
-00015320: 6561 6465 723d 6d69 7174 762e 706f 735f  eader=miqtv.pos_
-00015330: 6865 6164 6572 5b27 7061 6e67 6165 6127  header['pangaea'
-00015340: 5d2c 2064 6174 655f 666f 726d 6174 3d6d  ], date_format=m
-00015350: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00015360: 735b 2770 616e 6761 6561 275d 2c20 6f76  s['pangaea'], ov
-00015370: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
-00015380: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
-00015390: 5c74 222c 2076 6964 656f 5361 6d70 6c65  \t", videoSample
-000153a0: 5365 636f 6e64 733d 312c 0a20 2020 2020  Seconds=1,.     
-000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153c0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000153d0: 6666 7365 745f 783d 302c 206f 6666 7365  ffset_x=0, offse
-000153e0: 745f 793d 302c 206f 6666 7365 745f 7a3d  t_y=0, offset_z=
-000153f0: 302c 616e 676c 6573 5f69 6e5f 7261 6420  0,angles_in_rad 
-00015400: 3d20 4661 6c73 652c 2072 6563 6f72 6473  = False, records
-00015410: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
-00015420: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
-00015430: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
-00015440: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
-00015450: 6520 7769 7468 2034 2e35 4420 6e61 7669  e with 4.5D navi
-00015460: 6761 7469 6f6e 2064 6174 6120 666f 7220  gation data for 
-00015470: 6561 6368 2069 6d61 6765 2c20 692e 652e  each image, i.e.
-00015480: 2061 2073 696e 676c 6520 726f 7720 7065   a single row pe
-00015490: 7220 7068 6f74 6f2c 2076 6964 656f 2064  r photo, video d
-000154a0: 7572 6174 696f 6e20 5b73 6563 5d20 2f20  uration [sec] / 
-000154b0: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-000154c0: 6473 2072 6f77 7320 7065 7220 7669 6465  ds rows per vide
-000154d0: 6f2e 0a20 2020 2020 2020 2020 2020 206e  o..            n
-000154e0: 6176 5f68 6561 6465 7220 6d75 7374 2062  av_header must b
-000154f0: 6520 6469 6374 2063 6f6e 7461 696e 696e  e dict containin
-00015500: 6720 7468 6520 6b65 7973 2027 7574 6327  g the keys 'utc'
-00015510: 2c27 6c61 7427 2c27 6c6f 6e27 2c27 6465  ,'lat','lon','de
-00015520: 7027 286f 7220 2761 6c74 2729 2c20 6f70  p'(or 'alt'), op
-00015530: 7469 6f6e 616c 3a20 2768 6774 272c 2775  tional: 'hgt','u
-00015540: 6e63 6572 7427 2077 6974 6820 7468 6520  ncert' with the 
-00015550: 7265 7370 6563 7469 7665 2063 6f6c 756d  respective colum
-00015560: 6e20 6865 6164 6572 7320 6173 2076 616c  n headers as val
-00015570: 7565 7320 0a20 2020 2020 2020 2020 2020  ues .           
-00015580: 2069 6620 6f6e 6520 6f66 2074 6865 2076   if one of the v
-00015590: 6568 6963 6c65 2078 2c79 2c7a 206f 6666  ehicle x,y,z off
-000155a0: 7365 7473 205b 6d5d 2069 7320 6e6f 7420  sets [m] is not 
-000155b0: 3020 616e 6420 6e61 765f 6865 6164 6572  0 and nav_header
-000155c0: 2061 6c73 6f20 636f 6e74 6169 6e73 2027   also contains '
-000155d0: 7961 7727 2c27 7069 7463 6827 2c27 726f  yaw','pitch','ro
-000155e0: 6c6c 2720 6c65 7665 7261 726d 206f 6666  ll' leverarm off
-000155f0: 7365 7473 2061 7265 2063 6f6d 7065 6e73  sets are compens
-00015600: 6174 6564 2066 6f72 2022 2222 0a0a 2020  ated for """..  
-00015610: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
-00015620: 7465 726d 6564 6961 7465 4e61 7646 696c  termediateNavFil
-00015630: 6545 7869 7374 7328 2920 616e 6420 6e6f  eExists() and no
-00015640: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
-00015650: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00015660: 5472 7565 2c20 224f 7574 7075 7420 6669  True, "Output fi
-00015670: 6c65 2065 7869 7374 733a 2022 2b73 656c  le exists: "+sel
-00015680: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
-00015690: 6c65 2829 0a0a 2020 2020 2020 2020 6966  le()..        if
-000156a0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-000156b0: 7374 7328 6e61 765f 7061 7468 293a 0a20  sts(nav_path):. 
-000156c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000156d0: 6e20 4661 6c73 652c 2022 4e61 7669 6761  n False, "Naviga
-000156e0: 7469 6f6e 2066 696c 6520 6e6f 7420 666f  tion file not fo
-000156f0: 756e 643a 2022 2b6e 6176 5f70 6174 680a  und: "+nav_path.
-00015700: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00015710: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00015720: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
-00015730: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015740: 726e 2046 616c 7365 2c20 2249 6d61 6765  rn False, "Image
-00015750: 2066 6f6c 6465 7220 6e6f 7420 666f 756e   folder not foun
-00015760: 643a 2022 2b20 7365 6c66 2e69 6d61 6765  d: "+ self.image
-00015770: 7344 6972 0a0a 2020 2020 2020 2020 7320  sDir..        s 
-00015780: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-00015790: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
-000157a0: 6720 6974 656d 7327 206e 6176 6967 6174  g items' navigat
-000157b0: 696f 6e20 6461 7461 2229 0a20 2020 2020  ion data").     
-000157c0: 2020 2072 6574 7572 6e4d 7367 203d 2022     returnMsg = "
-000157d0: 220a 2020 2020 2020 2020 636f 6d70 656e  ".        compen
-000157e0: 7361 744f 6666 7365 7473 203d 2046 616c  satOffsets = Fal
-000157f0: 7365 0a20 2020 2020 2020 2069 6620 286f  se.        if (o
-00015800: 6666 7365 745f 7821 3d30 206f 7220 6f66  ffset_x!=0 or of
-00015810: 6673 6574 5f79 213d 3020 6f72 206f 6666  fset_y!=0 or off
-00015820: 7365 745f 7a21 3d30 2920 616e 6420 2779  set_z!=0) and 'y
-00015830: 6177 2720 696e 206e 6176 5f68 6561 6465  aw' in nav_heade
-00015840: 7220 616e 6420 2770 6974 6368 2720 696e  r and 'pitch' in
-00015850: 206e 6176 5f68 6561 6465 7220 616e 6420   nav_header and 
-00015860: 2772 6f6c 6c27 2069 6e20 6e61 765f 6865  'roll' in nav_he
-00015870: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00015880: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
-00015890: 7473 203d 2054 7275 650a 0a20 2020 2020  ts = True..     
-000158a0: 2020 2023 2063 6865 636b 2069 6620 666f     # check if fo
-000158b0: 7220 6d69 7373 696e 6720 6669 656c 6473  r missing fields
-000158c0: 2074 6865 7265 2061 7265 2063 6f6e 7374   there are const
-000158d0: 2076 616c 7565 7320 696e 2068 6561 6465   values in heade
-000158e0: 720a 2020 2020 2020 2020 636f 6e73 745f  r.        const_
-000158f0: 7661 6c75 6573 203d 207b 7d0a 2020 2020  values = {}.    
-00015900: 2020 2020 666f 7220 6e61 7646 6965 6c64      for navField
-00015910: 2069 6e20 6d69 7174 762e 706f 735f 6865   in miqtv.pos_he
-00015920: 6164 6572 5b27 6d61 7269 7174 275d 3a0a  ader['mariqt']:.
-00015930: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-00015940: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
-00015950: 6420 3d20 6d69 7174 762e 636f 6c5f 6865  d = miqtv.col_he
-00015960: 6164 6572 5b22 6d61 7269 7174 225d 5b6e  ader["mariqt"][n
-00015970: 6176 4669 656c 645d 0a20 2020 2020 2020  avField].       
-00015980: 2020 2020 2069 6620 6e61 7646 6965 6c64       if navField
-00015990: 206e 6f74 2069 6e20 6e61 765f 6865 6164   not in nav_head
-000159a0: 6572 2061 6e64 2028 7265 7370 6563 7469  er and (respecti
-000159b0: 7665 4865 6164 6572 4669 656c 6420 696e  veHeaderField in
-000159c0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-000159d0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-000159e0: 6572 4b65 795d 2061 6e64 2073 656c 662e  erKey] and self.
-000159f0: 6669 6e64 546d 7046 6965 6c64 3228 7265  findTmpField2(re
-00015a00: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
-00015a10: 656c 6429 2021 3d20 2222 293a 200a 2020  eld) != ""): .  
-00015a20: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00015a30: 6e73 745f 7661 6c75 6573 5b6e 6176 4669  nst_values[navFi
-00015a40: 656c 645d 203d 2073 656c 662e 6669 6e64  eld] = self.find
-00015a50: 546d 7046 6965 6c64 2872 6573 7065 6374  TmpField(respect
-00015a60: 6976 6548 6561 6465 7246 6965 6c64 290a  iveHeaderField).
-00015a70: 0a20 2020 2020 2020 2023 204c 6f61 6420  .        # Load 
-00015a80: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
-00015a90: 2020 2020 2020 2020 6e61 765f 6461 7461          nav_data
-00015aa0: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
-00015ab0: 746e 2e72 6561 6441 6c6c 506f 7369 7469  tn.readAllPositi
-00015ac0: 6f6e 7346 726f 6d46 696c 6550 6174 6828  onsFromFilePath(
-00015ad0: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
-00015ae0: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
-00015af0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
-00015b00: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
-00015b10: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
-00015b20: 5f76 616c 7565 7329 0a20 2020 2020 2020  _values).       
-00015b30: 2069 6620 7061 7273 654d 7367 2021 3d20   if parseMsg != 
-00015b40: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00015b50: 7365 6c66 2e70 726f 762e 6c6f 6728 7061  self.prov.log(pa
-00015b60: 7273 654d 7367 2c64 6f6e 7453 686f 773d  rseMsg,dontShow=
-00015b70: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00015b80: 2020 7265 7475 726e 4d73 6720 3d20 225c    returnMsg = "\
-00015b90: 6e22 202b 2070 6172 7365 4d73 670a 0a20  n" + parseMsg.. 
-00015ba0: 2020 2020 2020 2023 2066 696e 6420 666f         # find fo
-00015bb0: 7220 6561 6368 2069 6d61 6765 2074 6865  r each image the
-00015bc0: 2072 6573 7065 6374 6976 6520 6e61 7669   respective navi
-00015bd0: 6761 7469 6f6e 2064 6174 610a 2020 2020  gation data.    
-00015be0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00015bf0: 2020 2020 2073 7563 6365 7373 2c20 696d       success, im
-00015c00: 6167 655f 6474 732c 206d 7367 203d 2073  age_dts, msg = s
-00015c10: 656c 662e 6669 6e64 4e61 7644 6174 6146  elf.findNavDataF
-00015c20: 6f72 496d 6167 6528 6e61 765f 6461 7461  orImage(nav_data
-00015c30: 2c76 6964 656f 5361 6d70 6c65 5365 636f  ,videoSampleSeco
-00015c40: 6e64 7329 0a20 2020 2020 2020 2073 656c  nds).        sel
-00015c50: 662e 7072 6f76 2e6c 6f67 286d 7367 2c64  f.prov.log(msg,d
-00015c60: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
-00015c70: 2020 2020 2020 6966 206d 7367 2021 3d20        if msg != 
-00015c80: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00015c90: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
-00015ca0: 2220 2b20 6d73 670a 2020 2020 2020 2020  " + msg.        
-00015cb0: 6966 206e 6f74 2073 7563 6365 7373 3a0a  if not success:.
-00015cc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015cd0: 726e 2046 616c 7365 2c20 7265 7475 726e  rn False, return
-00015ce0: 4d73 670a 2020 2020 2020 2020 7320 3d20  Msg.        s = 
-00015cf0: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
-00015d00: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
-00015d10: 6974 656d 7327 206e 6176 6967 6174 696f  items' navigatio
-00015d20: 6e20 6461 7461 2229 0a0a 2020 2020 2020  n data")..      
-00015d30: 2020 2320 636f 6d70 656e 7361 7465 206c    # compensate l
-00015d40: 6576 6572 6172 6d20 6f66 6673 6574 730a  everarm offsets.
-00015d50: 2020 2020 2020 2020 6966 2063 6f6d 7065          if compe
-00015d60: 6e73 6174 4f66 6673 6574 733a 0a0a 2020  nsatOffsets:..  
-00015d70: 2020 2020 2020 2020 2020 2320 6c6f 6164            # load
-00015d80: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
-00015d90: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
-00015da0: 2020 2020 2020 2020 2020 2061 7474 5f64             att_d
-00015db0: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
-00015dc0: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
-00015dd0: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
-00015de0: 7468 286e 6176 5f70 6174 682c 206e 6176  th(nav_path, nav
-00015df0: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
-00015e00: 726d 6174 2c63 6f6c 5f73 6570 6172 6174  rmat,col_separat
-00015e10: 6f72 3d63 6f6c 5f73 6570 6172 6174 6f72  or=col_separator
-00015e20: 2c63 6f6e 7374 5f76 616c 7565 733d 636f  ,const_values=co
-00015e30: 6e73 745f 7661 6c75 6573 2c61 6e67 6c65  nst_values,angle
-00015e40: 7349 6e52 6164 3d61 6e67 6c65 735f 696e  sInRad=angles_in
-00015e50: 5f72 6164 290a 2020 2020 2020 2020 2020  _rad).          
-00015e60: 2020 6966 2070 6172 7365 4d73 6720 213d    if parseMsg !=
-00015e70: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00015e80: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00015e90: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
-00015ea0: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-00015eb0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00015ec0: 6e4d 7367 202b 3d20 225c 6e22 202b 2070  nMsg += "\n" + p
-00015ed0: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
-00015ee0: 2020 2020 2023 2066 696e 6420 666f 7220       # find for 
-00015ef0: 6561 6368 2069 6d61 6765 2074 6865 2072  each image the r
-00015f00: 6573 7065 6374 6976 6520 6e61 7669 6761  espective naviga
-00015f10: 7469 6f6e 2064 6174 610a 2020 2020 2020  tion data.      
-00015f20: 2020 2020 2020 7375 6363 6573 732c 2069        success, i
-00015f30: 6d61 6765 5f64 7473 5f61 7474 2c20 6d73  mage_dts_att, ms
-00015f40: 6720 3d20 7365 6c66 2e66 696e 644e 6176  g = self.findNav
-00015f50: 4461 7461 466f 7249 6d61 6765 2861 7474  DataForImage(att
-00015f60: 5f64 6174 612c 7669 6465 6f53 616d 706c  _data,videoSampl
-00015f70: 6553 6563 6f6e 6473 290a 2020 2020 2020  eSeconds).      
-00015f80: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00015f90: 6c6f 6728 6d73 672c 646f 6e74 5368 6f77  log(msg,dontShow
-00015fa0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-00015fb0: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
-00015fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015fd0: 2072 6574 7572 6e4d 7367 202b 3d20 225c   returnMsg += "\
-00015fe0: 6e22 202b 206d 7367 0a20 2020 2020 2020  n" + msg.       
-00015ff0: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
-00016000: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
-00016010: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00016020: 652c 2072 6574 7572 6e4d 7367 0a0a 2020  e, returnMsg..  
-00016030: 2020 2020 2020 2020 2020 2320 636f 6d70            # comp
-00016040: 656e 7361 7465 0a20 2020 2020 2020 2020  ensate.         
-00016050: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
-00016060: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
-00016070: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-00016080: 6f6e 7320 3d20 696d 6167 655f 6474 735b  ons = image_dts[
-00016090: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
-000160a0: 2020 2020 2020 6174 7469 7475 6465 7320        attitudes 
-000160b0: 3d20 696d 6167 655f 6474 735f 6174 745b  = image_dts_att[
-000160c0: 6669 6c65 5d0a 2020 2020 2020 2020 2020  file].          
-000160d0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000160e0: 616e 6765 286c 656e 2870 6f73 6974 696f  ange(len(positio
-000160f0: 6e73 2929 3a0a 2020 2020 2020 2020 2020  ns)):.          
-00016100: 2020 2020 2020 2020 2020 6c61 7420 3d20            lat = 
-00016110: 706f 7369 7469 6f6e 735b 695d 2e6c 6174  positions[i].lat
-00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016130: 2020 2020 206c 6f6e 203d 2070 6f73 6974       lon = posit
-00016140: 696f 6e73 5b69 5d2e 6c6f 6e0a 2020 2020  ions[i].lon.    
-00016150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016160: 6465 7020 3d20 706f 7369 7469 6f6e 735b  dep = positions[
-00016170: 695d 2e64 6570 0a20 2020 2020 2020 2020  i].dep.         
-00016180: 2020 2020 2020 2020 2020 2069 6620 2761             if 'a
-00016190: 6c74 2720 696e 206e 6176 5f68 6561 6465  lt' in nav_heade
-000161a0: 7220 616e 6420 6e6f 7420 2764 6570 2720  r and not 'dep' 
-000161b0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
-000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161d0: 2020 2020 2020 2064 6570 202a 3d20 2d31         dep *= -1
-000161e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000161f0: 2020 2020 2079 6177 203d 2061 7474 6974       yaw = attit
-00016200: 7564 6573 5b69 5d2e 7961 770a 2020 2020  udes[i].yaw.    
-00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016220: 7069 7463 6820 3d20 6174 7469 7475 6465  pitch = attitude
-00016230: 735b 695d 2e70 6974 6368 0a20 2020 2020  s[i].pitch.     
-00016240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016250: 6f6c 6c20 3d20 6174 7469 7475 6465 735b  oll = attitudes[
-00016260: 695d 2e72 6f6c 6c0a 2020 2020 2020 2020  i].roll.        
-00016270: 2020 2020 2020 2020 2020 2020 6966 2079              if y
-00016280: 6177 2069 7320 4e6f 6e65 206f 7220 7069  aw is None or pi
-00016290: 7463 6820 6973 204e 6f6e 6520 6f72 2072  tch is None or r
-000162a0: 6f6c 6c20 6973 204e 6f6e 653a 0a20 2020  oll is None:.   
-000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-000162d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162e0: 2020 6e65 775f 6c61 742c 6e65 775f 6c6f    new_lat,new_lo
-000162f0: 6e2c 6e65 775f 6465 7020 3d20 6d69 7174  n,new_dep = miqt
-00016300: 672e 6164 644c 6576 6572 6172 6d73 324c  g.addLeverarms2L
-00016310: 6174 6c6f 6e28 6c61 742c 6c6f 6e2c 6465  atlon(lat,lon,de
-00016320: 702c 6f66 6673 6574 5f78 2c6f 6666 7365  p,offset_x,offse
-00016330: 745f 792c 6f66 6673 6574 5f7a 2c79 6177  t_y,offset_z,yaw
-00016340: 2c70 6974 6368 2c72 6f6c 6c29 0a20 2020  ,pitch,roll).   
-00016350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016360: 2070 6f73 6974 696f 6e73 5b69 5d2e 6c61   positions[i].la
-00016370: 7420 3d20 6e65 775f 6c61 740a 2020 2020  t = new_lat.    
-00016380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016390: 706f 7369 7469 6f6e 735b 695d 2e6c 6f6e  positions[i].lon
-000163a0: 203d 206e 6577 5f6c 6f6e 0a20 2020 2020   = new_lon.     
-000163b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000163c0: 6f73 6974 696f 6e73 5b69 5d2e 6465 7020  ositions[i].dep 
-000163d0: 3d20 6e65 775f 6465 700a 0a20 2020 2020  = new_dep..     
-000163e0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-000163f0: 2e6c 6f67 2822 6170 706c 6965 6420 6c65  .log("applied le
-00016400: 7665 7220 6172 6d20 636f 6d70 656e 7361  ver arm compensa
-00016410: 7469 6f6e 2078 2c79 2c7a 203d 2022 202b  tion x,y,z = " +
-00016420: 2073 7472 286f 6666 7365 745f 7829 202b   str(offset_x) +
-00016430: 2022 2c22 202b 2073 7472 286f 6666 7365   "," + str(offse
-00016440: 745f 7929 202b 2022 2c22 202b 2073 7472  t_y) + "," + str
-00016450: 286f 6666 7365 745f 7a29 2c64 6f6e 7453  (offset_z),dontS
-00016460: 686f 773d 5472 7565 290a 0a20 2020 2020  how=True)..     
-00016470: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
-00016480: 6474 7329 203e 2030 3a0a 2020 2020 2020  dts) > 0:.      
-00016490: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-000164a0: 6574 6865 7220 6465 7074 6820 616e 6420  ether depth and 
-000164b0: 6865 6967 6874 2061 7265 2073 6574 0a20  height are set. 
-000164c0: 2020 2020 2020 2020 2020 206c 6174 5f69             lat_i
-000164d0: 6465 6e74 6963 616c 2c20 6c6f 6e5f 6964  dentical, lon_id
-000164e0: 656e 7469 6361 6c2c 2064 6570 5f69 6465  entical, dep_ide
-000164f0: 6e74 6963 616c 2c20 6867 745f 6964 656e  ntical, hgt_iden
-00016500: 7469 6361 6c2c 2064 6570 5f6e 6f74 5f7a  tical, dep_not_z
-00016510: 6572 6f2c 2068 6774 5f6e 6f74 5f7a 6572  ero, hgt_not_zer
-00016520: 6f2c 756e 6365 7274 5f6e 6f74 5f7a 6572  o,uncert_not_zer
-00016530: 6f20 3d20 6e61 765f 6461 7461 2e63 6865  o = nav_data.che
-00016540: 636b 506f 7369 7469 6f6e 7343 6f6e 7465  ckPositionsConte
-00016550: 6e74 2829 0a0a 2020 2020 2020 2020 2020  nt()..          
-00016560: 2020 2320 5772 6974 6520 746f 206e 6176    # Write to nav
-00016570: 6967 6174 696f 6e20 7478 7420 6669 6c65  igation txt file
-00016580: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
-00016590: 6561 6465 720a 2020 2020 2020 2020 2020  eader.          
-000165a0: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
-000165b0: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
-000165c0: 6c65 2829 2c20 2277 2229 0a20 2020 2020  le(), "w").     
-000165d0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000165e0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-000165f0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00016600: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
-00016610: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00016620: 275d 5b27 7574 6327 5d29 0a0a 2020 2020  ']['utc'])..    
-00016630: 2020 2020 2020 2020 6861 735f 616c 7420          has_alt 
-00016640: 3d20 5472 7565 2069 6620 6465 705f 6e6f  = True if dep_no
-00016650: 745f 7a65 726f 2061 6e64 2028 2027 6465  t_zero and ( 'de
-00016660: 7027 2069 6e20 6e61 765f 6865 6164 6572  p' in nav_header
-00016670: 206f 7220 2761 6c74 2720 696e 206e 6176   or 'alt' in nav
-00016680: 5f68 6561 6465 7220 2920 656c 7365 2046  _header ) else F
-00016690: 616c 7365 0a0a 2020 2020 2020 2020 2020  alse..          
-000166a0: 2020 6966 2027 6c61 7427 2069 6e20 6e61    if 'lat' in na
-000166b0: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-000166c0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-000166d0: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-000166e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000166f0: 7427 5d5b 276c 6174 275d 290a 2020 2020  t']['lat']).    
-00016700: 2020 2020 2020 2020 6966 2027 6c6f 6e27          if 'lon'
-00016710: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016730: 7265 732e 7772 6974 6528 225c 7422 2b6d  res.write("\t"+m
-00016740: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00016750: 276d 6172 6971 7427 5d5b 276c 6f6e 275d  'mariqt']['lon']
-00016760: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00016770: 2068 6173 5f61 6c74 3a0a 2020 2020 2020   has_alt:.      
-00016780: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00016790: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-000167a0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000167b0: 7427 5d5b 2761 6c74 275d 290a 2020 2020  t']['alt']).    
-000167c0: 2020 2020 2020 2020 6966 2068 6774 5f6e          if hgt_n
-000167d0: 6f74 5f7a 6572 6f20 616e 6420 2768 6774  ot_zero and 'hgt
-000167e0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-000167f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016800: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-00016810: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00016820: 5b27 6d61 7269 7174 275d 5b27 6867 7427  ['mariqt']['hgt'
-00016830: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-00016840: 6620 756e 6365 7274 5f6e 6f74 5f7a 6572  f uncert_not_zer
-00016850: 6f20 616e 6420 2775 6e63 6572 7427 2069  o and 'uncert' i
-00016860: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00016870: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016880: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
-00016890: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-000168a0: 6172 6971 7427 5d5b 2775 6e63 6572 7427  ariqt']['uncert'
-000168b0: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
-000168c0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
-000168d0: 2020 2020 2020 2020 2020 2023 2064 6174             # dat
-000168e0: 6120 6c69 6e65 730a 2020 2020 2020 2020  a lines.        
-000168f0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00016900: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00016910: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
-00016920: 696d 6570 6f69 6e74 2069 6e20 696d 6167  imepoint in imag
-00016930: 655f 6474 735b 6669 6c65 5d3a 0a20 2020  e_dts[file]:.   
-00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016950: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
-00016960: 225c 7422 2b74 696d 6570 6f69 6e74 2e64  "\t"+timepoint.d
-00016970: 6174 6554 696d 6528 292e 7374 7266 7469  ateTime().strfti
-00016980: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
-00016990: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-000169a0: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
-000169b0: 2020 2020 2020 2069 6620 276c 6174 2720         if 'lat' 
-000169c0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
-000169d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169e0: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
-000169f0: 6570 6f69 6e74 2e6c 6174 0a20 2020 2020  epoint.lat.     
-00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a10: 2020 2069 6620 276c 6174 2720 696e 2072     if 'lat' in r
-00016a20: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
-00016a30: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00016a40: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00016a50: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
-00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a70: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
-00016a80: 7374 7228 7661 6c29 290a 2020 2020 2020  str(val)).      
-00016a90: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00016aa0: 2027 6c6f 6e27 2069 6e20 6e61 765f 6865   'lon' in nav_he
-00016ab0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00016ad0: 6c20 3d20 7469 6d65 706f 696e 742e 6c6f  l = timepoint.lo
-00016ae0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00016af0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
-00016b00: 6e27 2069 6e20 7265 636f 7264 7332 6265  n' in records2be
-00016b10: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
-00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b50: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00016b60: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
-00016b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b80: 2020 2020 2069 6620 6861 735f 616c 743a       if has_alt:
-00016b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ba0: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
-00016bb0: 696d 6570 6f69 6e74 2e64 6570 0a20 2020  imepoint.dep.   
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bd0: 2020 2020 2069 6620 2764 6570 2720 696e       if 'dep' in
-00016be0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
-00016bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c00: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
-00016c10: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00016c20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016c30: 6620 2764 6570 2720 696e 2072 6563 6f72  f 'dep' in recor
-00016c40: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
-00016c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00016c70: 616c 202a 3d20 2d31 0a20 2020 2020 2020  al *= -1.       
-00016c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c90: 2065 6c69 6620 2027 616c 7427 2069 6e20   elif  'alt' in 
-00016ca0: 6e61 765f 6865 6164 6572 2061 6e64 2027  nav_header and '
-00016cb0: 616c 7427 2069 6e20 7265 636f 7264 7332  alt' in records2
-00016cc0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-00016cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ce0: 2020 2020 2020 2020 7661 6c20 2a3d 202d          val *= -
-00016cf0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00016d00: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00016d10: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
-00016d20: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00016d30: 2020 2020 2020 2069 6620 6867 745f 6e6f         if hgt_no
-00016d40: 745f 7a65 726f 2061 6e64 2027 6867 7427  t_zero and 'hgt'
-00016d50: 2069 6e20 6e61 765f 6865 6164 6572 3a0a   in nav_header:.
-00016d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d70: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
-00016d80: 6d65 706f 696e 742e 6867 740a 2020 2020  mepoint.hgt.    
-00016d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016da0: 2020 2020 6966 2027 6867 7427 2069 6e20      if 'hgt' in 
-00016db0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00016dc0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00016dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016de0: 7661 6c20 2a3d 202d 310a 2020 2020 2020  val *= -1.      
-00016df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e00: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00016e10: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
-00016e20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016e30: 6620 756e 6365 7274 5f6e 6f74 5f7a 6572  f uncert_not_zer
-00016e40: 6f20 616e 6420 2775 6e63 6572 7427 2069  o and 'uncert' i
-00016e50: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
-00016e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e70: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-00016e80: 706f 696e 742e 756e 6365 7274 0a20 2020  point.uncert.   
-00016e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ea0: 2020 2020 2069 6620 2775 6e63 6572 7427       if 'uncert'
-00016eb0: 2069 6e20 7265 636f 7264 7332 6265 496e   in records2beIn
-00016ec0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+00010b10: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+00010b20: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00010b30: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+00010b40: 6579 5d5b 6974 656d 5d2c 6c69 7374 293a  ey][item],list):
+00010b50: 2023 2069 6e20 6361 7365 206f 6620 7669   # in case of vi
+00010b60: 6465 6f20 7769 7468 2069 7465 6d20 6173  deo with item as
+00010b70: 206c 6973 7420 7468 6520 6669 7273 7420   list the first 
+00010b80: 656e 7472 7920 686f 6c64 7320 7468 6520  entry holds the 
+00010b90: 6465 6661 756c 7420 616e 6420 7468 6520  default and the 
+00010ba0: 6861 7368 2063 616e 6e6f 7420 7661 7279  hash cannot vary
+00010bb0: 2066 6f72 2074 6865 2073 616d 6520 696d   for the same im
+00010bc0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
+00010bd0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00010be0: 456e 7472 7920 3d20 7365 6c66 2e69 6664  Entry = self.ifd
+00010bf0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00010c00: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
+00010c10: 6d5d 5b30 5d20 0a20 2020 2020 2020 2020  m][0] .         
+00010c20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00010c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010c40: 2020 2020 2020 2020 2069 7465 6d45 6e74           itemEnt
+00010c50: 7279 203d 2073 656c 662e 6966 646f 5f74  ry = self.ifdo_t
+00010c60: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00010c70: 4974 656d 734b 6579 5d5b 6974 656d 5d0a  ItemsKey][item].
+00010c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010c90: 2020 2020 2069 6d61 6765 4d6f 6454 696d       imageModTim
+00010ca0: 6520 3d20 6f73 2e70 6174 682e 6765 746d  e = os.path.getm
+00010cb0: 7469 6d65 2869 6d61 6765 290a 2020 2020  time(image).    
+00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cd0: 6966 206e 6f74 2068 6172 6420 616e 6420  if not hard and 
+00010ce0: 696d 6167 654d 6f64 5469 6d65 203c 2068  imageModTime < h
+00010cf0: 6173 6846 696c 654d 6f64 5469 6d65 3a0a  ashFileModTime:.
+00010d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d10: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+00010d20: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00010d30: 696d 6167 6529 2069 6e20 6861 7368 6573  image) in hashes
+00010d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010d50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010d60: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+00010d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d90: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00010da0: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
+00010db0: 2022 6e6f 7420 666f 756e 6420 696e 2069   "not found in i
+00010dc0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
+00010dd0: 2066 696c 6522 2c73 656c 662e 6765 745f   file",self.get_
+00010de0: 696e 745f 6861 7368 5f66 696c 6528 292c  int_hash_file(),
+00010df0: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
+00010e00: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
+00010e10: 2066 6972 7374 2229 200a 2020 2020 2020   first") .      
+00010e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00010e60: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
+00010e70: 285b 6669 6c65 4e61 6d65 2c22 6e6f 7420  ([fileName,"not 
+00010e80: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
+00010e90: 6964 6174 6520 6861 7368 2066 696c 6520  idate hash file 
+00010ea0: 2220 2b20 7374 7228 7365 6c66 2e67 6574  " + str(self.get
+00010eb0: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
+00010ec0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+00010ed0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00010ee0: 6f74 2069 7465 6d45 6e74 7279 5b27 696d  ot itemEntry['im
+00010ef0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
+00010f00: 5d20 3d3d 2068 6173 6865 735b 6f73 2e70  ] == hashes[os.p
+00010f10: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
+00010f20: 6765 295d 5b27 696d 6167 652d 6861 7368  ge)]['image-hash
+00010f30: 2d73 6861 3235 3627 5d3a 0a20 2020 2020  -sha256']:.     
+00010f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f50: 2020 2020 2020 2069 6620 7261 6973 6545         if raiseE
+00010f60: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+00010f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f80: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010f90: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00010fa0: 696f 6e28 6974 656d 2c20 2269 6e63 6f72  ion(item, "incor
+00010fb0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+00010fc0: 222c 2069 7465 6d45 6e74 7279 5b27 696d  ", itemEntry['im
+00010fd0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
+00010fe0: 5d2c 2266 6f72 2066 696c 6522 2c66 696c  ],"for file",fil
+00010ff0: 654e 616d 652c 2220 7275 6e20 6372 6561  eName," run crea
+00011000: 7465 5f69 6d61 6765 5f73 6861 3235 365f  te_image_sha256_
+00011010: 6669 6c65 2829 2066 6972 7374 2229 0a20  file() first"). 
+00011020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011030: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011060: 2065 7863 6570 7469 6f6e 4c69 7374 2e61   exceptionList.a
+00011070: 7070 656e 6428 5b66 696c 654e 616d 652c  ppend([fileName,
+00011080: 2269 6e63 6f72 7265 6374 2073 6861 3235  "incorrect sha25
+00011090: 3620 6861 7368 225d 290a 2020 2020 2020  6 hash"]).      
+000110a0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000110b0: 6966 206e 6f74 2069 7465 6d45 6e74 7279  if not itemEntry
+000110c0: 5b27 696d 6167 652d 6861 7368 2d73 6861  ['image-hash-sha
+000110d0: 3235 3627 5d20 3d3d 206d 6971 7463 2e73  256'] == miqtc.s
+000110e0: 6861 3235 3648 6173 6846 696c 6528 696d  ha256HashFile(im
+000110f0: 6167 6529 3a0a 2020 2020 2020 2020 2020  age):.          
+00011100: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011110: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+00011120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011130: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00011140: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00011150: 6570 7469 6f6e 2869 7465 6d2c 2022 696e  eption(item, "in
+00011160: 636f 7272 6563 7420 7368 6132 3536 2068  correct sha256 h
+00011170: 6173 6822 2c20 6974 656d 456e 7472 795b  ash", itemEntry[
+00011180: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
+00011190: 3536 275d 2c22 666f 7220 6669 6c65 222c  56'],"for file",
+000111a0: 6669 6c65 4e61 6d65 2c22 2072 756e 2063  fileName," run c
+000111b0: 7265 6174 655f 696d 6167 655f 7368 6132  reate_image_sha2
+000111c0: 3536 5f66 696c 6528 2920 6669 7273 7422  56_file() first"
+000111d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000111e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000111f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011200: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00011210: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
+00011220: 285b 6669 6c65 4e61 6d65 2c22 696e 636f  ([fileName,"inco
+00011230: 7272 6563 7420 7368 6132 3536 2068 6173  rrect sha256 has
+00011240: 6822 5d29 0a20 2020 2020 2020 2020 2020  h"]).           
+00011250: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+00011260: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
+00011270: 756e 643a 0a20 2020 2020 2020 2020 2020  und:.           
+00011280: 2020 2020 2064 656c 2068 6173 6855 6e63       del hashUnc
+00011290: 6865 636b 496d 6167 6573 496e 5261 775b  heckImagesInRaw[
+000112a0: 696d 6167 655d 0a20 2020 2020 2020 2020  image].         
+000112b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000112c0: 2020 2020 2020 2020 2069 6620 7261 6973           if rais
+000112d0: 6545 7863 6570 7469 6f6e 3a0a 2020 2020  eException:.    
+000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112f0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00011300: 4578 6365 7074 696f 6e28 2022 696d 6167  Exception( "imag
+00011310: 6522 2c20 6974 656d 2c20 226e 6f74 2066  e", item, "not f
+00011320: 6f75 6e64 2069 6e20 6469 7265 6374 6f72  ound in director
+00011330: 7927 7320 7261 7720 666f 6c64 6572 2122  y's raw folder!"
+00011340: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011350: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011360: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00011370: 7074 696f 6e4c 6973 742e 6170 7065 6e64  ptionList.append
+00011380: 285b 6669 6c65 4e61 6d65 2c22 6669 6c65  ([fileName,"file
+00011390: 206e 6f74 2066 6f75 6e64 225d 290a 2020   not found"]).  
+000113a0: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+000113b0: 2829 0a20 2020 2020 2020 2069 6620 6e6f  ().        if no
+000113c0: 7420 7261 6973 6545 7863 6570 7469 6f6e  t raiseException
+000113d0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000113e0: 7475 726e 2065 7863 6570 7469 6f6e 4c69  turn exceptionLi
+000113f0: 7374 0a0a 0a20 2020 2064 6566 2063 7265  st...    def cre
+00011400: 6174 655f 7575 6964 5f66 696c 6528 7365  ate_uuid_file(se
+00011410: 6c66 2c63 6c65 616e 3d54 7275 6529 3a0a  lf,clean=True):.
+00011420: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
+00011430: 7465 7320 696e 202f 696e 7465 726d 6564  tes in /intermed
+00011440: 6961 7465 2061 2074 6578 7420 6669 6c65  iate a text file
+00011450: 2063 6f6e 7461 696e 696e 6720 7065 7220   containing per 
+00011460: 696d 6167 6520 6120 6372 6561 7465 6420  image a created 
+00011470: 7575 6964 2028 7665 7273 696f 6e20 3429  uuid (version 4)
+00011480: 2e0a 0a20 2020 2020 2020 2054 6865 2055  ...        The U
+00011490: 5549 4420 6973 206f 6e6c 7920 2a74 616b  UID is only *tak
+000114a0: 656e 2a20 6672 6f6d 2074 6865 206d 6574  en* from the met
+000114b0: 6164 6174 6120 6f66 2074 6865 2069 6d61  adata of the ima
+000114c0: 6765 732e 2049 7420 646f 6573 206e 6f74  ges. It does not
+000114d0: 2077 7269 7465 2055 5549 4473 2074 6f20   write UUIDs to 
+000114e0: 7468 6520 6d65 7461 6461 7461 2069 6e20  the metadata in 
+000114f0: 6361 7365 2073 6f6d 6520 6669 6c65 7320  case some files 
+00011500: 6172 6520 6d69 7373 696e 6720 6974 2e0a  are missing it..
+00011510: 2020 2020 2020 2020 4275 742c 2069 7420          But, it 
+00011520: 6372 6561 7465 7320 6120 4353 5620 6669  creates a CSV fi
+00011530: 6c65 2069 6e20 7468 6174 2063 6173 6520  le in that case 
+00011540: 7468 6174 2079 6f75 2063 616e 2075 7365  that you can use
+00011550: 2074 6f67 6574 6865 7220 7769 7468 2065   together with e
+00011560: 7869 6674 6f6f 6c20 746f 2061 6464 2074  xiftool to add t
+00011570: 6865 2055 5549 4420 746f 2079 6f75 7220  he UUID to your 
+00011580: 6461 7461 2e20 4265 7761 7265 2120 7468  data. Beware! th
+00011590: 6973 2063 616e 2064 6573 7472 6f79 2079  is can destroy y
+000115a0: 6f75 7220 696d 6167 6573 0a20 2020 2020  our images.     
+000115b0: 2020 2069 6620 6e6f 7420 646f 6e65 2070     if not done p
+000115c0: 726f 7065 726c 7921 204e 6f20 6775 6172  roperly! No guar
+000115d0: 616e 7465 6520 6973 2067 6976 656e 2069  antee is given i
+000115e0: 7420 7769 6c6c 2077 6f72 6b2e 2042 6520  t will work. Be 
+000115f0: 6361 7265 6675 6c21 0a0a 2020 2020 2020  careful!..      
+00011600: 2020 5573 6520 636c 6561 6e3d 4661 6c73    Use clean=Fals
+00011610: 6520 746f 206e 6f74 2063 6865 636b 2074  e to not check t
+00011620: 686f 7365 2066 696c 6573 2061 6761 696e  hose files again
+00011630: 2077 6869 6368 2061 7265 2061 6c72 6561   which are alrea
+00011640: 6479 2066 6f75 6e64 2069 6e20 696e 7465  dy found in inte
+00011650: 726d 6564 6961 7465 2075 7569 6420 6669  rmediate uuid fi
+00011660: 6c65 0a20 2020 2020 2020 2022 2222 0a0a  le.        """..
+00011670: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
+00011680: 7b7d 0a20 2020 2020 2020 2023 2043 6865  {}.        # Che
+00011690: 636b 2077 6865 7468 6572 2061 2066 696c  ck whether a fil
+000116a0: 6520 7769 7468 2055 5549 4473 2065 7869  e with UUIDs exi
+000116b0: 7374 732c 2074 6865 6e20 7265 6164 2069  sts, then read i
+000116c0: 740a 2020 2020 2020 2020 6966 206e 6f74  t.        if not
+000116d0: 2063 6c65 616e 2061 6e64 206f 732e 7061   clean and os.pa
+000116e0: 7468 2e65 7869 7374 7328 7365 6c66 2e67  th.exists(self.g
+000116f0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
+00011700: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00011710: 2075 7569 6473 203d 206d 6971 7466 2e74   uuids = miqtf.t
+00011720: 6162 4669 6c65 4461 7461 2873 656c 662e  abFileData(self.
+00011730: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
+00011740: 6528 292c 205b 6d69 7174 762e 636f 6c5f  e(), [miqtv.col_
+00011750: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00011760: 5b27 696d 6727 5d2c 206d 6971 7476 2e63  ['img'], miqtv.c
+00011770: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00011780: 7427 5d5b 2775 7569 6427 5d5d 2c20 6b65  t']['uuid']], ke
+00011790: 795f 636f 6c3d 6d69 7174 762e 636f 6c5f  y_col=miqtv.col_
+000117a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000117b0: 5b27 696d 6727 5d29 0a20 2020 2020 2020  ['img']).       
+000117c0: 2020 2020 200a 2020 2020 2020 2020 6966       .        if
+000117d0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000117e0: 7365 6c66 2e69 6d61 6765 7344 6972 293a  self.imagesDir):
+000117f0: 0a0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
+00011800: 7373 696e 675f 7575 6964 7320 3d20 7b7d  ssing_uuids = {}
+00011810: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
+00011820: 6564 5f75 7569 6473 203d 2030 0a0a 2020  ed_uuids = 0..  
+00011830: 2020 2020 2020 2020 2020 756e 6b6e 6f77            unknow
+00011840: 6e46 696c 6573 203d 205b 5d0a 2020 2020  nFiles = [].    
+00011850: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00011860: 2069 6e20 7365 6c66 2e69 6d61 6765 7349   in self.imagesI
+00011870: 6e49 6d61 6765 7344 6972 2829 3a0a 2020  nImagesDir():.  
+00011880: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00011890: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
+000118a0: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
+000118b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000118c0: 2069 6620 6669 6c65 5f6e 616d 6520 6e6f   if file_name no
+000118d0: 7420 696e 2075 7569 6473 3a0a 2020 2020  t in uuids:.    
+000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118f0: 756e 6b6e 6f77 6e46 696c 6573 2e61 7070  unknownFiles.app
+00011900: 656e 6428 6669 6c65 290a 2020 2020 2020  end(file).      
+00011910: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00011920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011930: 2020 2020 7575 6964 735b 6669 6c65 5f6e      uuids[file_n
+00011940: 616d 655d 203d 2075 7569 6473 5b66 696c  ame] = uuids[fil
+00011950: 655f 6e61 6d65 5d5b 6d69 7174 762e 636f  e_name][miqtv.co
+00011960: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00011970: 275d 5b27 7575 6964 275d 5d0a 0a20 2020  ']['uuid']]..   
+00011980: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
+00011990: 4669 6c65 7355 5549 4473 203d 206d 6971  FilesUUIDs = miq
+000119a0: 7469 2e69 6d61 6765 7343 6f6e 7461 696e  ti.imagesContain
+000119b0: 5661 6c69 6455 5549 4428 756e 6b6e 6f77  ValidUUID(unknow
+000119c0: 6e46 696c 6573 290a 2020 2020 2020 2020  nFiles).        
+000119d0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+000119e0: 756e 6b6e 6f77 6e46 696c 6573 5555 4944  unknownFilesUUID
+000119f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00011a00: 2020 2066 696c 655f 6e61 6d65 203d 206f     file_name = o
+00011a10: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00011a20: 6669 6c65 290a 2020 2020 2020 2020 2020  file).          
+00011a30: 2020 2020 2020 6966 206e 6f74 2075 6e6b        if not unk
+00011a40: 6e6f 776e 4669 6c65 7355 5549 4473 5b66  nownFilesUUIDs[f
+00011a50: 696c 655d 5b27 7661 6c69 6427 5d3a 0a20  ile]['valid']:. 
+00011a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a70: 2020 2075 7569 6420 3d20 6d69 7174 632e     uuid = miqtc.
+00011a80: 7575 6964 3428 290a 2020 2020 2020 2020  uuid4().        
+00011a90: 2020 2020 2020 2020 2020 2020 6d69 7373              miss
+00011aa0: 696e 675f 7575 6964 735b 6669 6c65 5d20  ing_uuids[file] 
+00011ab0: 3d20 7575 6964 0a20 2020 2020 2020 2020  = uuid.         
+00011ac0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ae0: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
+00011af0: 5d20 3d20 756e 6b6e 6f77 6e46 696c 6573  ] = unknownFiles
+00011b00: 5555 4944 735b 6669 6c65 5d5b 2775 7569  UUIDs[file]['uui
+00011b10: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
+00011b20: 2020 2020 2020 2020 6164 6465 645f 7575          added_uu
+00011b30: 6964 7320 2b3d 2031 0a0a 2020 2020 2020  ids += 1..      
+00011b40: 2020 2020 2020 2320 4966 2070 7265 7669        # If previ
+00011b50: 6f75 736c 7920 756e 6b6e 6f77 6e20 5555  ously unknown UU
+00011b60: 4944 7320 7765 7265 2066 6f75 6e64 2069  IDs were found i
+00011b70: 6e20 7468 6520 6669 6c65 2068 6561 6465  n the file heade
+00011b80: 7273 2c20 6164 6420 7468 656d 2074 6f20  rs, add them to 
+00011b90: 7468 6520 5555 4944 2066 696c 650a 2020  the UUID file.  
+00011ba0: 2020 2020 2020 2020 2020 6966 2061 6464            if add
+00011bb0: 6564 5f75 7569 6473 203e 2030 3a0a 2020  ed_uuids > 0:.  
+00011bc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00011bd0: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
+00011be0: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+00011bf0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
+00011c00: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00011c10: 6528 6d69 7174 762e 636f 6c5f 6865 6164  e(miqtv.col_head
+00011c20: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00011c30: 6727 5d20 2b22 5c74 222b 6d69 7174 762e  g'] +"\t"+miqtv.
+00011c40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00011c50: 7174 275d 5b27 7575 6964 275d 2b22 5c6e  qt']['uuid']+"\n
+00011c60: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00011c70: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
+00011c80: 7569 6473 3a0a 2020 2020 2020 2020 2020  uids:.          
+00011c90: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00011ca0: 6974 6528 6669 6c65 2b22 5c74 222b 7374  ite(file+"\t"+st
+00011cb0: 7228 7575 6964 735b 6669 6c65 5d29 2b22  r(uuids[file])+"
+00011cc0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00011cd0: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
+00011ce0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00011cf0: 206c 656e 286d 6973 7369 6e67 5f75 7569   len(missing_uui
+00011d00: 6473 2920 3e20 303a 0a20 2020 2020 2020  ds) > 0:.       
+00011d10: 2020 2020 2020 2020 2065 6373 765f 7061           ecsv_pa
+00011d20: 7468 203d 2073 656c 662e 5f5f 6765 745f  th = self.__get_
+00011d30: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+00011d40: 2920 2b20 225f 6578 6966 2d61 6464 2d75  ) + "_exif-add-u
+00011d50: 7569 642e 6373 7622 0a20 2020 2020 2020  uid.csv".       
+00011d60: 2020 2020 2020 2020 2063 7376 203d 206f           csv = o
+00011d70: 7065 6e28 6563 7376 5f70 6174 682c 2022  pen(ecsv_path, "
+00011d80: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+00011d90: 2020 2020 6373 762e 7772 6974 6528 6d69      csv.write(mi
+00011da0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011db0: 6578 6966 275d 5b27 696d 6727 5d20 2b0a  exif']['img'] +.
+00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011dd0: 2020 2020 2020 2020 2020 222c 222b 6d69            ","+mi
+00011de0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011df0: 6578 6966 275d 5b27 7575 6964 275d 2b22  exif']['uuid']+"
+00011e00: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00011e10: 2020 2020 2064 6966 6665 7265 6e74 5f70       different_p
+00011e20: 6174 6873 203d 205b 5d0a 2020 2020 2020  aths = [].      
+00011e30: 2020 2020 2020 2020 2020 666f 7220 696d            for im
+00011e40: 6720 696e 206d 6973 7369 6e67 5f75 7569  g in missing_uui
+00011e50: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
+00011e60: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+00011e70: 7468 2e62 6173 656e 616d 6528 696d 6729  th.basename(img)
+00011e80: 206e 6f74 2069 6e20 6469 6666 6572 656e   not in differen
+00011e90: 745f 7061 7468 733a 0a20 2020 2020 2020  t_paths:.       
+00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011eb0: 2064 6966 6665 7265 6e74 5f70 6174 6873   different_paths
+00011ec0: 2e61 7070 656e 6428 6f73 2e70 6174 682e  .append(os.path.
+00011ed0: 6261 7365 6e61 6d65 2869 6d67 2929 0a20  basename(img)). 
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ef0: 2020 2063 7376 2e77 7269 7465 2869 6d67     csv.write(img
+00011f00: 2b22 2c22 2b73 7472 286d 6973 7369 6e67  +","+str(missing
+00011f10: 5f75 7569 6473 5b69 6d67 5d29 2b22 5c6e  _uuids[img])+"\n
+00011f20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00011f30: 2020 2023 7265 7475 726e 2046 616c 7365     #return False
+00011f40: 2c20 2265 7869 6674 6f6f 6c20 2d63 7376  , "exiftool -csv
+00011f50: 3d22 2b65 6373 765f 7061 7468 2b22 2022  ="+ecsv_path+" "
+00011f60: 2b22 2022 2e6a 6f69 6e28 6469 6666 6572  +" ".join(differ
+00011f70: 656e 745f 7061 7468 7329 0a20 2020 2020  ent_paths).     
+00011f80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011f90: 6e20 4661 6c73 652c 2022 4e6f 7420 616c  n False, "Not al
+00011fa0: 6c20 696d 6167 6573 2068 6176 6520 7661  l images have va
+00011fb0: 6c69 6420 5555 4944 732e 204d 6973 7369  lid UUIDs. Missi
+00011fc0: 6e67 2066 6f72 2066 6f6c 6c6f 7769 6e67  ng for following
+00011fd0: 2066 696c 6573 3a5c 6e22 2b22 5cc5 8622   files:\n"+"\.."
+00011fe0: 2e6a 6f69 6e28 6469 6666 6572 656e 745f  .join(different_
+00011ff0: 7061 7468 7329 0a20 2020 2020 2020 2020  paths).         
+00012000: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00012010: 7365 6c66 2e5f 5f61 6c6c 5555 4944 7343  self.__allUUIDsC
+00012020: 6865 636b 6564 203d 2054 7275 650a 2020  hecked = True.  
+00012030: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00012040: 2054 7275 652c 2022 416c 6c20 696d 6167   True, "All imag
+00012050: 6573 2068 6176 6520 6120 5555 4944 220a  es have a UUID".
+00012060: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00012070: 616c 7365 2c20 2250 6174 6820 222b 7365  alse, "Path "+se
+00012080: 6c66 2e69 6d61 6765 7344 6972 202b 2022  lf.imagesDir + "
+00012090: 206e 6f74 2066 6f75 6e64 2e22 0a0a 2020   not found."..  
+000120a0: 2020 6465 6620 6372 6561 7465 5555 4944    def createUUID
+000120b0: 4669 6c65 2873 656c 662c 636c 6561 6e3d  File(self,clean=
+000120c0: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+000120d0: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+000120e0: 7573 6520 6372 6561 7465 5f75 7569 645f  use create_uuid_
+000120f0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
+00012100: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
+00012110: 6174 655f 7575 6964 5f66 696c 6528 636c  ate_uuid_file(cl
+00012120: 6561 6e29 0a0a 0a20 2020 2064 6566 2073  ean)...    def s
+00012130: 6574 5f69 6d61 6765 5f73 6574 5f61 7474  et_image_set_att
+00012140: 6974 7564 6528 7365 6c66 2c79 6177 5f66  itude(self,yaw_f
+00012150: 7261 6d65 3a66 6c6f 6174 2c70 6974 6368  rame:float,pitch
+00012160: 5f66 7261 6d65 3a66 6c6f 6174 2c72 6f6c  _frame:float,rol
+00012170: 6c5f 6672 616d 653a 666c 6f61 742c 7961  l_frame:float,ya
+00012180: 775f 6361 6d32 6672 616d 653a 666c 6f61  w_cam2frame:floa
+00012190: 742c 7069 7463 685f 6361 6d32 6672 616d  t,pitch_cam2fram
+000121a0: 653a 666c 6f61 742c 726f 6c6c 5f63 616d  e:float,roll_cam
+000121b0: 3266 7261 6d65 3a66 6c6f 6174 293a 0a20  2frame:float):. 
+000121c0: 2020 2020 2020 2022 2222 2063 616c 6375         """ calcu
+000121d0: 6c61 7465 7320 7468 6520 7468 6520 6361  lates the the ca
+000121e0: 6d65 7261 7320 6162 736f 6c75 7465 2061  meras absolute a
+000121f0: 7474 6974 7564 6520 616e 6420 7365 7473  ttitude and sets
+00012200: 2069 7420 746f 2069 6d61 6765 2073 6574   it to image set
+00012210: 2068 6561 6465 722e 2041 6c6c 2061 6e67   header. All ang
+00012220: 6c65 7320 6172 6520 6578 7065 6374 6564  les are expected
+00012230: 2069 6e20 6465 6772 6565 732e 200a 2020   in degrees. .  
+00012240: 2020 2020 2020 6361 6d65 7261 3266 7261        camera2fra
+00012250: 6d65 2061 6e67 6c65 733a 2072 6f74 6174  me angles: rotat
+00012260: 696f 6e20 6f66 2063 616d 6572 6120 636f  ion of camera co
+00012270: 6f72 6469 6e61 7465 7320 2878 2c79 2c7a  ordinates (x,y,z
+00012280: 203d 2074 6f70 2c20 7269 6768 742c 206c   = top, right, l
+00012290: 696e 6520 6f66 2073 6967 6874 2920 7769  ine of sight) wi
+000122a0: 7468 2072 6573 7065 6374 2074 6f20 7665  th respect to ve
+000122b0: 6869 636c 6520 636f 6f72 6469 6e61 7465  hicle coordinate
+000122c0: 7320 2878 2c79 2c7a 203d 2066 6f72 7761  s (x,y,z = forwa
+000122d0: 7264 2c72 6967 6874 2c64 6f77 6e29 200a  rd,right,down) .
+000122e0: 2020 2020 2020 2020 696e 2061 6363 6f72          in accor
+000122f0: 6461 6e63 6520 7769 7468 2074 6865 2079  dance with the y
+00012300: 6177 2c70 6974 6368 2c72 6f6c 6c20 726f  aw,pitch,roll ro
+00012310: 7461 7469 6f6e 206f 7264 6572 2063 6f6e  tation order con
+00012320: 7665 6e74 696f 6e3a 0a0a 2020 2020 2020  vention:..      
+00012330: 2020 312e 2079 6177 2061 726f 756e 6420    1. yaw around 
+00012340: 7a2c 0a20 2020 2020 2020 2032 2e20 7069  z,.        2. pi
+00012350: 7463 6820 6172 6f75 6e64 2072 6f74 6174  tch around rotat
+00012360: 6564 2079 2c0a 2020 2020 2020 2020 332e  ed y,.        3.
+00012370: 2072 6f6c 6c20 6172 6f75 6e64 2072 6f74   roll around rot
+00012380: 6174 6564 2078 0a0a 2020 2020 2020 2020  ated x..        
+00012390: 526f 7461 7469 6f6e 2064 6972 6563 7469  Rotation directi
+000123a0: 6f6e 7320 6163 636f 7264 696e 6720 746f  ons according to
+000123b0: 205c 2772 6967 6874 2d68 616e 6420 7275   \'right-hand ru
+000123c0: 6c65 5c27 2e0a 0a20 2020 2020 2020 2049  le\'...        I
+000123d0: 2e65 2e20 6361 6d65 7261 3246 7261 6d65  .e. camera2Frame
+000123e0: 2061 6e67 6c65 7320 3d20 302c 302c 3020   angles = 0,0,0 
+000123f0: 6361 6d65 7261 2069 7320 6661 6369 6e67  camera is facing
+00012400: 2064 6f77 6e77 6172 6420 7769 7468 2074   downward with t
+00012410: 6f70 2073 6964 6520 746f 7761 7264 7320  op side towards 
+00012420: 7665 6869 636c 6527 7320 666f 7277 6172  vehicle's forwar
+00012430: 6420 6469 7265 6374 696f 6e27 2022 2222  d direction' """
+00012440: 0a0a 2020 2020 2020 2020 525f 6672 616d  ..        R_fram
+00012450: 6532 6e65 6420 3d20 6d69 7174 672e 525f  e2ned = miqtg.R_
+00012460: 5961 7750 6974 6368 526f 6c6c 2879 6177  YawPitchRoll(yaw
+00012470: 5f66 7261 6d65 2c70 6974 6368 5f66 7261  _frame,pitch_fra
+00012480: 6d65 2c72 6f6c 6c5f 6672 616d 6529 0a20  me,roll_frame). 
+00012490: 2020 2020 2020 2052 5f63 616d 3266 7261         R_cam2fra
+000124a0: 6d65 203d 206d 6971 7467 2e52 5f59 6177  me = miqtg.R_Yaw
+000124b0: 5069 7463 6852 6f6c 6c28 7961 775f 6361  PitchRoll(yaw_ca
+000124c0: 6d32 6672 616d 652c 7069 7463 685f 6361  m2frame,pitch_ca
+000124d0: 6d32 6672 616d 652c 726f 6c6c 5f63 616d  m2frame,roll_cam
+000124e0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
+000124f0: 525f 6361 6d32 6e65 6420 3d20 525f 6672  R_cam2ned = R_fr
+00012500: 616d 6532 6e65 642e 646f 7428 525f 6361  ame2ned.dot(R_ca
+00012510: 6d32 6672 616d 6529 0a20 2020 2020 2020  m2frame).       
+00012520: 2079 6177 2c70 6974 6368 2c72 6f6c 6c20   yaw,pitch,roll 
+00012530: 3d20 6d69 7174 672e 7961 7750 6974 6368  = miqtg.yawPitch
+00012540: 526f 6c6c 2852 5f63 616d 326e 6564 290a  Roll(R_cam2ned).
+00012550: 0a20 2020 2020 2020 2023 2070 6f73 6520  .        # pose 
+00012560: 6d61 7472 6978 2063 616d 3275 746d 0a20  matrix cam2utm. 
+00012570: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
+00012580: 7574 6d20 3d20 7365 6c66 2e67 6574 5f52  utm = self.get_R
+00012590: 5f63 616d 5374 6432 7574 6d28 525f 6361  _camStd2utm(R_ca
+000125a0: 6d32 6672 616d 652c 525f 6672 616d 6532  m2frame,R_frame2
+000125b0: 6e65 6429 0a0a 2020 2020 2020 2020 2222  ned)..        ""
+000125c0: 220a 2020 2020 2020 2020 7820 3d20 6e70  ".        x = np
+000125d0: 2e61 7272 6179 285b 312c 302c 305d 290a  .array([1,0,0]).
+000125e0: 2020 2020 2020 2020 7920 3d20 6e70 2e61          y = np.a
+000125f0: 7272 6179 285b 302c 312c 305d 290a 2020  rray([0,1,0]).  
+00012600: 2020 2020 2020 7a20 3d20 6e70 2e61 7272        z = np.arr
+00012610: 6179 285b 302c 302c 315d 290a 2020 2020  ay([0,0,1]).    
+00012620: 2020 2020 7072 696e 7428 2778 272c 525f      print('x',R_
+00012630: 6361 6d53 7464 3275 746d 2e64 6f74 2878  camStd2utm.dot(x
+00012640: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
+00012650: 2020 2020 7072 696e 7428 2779 272c 525f      print('y',R_
+00012660: 6361 6d53 7464 3275 746d 2e64 6f74 2879  camStd2utm.dot(y
+00012670: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
+00012680: 2020 2020 7072 696e 7428 277a 272c 525f      print('z',R_
+00012690: 6361 6d53 7464 3275 746d 2e64 6f74 287a  camStd2utm.dot(z
+000126a0: 292e 726f 756e 6428 3529 290a 2020 2020  ).round(5)).    
+000126b0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+000126c0: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
+000126d0: 7b0a 2020 2020 2020 2020 2020 2020 6d69  {.            mi
+000126e0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+000126f0: 6d61 7269 7174 275d 5b27 7961 7727 5d3a  mariqt']['yaw']:
+00012700: 7961 772c 0a20 2020 2020 2020 2020 2020  yaw,.           
+00012710: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00012720: 725b 276d 6172 6971 7427 5d5b 2770 6974  r['mariqt']['pit
+00012730: 6368 275d 3a70 6974 6368 2c0a 2020 2020  ch']:pitch,.    
+00012740: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+00012750: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00012760: 275d 5b27 726f 6c6c 275d 3a72 6f6c 6c2c  ']['roll']:roll,
+00012770: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
+00012780: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00012790: 6172 6971 7427 5d5b 2770 6f73 6527 5d3a  ariqt']['pose']:
+000127a0: 7b27 706f 7365 2d61 6273 6f6c 7574 652d  {'pose-absolute-
+000127b0: 6f72 6965 6e74 6174 696f 6e2d 7574 6d2d  orientation-utm-
+000127c0: 6d61 7472 6978 273a 525f 6361 6d53 7464  matrix':R_camStd
+000127d0: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
+000127e0: 6f6c 6973 7428 297d 0a20 2020 2020 2020  olist()}.       
+000127f0: 207d 0a20 2020 2020 2020 2073 656c 662e   }.        self.
+00012800: 7570 6461 7465 5f69 6664 6f5f 6865 6164  update_ifdo_head
+00012810: 6572 5f66 6965 6c64 7328 6865 6164 6572  er_fields(header
+00012820: 5570 6461 7465 290a 0a20 2020 2064 6566  Update)..    def
+00012830: 2073 6574 496d 6167 6553 6574 4174 7469   setImageSetAtti
+00012840: 7475 6465 2873 656c 662c 7961 775f 6672  tude(self,yaw_fr
+00012850: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
+00012860: 6672 616d 653a 666c 6f61 742c 726f 6c6c  frame:float,roll
+00012870: 5f66 7261 6d65 3a66 6c6f 6174 2c79 6177  _frame:float,yaw
+00012880: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
+00012890: 2c70 6974 6368 5f63 616d 3266 7261 6d65  ,pitch_cam2frame
+000128a0: 3a66 6c6f 6174 2c72 6f6c 6c5f 6361 6d32  :float,roll_cam2
+000128b0: 6672 616d 653a 666c 6f61 7429 3a0a 2020  frame:float):.  
+000128c0: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
+000128d0: 6174 6564 202d 2075 7365 2073 6574 5f69  ated - use set_i
+000128e0: 6d61 6765 5f73 6574 5f61 7474 6974 7564  mage_set_attitud
+000128f0: 6520 2222 220a 2020 2020 2020 2020 7365  e """.        se
+00012900: 6c66 2e73 6574 5f69 6d61 6765 5f73 6574  lf.set_image_set
+00012910: 5f61 7474 6974 7564 6528 7961 775f 6672  _attitude(yaw_fr
+00012920: 616d 652c 2070 6974 6368 5f66 7261 6d65  ame, pitch_frame
+00012930: 2c20 726f 6c6c 5f66 7261 6d65 2c20 7961  , roll_frame, ya
+00012940: 775f 6361 6d32 6672 616d 652c 2070 6974  w_cam2frame, pit
+00012950: 6368 5f63 616d 3266 7261 6d65 2c20 726f  ch_cam2frame, ro
+00012960: 6c6c 5f63 616d 3266 7261 6d65 290a 0a0a  ll_cam2frame)...
+00012970: 2020 2020 6465 6620 6372 6561 7465 5f69      def create_i
+00012980: 6d61 6765 5f61 7474 6974 7564 655f 6669  mage_attitude_fi
+00012990: 6c65 2873 656c 662c 2061 7474 5f70 6174  le(self, att_pat
+000129a0: 683a 7374 722c 2066 7261 6d65 5f61 7474  h:str, frame_att
+000129b0: 5f68 6561 6465 723a 6469 6374 2c20 6361  _header:dict, ca
+000129c0: 6d65 7261 3246 7261 6d65 5f79 6177 3a66  mera2Frame_yaw:f
+000129d0: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
+000129e0: 655f 7069 7463 683a 666c 6f61 742c 6361  e_pitch:float,ca
+000129f0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c3a  mera2Frame_roll:
+00012a00: 666c 6f61 742c 0a20 2020 2020 2020 2020  float,.         
+00012a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a20: 2020 2020 2020 2064 6174 655f 666f 726d         date_form
+00012a30: 6174 3d6d 6971 7476 2e64 6174 655f 666f  at=miqtv.date_fo
+00012a40: 726d 6174 735b 2770 616e 6761 6561 275d  rmats['pangaea']
+00012a50: 2c20 636f 6e73 745f 7661 6c75 6573 203d  , const_values =
+00012a60: 207b 7d2c 206f 7665 7277 7269 7465 3d46   {}, overwrite=F
+00012a70: 616c 7365 2c20 636f 6c5f 7365 7061 7261  alse, col_separa
+00012a80: 746f 7220 3d20 225c 7422 2c0a 2020 2020  tor = "\t",.    
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 2020 2020 2020 2020 2020 6174 745f              att_
+00012ab0: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
+00012ac0: 6164 203d 2046 616c 7365 2c20 7669 6465  ad = False, vide
+00012ad0: 6f53 616d 706c 6553 6563 6f6e 6473 3d31  oSampleSeconds=1
+00012ae0: 2c72 6563 6f72 6473 3262 6549 6e76 6572  ,records2beInver
+00012af0: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
+00012b00: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
+00012b10: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
+00012b20: 7465 7874 2066 696c 6520 7769 7468 2063  text file with c
+00012b30: 616d 6572 6120 6174 7469 7475 6465 2064  amera attitude d
+00012b40: 6174 6120 666f 7220 6561 6368 2069 6d61  ata for each ima
+00012b50: 6765 2e20 416c 6c20 616e 676c 6573 2061  ge. All angles a
+00012b60: 7265 2065 7870 6563 7465 6420 696e 2064  re expected in d
+00012b70: 6567 7265 6573 2e20 5573 6520 6174 745f  egrees. Use att_
+00012b80: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
+00012b90: 6164 2069 6620 6e65 6365 7373 6172 792e  ad if necessary.
+00012ba0: 200a 2020 2020 2020 2020 6361 6d65 7261   .        camera
+00012bb0: 3246 7261 6d65 2061 6e67 6c65 733a 2072  2Frame angles: r
+00012bc0: 6f74 6174 696f 6e20 6f66 2063 616d 6572  otation of camer
+00012bd0: 6120 636f 6f72 6469 6e61 7465 7320 2878  a coordinates (x
+00012be0: 2c79 2c7a 203d 2074 6f70 2c20 7269 6768  ,y,z = top, righ
+00012bf0: 742c 206c 696e 6520 6f66 2073 6967 6874  t, line of sight
+00012c00: 2920 7769 7468 2072 6573 7065 6374 2074  ) with respect t
+00012c10: 6f20 7665 6869 636c 6520 636f 6f72 6469  o vehicle coordi
+00012c20: 6e61 7465 7320 2878 2c79 2c7a 203d 2066  nates (x,y,z = f
+00012c30: 6f72 7761 7264 2c72 6967 6874 2c64 6f77  orward,right,dow
+00012c40: 6e29 200a 2020 2020 2020 2020 696e 2061  n) .        in a
+00012c50: 6363 6f72 6461 6e63 6520 7769 7468 2074  ccordance with t
+00012c60: 6865 2079 6177 2c70 6974 6368 2c72 6f6c  he yaw,pitch,rol
+00012c70: 6c20 726f 7461 7469 6f6e 206f 7264 6572  l rotation order
+00012c80: 2063 6f6e 7665 6e74 696f 6e3a 0a20 2020   convention:.   
+00012c90: 2020 2020 2031 2e20 7961 7720 6172 6f75       1. yaw arou
+00012ca0: 6e64 207a 2c0a 2020 2020 2020 2020 322e  nd z,.        2.
+00012cb0: 2070 6974 6368 2061 726f 756e 6420 726f   pitch around ro
+00012cc0: 7461 7465 6420 792c 0a20 2020 2020 2020  tated y,.       
+00012cd0: 2033 2e20 726f 6c6c 2061 726f 756e 6420   3. roll around 
+00012ce0: 726f 7461 7465 6420 780a 0a20 2020 2020  rotated x..     
+00012cf0: 2020 2052 6f74 6174 696f 6e20 6469 7265     Rotation dire
+00012d00: 6374 696f 6e73 2061 6363 6f72 6469 6e67  ctions according
+00012d10: 2074 6f20 5c27 7269 6768 742d 6861 6e64   to \'right-hand
+00012d20: 2072 756c 655c 272e 0a0a 2020 2020 2020   rule\'...      
+00012d30: 2020 492e 652e 2063 616d 6572 6132 4672    I.e. camera2Fr
+00012d40: 616d 6520 616e 676c 6573 203d 2030 2c30  ame angles = 0,0
+00012d50: 2c30 2063 616d 6572 6120 6973 2066 6163  ,0 camera is fac
+00012d60: 696e 6720 646f 776e 7761 7264 2077 6974  ing downward wit
+00012d70: 6820 746f 7020 7369 6465 2074 6f77 6172  h top side towar
+00012d80: 6473 2076 6568 6963 6c65 2773 2066 6f72  ds vehicle's for
+00012d90: 7761 7264 2064 6972 6563 7469 6f6e 2720  ward direction' 
+00012da0: 2222 220a 0a20 2020 2020 2020 2069 6e74  """..        int
+00012db0: 5f61 7474 7574 7564 655f 6669 6c65 203d  _attutude_file =
+00012dc0: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
+00012dd0: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
+00012de0: 275f 696d 6167 652d 6174 7469 7475 6465  '_image-attitude
+00012df0: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
+00012e00: 7470 7574 5f68 6561 6465 725f 6174 7420  tput_header_att 
+00012e10: 3d20 7b20 2020 6d69 7174 762e 636f 6c5f  = {   miqtv.col_
+00012e20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00012e30: 5b27 696d 6727 5d3a 2020 6d69 7174 762e  ['img']:  miqtv.
+00012e40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00012e50: 7174 275d 5b27 696d 6727 5d2c 0a20 2020  qt']['img'],.   
+00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e70: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+00012e80: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00012e90: 6172 6971 7427 5d5b 2775 7463 275d 3a6d  ariqt']['utc']:m
+00012ea0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00012eb0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
+00012ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ee0: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00012ef0: 6572 5b27 6d61 7269 7174 275d 5b27 7961  er['mariqt']['ya
+00012f00: 7727 5d3a 6d69 7174 762e 636f 6c5f 6865  w']:miqtv.col_he
+00012f10: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00012f20: 7961 7727 5d2c 0a20 2020 2020 2020 2020  yaw'],.         
+00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f40: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00012f50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00012f60: 5d5b 2770 6974 6368 275d 3a6d 6971 7476  ]['pitch']:miqtv
+00012f70: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00012f80: 6971 7427 5d5b 2770 6974 6368 275d 2c0a  iqt']['pitch'],.
+00012f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012fc0: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
+00012fd0: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
+00012fe0: 6465 725b 276d 6172 6971 7427 5d5b 2772  der['mariqt']['r
+00012ff0: 6f6c 6c27 5d2c 0a20 2020 2020 2020 2020  oll'],.         
+00013000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013010: 2020 207d 0a0a 2020 2020 2020 2020 696e     }..        in
+00013020: 745f 706f 7365 5f66 696c 6520 3d20 7365  t_pose_file = se
+00013030: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
+00013040: 655f 7072 6566 6978 2829 202b 2027 5f69  e_prefix() + '_i
+00013050: 6d61 6765 2d63 616d 6572 612d 706f 7365  mage-camera-pose
+00013060: 2e74 7874 270a 2020 2020 2020 2020 6f75  .txt'.        ou
+00013070: 7470 7574 5f68 6561 6465 725f 706f 7365  tput_header_pose
+00013080: 203d 207b 2020 6d69 7174 762e 636f 6c5f   = {  miqtv.col_
+00013090: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000130a0: 5b27 696d 6727 5d3a 6d69 7174 762e 636f  ['img']:miqtv.co
+000130b0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000130c0: 275d 5b27 696d 6727 5d2c 0a20 2020 2020  ']['img'],.     
+000130d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130e0: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
+000130f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00013100: 6971 7427 5d5b 2775 7463 275d 3a6d 6971  iqt']['utc']:miq
+00013110: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013120: 6172 6971 7427 5d5b 2775 7463 275d 2c0a  ariqt']['utc'],.
+00013130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013150: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013160: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
+00013170: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
+00013180: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
+00013190: 6f73 6527 5d2c 0a20 2020 2020 2020 2020  ose'],.         
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131b0: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
+000131c0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
+000131d0: 696e 745f 6174 7475 7475 6465 5f66 696c  int_attutude_fil
+000131e0: 6529 2061 6e64 206e 6f74 206f 7665 7277  e) and not overw
+000131f0: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
+00013200: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
+00013210: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
+00013220: 745f 6174 7475 7475 6465 5f66 696c 652c  t_attutude_file,
+00013230: 225c 7422 2c6f 7574 7075 745f 6865 6164  "\t",output_head
+00013240: 6572 5f61 7474 290a 2020 2020 2020 2020  er_att).        
+00013250: 2020 2020 6578 7472 615f 6d73 6720 3d20      extra_msg = 
+00013260: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
+00013270: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00013280: 2869 6e74 5f70 6f73 655f 6669 6c65 293a  (int_pose_file):
+00013290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000132a0: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
+000132b0: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
+000132c0: 5f70 6f73 655f 6669 6c65 2c22 5c74 222c  _pose_file,"\t",
+000132d0: 6f75 7470 7574 5f68 6561 6465 725f 706f  output_header_po
+000132e0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+000132f0: 2020 2020 6578 7472 615f 6d73 6720 3d20      extra_msg = 
+00013300: 222c 2022 202b 2069 6e74 5f70 6f73 655f  ", " + int_pose_
+00013310: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00013320: 2072 6574 7572 6e20 5472 7565 2c20 224f   return True, "O
+00013330: 7574 7075 7420 6669 6c65 2065 7869 7374  utput file exist
+00013340: 733a 2022 2b69 6e74 5f61 7474 7574 7564  s: "+int_attutud
+00013350: 655f 6669 6c65 202b 2065 7874 7261 5f6d  e_file + extra_m
+00013360: 7367 0a0a 2020 2020 2020 2020 6966 206e  sg..        if n
+00013370: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+00013380: 7328 6174 745f 7061 7468 293a 0a20 2020  s(att_path):.   
+00013390: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000133a0: 4661 6c73 652c 2022 4174 7469 7475 6465  False, "Attitude
+000133b0: 2066 696c 6520 6e6f 7420 666f 756e 643a   file not found:
+000133c0: 2022 2b61 7474 5f70 6174 680a 0a20 2020   "+att_path..   
+000133d0: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+000133e0: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+000133f0: 696d 6167 6573 4469 7229 3a0a 2020 2020  imagesDir):.    
+00013400: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00013410: 616c 7365 2c20 2249 6d61 6765 2066 6f6c  alse, "Image fol
+00013420: 6465 7220 6e6f 7420 666f 756e 643a 2022  der not found: "
+00013430: 2b20 7365 6c66 2e69 6d61 6765 7344 6972  + self.imagesDir
+00013440: 0a0a 2020 2020 2020 2020 7320 3d20 6d69  ..        s = mi
+00013450: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
+00013460: 4d73 6728 2243 7265 6174 696e 6720 6974  Msg("Creating it
+00013470: 656d 7327 2061 7474 6974 7564 6520 6461  ems' attitude da
+00013480: 7461 2229 0a0a 2020 2020 2020 2020 2320  ta")..        # 
+00013490: 6c6f 6164 2066 7261 6d65 2061 7474 6974  load frame attit
+000134a0: 7564 6520 6461 7461 2066 726f 6d20 6669  ude data from fi
+000134b0: 6c65 0a20 2020 2020 2020 2061 7474 5f64  le.        att_d
+000134c0: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
+000134d0: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
+000134e0: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
+000134f0: 7468 2861 7474 5f70 6174 682c 2066 7261  th(att_path, fra
+00013500: 6d65 5f61 7474 5f68 6561 6465 722c 2064  me_att_header, d
+00013510: 6174 655f 666f 726d 6174 2c63 6f6c 5f73  ate_format,col_s
+00013520: 6570 6172 6174 6f72 3d63 6f6c 5f73 6570  eparator=col_sep
+00013530: 6172 6174 6f72 2c63 6f6e 7374 5f76 616c  arator,const_val
+00013540: 7565 733d 636f 6e73 745f 7661 6c75 6573  ues=const_values
+00013550: 2c61 6e67 6c65 7349 6e52 6164 3d61 7474  ,anglesInRad=att
+00013560: 5f70 6174 685f 616e 676c 6573 5f69 6e5f  _path_angles_in_
+00013570: 7261 6429 0a20 2020 2020 2020 2069 6620  rad).        if 
+00013580: 7061 7273 654d 7367 2021 3d20 2222 3a0a  parseMsg != "":.
+00013590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000135a0: 2e70 726f 762e 6c6f 6728 7061 7273 654d  .prov.log(parseM
+000135b0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
+000135c0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+000135d0: 7273 654d 7367 203d 2022 5c6e 2220 2b20  rseMsg = "\n" + 
+000135e0: 7061 7273 654d 7367 0a0a 2020 2020 2020  parseMsg..      
+000135f0: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
+00013600: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
+00013610: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
+00013620: 6e20 6461 7461 0a20 2020 2020 2020 2073  n data.        s
+00013630: 2e73 746f 7028 290a 2020 2020 2020 2020  .stop().        
+00013640: 7375 6363 6573 732c 2069 6d61 6765 5f64  success, image_d
+00013650: 7473 2c20 6d73 6720 3d20 7365 6c66 2e66  ts, msg = self.f
+00013660: 696e 644e 6176 4461 7461 466f 7249 6d61  indNavDataForIma
+00013670: 6765 2861 7474 5f64 6174 612c 7669 6465  ge(att_data,vide
+00013680: 6f53 616d 706c 6553 6563 6f6e 6473 290a  oSampleSeconds).
+00013690: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+000136a0: 7563 6365 7373 3a0a 2020 2020 2020 2020  uccess:.        
+000136b0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+000136c0: 2c20 6d73 6720 2b20 7061 7273 654d 7367  , msg + parseMsg
+000136d0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+000136e0: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+000136f0: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
+00013700: 6d73 2720 6174 7469 7475 6465 2064 6174  ms' attitude dat
+00013710: 6122 290a 0a20 2020 2020 2020 2023 2061  a")..        # a
+00013720: 6464 2063 616d 6572 6132 4672 616d 6520  dd camera2Frame 
+00013730: 616e 676c 6573 0a20 2020 2020 2020 2052  angles.        R
+00013740: 5f63 616d 3266 7261 6d65 203d 206d 6971  _cam2frame = miq
+00013750: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
+00013760: 6c28 6361 6d65 7261 3246 7261 6d65 5f79  l(camera2Frame_y
+00013770: 6177 2c63 616d 6572 6132 4672 616d 655f  aw,camera2Frame_
+00013780: 7069 7463 682c 6361 6d65 7261 3246 7261  pitch,camera2Fra
+00013790: 6d65 5f72 6f6c 6c29 0a20 2020 2020 2020  me_roll).       
+000137a0: 2052 5f63 616d 3275 746d 5f6c 6973 7420   R_cam2utm_list 
+000137b0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+000137c0: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
+000137d0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+000137e0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
+000137f0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+00013800: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013810: 2020 6174 7469 7475 6465 203d 2074 696d    attitude = tim
+00013820: 6570 6f69 6e74 0a20 2020 2020 2020 2020  epoint.         
+00013830: 2020 2020 2020 2069 6620 6174 7469 7475         if attitu
+00013840: 6465 2e79 6177 2069 7320 4e6f 6e65 206f  de.yaw is None o
+00013850: 7220 6174 7469 7475 6465 2e70 6974 6368  r attitude.pitch
+00013860: 2069 7320 4e6f 6e65 206f 7220 6174 7469   is None or atti
+00013870: 7475 6465 2e72 6f6c 6c20 6973 204e 6f6e  tude.roll is Non
+00013880: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00013890: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
+000138a0: 5f6c 6973 742e 6170 7065 6e64 2822 2229  _list.append("")
+000138b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000138c0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+000138d0: 2020 2020 2020 2020 2020 2020 2020 525f                R_
+000138e0: 6672 616d 6532 6e65 6420 3d20 6d69 7174  frame2ned = miqt
+000138f0: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
+00013900: 2861 7474 6974 7564 652e 7961 772c 6174  (attitude.yaw,at
+00013910: 7469 7475 6465 2e70 6974 6368 2c61 7474  titude.pitch,att
+00013920: 6974 7564 652e 726f 6c6c 290a 2020 2020  itude.roll).    
+00013930: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
+00013940: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
+00013950: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
+00013960: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00013970: 2020 2020 2079 6177 2c70 6974 6368 2c72       yaw,pitch,r
+00013980: 6f6c 6c20 3d20 6d69 7174 672e 7961 7750  oll = miqtg.yawP
+00013990: 6974 6368 526f 6c6c 2852 5f63 616d 326e  itchRoll(R_cam2n
+000139a0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+000139b0: 2020 2020 6174 7469 7475 6465 2e79 6177      attitude.yaw
+000139c0: 203d 2079 6177 0a20 2020 2020 2020 2020   = yaw.         
+000139d0: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
+000139e0: 7069 7463 6820 3d20 7069 7463 680a 2020  pitch = pitch.  
+000139f0: 2020 2020 2020 2020 2020 2020 2020 6174                at
+00013a00: 7469 7475 6465 2e72 6f6c 6c20 3d20 726f  titude.roll = ro
+00013a10: 6c6c 0a0a 2020 2020 2020 2020 2020 2020  ll..            
+00013a20: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
+00013a30: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
+00013a40: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
+00013a50: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
+00013a60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013a70: 2020 525f 6361 6d32 7574 6d5f 6c69 7374    R_cam2utm_list
+00013a80: 2e61 7070 656e 6428 525f 6361 6d53 7464  .append(R_camStd
+00013a90: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
+00013aa0: 6f6c 6973 7428 2929 0a0a 2020 2020 2020  olist())..      
+00013ab0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00013ac0: 2261 7070 6c69 6564 2066 7261 6d65 2074  "applied frame t
+00013ad0: 6f20 6361 6d65 7261 2072 6f74 6174 696f  o camera rotatio
+00013ae0: 6e20 7961 772c 7069 7463 682c 726f 6c6c  n yaw,pitch,roll
+00013af0: 203d 2022 202b 2073 7472 2863 616d 6572   = " + str(camer
+00013b00: 6132 4672 616d 655f 7961 7729 202b 2022  a2Frame_yaw) + "
+00013b10: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
+00013b20: 4672 616d 655f 7069 7463 6829 202b 2022  Frame_pitch) + "
+00013b30: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
+00013b40: 4672 616d 655f 726f 6c6c 292c 646f 6e74  Frame_roll),dont
+00013b50: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
+00013b60: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
+00013b70: 5f64 7473 2920 3e20 303a 0a0a 2020 2020  _dts) > 0:..    
+00013b80: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00013b90: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
+00013ba0: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
+00013bb0: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
+00013bc0: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+00013bd0: 656e 2869 6e74 5f61 7474 7574 7564 655f  en(int_attutude_
+00013be0: 6669 6c65 2c20 2277 2229 0a20 2020 2020  file, "w").     
+00013bf0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00013c00: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+00013c10: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00013c20: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
+00013c30: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00013c40: 275d 5b27 7574 6327 5d29 0a20 2020 2020  ']['utc']).     
+00013c50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00013c60: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00013c70: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00013c80: 5b27 7961 7727 5d29 0a20 2020 2020 2020  ['yaw']).       
+00013c90: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00013ca0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00013cb0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013cc0: 7069 7463 6827 5d29 0a20 2020 2020 2020  pitch']).       
+00013cd0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00013ce0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00013cf0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013d00: 726f 6c6c 275d 290a 0a20 2020 2020 2020  roll'])..       
+00013d10: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00013d20: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00013d30: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
+00013d40: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00013d50: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
+00013d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d70: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
+00013d80: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+00013d90: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00013da0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00013db0: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
+00013dc0: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
+00013dd0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+00013de0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+00013df0: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
+00013e00: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00013e10: 203d 2074 696d 6570 6f69 6e74 2e79 6177   = timepoint.yaw
+00013e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e30: 2020 2020 2069 6620 2779 6177 2720 696e       if 'yaw' in
+00013e40: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00013e50: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+00013e60: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00013e70: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+00013e80: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00013e90: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
+00013ea0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+00013eb0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00013ec0: 6d65 706f 696e 742e 7069 7463 680a 2020  mepoint.pitch.  
+00013ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ee0: 2020 6966 2027 7069 7463 6827 2069 6e20    if 'pitch' in 
+00013ef0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00013f00: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00013f10: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+00013f20: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+00013f30: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00013f40: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
+00013f50: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00013f60: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
+00013f70: 6570 6f69 6e74 2e72 6f6c 6c0a 2020 2020  epoint.roll.    
+00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f90: 6966 2027 726f 6c6c 2720 696e 2072 6563  if 'roll' in rec
+00013fa0: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
+00013fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013fc0: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
+00013fd0: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+00013fe0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00013ff0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+00014000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014010: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00014020: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
+00014030: 7265 732e 636c 6f73 6528 290a 0a20 2020  res.close()..   
+00014040: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00014050: 6f76 2e61 6464 4172 6775 6d65 6e74 2822  ov.addArgument("
+00014060: 696e 7075 7441 7474 6974 7564 6546 696c  inputAttitudeFil
+00014070: 6522 2c61 7474 5f70 6174 682c 6f76 6572  e",att_path,over
+00014080: 7772 6974 653d 5472 7565 290a 2020 2020  write=True).    
+00014090: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+000140a0: 762e 6c6f 6728 2270 6172 7365 6420 6672  v.log("parsed fr
+000140b0: 6f6d 2069 6e70 7574 4174 7469 7475 6465  om inputAttitude
+000140c0: 4669 6c65 3a20 2220 2b20 7374 7228 6672  File: " + str(fr
+000140d0: 616d 655f 6174 745f 6865 6164 6572 292c  ame_att_header),
+000140e0: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+000140f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014100: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+00014110: 625f 6669 6c65 2869 6e74 5f61 7474 7574  b_file(int_attut
+00014120: 7564 655f 6669 6c65 2c22 5c74 222c 6f75  ude_file,"\t",ou
+00014130: 7470 7574 5f68 6561 6465 725f 6174 7429  tput_header_att)
+00014140: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00014150: 5772 6974 6520 746f 2070 6f73 6520 7478  Write to pose tx
+00014160: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
+00014170: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
+00014180: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+00014190: 656e 2869 6e74 5f70 6f73 655f 6669 6c65  en(int_pose_file
+000141a0: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+000141b0: 2020 2072 6573 2e77 7269 7465 286d 6971     res.write(miq
+000141c0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+000141d0: 6172 6971 7427 5d5b 2769 6d67 275d 2b22  ariqt']['img']+"
+000141e0: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+000141f0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00014200: 7574 6327 5d29 0a20 2020 2020 2020 2020  utc']).         
+00014210: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00014220: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00014230: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
+00014240: 7365 275d 290a 2020 2020 2020 2020 2020  se']).          
+00014250: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
+00014260: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00014270: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
+00014280: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
+00014290: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+000142a0: 6520 696e 2069 6d61 6765 5f64 7473 3a0a  e in image_dts:.
+000142b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142c0: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
+000142d0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+000142e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000142f0: 2020 2020 2020 6966 2052 5f63 616d 3275        if R_cam2u
+00014300: 746d 5f6c 6973 745b 695d 203d 3d20 2222  tm_list[i] == ""
+00014310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014320: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
+00014330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014340: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00014350: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00014360: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00014370: 6669 6c65 2b22 5c74 222b 7469 6d65 706f  file+"\t"+timepo
+00014380: 696e 742e 6461 7465 5469 6d65 2829 2e73  int.dateTime().s
+00014390: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
+000143a0: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+000143b0: 7174 275d 2929 200a 2020 2020 2020 2020  qt'])) .        
+000143c0: 2020 2020 2020 2020 2020 2020 656e 7472              entr
+000143d0: 7920 3d20 7374 7228 7b27 706f 7365 2d61  y = str({'pose-a
+000143e0: 6273 6f6c 7574 652d 6f72 6965 6e74 6174  bsolute-orientat
+000143f0: 696f 6e2d 7574 6d2d 6d61 7472 6978 273a  ion-utm-matrix':
+00014400: 525f 6361 6d32 7574 6d5f 6c69 7374 5b69  R_cam2utm_list[i
+00014410: 5d7d 292e 7265 706c 6163 6528 275c 6e27  ]}).replace('\n'
+00014420: 2c27 2729 0a20 2020 2020 2020 2020 2020  ,'').           
+00014430: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00014440: 7465 2822 5c74 222b 656e 7472 7929 0a20  te("\t"+entry). 
+00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014460: 2020 2069 202b 3d20 310a 2020 2020 2020     i += 1.      
+00014470: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00014480: 732e 7772 6974 6528 225c 6e22 290a 2020  s.write("\n").  
+00014490: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
+000144a0: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+000144b0: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
+000144c0: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
+000144d0: 745f 706f 7365 5f66 696c 652c 225c 7422  t_pose_file,"\t"
+000144e0: 2c6f 7574 7075 745f 6865 6164 6572 5f70  ,output_header_p
+000144f0: 6f73 6529 0a20 2020 2020 2020 2020 2020  ose).           
+00014500: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+00014510: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00014520: 652c 2022 4174 7469 7475 6465 2064 6174  e, "Attitude dat
+00014530: 6120 6372 6561 7465 6422 202b 2070 6172  a created" + par
+00014540: 7365 4d73 670a 2020 2020 2020 2020 656c  seMsg.        el
+00014550: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00014560: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00014570: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00014580: 652c 2022 4e6f 2069 6d61 6765 2061 7474  e, "No image att
+00014590: 6974 7564 6573 2066 6f75 6e64 2220 2b20  itudes found" + 
+000145a0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
+000145b0: 200a 2020 2020 2020 2020 0a20 2020 2064   .        .    d
+000145c0: 6566 2063 7265 6174 6549 6d61 6765 4174  ef createImageAt
+000145d0: 7469 7475 6465 4669 6c65 2873 656c 662c  titudeFile(self,
+000145e0: 2061 7474 5f70 6174 683a 7374 722c 2066   att_path:str, f
+000145f0: 7261 6d65 5f61 7474 5f68 6561 6465 723a  rame_att_header:
+00014600: 6469 6374 2c20 6361 6d65 7261 3246 7261  dict, camera2Fra
+00014610: 6d65 5f79 6177 3a66 6c6f 6174 2c63 616d  me_yaw:float,cam
+00014620: 6572 6132 4672 616d 655f 7069 7463 683a  era2Frame_pitch:
+00014630: 666c 6f61 742c 6361 6d65 7261 3246 7261  float,camera2Fra
+00014640: 6d65 5f72 6f6c 6c3a 666c 6f61 742c 0a20  me_roll:float,. 
+00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014660: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00014670: 6174 655f 666f 726d 6174 3d6d 6971 7476  ate_format=miqtv
+00014680: 2e64 6174 655f 666f 726d 6174 735b 2770  .date_formats['p
+00014690: 616e 6761 6561 275d 2c20 636f 6e73 745f  angaea'], const_
+000146a0: 7661 6c75 6573 203d 207b 7d2c 206f 7665  values = {}, ove
+000146b0: 7277 7269 7465 3d46 616c 7365 2c20 636f  rwrite=False, co
+000146c0: 6c5f 7365 7061 7261 746f 7220 3d20 225c  l_separator = "\
+000146d0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000146f0: 2020 2020 6174 745f 7061 7468 5f61 6e67      att_path_ang
+00014700: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
+00014710: 7365 2c20 7669 6465 6f53 616d 706c 6553  se, videoSampleS
+00014720: 6563 6f6e 6473 3d31 2c72 6563 6f72 6473  econds=1,records
+00014730: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
+00014740: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
+00014750: 7265 6361 7464 6520 2d20 7573 6520 6372  recatde - use cr
+00014760: 6561 7465 5f69 6d61 6765 5f61 7474 6974  eate_image_attit
+00014770: 7564 655f 6669 6c65 2022 2222 0a20 2020  ude_file """.   
+00014780: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00014790: 2e63 7265 6174 655f 696d 6167 655f 6174  .create_image_at
+000147a0: 7469 7475 6465 5f66 696c 6528 6174 745f  titude_file(att_
+000147b0: 7061 7468 2c20 6672 616d 655f 6174 745f  path, frame_att_
+000147c0: 6865 6164 6572 2c20 6361 6d65 7261 3246  header, camera2F
+000147d0: 7261 6d65 5f79 6177 2c20 6361 6d65 7261  rame_yaw, camera
+000147e0: 3246 7261 6d65 5f70 6974 6368 2c20 6361  2Frame_pitch, ca
+000147f0: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c2c  mera2Frame_roll,
+00014800: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014830: 2064 6174 655f 666f 726d 6174 2c20 636f   date_format, co
+00014840: 6e73 745f 7661 6c75 6573 2c20 6f76 6572  nst_values, over
+00014850: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
+00014860: 6174 6f72 2c20 6174 745f 7061 7468 5f61  ator, att_path_a
+00014870: 6e67 6c65 735f 696e 5f72 6164 2c20 7669  ngles_in_rad, vi
+00014880: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00014890: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148c0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+000148d0: 7465 6429 0a20 2020 2020 2020 200a 0a20  ted).        .. 
+000148e0: 2020 2064 6566 2067 6574 5f52 5f63 616d     def get_R_cam
+000148f0: 5374 6432 7574 6d28 7365 6c66 2c52 5f63  Std2utm(self,R_c
+00014900: 616d 3266 7261 6d65 3a6e 702e 6172 7261  am2frame:np.arra
+00014910: 792c 525f 6672 616d 6532 6e65 643a 6e70  y,R_frame2ned:np
+00014920: 2e61 7272 6179 293a 0a20 2020 2020 2020  .array):.       
+00014930: 2022 2222 2072 6574 7275 6e20 726f 7461   """ retrun rota
+00014940: 7469 6f6e 206d 6174 7269 7820 5220 7472  tion matrix R tr
+00014950: 616e 666f 726d 696e 6720 6672 6f6d 2063  anforming from c
+00014960: 616d 5374 643a 2028 782c 792c 7a20 3d20  amStd: (x,y,z = 
+00014970: 7269 6768 742c 6275 7474 6f6d 2c6c 696e  right,buttom,lin
+00014980: 6520 6f66 2073 6967 6874 2920 746f 2075  e of sight) to u
+00014990: 746d 2028 782c 792c 7a20 3d20 6561 7374  tm (x,y,z = east
+000149a0: 696e 672c 6e6f 7274 6869 6e67 2c75 7029  ing,northing,up)
+000149b0: 2022 2222 0a20 2020 2020 2020 2052 5f63   """.        R_c
+000149c0: 616d 6946 444f 3263 616d 5374 6420 3d20  amiFDO2camStd = 
+000149d0: 6d69 7174 672e 525f 5961 7750 6974 6368  miqtg.R_YawPitch
+000149e0: 526f 6c6c 2839 302c 302c 3029 2023 2069  Roll(90,0,0) # i
+000149f0: 6e20 6946 444f 2063 616d 3a20 2878 2c79  n iFDO cam: (x,y
+00014a00: 2c7a 203d 2074 6f70 2c72 6967 6874 2c6c  ,z = top,right,l
+00014a10: 696e 6520 6f66 2073 6967 6874 2920 6275  ine of sight) bu
+00014a20: 7420 666f 7220 706f 7365 2074 6865 2027  t for pose the '
+00014a30: 7374 616e 6461 7264 2720 6361 6d53 7464  standard' camStd
+00014a40: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
+00014a50: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
+00014a60: 7369 6768 7429 2069 7320 6578 7065 6374  sight) is expect
+00014a70: 6564 0a20 2020 2020 2020 2052 5f63 616d  ed.        R_cam
+00014a80: 5374 6432 6672 616d 6520 3d20 525f 6361  Std2frame = R_ca
+00014a90: 6d32 6672 616d 652e 646f 7428 525f 6361  m2frame.dot(R_ca
+00014aa0: 6d69 4644 4f32 6361 6d53 7464 290a 2020  miFDO2camStd).  
+00014ab0: 2020 2020 2020 525f 6361 6d53 7464 326e        R_camStd2n
+00014ac0: 6564 203d 2052 5f66 7261 6d65 326e 6564  ed = R_frame2ned
+00014ad0: 2e64 6f74 2852 5f63 616d 5374 6432 6672  .dot(R_camStd2fr
+00014ae0: 616d 6529 0a20 2020 2020 2020 2052 5f6e  ame).        R_n
+00014af0: 6564 3275 746d 203d 206d 6971 7467 2e52  ed2utm = miqtg.R
+00014b00: 5f58 595a 2831 3830 2c30 2c39 3029 2023  _XYZ(180,0,90) #
+00014b10: 2077 6974 6820 7574 6d20 782c 792c 7a20   with utm x,y,z 
+00014b20: 3d20 6561 7374 696e 672c 6e6f 7274 6869  = easting,northi
+00014b30: 6e67 2c75 700a 2020 2020 2020 2020 525f  ng,up.        R_
+00014b40: 6361 6d53 7464 3275 746d 203d 2052 5f6e  camStd2utm = R_n
+00014b50: 6564 3275 746d 2e64 6f74 2852 5f63 616d  ed2utm.dot(R_cam
+00014b60: 5374 6432 6e65 6429 2e72 6f75 6e64 2835  Std2ned).round(5
+00014b70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00014b80: 2052 5f63 616d 5374 6432 7574 6d0a 0a0a   R_camStd2utm...
+00014b90: 2020 2020 6465 6620 6669 6e64 4e61 7644      def findNavD
+00014ba0: 6174 6146 6f72 496d 6167 6528 7365 6c66  ataForImage(self
+00014bb0: 2c64 6174 613a 6d69 7174 672e 4e75 6d44  ,data:miqtg.NumD
+00014bc0: 6174 6154 696d 6553 7461 6d70 6564 2c76  ataTimeStamped,v
+00014bd0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+00014be0: 733d 3129 3a0a 2020 2020 2020 2020 2222  s=1):.        ""
+00014bf0: 2220 6372 6561 7465 7320 6120 6469 6374  " creates a dict
+00014c00: 2028 696d 6167 655f 6474 7329 2077 6974   (image_dts) wit
+00014c10: 6820 6669 6c65 206e 616d 6520 6173 206b  h file name as k
+00014c20: 6579 2061 6e64 2061 206c 6973 7420 6f66  ey and a list of
+00014c30: 2064 6174 6120 656c 656d 656e 7473 2061   data elements a
+00014c40: 7320 7661 6c75 652e 200a 2020 2020 2020  s value. .      
+00014c50: 2020 2020 2020 496e 2063 6173 6520 6f66        In case of
+00014c60: 2070 686f 746f 7320 7468 6520 6c69 7374   photos the list
+00014c70: 2068 6173 206f 6e6c 7920 6120 7369 6e67   has only a sing
+00014c80: 6c65 2065 6e74 7279 2c20 666f 7220 7669  le entry, for vi
+00014c90: 6465 6f73 2069 7420 6861 7320 7669 6465  deos it has vide
+00014ca0: 6f20 6475 7261 7469 6f6e 205b 7365 635d  o duration [sec]
+00014cb0: 202f 2076 6964 656f 5361 6d70 6c65 5365   / videoSampleSe
+00014cc0: 636f 6e64 7320 656e 7472 6965 732e 0a20  conds entries.. 
+00014cd0: 2020 2020 2020 2020 2020 2052 6574 7572             Retur
+00014ce0: 6e73 2073 7563 6365 7373 2c20 696d 6167  ns success, imag
+00014cf0: 655f 6474 732c 206d 7367 2022 2222 0a0a  e_dts, msg """..
+00014d00: 2020 2020 2020 2020 6966 2076 6964 656f          if video
+00014d10: 5361 6d70 6c65 5365 636f 6e64 7320 3c3d  SampleSeconds <=
+00014d20: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00014d30: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+00014d40: 2266 696e 644e 6176 4461 7461 466f 7249  "findNavDataForI
+00014d50: 6d61 6765 3a20 7669 6465 6f53 616d 706c  mage: videoSampl
+00014d60: 6553 6563 6f6e 6473 206d 7573 7420 6265  eSeconds must be
+00014d70: 2067 7265 6174 6572 2030 2229 0a0a 2020   greater 0")..  
+00014d80: 2020 2020 2020 2320 6372 6561 7465 2073        # create s
+00014d90: 6f72 7465 6420 7469 6d65 2070 6f69 6e74  orted time point
+00014da0: 730a 2020 2020 2020 2020 7469 6d65 5f70  s.        time_p
+00014db0: 6f69 6e74 7320 3d20 6c69 7374 2864 6174  oints = list(dat
+00014dc0: 612e 6b65 7973 2829 290a 2020 2020 2020  a.keys()).      
+00014dd0: 2020 7469 6d65 5f70 6f69 6e74 732e 736f    time_points.so
+00014de0: 7274 2829 0a20 2020 2020 2020 2075 6e6d  rt().        unm
+00014df0: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
+00014e00: 203d 205b 5d0a 2020 2020 2020 2020 696d   = [].        im
+00014e10: 6167 655f 6474 7320 3d20 7b7d 0a20 2020  age_dts = {}.   
+00014e20: 2020 2020 2073 7461 7274 5365 6172 6368       startSearch
+00014e30: 496e 6465 7820 3d20 300a 2020 2020 2020  Index = 0.      
+00014e40: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
+00014e50: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
+00014e60: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
+00014e70: 2020 696d 6167 6573 496e 5261 7753 6f72    imagesInRawSor
+00014e80: 7465 644c 6973 7420 3d20 7365 6c66 2e69  tedList = self.i
+00014e90: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+00014ea0: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
+00014eb0: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+00014ec0: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+00014ed0: 7265 7373 4d73 6728 2249 6e74 6572 706f  ressMsg("Interpo
+00014ee0: 6c61 7469 6e67 206e 6176 6967 6174 696f  lating navigatio
+00014ef0: 6e20 666f 7220 696d 6167 6522 2c20 6c65  n for image", le
+00014f00: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
+00014f10: 6f64 756c 6f3d 3129 0a20 2020 2020 2020  odulo=1).       
+00014f20: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00014f30: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
+00014f40: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+00014f50: 7072 6f67 2e70 726f 6772 6573 7328 290a  prog.progress().
+00014f60: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00014f70: 5f6e 616d 6520 3d20 6f73 2e70 6174 682e  _name = os.path.
+00014f80: 6261 7365 6e61 6d65 2866 696c 6529 0a0a  basename(file)..
+00014f90: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
+00014fa0: 6d61 6765 203d 206d 6971 7463 2e70 6172  mage = miqtc.par
+00014fb0: 7365 4669 6c65 4461 7465 5469 6d65 4173  seFileDateTimeAs
+00014fc0: 5554 4328 6669 6c65 5f6e 616d 6529 0a20  UTC(file_name). 
+00014fd0: 2020 2020 2020 2020 2020 2064 745f 696d             dt_im
+00014fe0: 6167 655f 7473 203d 2069 6e74 2864 745f  age_ts = int(dt_
+00014ff0: 696d 6167 652e 7469 6d65 7374 616d 7028  image.timestamp(
+00015000: 2920 2a20 3130 3030 290a 0a20 2020 2020  ) * 1000)..     
+00015010: 2020 2020 2020 2072 756e 5469 6d65 203d         runTime =
+00015020: 2069 6d61 6765 7349 6e52 6177 5b66 696c   imagesInRaw[fil
+00015030: 655d 5b31 5d20 2320 2d31 2066 6f72 2070  e][1] # -1 for p
+00015040: 686f 746f 730a 2020 2020 2020 2020 2020  hotos.          
+00015050: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
+00015060: 2020 2020 2020 6966 2069 6d61 6765 7349        if imagesI
+00015070: 6e52 6177 5b66 696c 655d 5b32 5d20 696e  nRaw[file][2] in
+00015080: 206d 6971 7476 2e76 6964 656f 5f74 7970   miqtv.video_typ
+00015090: 6573 2061 6e64 2072 756e 5469 6d65 203c  es and runTime <
+000150a0: 3d20 303a 2023 2065 7874 0a20 2020 2020  = 0: # ext.     
+000150b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000150c0: 2822 4361 7574 696f 6e21 2043 6f75 6c64  ("Caution! Could
+000150d0: 206e 6f74 2072 6561 6420 7669 6465 6f20   not read video 
+000150e0: 7275 6e20 7469 6d65 2066 726f 6d20 6669  run time from fi
+000150f0: 6c65 222c 6669 6c65 2920 2320 544f 444f  le",file) # TODO
+00015100: 2064 6f65 7320 7468 6973 2068 6170 7065   does this happe
+00015110: 6e3f 2048 616e 646c 6520 6265 7474 6572  n? Handle better
+00015120: 3f0a 0a20 2020 2020 2020 2020 2020 2073  ?..            s
+00015130: 616d 706c 6554 696d 6553 6563 7320 3d20  ampleTimeSecs = 
+00015140: 300a 2020 2020 2020 2020 2020 2020 706f  0.            po
+00015150: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
+00015160: 2020 2020 2020 2020 676f 203d 2054 7275          go = Tru
+00015170: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
+00015180: 696c 6520 676f 3a0a 2020 2020 2020 2020  ile go:.        
+00015190: 2020 2020 2020 2020 7472 793a 2020 2020          try:    
+000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151c0: 2020 2020 2070 6f73 2c20 7374 6172 7453       pos, startS
+000151d0: 6561 7263 6849 6e64 6578 203d 2064 6174  earchIndex = dat
+000151e0: 612e 696e 7465 7270 6f6c 6174 6541 7454  a.interpolateAtT
+000151f0: 696d 6528 6474 5f69 6d61 6765 5f74 7320  ime(dt_image_ts 
+00015200: 2b20 7361 6d70 6c65 5469 6d65 5365 6373  + sampleTimeSecs
+00015210: 202a 2031 3030 302c 7469 6d65 5f70 6f69   * 1000,time_poi
+00015220: 6e74 732c 7374 6172 7453 6561 7263 6849  nts,startSearchI
+00015230: 6e64 6578 290a 2020 2020 2020 2020 2020  ndex).          
+00015240: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00015250: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00015260: 2069 6e74 6572 706f 6c61 7465 4174 5469   interpolateAtTi
+00015270: 6d65 2072 6574 7572 6e73 204e 6f6e 6520  me returns None 
+00015280: 7661 6c75 6573 2069 6620 7469 6d65 206f  values if time o
+00015290: 7574 206f 6620 7261 6e67 650a 2020 2020  ut of range.    
+000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152b0: 6966 2070 6f73 2e63 6f74 6169 6e73 4e6f  if pos.cotainsNo
+000152c0: 6e65 5661 6c75 6573 496e 5265 7175 6972  neValuesInRequir
+000152d0: 6564 4669 656c 6473 2829 3a0a 2020 2020  edFields():.    
+000152e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152f0: 2020 2020 756e 6d61 7463 6865 6454 696d      unmatchedTim
+00015300: 6550 6f69 6e74 732e 6170 7065 6e64 2828  ePoints.append((
+00015310: 6474 5f69 6d61 6765 5f74 7320 2b20 7361  dt_image_ts + sa
+00015320: 6d70 6c65 5469 6d65 5365 6373 202a 2031  mpleTimeSecs * 1
+00015330: 3030 3029 2f31 3030 3029 0a20 2020 2020  000)/1000).     
+00015340: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00015350: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00015360: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00015370: 5f6c 6973 742e 6170 7065 6e64 2870 6f73  _list.append(pos
+00015380: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015390: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+000153a0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+000153b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000153c0: 7572 6e20 4661 6c73 652c 2069 6d61 6765  urn False, image
+000153d0: 5f64 7473 2c20 2243 6f75 6c64 206e 6f74  _dts, "Could not
+000153e0: 2066 696e 6420 696d 6167 6520 7469 6d65   find image time
+000153f0: 2022 2b20 6461 7465 7469 6d65 2e64 6174   "+ datetime.dat
+00015400: 6574 696d 652e 7574 6366 726f 6d74 696d  etime.utcfromtim
+00015410: 6573 7461 6d70 2828 6474 5f69 6d61 6765  estamp((dt_image
+00015420: 5f74 7320 2b20 7361 6d70 6c65 5469 6d65  _ts + sampleTime
+00015430: 5365 6373 202a 2031 3030 3029 2f31 3030  Secs * 1000)/100
+00015440: 3029 2e73 7472 6674 696d 6528 6d69 7174  0).strftime(miqt
+00015450: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00015460: 6d61 7269 7174 275d 2920 2b22 2069 6e20  mariqt']) +" in 
+00015470: 222b 7374 7228 6461 7461 2e6c 656e 2829  "+str(data.len()
+00015480: 292b 2220 6461 7461 2070 6f73 6974 696f  )+" data positio
+00015490: 6e73 2220 2b20 7374 7228 652e 6172 6773  ns" + str(e.args
+000154a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000154b0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
+000154c0: 202b 3d20 7669 6465 6f53 616d 706c 6553   += videoSampleS
+000154d0: 6563 6f6e 6473 0a20 2020 2020 2020 2020  econds.         
+000154e0: 2020 2020 2020 2069 6620 7361 6d70 6c65         if sample
+000154f0: 5469 6d65 5365 6373 203e 2072 756e 5469  TimeSecs > runTi
+00015500: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+00015510: 2020 2020 2020 2020 676f 203d 2046 616c          go = Fal
+00015520: 7365 0a20 2020 2020 2020 2020 2020 200a  se.            .
+00015530: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00015540: 655f 6474 735b 6669 6c65 5f6e 616d 655d  e_dts[file_name]
+00015550: 203d 2070 6f73 5f6c 6973 740a 2020 2020   = pos_list.    
+00015560: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+00015570: 0a20 2020 2020 2020 2072 6574 7572 6e4d  .        returnM
+00015580: 7367 203d 2022 220a 2020 2020 2020 2020  sg = "".        
+00015590: 6966 206c 656e 2875 6e6d 6174 6368 6564  if len(unmatched
+000155a0: 5469 6d65 506f 696e 7473 2920 213d 2030  TimePoints) != 0
+000155b0: 3a0a 2020 2020 2020 2020 2020 2020 756e  :.            un
+000155c0: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
+000155d0: 732e 736f 7274 2829 0a20 2020 2020 2020  s.sort().       
+000155e0: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
+000155f0: 6d65 506f 696e 7473 203d 205b 6461 7465  mePoints = [date
+00015600: 7469 6d65 2e64 6174 6574 696d 652e 7574  time.datetime.ut
+00015610: 6366 726f 6d74 696d 6573 7461 6d70 2874  cfromtimestamp(t
+00015620: 7329 2e73 7472 6674 696d 6528 6d69 7174  s).strftime(miqt
+00015630: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00015640: 6d61 7269 7174 275d 2920 666f 7220 7473  mariqt']) for ts
+00015650: 2069 6e20 756e 6d61 7463 6865 6454 696d   in unmatchedTim
+00015660: 6550 6f69 6e74 735d 0a20 2020 2020 2020  ePoints].       
+00015670: 2020 2020 2072 6574 7572 6e4d 7367 203d       returnMsg =
+00015680: 2022 4341 5554 494f 4e21 204e 6176 6967   "CAUTION! Navig
+00015690: 6174 696f 6e20 6e6f 7420 666f 756e 6420  ation not found 
+000156a0: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
+000156b0: 6720 696d 6167 6520 7469 6d65 2070 6f69  g image time poi
+000156c0: 6e74 732e 2044 6f75 626c 6520 6368 6563  nts. Double chec
+000156d0: 6b20 6f72 2070 726f 7669 6465 2061 7420  k or provide at 
+000156e0: 6c65 6173 7420 7374 6174 6963 2064 6566  least static def
+000156f0: 6175 6c74 206e 6176 6967 6174 696f 6e20  ault navigation 
+00015700: 696e 2068 6561 6465 7220 6669 656c 6473  in header fields
+00015710: 2e22 0a20 2020 2020 2020 2020 2020 2072  .".            r
+00015720: 6574 7572 6e4d 7367 202b 3d20 225c 6e22  eturnMsg += "\n"
+00015730: 202b 2022 5c6e 222e 6a6f 696e 2875 6e6d   + "\n".join(unm
+00015740: 6174 6368 6564 5469 6d65 506f 696e 7473  atchedTimePoints
+00015750: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00015760: 2054 7275 652c 2069 6d61 6765 5f64 7473   True, image_dts
+00015770: 2c20 7265 7475 726e 4d73 670a 0a0a 2020  , returnMsg...  
+00015780: 2020 6465 6620 6372 6561 7465 5f69 6d61    def create_ima
+00015790: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
+000157a0: 6c65 2873 656c 662c 206e 6176 5f70 6174  le(self, nav_pat
+000157b0: 683a 2073 7472 2c20 6e61 765f 6865 6164  h: str, nav_head
+000157c0: 6572 3d6d 6971 7476 2e70 6f73 5f68 6561  er=miqtv.pos_hea
+000157d0: 6465 725b 2770 616e 6761 6561 275d 2c20  der['pangaea'], 
+000157e0: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
+000157f0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00015800: 7061 6e67 6165 6127 5d2c 206f 7665 7277  pangaea'], overw
+00015810: 7269 7465 3d46 616c 7365 2c20 636f 6c5f  rite=False, col_
+00015820: 7365 7061 7261 746f 7220 3d20 225c 7422  separator = "\t"
+00015830: 2c20 7669 6465 6f53 616d 706c 6553 6563  , videoSampleSec
+00015840: 6f6e 6473 3d31 2c0a 2020 2020 2020 2020  onds=1,.        
+00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015860: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
+00015870: 6574 5f78 3d30 2c20 6f66 6673 6574 5f79  et_x=0, offset_y
+00015880: 3d30 2c20 6f66 6673 6574 5f7a 3d30 2c61  =0, offset_z=0,a
+00015890: 6e67 6c65 735f 696e 5f72 6164 203d 2046  ngles_in_rad = F
+000158a0: 616c 7365 2c20 7265 636f 7264 7332 6265  alse, records2be
+000158b0: 496e 7665 7274 6564 3d5b 5d29 3a0a 2020  Inverted=[]):.  
+000158c0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
+000158d0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
+000158e0: 7465 2061 2074 6578 7420 6669 6c65 2077  te a text file w
+000158f0: 6974 6820 342e 3544 206e 6176 6967 6174  ith 4.5D navigat
+00015900: 696f 6e20 6461 7461 2066 6f72 2065 6163  ion data for eac
+00015910: 6820 696d 6167 652c 2069 2e65 2e20 6120  h image, i.e. a 
+00015920: 7369 6e67 6c65 2072 6f77 2070 6572 2070  single row per p
+00015930: 686f 746f 2c20 7669 6465 6f20 6475 7261  hoto, video dura
+00015940: 7469 6f6e 205b 7365 635d 202f 2076 6964  tion [sec] / vid
+00015950: 656f 5361 6d70 6c65 5365 636f 6e64 7320  eoSampleSeconds 
+00015960: 726f 7773 2070 6572 2076 6964 656f 2e0a  rows per video..
+00015970: 2020 2020 2020 2020 2020 2020 6e61 765f              nav_
+00015980: 6865 6164 6572 206d 7573 7420 6265 2064  header must be d
+00015990: 6963 7420 636f 6e74 6169 6e69 6e67 2074  ict containing t
+000159a0: 6865 206b 6579 7320 2775 7463 272c 276c  he keys 'utc','l
+000159b0: 6174 272c 276c 6f6e 272c 2764 6570 2728  at','lon','dep'(
+000159c0: 6f72 2027 616c 7427 292c 206f 7074 696f  or 'alt'), optio
+000159d0: 6e61 6c3a 2027 6867 7427 2c27 756e 6365  nal: 'hgt','unce
+000159e0: 7274 2720 7769 7468 2074 6865 2072 6573  rt' with the res
+000159f0: 7065 6374 6976 6520 636f 6c75 6d6e 2068  pective column h
+00015a00: 6561 6465 7273 2061 7320 7661 6c75 6573  eaders as values
+00015a10: 200a 2020 2020 2020 2020 2020 2020 6966   .            if
+00015a20: 206f 6e65 206f 6620 7468 6520 7665 6869   one of the vehi
+00015a30: 636c 6520 782c 792c 7a20 6f66 6673 6574  cle x,y,z offset
+00015a40: 7320 5b6d 5d20 6973 206e 6f74 2030 2061  s [m] is not 0 a
+00015a50: 6e64 206e 6176 5f68 6561 6465 7220 616c  nd nav_header al
+00015a60: 736f 2063 6f6e 7461 696e 7320 2779 6177  so contains 'yaw
+00015a70: 272c 2770 6974 6368 272c 2772 6f6c 6c27  ','pitch','roll'
+00015a80: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
+00015a90: 7320 6172 6520 636f 6d70 656e 7361 7465  s are compensate
+00015aa0: 6420 666f 7220 2222 220a 0a20 2020 2020  d for """..     
+00015ab0: 2020 2069 6620 7365 6c66 2e69 6e74 6572     if self.inter
+00015ac0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
+00015ad0: 6973 7473 2829 2061 6e64 206e 6f74 206f  ists() and not o
+00015ae0: 7665 7277 7269 7465 3a0a 2020 2020 2020  verwrite:.      
+00015af0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+00015b00: 652c 2022 4f75 7470 7574 2066 696c 6520  e, "Output file 
+00015b10: 6578 6973 7473 3a20 222b 7365 6c66 2e67  exists: "+self.g
+00015b20: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
+00015b30: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+00015b40: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+00015b50: 286e 6176 5f70 6174 6829 3a0a 2020 2020  (nav_path):.    
+00015b60: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00015b70: 616c 7365 2c20 224e 6176 6967 6174 696f  alse, "Navigatio
+00015b80: 6e20 6669 6c65 206e 6f74 2066 6f75 6e64  n file not found
+00015b90: 3a20 222b 6e61 765f 7061 7468 0a0a 2020  : "+nav_path..  
+00015ba0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+00015bb0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
+00015bc0: 2e69 6d61 6765 7344 6972 293a 0a20 2020  .imagesDir):.   
+00015bd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00015be0: 4661 6c73 652c 2022 496d 6167 6520 666f  False, "Image fo
+00015bf0: 6c64 6572 206e 6f74 2066 6f75 6e64 3a20  lder not found: 
+00015c00: 222b 2073 656c 662e 696d 6167 6573 4469  "+ self.imagesDi
+00015c10: 720a 0a20 2020 2020 2020 2073 203d 206d  r..        s = m
+00015c20: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
+00015c30: 674d 7367 2822 4372 6561 7469 6e67 2069  gMsg("Creating i
+00015c40: 7465 6d73 2720 6e61 7669 6761 7469 6f6e  tems' navigation
+00015c50: 2064 6174 6122 290a 2020 2020 2020 2020   data").        
+00015c60: 7265 7475 726e 4d73 6720 3d20 2222 0a20  returnMsg = "". 
+00015c70: 2020 2020 2020 2063 6f6d 7065 6e73 6174         compensat
+00015c80: 4f66 6673 6574 7320 3d20 4661 6c73 650a  Offsets = False.
+00015c90: 2020 2020 2020 2020 6966 2028 6f66 6673          if (offs
+00015ca0: 6574 5f78 213d 3020 6f72 206f 6666 7365  et_x!=0 or offse
+00015cb0: 745f 7921 3d30 206f 7220 6f66 6673 6574  t_y!=0 or offset
+00015cc0: 5f7a 213d 3029 2061 6e64 2027 7961 7727  _z!=0) and 'yaw'
+00015cd0: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
+00015ce0: 6e64 2027 7069 7463 6827 2069 6e20 6e61  nd 'pitch' in na
+00015cf0: 765f 6865 6164 6572 2061 6e64 2027 726f  v_header and 'ro
+00015d00: 6c6c 2720 696e 206e 6176 5f68 6561 6465  ll' in nav_heade
+00015d10: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
+00015d20: 6f6d 7065 6e73 6174 4f66 6673 6574 7320  ompensatOffsets 
+00015d30: 3d20 5472 7565 0a0a 2020 2020 2020 2020  = True..        
+00015d40: 2320 6368 6563 6b20 6966 2066 6f72 206d  # check if for m
+00015d50: 6973 7369 6e67 2066 6965 6c64 7320 7468  issing fields th
+00015d60: 6572 6520 6172 6520 636f 6e73 7420 7661  ere are const va
+00015d70: 6c75 6573 2069 6e20 6865 6164 6572 0a20  lues in header. 
+00015d80: 2020 2020 2020 2063 6f6e 7374 5f76 616c         const_val
+00015d90: 7565 7320 3d20 7b7d 0a20 2020 2020 2020  ues = {}.       
+00015da0: 2066 6f72 206e 6176 4669 656c 6420 696e   for navField in
+00015db0: 206d 6971 7476 2e70 6f73 5f68 6561 6465   miqtv.pos_heade
+00015dc0: 725b 276d 6172 6971 7427 5d3a 0a20 2020  r['mariqt']:.   
+00015dd0: 2020 2020 2020 2020 2072 6573 7065 6374           respect
+00015de0: 6976 6548 6561 6465 7246 6965 6c64 203d  iveHeaderField =
+00015df0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00015e00: 725b 226d 6172 6971 7422 5d5b 6e61 7646  r["mariqt"][navF
+00015e10: 6965 6c64 5d0a 2020 2020 2020 2020 2020  ield].          
+00015e20: 2020 6966 206e 6176 4669 656c 6420 6e6f    if navField no
+00015e30: 7420 696e 206e 6176 5f68 6561 6465 7220  t in nav_header 
+00015e40: 616e 6420 2872 6573 7065 6374 6976 6548  and (respectiveH
+00015e50: 6561 6465 7246 6965 6c64 2069 6e20 7365  eaderField in se
+00015e60: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00015e70: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00015e80: 6579 5d20 616e 6420 7365 6c66 2e66 696e  ey] and self.fin
+00015e90: 6454 6d70 4669 656c 6432 2872 6573 7065  dTmpField2(respe
+00015ea0: 6374 6976 6548 6561 6465 7246 6965 6c64  ctiveHeaderField
+00015eb0: 2920 213d 2022 2229 3a20 0a20 2020 2020  ) != ""): .     
+00015ec0: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+00015ed0: 5f76 616c 7565 735b 6e61 7646 6965 6c64  _values[navField
+00015ee0: 5d20 3d20 7365 6c66 2e66 696e 6454 6d70  ] = self.findTmp
+00015ef0: 4669 656c 6428 7265 7370 6563 7469 7665  Field(respective
+00015f00: 4865 6164 6572 4669 656c 6429 0a0a 2020  HeaderField)..  
+00015f10: 2020 2020 2020 2320 4c6f 6164 206e 6176        # Load nav
+00015f20: 6967 6174 696f 6e20 6461 7461 0a20 2020  igation data.   
+00015f30: 2020 2020 206e 6176 5f64 6174 612c 2070       nav_data, p
+00015f40: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
+00015f50: 7265 6164 416c 6c50 6f73 6974 696f 6e73  readAllPositions
+00015f60: 4672 6f6d 4669 6c65 5061 7468 286e 6176  FromFilePath(nav
+00015f70: 5f70 6174 682c 206e 6176 5f68 6561 6465  _path, nav_heade
+00015f80: 722c 2064 6174 655f 666f 726d 6174 2c63  r, date_format,c
+00015f90: 6f6c 5f73 6570 6172 6174 6f72 3d63 6f6c  ol_separator=col
+00015fa0: 5f73 6570 6172 6174 6f72 2c63 6f6e 7374  _separator,const
+00015fb0: 5f76 616c 7565 733d 636f 6e73 745f 7661  _values=const_va
+00015fc0: 6c75 6573 290a 2020 2020 2020 2020 6966  lues).        if
+00015fd0: 2070 6172 7365 4d73 6720 213d 2022 223a   parseMsg != "":
+00015fe0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015ff0: 662e 7072 6f76 2e6c 6f67 2870 6172 7365  f.prov.log(parse
+00016000: 4d73 672c 646f 6e74 5368 6f77 3d54 7275  Msg,dontShow=Tru
+00016010: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+00016020: 6574 7572 6e4d 7367 203d 2022 5c6e 2220  eturnMsg = "\n" 
+00016030: 2b20 7061 7273 654d 7367 0a0a 2020 2020  + parseMsg..    
+00016040: 2020 2020 2320 6669 6e64 2066 6f72 2065      # find for e
+00016050: 6163 6820 696d 6167 6520 7468 6520 7265  ach image the re
+00016060: 7370 6563 7469 7665 206e 6176 6967 6174  spective navigat
+00016070: 696f 6e20 6461 7461 0a20 2020 2020 2020  ion data.       
+00016080: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+00016090: 2020 7375 6363 6573 732c 2069 6d61 6765    success, image
+000160a0: 5f64 7473 2c20 6d73 6720 3d20 7365 6c66  _dts, msg = self
+000160b0: 2e66 696e 644e 6176 4461 7461 466f 7249  .findNavDataForI
+000160c0: 6d61 6765 286e 6176 5f64 6174 612c 7669  mage(nav_data,vi
+000160d0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+000160e0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+000160f0: 726f 762e 6c6f 6728 6d73 672c 646f 6e74  rov.log(msg,dont
+00016100: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+00016110: 2020 2069 6620 6d73 6720 213d 2022 223a     if msg != "":
+00016120: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00016130: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
+00016140: 206d 7367 0a20 2020 2020 2020 2069 6620   msg.        if 
+00016150: 6e6f 7420 7375 6363 6573 733a 0a20 2020  not success:.   
+00016160: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016170: 4661 6c73 652c 2072 6574 7572 6e4d 7367  False, returnMsg
+00016180: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
+00016190: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
+000161a0: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
+000161b0: 6d73 2720 6e61 7669 6761 7469 6f6e 2064  ms' navigation d
+000161c0: 6174 6122 290a 0a20 2020 2020 2020 2023  ata")..        #
+000161d0: 2063 6f6d 7065 6e73 6174 6520 6c65 7665   compensate leve
+000161e0: 7261 726d 206f 6666 7365 7473 0a20 2020  rarm offsets.   
+000161f0: 2020 2020 2069 6620 636f 6d70 656e 7361       if compensa
+00016200: 744f 6666 7365 7473 3a0a 0a20 2020 2020  tOffsets:..     
+00016210: 2020 2020 2020 2023 206c 6f61 6420 6672         # load fr
+00016220: 616d 6520 6174 7469 7475 6465 2064 6174  ame attitude dat
+00016230: 6120 6672 6f6d 2066 696c 650a 2020 2020  a from file.    
+00016240: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
+00016250: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
+00016260: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
+00016270: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
+00016280: 6e61 765f 7061 7468 2c20 6e61 765f 6865  nav_path, nav_he
+00016290: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
+000162a0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
+000162b0: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
+000162c0: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
+000162d0: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
+000162e0: 5261 643d 616e 676c 6573 5f69 6e5f 7261  Rad=angles_in_ra
+000162f0: 6429 0a20 2020 2020 2020 2020 2020 2069  d).            i
+00016300: 6620 7061 7273 654d 7367 2021 3d20 2222  f parseMsg != ""
+00016310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016320: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00016330: 7061 7273 654d 7367 2c64 6f6e 7453 686f  parseMsg,dontSho
+00016340: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+00016350: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
+00016360: 6720 2b3d 2022 5c6e 2220 2b20 7061 7273  g += "\n" + pars
+00016370: 654d 7367 0a0a 2020 2020 2020 2020 2020  eMsg..          
+00016380: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
+00016390: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
+000163a0: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
+000163b0: 6e20 6461 7461 0a20 2020 2020 2020 2020  n data.         
+000163c0: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
+000163d0: 655f 6474 735f 6174 742c 206d 7367 203d  e_dts_att, msg =
+000163e0: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
+000163f0: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
+00016400: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
+00016410: 636f 6e64 7329 0a20 2020 2020 2020 2020  conds).         
+00016420: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00016430: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
+00016440: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00016450: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
+00016460: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016470: 7475 726e 4d73 6720 2b3d 2022 5c6e 2220  turnMsg += "\n" 
+00016480: 2b20 6d73 670a 2020 2020 2020 2020 2020  + msg.          
+00016490: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
+000164a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000164b0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+000164c0: 7265 7475 726e 4d73 670a 0a20 2020 2020  returnMsg..     
+000164d0: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
+000164e0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
+000164f0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00016500: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+00016510: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00016520: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
+00016530: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00016540: 2020 2061 7474 6974 7564 6573 203d 2069     attitudes = i
+00016550: 6d61 6765 5f64 7473 5f61 7474 5b66 696c  mage_dts_att[fil
+00016560: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00016570: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00016580: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
+00016590: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000165a0: 2020 2020 2020 206c 6174 203d 2070 6f73         lat = pos
+000165b0: 6974 696f 6e73 5b69 5d2e 6c61 740a 2020  itions[i].lat.  
+000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165d0: 2020 6c6f 6e20 3d20 706f 7369 7469 6f6e    lon = position
+000165e0: 735b 695d 2e6c 6f6e 0a20 2020 2020 2020  s[i].lon.       
+000165f0: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+00016600: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
+00016610: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
+00016620: 2020 2020 2020 2020 6966 2027 616c 7427          if 'alt'
+00016630: 2069 6e20 6e61 765f 6865 6164 6572 2061   in nav_header a
+00016640: 6e64 206e 6f74 2027 6465 7027 2069 6e20  nd not 'dep' in 
+00016650: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+00016660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016670: 2020 2020 6465 7020 2a3d 202d 310a 2020      dep *= -1.  
+00016680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016690: 2020 7961 7720 3d20 6174 7469 7475 6465    yaw = attitude
+000166a0: 735b 695d 2e79 6177 0a20 2020 2020 2020  s[i].yaw.       
+000166b0: 2020 2020 2020 2020 2020 2020 2070 6974               pit
+000166c0: 6368 203d 2061 7474 6974 7564 6573 5b69  ch = attitudes[i
+000166d0: 5d2e 7069 7463 680a 2020 2020 2020 2020  ].pitch.        
+000166e0: 2020 2020 2020 2020 2020 2020 726f 6c6c              roll
+000166f0: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
+00016700: 726f 6c6c 0a20 2020 2020 2020 2020 2020  roll.           
+00016710: 2020 2020 2020 2020 2069 6620 7961 7720           if yaw 
+00016720: 6973 204e 6f6e 6520 6f72 2070 6974 6368  is None or pitch
+00016730: 2069 7320 4e6f 6e65 206f 7220 726f 6c6c   is None or roll
+00016740: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00016750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016760: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00016770: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00016780: 6577 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e  ew_lat,new_lon,n
+00016790: 6577 5f64 6570 203d 206d 6971 7467 2e61  ew_dep = miqtg.a
+000167a0: 6464 4c65 7665 7261 726d 7332 4c61 746c  ddLeverarms2Latl
+000167b0: 6f6e 286c 6174 2c6c 6f6e 2c64 6570 2c6f  on(lat,lon,dep,o
+000167c0: 6666 7365 745f 782c 6f66 6673 6574 5f79  ffset_x,offset_y
+000167d0: 2c6f 6666 7365 745f 7a2c 7961 772c 7069  ,offset_z,yaw,pi
+000167e0: 7463 682c 726f 6c6c 290a 2020 2020 2020  tch,roll).      
+000167f0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00016800: 7369 7469 6f6e 735b 695d 2e6c 6174 203d  sitions[i].lat =
+00016810: 206e 6577 5f6c 6174 0a20 2020 2020 2020   new_lat.       
+00016820: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00016830: 6974 696f 6e73 5b69 5d2e 6c6f 6e20 3d20  itions[i].lon = 
+00016840: 6e65 775f 6c6f 6e0a 2020 2020 2020 2020  new_lon.        
+00016850: 2020 2020 2020 2020 2020 2020 706f 7369              posi
+00016860: 7469 6f6e 735b 695d 2e64 6570 203d 206e  tions[i].dep = n
+00016870: 6577 5f64 6570 0a0a 2020 2020 2020 2020  ew_dep..        
+00016880: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00016890: 6728 2261 7070 6c69 6564 206c 6576 6572  g("applied lever
+000168a0: 2061 726d 2063 6f6d 7065 6e73 6174 696f   arm compensatio
+000168b0: 6e20 782c 792c 7a20 3d20 2220 2b20 7374  n x,y,z = " + st
+000168c0: 7228 6f66 6673 6574 5f78 2920 2b20 222c  r(offset_x) + ",
+000168d0: 2220 2b20 7374 7228 6f66 6673 6574 5f79  " + str(offset_y
+000168e0: 2920 2b20 222c 2220 2b20 7374 7228 6f66  ) + "," + str(of
+000168f0: 6673 6574 5f7a 292c 646f 6e74 5368 6f77  fset_z),dontShow
+00016900: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
+00016910: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
+00016920: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+00016930: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
+00016940: 6572 2064 6570 7468 2061 6e64 2068 6569  er depth and hei
+00016950: 6768 7420 6172 6520 7365 740a 2020 2020  ght are set.    
+00016960: 2020 2020 2020 2020 6c61 745f 6964 656e          lat_iden
+00016970: 7469 6361 6c2c 206c 6f6e 5f69 6465 6e74  tical, lon_ident
+00016980: 6963 616c 2c20 6465 705f 6964 656e 7469  ical, dep_identi
+00016990: 6361 6c2c 2068 6774 5f69 6465 6e74 6963  cal, hgt_identic
+000169a0: 616c 2c20 6465 705f 6e6f 745f 7a65 726f  al, dep_not_zero
+000169b0: 2c20 6867 745f 6e6f 745f 7a65 726f 2c75  , hgt_not_zero,u
+000169c0: 6e63 6572 745f 6e6f 745f 7a65 726f 203d  ncert_not_zero =
+000169d0: 206e 6176 5f64 6174 612e 6368 6563 6b50   nav_data.checkP
+000169e0: 6f73 6974 696f 6e73 436f 6e74 656e 7428  ositionsContent(
+000169f0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00016a00: 2057 7269 7465 2074 6f20 6e61 7669 6761   Write to naviga
+00016a10: 7469 6f6e 2074 7874 2066 696c 650a 2020  tion txt file.  
+00016a20: 2020 2020 2020 2020 2020 2320 6865 6164            # head
+00016a30: 6572 0a20 2020 2020 2020 2020 2020 2072  er.            r
+00016a40: 6573 203d 206f 7065 6e28 7365 6c66 2e67  es = open(self.g
+00016a50: 6574 5f69 6e74 5f6e 6176 5f66 696c 6528  et_int_nav_file(
+00016a60: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
+00016a70: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
+00016a80: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00016a90: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
+00016aa0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00016ab0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00016ac0: 2775 7463 275d 290a 0a20 2020 2020 2020  'utc'])..       
+00016ad0: 2020 2020 2068 6173 5f61 6c74 203d 2054       has_alt = T
+00016ae0: 7275 6520 6966 2064 6570 5f6e 6f74 5f7a  rue if dep_not_z
+00016af0: 6572 6f20 616e 6420 2820 2764 6570 2720  ero and ( 'dep' 
+00016b00: 696e 206e 6176 5f68 6561 6465 7220 6f72  in nav_header or
+00016b10: 2027 616c 7427 2069 6e20 6e61 765f 6865   'alt' in nav_he
+00016b20: 6164 6572 2029 2065 6c73 6520 4661 6c73  ader ) else Fals
+00016b30: 650a 0a20 2020 2020 2020 2020 2020 2069  e..            i
+00016b40: 6620 276c 6174 2720 696e 206e 6176 5f68  f 'lat' in nav_h
+00016b50: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
+00016b60: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00016b70: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00016b80: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00016b90: 5b27 6c61 7427 5d29 0a20 2020 2020 2020  ['lat']).       
+00016ba0: 2020 2020 2069 6620 276c 6f6e 2720 696e       if 'lon' in
+00016bb0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
+00016bc0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00016bd0: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+00016be0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00016bf0: 7269 7174 275d 5b27 6c6f 6e27 5d29 0a20  riqt']['lon']). 
+00016c00: 2020 2020 2020 2020 2020 2069 6620 6861             if ha
+00016c10: 735f 616c 743a 0a20 2020 2020 2020 2020  s_alt:.         
+00016c20: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00016c30: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00016c40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00016c50: 5b27 616c 7427 5d29 0a20 2020 2020 2020  ['alt']).       
+00016c60: 2020 2020 2069 6620 6867 745f 6e6f 745f       if hgt_not_
+00016c70: 7a65 726f 2061 6e64 2027 6867 7427 2069  zero and 'hgt' i
+00016c80: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00016c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016ca0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
+00016cb0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00016cc0: 6172 6971 7427 5d5b 2768 6774 275d 290a  ariqt']['hgt']).
+00016cd0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+00016ce0: 6e63 6572 745f 6e6f 745f 7a65 726f 2061  ncert_not_zero a
+00016cf0: 6e64 2027 756e 6365 7274 2720 696e 206e  nd 'uncert' in n
+00016d00: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
+00016d10: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00016d20: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
+00016d30: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00016d40: 7174 275d 5b27 756e 6365 7274 275d 290a  qt']['uncert']).
+00016d50: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00016d60: 7772 6974 6528 225c 6e22 290a 2020 2020  write("\n").    
+00016d70: 2020 2020 2020 2020 2320 6461 7461 206c          # data l
+00016d80: 696e 6573 0a20 2020 2020 2020 2020 2020  ines.           
+00016d90: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+00016da0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+00016db0: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
+00016dc0: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
+00016dd0: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
+00016de0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016df0: 732e 7772 6974 6528 6669 6c65 2b22 5c74  s.write(file+"\t
+00016e00: 222b 7469 6d65 706f 696e 742e 6461 7465  "+timepoint.date
+00016e10: 5469 6d65 2829 2e73 7472 6674 696d 6528  Time().strftime(
+00016e20: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+00016e30: 7473 5b27 6d61 7269 7174 275d 2929 200a  ts['mariqt'])) .
+00016e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e50: 2020 2020 6966 2027 6c61 7427 2069 6e20      if 'lat' in 
+00016e60: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
+00016e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e80: 2020 2020 7661 6c20 3d20 7469 6d65 706f      val = timepo
+00016e90: 696e 742e 6c61 740a 2020 2020 2020 2020  int.lat.        
+00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016eb0: 6966 2027 6c61 7427 2069 6e20 7265 636f  if 'lat' in reco
+00016ec0: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
 00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 2020 7661 6c20 2a3d 202d 310a 2020      val *= -1.  
-00016ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f00: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00016f10: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
-00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f30: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
-00016f40: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-00016f50: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
-00016f60: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00016f70: 746f 2067 656f 6a73 6f6e 2066 696c 650a  to geojson file.
-00016f80: 2020 2020 2020 2020 2020 2020 6765 6f6a              geoj
-00016f90: 736f 6e20 3d20 7b27 7479 7065 273a 2027  son = {'type': '
-00016fa0: 4665 6174 7572 6543 6f6c 6c65 6374 696f  FeatureCollectio
-00016fb0: 6e27 2c20 276e 616d 6527 3a20 7365 6c66  n', 'name': self
-00016fc0: 2e64 6972 2e65 7665 6e74 2829 2b22 5f22  .dir.event()+"_"
-00016fd0: 2b73 656c 662e 6469 722e 7365 6e73 6f72  +self.dir.sensor
-00016fe0: 2829 2b22 5f69 6d61 6765 2d6e 6176 6967  ()+"_image-navig
-00016ff0: 6174 696f 6e22 2c20 2766 6561 7475 7265  ation", 'feature
-00017000: 7327 3a20 5b5d 7d0a 2020 2020 2020 2020  s': []}.        
-00017010: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00017020: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00017030: 2020 2020 2020 2020 2020 2023 2070 686f             # pho
-00017040: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
-00017050: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
-00017060: 6474 735b 6669 6c65 5d29 203d 3d20 313a  dts[file]) == 1:
-00017070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017080: 2020 2020 2069 6620 6465 705f 6e6f 745f       if dep_not_
-00017090: 7a65 726f 3a0a 2020 2020 2020 2020 2020  zero:.          
-000170a0: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-000170b0: 6f6d 6574 7279 203d 2020 7b27 7479 7065  ometry =  {'type
-000170c0: 273a 2022 506f 696e 7422 2c20 2763 6f6f  ': "Point", 'coo
-000170d0: 7264 696e 6174 6573 273a 200a 2020 2020  rdinates': .    
-000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+00016ef0: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+00016f00: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016f10: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
+00016f20: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
+00016f30: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
+00016f40: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
+00016f50: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00016f60: 2020 2020 2020 2020 2020 2076 616c 203d             val =
+00016f70: 2074 696d 6570 6f69 6e74 2e6c 6f6e 0a20   timepoint.lon. 
+00016f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f90: 2020 2020 2020 2069 6620 276c 6f6e 2720         if 'lon' 
+00016fa0: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
+00016fb0: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fd0: 2020 2076 616c 202a 3d20 2d31 0a20 2020     val *= -1.   
+00016fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ff0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00017000: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
+00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017020: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
+00017030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017040: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
+00017050: 706f 696e 742e 6465 700a 2020 2020 2020  point.dep.      
+00017060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017070: 2020 6966 2027 6465 7027 2069 6e20 6e61    if 'dep' in na
+00017080: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00017090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170a0: 2020 2020 2020 7661 6c20 2a3d 202d 310a        val *= -1.
+000170b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170c0: 2020 2020 2020 2020 2020 2020 6966 2027              if '
+000170d0: 6465 7027 2069 6e20 7265 636f 7264 7332  dep' in records2
+000170e0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
 000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017100: 2020 2020 5b66 6c6f 6174 2869 6d61 6765      [float(image
-00017110: 5f64 7473 5b66 696c 655d 5b30 5d2e 6c6f  _dts[file][0].lo
-00017120: 6e29 2c20 666c 6f61 7428 696d 6167 655f  n), float(image_
-00017130: 6474 735b 6669 6c65 5d5b 305d 2e6c 6174  dts[file][0].lat
-00017140: 292c 2066 6c6f 6174 2869 6d61 6765 5f64  ), float(image_d
-00017150: 7473 5b66 696c 655d 5b30 5d2e 6465 7029  ts[file][0].dep)
-00017160: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017100: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
+00017110: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+00017120: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00017130: 6966 2020 2761 6c74 2720 696e 206e 6176  if  'alt' in nav
+00017140: 5f68 6561 6465 7220 616e 6420 2761 6c74  _header and 'alt
+00017150: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
+00017160: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
 00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00017190: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000171a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000171b0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
-000171c0: 7279 203d 2020 7b27 7479 7065 273a 2022  ry =  {'type': "
-000171d0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
-000171e0: 6174 6573 273a 200a 2020 2020 2020 2020  ates': .        
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017180: 2020 2020 2076 616c 202a 3d20 2d31 0a20       val *= -1. 
+00017190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000171b0: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
+000171c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171d0: 2020 2020 6966 2068 6774 5f6e 6f74 5f7a      if hgt_not_z
+000171e0: 6572 6f20 616e 6420 2768 6774 2720 696e  ero and 'hgt' in
+000171f0: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
 00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017210: 5b66 6c6f 6174 2869 6d61 6765 5f64 7473  [float(image_dts
-00017220: 5b66 696c 655d 5b30 5d2e 6c6f 6e29 2c20  [file][0].lon), 
-00017230: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-00017240: 6669 6c65 5d5b 305d 2e6c 6174 295d 0a20  file][0].lat)]. 
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017270: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00017280: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00017290: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
-000172a0: 7829 2066 6f72 2078 2069 6e20 6765 6f6d  x) for x in geom
-000172b0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
-000172c0: 7327 5d5d 3a0a 2020 2020 2020 2020 2020  s']]:.          
-000172d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000172e0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-000172f0: 2020 2020 2020 2020 2320 7669 6465 6f0a          # video.
+00017210: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
+00017220: 6f69 6e74 2e68 6774 0a20 2020 2020 2020  oint.hgt.       
+00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017240: 2069 6620 2768 6774 2720 696e 2072 6563   if 'hgt' in rec
+00017250: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
+00017260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017270: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00017280: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+00017290: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000172a0: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
+000172b0: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
+000172c0: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+000172d0: 6e63 6572 745f 6e6f 745f 7a65 726f 2061  ncert_not_zero a
+000172e0: 6e64 2027 756e 6365 7274 2720 696e 206e  nd 'uncert' in n
+000172f0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
 00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017310: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00017320: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
-00017330: 5f6e 6f74 5f7a 6572 6f3a 0a20 2020 2020  _not_zero:.     
-00017340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017350: 2020 2067 656f 6d65 7472 7920 3d20 207b     geometry =  {
-00017360: 2774 7970 6527 3a20 224d 756c 7469 506f  'type': "MultiPo
-00017370: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
-00017380: 6573 273a 0a20 2020 2020 2020 2020 2020  es':.           
+00017310: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
+00017320: 6e74 2e75 6e63 6572 740a 2020 2020 2020  nt.uncert.      
+00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017340: 2020 6966 2027 756e 6365 7274 2720 696e    if 'uncert' in
+00017350: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00017360: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
+00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
 00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 2020 2020 2020 2020 2020 2020 205b 5b66               [[f
-000173b0: 6c6f 6174 2864 2e6c 6f6e 292c 2066 6c6f  loat(d.lon), flo
-000173c0: 6174 2864 2e6c 6174 292c 2066 6c6f 6174  at(d.lat), float
-000173d0: 2864 2e64 6570 295d 2066 6f72 2064 2069  (d.dep)] for d i
-000173e0: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-000173f0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017410: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00017420: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00017430: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00017440: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-00017450: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
-00017460: 224d 756c 7469 506f 696e 7422 2c20 2763  "MultiPoint", 'c
-00017470: 6f6f 7264 696e 6174 6573 273a 0a20 2020  oordinates':.   
-00017480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174a0: 2020 2020 205b 5b66 6c6f 6174 2864 2e6c       [[float(d.l
-000174b0: 6f6e 292c 2066 6c6f 6174 2864 2e6c 6174  on), float(d.lat
-000174c0: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
-000174d0: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
+000173a0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+000173b0: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173d0: 7265 732e 7772 6974 6528 225c 6e22 290a  res.write("\n").
+000173e0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+000173f0: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
+00017400: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
+00017410: 6765 6f6a 736f 6e20 6669 6c65 0a20 2020  geojson file.   
+00017420: 2020 2020 2020 2020 2067 656f 6a73 6f6e           geojson
+00017430: 203d 207b 2774 7970 6527 3a20 2746 6561   = {'type': 'Fea
+00017440: 7475 7265 436f 6c6c 6563 7469 6f6e 272c  tureCollection',
+00017450: 2027 6e61 6d65 273a 2073 656c 662e 6469   'name': self.di
+00017460: 722e 6576 656e 7428 292b 225f 222b 7365  r.event()+"_"+se
+00017470: 6c66 2e64 6972 2e73 656e 736f 7228 292b  lf.dir.sensor()+
+00017480: 225f 696d 6167 652d 6e61 7669 6761 7469  "_image-navigati
+00017490: 6f6e 222c 2027 6665 6174 7572 6573 273a  on", 'features':
+000174a0: 205b 5d7d 0a20 2020 2020 2020 2020 2020   []}.           
+000174b0: 2066 6f72 2066 696c 6520 696e 2069 6d61   for file in ima
+000174c0: 6765 5f64 7473 3a0a 2020 2020 2020 2020  ge_dts:.        
+000174d0: 2020 2020 2020 2020 2320 7068 6f74 6f0a          # photo.
 000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017500: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-00017510: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
-00017520: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
-00017530: 2066 6f72 2078 2069 6e20 5b69 7465 6d20   for x in [item 
-00017540: 666f 7220 7375 626c 6973 7420 696e 2067  for sublist in g
-00017550: 656f 6d65 7472 795b 2763 6f6f 7264 696e  eometry['coordin
-00017560: 6174 6573 275d 2066 6f72 2069 7465 6d20  ates'] for item 
-00017570: 696e 2073 7562 6c69 7374 5d5d 3a0a 2020  in sublist]]:.  
+000174f0: 6966 206c 656e 2869 6d61 6765 5f64 7473  if len(image_dts
+00017500: 5b66 696c 655d 2920 3d3d 2031 3a0a 2020  [file]) == 1:.  
+00017510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017520: 2020 6966 2064 6570 5f6e 6f74 5f7a 6572    if dep_not_zer
+00017530: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
+00017540: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
+00017550: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
+00017560: 2250 6f69 6e74 222c 2027 636f 6f72 6469  "Point", 'coordi
+00017570: 6e61 7465 7327 3a20 0a20 2020 2020 2020  nates': .       
 00017580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017590: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-000175a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175b0: 6765 6f6a 736f 6e5b 2766 6561 7475 7265  geojson['feature
-000175c0: 7327 5d2e 6170 7065 6e64 287b 2774 7970  s'].append({'typ
-000175d0: 6527 3a20 2746 6561 7475 7265 272c 2027  e': 'Feature', '
-000175e0: 7072 6f70 6572 7469 6573 273a 207b 2769  properties': {'i
-000175f0: 6427 3a20 6669 6c65 7d2c 2027 6765 6f6d  d': file}, 'geom
-00017600: 6574 7279 273a 2067 656f 6d65 7472 7920  etry': geometry 
-00017610: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00017620: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00017630: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
-00017640: 745f 696e 745f 6e61 765f 6669 6c65 2829  t_int_nav_file()
-00017650: 2e72 6570 6c61 6365 2822 2e74 7874 222c  .replace(".txt",
-00017660: 2022 2e67 656f 6a73 6f6e 2229 2c0a 2020   ".geojson"),.  
-00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017680: 2020 2022 7722 2c20 6572 726f 7273 3d22     "w", errors="
-00017690: 6967 6e6f 7265 222c 2065 6e63 6f64 696e  ignore", encodin
-000176a0: 673d 2775 7466 2d38 2729 0a20 2020 2020  g='utf-8').     
-000176b0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
-000176c0: 2867 656f 6a73 6f6e 2c20 6f2c 2065 6e73  (geojson, o, ens
-000176d0: 7572 655f 6173 6369 693d 4661 6c73 652c  ure_ascii=False,
-000176e0: 2069 6e64 656e 743d 3429 0a20 2020 2020   indent=4).     
-000176f0: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
-00017700: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00017710: 6c66 2e70 726f 762e 6164 6441 7267 756d  lf.prov.addArgum
-00017720: 656e 7428 2269 6e70 7574 4e61 7669 6761  ent("inputNaviga
-00017730: 7469 6f6e 4669 6c65 222c 6e61 765f 7061  tionFile",nav_pa
-00017740: 7468 2c6f 7665 7277 7269 7465 3d54 7275  th,overwrite=Tru
-00017750: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00017760: 656c 662e 7072 6f76 2e6c 6f67 2822 7061  elf.prov.log("pa
-00017770: 7273 6564 2066 726f 6d20 696e 7075 744e  rsed from inputN
-00017780: 6176 6967 6174 696f 6e46 696c 653a 2022  avigationFile: "
-00017790: 202b 2073 7472 286e 6176 5f68 6561 6465   + str(nav_heade
-000177a0: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
-000177b0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
-000177c0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
-000177d0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-000177e0: 224e 6176 6967 6174 696f 6e20 6461 7461  "Navigation data
-000177f0: 2063 7265 6174 6564 2220 2b20 7265 7475   created" + retu
-00017800: 726e 4d73 670a 2020 2020 2020 2020 656c  rnMsg.        el
-00017810: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017820: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00017830: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00017840: 652c 2022 4e6f 2069 6d61 6765 2063 6f6f  e, "No image coo
-00017850: 7264 696e 6174 6573 2066 6f75 6e64 2220  rdinates found" 
-00017860: 2b20 7265 7475 726e 4d73 670a 0a20 2020  + returnMsg..   
-00017870: 2064 6566 2063 7265 6174 6549 6d61 6765   def createImage
-00017880: 4e61 7669 6761 7469 6f6e 4669 6c65 2873  NavigationFile(s
-00017890: 656c 662c 206e 6176 5f70 6174 683a 2073  elf, nav_path: s
-000178a0: 7472 2c20 6e61 765f 6865 6164 6572 3d6d  tr, nav_header=m
-000178b0: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
-000178c0: 2770 616e 6761 6561 275d 2c20 6461 7465  'pangaea'], date
-000178d0: 5f66 6f72 6d61 743d 6d69 7174 762e 6461  _format=miqtv.da
-000178e0: 7465 5f66 6f72 6d61 7473 5b27 7061 6e67  te_formats['pang
-000178f0: 6165 6127 5d2c 206f 7665 7277 7269 7465  aea'], overwrite
-00017900: 3d46 616c 7365 2c20 636f 6c5f 7365 7061  =False, col_sepa
-00017910: 7261 746f 7220 3d20 225c 7422 2c20 7669  rator = "\t", vi
-00017920: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00017930: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
-00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017950: 2020 2020 2020 2020 6f66 6673 6574 5f78          offset_x
-00017960: 3d30 2c20 6f66 6673 6574 5f79 3d30 2c20  =0, offset_y=0, 
-00017970: 6f66 6673 6574 5f7a 3d30 2c61 6e67 6c65  offset_z=0,angle
-00017980: 735f 696e 5f72 6164 203d 2046 616c 7365  s_in_rad = False
-00017990: 2c20 7265 636f 7264 7332 6265 496e 7665  , records2beInve
-000179a0: 7274 6564 3d5b 5d29 3a0a 2020 2020 2020  rted=[]):.      
-000179b0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
-000179c0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
-000179d0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
-000179e0: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-000179f0: 7365 6c66 2e63 7265 6174 655f 696d 6167  self.create_imag
-00017a00: 655f 6e61 7669 6761 7469 6f6e 5f66 696c  e_navigation_fil
-00017a10: 6528 6e61 765f 7061 7468 2c20 6e61 765f  e(nav_path, nav_
-00017a20: 6865 6164 6572 2c20 6461 7465 5f66 6f72  header, date_for
-00017a30: 6d61 742c 206f 7665 7277 7269 7465 2c20  mat, overwrite, 
-00017a40: 636f 6c5f 7365 7061 7261 746f 722c 2076  col_separator, v
-00017a50: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-00017a60: 732c 206f 6666 7365 745f 782c 206f 6666  s, offset_x, off
-00017a70: 7365 745f 792c 206f 6666 7365 745f 7a2c  set_y, offset_z,
-00017a80: 2061 6e67 6c65 735f 696e 5f72 6164 2c20   angles_in_rad, 
-00017a90: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00017aa0: 6564 290a 0a0a 2020 2020 6465 6620 6372  ed)...    def cr
-00017ab0: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
-00017ac0: 365f 6669 6c65 2873 656c 662c 7265 5265  6_file(self,reRe
-00017ad0: 6164 416c 6c3d 5472 7565 293a 0a20 2020  adAll=True):.   
-00017ae0: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
-00017af0: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
-00017b00: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
-00017b10: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
-00017b20: 6765 2069 7473 2053 4841 3235 3620 6861  ge its SHA256 ha
-00017b30: 7368 2e0a 2020 2020 2020 2020 2020 2020  sh..            
-00017b40: 4966 2072 6552 6561 6441 6c6c 2069 7320  If reReadAll is 
-00017b50: 5472 7565 2061 6c6c 2069 6d61 6765 7327  True all images'
-00017b60: 2068 6173 6865 7320 6172 6520 6465 7465   hashes are dete
-00017b70: 726d 696e 6564 2e20 4f74 6865 7277 6973  rmined. Otherwis
-00017b80: 6520 6f6e 6c79 2066 6f72 2074 686f 7365  e only for those
-00017b90: 2066 696c 6573 0a20 2020 2020 2020 2020   files.         
-00017ba0: 2020 2077 6869 6368 2061 7265 206e 6f74     which are not
-00017bb0: 2079 6574 2069 6e20 7468 6520 696e 7465   yet in the inte
-00017bc0: 726d 6564 6961 7465 2066 696c 6520 636f  rmediate file co
-00017bd0: 6e74 6169 6e69 6e67 2074 6865 2069 6d61  ntaining the ima
-00017be0: 6765 2068 6173 6865 7320 2022 2222 0a20  ge hashes  """. 
-00017bf0: 2020 2020 2020 2068 6173 6865 7320 3d20         hashes = 
-00017c00: 7b7d 0a20 2020 2020 2020 2069 6620 6f73  {}.        if os
-00017c10: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00017c20: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
-00017c30: 696c 6528 2929 3a0a 2020 2020 2020 2020  ile()):.        
-00017c40: 2020 2020 6861 7368 6573 203d 206d 6971      hashes = miq
-00017c50: 7466 2e74 6162 4669 6c65 4461 7461 2873  tf.tabFileData(s
-00017c60: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
-00017c70: 5f66 696c 6528 292c 205b 6d69 7174 762e  _file(), [miqtv.
-00017c80: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00017c90: 7174 275d 5b27 696d 6727 5d2c 206d 6971  qt']['img'], miq
-00017ca0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00017cb0: 6172 6971 7427 5d5b 2768 6173 6827 5d5d  ariqt']['hash']]
-00017cc0: 2c20 6b65 795f 636f 6c3d 6d69 7174 762e  , key_col=miqtv.
-00017cd0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00017ce0: 7174 275d 5b27 696d 6727 5d29 0a0a 2020  qt']['img'])..  
-00017cf0: 2020 2020 2020 696d 6167 6573 496e 5261        imagesInRa
-00017d00: 7720 3d20 7365 6c66 2e69 6d61 6765 7349  w = self.imagesI
-00017d10: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-00017d20: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-00017d30: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
-00017d40: 2020 2020 2020 2020 2020 2061 6464 6564             added
-00017d50: 5f68 6173 6865 7320 3d20 300a 2020 2020  _hashes = 0.    
-00017d60: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00017d70: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00017d80: 726f 6772 6573 734d 7367 2822 4368 6563  rogressMsg("Chec
-00017d90: 6b69 6e67 2068 6173 6865 7322 2c20 6c65  king hashes", le
-00017da0: 6e28 696d 6167 6573 496e 5261 7729 2c6d  n(imagesInRaw),m
-00017db0: 6f64 756c 6f3d 3529 0a20 2020 2020 2020  odulo=5).       
-00017dc0: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-00017dd0: 2069 6d61 6765 7349 6e52 6177 3a0a 2020   imagesInRaw:.  
-00017de0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00017df0: 6f67 2e70 726f 6772 6573 7328 290a 0a20  og.progress().. 
-00017e00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017e10: 6620 6e6f 7420 7365 6c66 2e5f 5f61 6c6c  f not self.__all
-00017e20: 5555 4944 7343 6865 636b 6564 2061 6e64  UUIDsChecked and
-00017e30: 206e 6f74 206d 6971 7469 2e69 6d61 6765   not miqti.image
-00017e40: 436f 6e74 6169 6e73 5661 6c69 6455 5549  ContainsValidUUI
-00017e50: 4428 6669 6c65 295b 305d 3a0a 2020 2020  D(file)[0]:.    
-00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e70: 2320 7265 6d6f 7665 2066 726f 6d20 7575  # remove from uu
-00017e80: 6964 2066 696c 650a 2020 2020 2020 2020  id file.        
-00017e90: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00017ea0: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
-00017eb0: 6c66 2e67 6574 5f69 6e74 5f75 7569 645f  lf.get_int_uuid_
-00017ec0: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-00017ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ee0: 2072 6573 203d 206f 7065 6e28 7365 6c66   res = open(self
-00017ef0: 2e67 6574 5f69 6e74 5f75 7569 645f 6669  .get_int_uuid_fi
-00017f00: 6c65 2829 2c20 2272 2229 0a20 2020 2020  le(), "r").     
-00017f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f20: 2020 206c 696e 6573 203d 2072 6573 2e72     lines = res.r
-00017f30: 6561 646c 696e 6573 2829 0a20 2020 2020  eadlines().     
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2072 6573 2e63 6c6f 7365 2829 0a20     res.close(). 
-00017f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f70: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00017f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f90: 206c 696e 6573 203d 205b 5d0a 2020 2020   lines = [].    
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fb0: 6920 3d20 300a 2020 2020 2020 2020 2020  i = 0.          
-00017fc0: 2020 2020 2020 2020 2020 6c69 6e65 4e72            lineNr
-00017fd0: 203d 2069 0a20 2020 2020 2020 2020 2020   = i.           
-00017fe0: 2020 2020 2020 2020 2066 6f72 206c 696e           for lin
-00017ff0: 6520 696e 206c 696e 6573 3a0a 2020 2020  e in lines:.    
-00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018010: 2020 2020 6966 206f 732e 7061 7468 2e62      if os.path.b
-00018020: 6173 656e 616d 6528 6669 6c65 2920 696e  asename(file) in
-00018030: 206c 696e 653a 0a20 2020 2020 2020 2020   line:.         
-00018040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018050: 2020 206c 696e 654e 7220 3d20 690a 2020     lineNr = i.  
-00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018070: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00018080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018090: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
-000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180b0: 2020 2069 6620 6c69 6e65 4e72 2021 3d20     if lineNr != 
-000180c0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-000180d0: 2020 2020 2020 2020 2020 2064 656c 206c             del l
-000180e0: 696e 6573 5b6c 696e 654e 725d 0a20 2020  ines[lineNr].   
-000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018100: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
-00018110: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
-00018120: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00018150: 6c69 6e65 7328 6c69 6e65 7329 0a20 2020  lines(lines).   
-00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018170: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
-00018180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018190: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000181a0: 7469 6f6e 2820 2246 696c 6520 2220 2b20  tion( "File " + 
-000181b0: 6669 6c65 202b 2022 2064 6f65 7320 6e6f  file + " does no
-000181c0: 7420 636f 7461 696e 2061 2076 616c 6964  t cotain a valid
-000181d0: 2055 5549 442e 2052 756e 2063 7265 6174   UUID. Run creat
-000181e0: 655f 7575 6964 5f66 696c 6528 2920 6669  e_uuid_file() fi
-000181f0: 7273 7421 2229 0a0a 2020 2020 2020 2020  rst!")..        
-00018200: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-00018210: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00018220: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
-00018230: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00018240: 7420 7265 5265 6164 416c 6c20 616e 6420  t reReadAll and 
-00018250: 6669 6c65 5f6e 616d 6520 696e 2068 6173  file_name in has
-00018260: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
-00018270: 2020 2020 2020 2020 2068 6173 6865 735b           hashes[
-00018280: 6669 6c65 5f6e 616d 655d 203d 2068 6173  file_name] = has
-00018290: 6865 735b 6669 6c65 5f6e 616d 655d 5b6d  hes[file_name][m
-000182a0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-000182b0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
-000182c0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-000182d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000182e0: 2020 2020 2020 2020 2020 2020 2068 6173               has
-000182f0: 6865 735b 6669 6c65 5f6e 616d 655d 203d  hes[file_name] =
-00018300: 206d 6971 7463 2e73 6861 3235 3648 6173   miqtc.sha256Has
-00018310: 6846 696c 6528 6669 6c65 290a 2020 2020  hFile(file).    
-00018320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018330: 6164 6465 645f 6861 7368 6573 202b 3d20  added_hashes += 
-00018340: 310a 2020 2020 2020 2020 2020 2020 7072  1.            pr
-00018350: 6f67 2e63 6c65 6172 2829 0a0a 2020 2020  og.clear()..    
-00018360: 2020 2020 2020 2020 6966 2072 6552 6561          if reRea
-00018370: 6441 6c6c 206f 7220 6164 6465 645f 6861  dAll or added_ha
-00018380: 7368 6573 203e 2030 3a0a 2020 2020 2020  shes > 0:.      
-00018390: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-000183a0: 696c 6520 3d20 6f70 656e 2873 656c 662e  ile = open(self.
-000183b0: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
-000183c0: 6528 292c 2022 7722 290a 2020 2020 2020  e(), "w").      
-000183d0: 2020 2020 2020 2020 2020 6861 7368 5f66            hash_f
-000183e0: 696c 652e 7772 6974 6528 206d 6971 7476  ile.write( miqtv
-000183f0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00018400: 6971 7427 5d5b 2769 6d67 275d 2b22 5c74  iqt']['img']+"\t
-00018410: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00018420: 6572 5b27 6d61 7269 7174 275d 5b27 6861  er['mariqt']['ha
-00018430: 7368 275d 2b22 5c6e 2229 0a20 2020 2020  sh']+"\n").     
-00018440: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-00018450: 696c 655f 6e61 6d65 2069 6e20 6861 7368  ile_name in hash
-00018460: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00018470: 2020 2020 2020 2020 6861 7368 5f66 696c          hash_fil
-00018480: 652e 7772 6974 6528 6669 6c65 5f6e 616d  e.write(file_nam
-00018490: 652b 225c 7422 2b68 6173 6865 735b 6669  e+"\t"+hashes[fi
-000184a0: 6c65 5f6e 616d 655d 2b22 5c6e 2229 0a0a  le_name]+"\n")..
-000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184c0: 6861 7368 5f66 696c 652e 636c 6f73 6528  hash_file.close(
-000184d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000184e0: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
-000184f0: 4164 6465 6420 222b 7374 7228 6164 6465  Added "+str(adde
-00018500: 645f 6861 7368 6573 292b 2220 6861 7368  d_hashes)+" hash
-00018510: 6573 2074 6f20 6861 7368 2066 696c 6522  es to hash file"
-00018520: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00018530: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018540: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00018550: 2241 6c6c 2068 6173 6865 7320 6578 6973  "All hashes exis
-00018560: 7422 0a0a 2020 2020 2020 2020 656c 7365  t"..        else
-00018570: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00018580: 7475 726e 2046 616c 7365 2c20 224e 6f20  turn False, "No 
-00018590: 696d 6167 6573 2066 6f75 6e64 2074 6f20  images found to 
-000185a0: 6861 7368 220a 2020 2020 2020 2020 0a20  hash".        . 
-000185b0: 2020 2064 6566 2063 7265 6174 6549 6d61     def createIma
-000185c0: 6765 5348 4132 3536 4669 6c65 2873 656c  geSHA256File(sel
-000185d0: 662c 7265 5265 6164 416c 6c3d 5472 7565  f,reReadAll=True
-000185e0: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-000185f0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
-00018600: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
-00018610: 3235 365f 6669 6c65 2022 2222 0a20 2020  256_file """.   
-00018620: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00018630: 2e63 7265 6174 655f 696d 6167 655f 7368  .create_image_sh
-00018640: 6132 3536 5f66 696c 6528 7265 5265 6164  a256_file(reRead
-00018650: 416c 6c29 0a0a 0a20 2020 2064 6566 2063  All)...    def c
-00018660: 7265 6174 655f 7374 6172 745f 7469 6d65  reate_start_time
-00018670: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
-00018680: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
-00018690: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
-000186a0: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
-000186b0: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
-000186c0: 6765 2069 7473 2073 7461 7274 2074 696d  ge its start tim
-000186d0: 6520 7061 7273 6564 2066 726f 6d20 7468  e parsed from th
-000186e0: 6520 6669 6c65 206e 616d 6520 2222 220a  e file name """.
-000186f0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-00018700: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-00018710: 7367 2822 4372 6561 7469 6e67 2069 6e74  sg("Creating int
-00018720: 6572 6d65 6469 6174 6520 7374 6172 7474  ermediate startt
-00018730: 696d 6520 6669 6c65 2022 290a 2020 2020  ime file ").    
-00018740: 2020 2020 696d 6167 6573 496e 5261 7720      imagesInRaw 
-00018750: 3d20 7365 6c66 2e69 6d61 6765 7349 6e49  = self.imagesInI
-00018760: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
-00018770: 7374 2829 0a20 2020 2020 2020 2069 6620  st().        if 
-00018780: 6c65 6e28 696d 6167 6573 496e 5261 7729  len(imagesInRaw)
-00018790: 203e 2030 3a0a 0a20 2020 2020 2020 2020   > 0:..         
-000187a0: 2020 206f 203d 206f 7065 6e28 7365 6c66     o = open(self
-000187b0: 2e67 6574 5f69 6e74 5f73 7461 7274 5469  .get_int_startTi
-000187c0: 6d65 735f 6669 6c65 2829 2c20 2277 2229  mes_file(), "w")
-000187d0: 0a20 2020 2020 2020 2020 2020 206f 2e77  .            o.w
-000187e0: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
-000187f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00018800: 2769 6d67 275d 202b 0a20 2020 2020 2020  'img'] +.       
-00018810: 2020 2020 2020 2020 2020 2020 2022 5c74               "\t
-00018820: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00018830: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
-00018840: 6327 5d2b 225c 6e22 290a 0a20 2020 2020  c']+"\n")..     
-00018850: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
-00018860: 696e 2069 6d61 6765 7349 6e52 6177 3a0a  in imagesInRaw:.
-00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018880: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
-00018890: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
-000188a0: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-000188b0: 2020 2020 6474 203d 206d 6971 7463 2e70      dt = miqtc.p
-000188c0: 6172 7365 4669 6c65 4461 7465 5469 6d65  arseFileDateTime
-000188d0: 4173 5554 4328 6669 6c65 5f6e 616d 6529  AsUTC(file_name)
-000188e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000188f0: 206f 2e77 7269 7465 2866 696c 655f 6e61   o.write(file_na
-00018900: 6d65 2b22 5c74 2220 2b20 6474 2e73 7472  me+"\t" + dt.str
-00018910: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
-00018920: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-00018930: 275d 292b 225c 6e22 290a 0a20 2020 2020  '])+"\n")..     
-00018940: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
-00018950: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
-00018960: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
-00018970: 2020 7265 7475 726e 2054 7275 652c 2022    return True, "
-00018980: 4372 6561 7465 6420 7374 6172 7420 7469  Created start ti
-00018990: 6d65 2066 696c 6522 0a20 2020 2020 2020  me file".       
-000189a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000189b0: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-000189c0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000189d0: 616c 7365 2c20 224e 6f20 696d 6167 6573  alse, "No images
-000189e0: 2066 6f75 6e64 2074 6f20 7265 6164 2073   found to read s
-000189f0: 7461 7274 2074 696d 6573 220a 2020 2020  tart times".    
-00018a00: 2020 2020 0a20 2020 2064 6566 2063 7265      .    def cre
-00018a10: 6174 6553 7461 7274 5469 6d65 4669 6c65  ateStartTimeFile
-00018a20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00018a30: 2222 2220 4465 7072 6563 6174 6564 202d  """ Deprecated -
-00018a40: 2075 7365 2063 7265 6174 655f 7374 6172   use create_star
-00018a50: 745f 7469 6d65 5f66 696c 6520 2222 220a  t_time_file """.
-00018a60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00018a70: 656c 662e 6372 6561 7465 5f73 7461 7274  elf.create_start
-00018a80: 5f74 696d 655f 6669 6c65 2829 0a0a 0a20  _time_file()... 
-00018a90: 2020 2064 6566 2063 7265 6174 6541 6371     def createAcq
-00018aa0: 7569 7369 7469 6f6e 5365 7474 696e 6773  uisitionSettings
-00018ab0: 4558 4946 4669 6c65 2873 656c 662c 6f76  EXIFFile(self,ov
-00018ac0: 6572 7269 6465 3d46 616c 7365 293a 0a20  erride=False):. 
-00018ad0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-00018ae0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
-00018af0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
-00018b00: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
-00018b10: 6d61 6765 2061 2064 6963 7420 6f66 2065  mage a dict of e
-00018b20: 7869 6620 7461 6773 2061 6e64 2074 6865  xif tags and the
-00018b30: 6972 2076 616c 7565 7320 7061 7273 6564  ir values parsed
-00018b40: 2066 726f 6d20 7468 6520 696d 6167 6520   from the image 
-00018b50: 2222 220a 0a20 2020 2020 2020 2069 6e74  """..        int
-00018b60: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
-00018b70: 696e 675f 6669 6c65 203d 2073 656c 662e  ing_file = self.
-00018b80: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
-00018b90: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
-00018ba0: 652d 6163 7175 6973 6974 696f 6e2d 7365  e-acquisition-se
-00018bb0: 7474 696e 6773 2e74 7874 270a 2020 2020  ttings.txt'.    
-00018bc0: 2020 2020 6865 6164 6572 203d 207b 2020      header = {  
-00018bd0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00018be0: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00018bf0: 5d3a 2020 6d69 7174 762e 636f 6c5f 6865  ]:  miqtv.col_he
-00018c00: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00018c10: 696d 6727 5d2c 0a20 2020 2020 2020 2020  img'],.         
-00018c20: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00018c30: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00018c40: 6971 7427 5d5b 2761 6371 7569 275d 3a6d  iqt']['acqui']:m
-00018c50: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00018c60: 276d 6172 6971 7427 5d5b 2761 6371 7569  'mariqt']['acqui
-00018c70: 275d 7d0a 2020 2020 2020 2020 6966 206f  ']}.        if o
-00018c80: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
-00018c90: 745f 6163 7175 6973 6974 696f 6e53 6574  t_acquisitionSet
-00018ca0: 7469 6e67 5f66 696c 6529 2061 6e64 206e  ting_file) and n
-00018cb0: 6f74 206f 7665 7272 6964 653a 0a20 2020  ot override:.   
-00018cc0: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
-00018cd0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
-00018ce0: 6669 6c65 2869 6e74 5f61 6371 7569 7369  file(int_acquisi
-00018cf0: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
-00018d00: 2c22 5c74 222c 6865 6164 6572 290a 2020  ,"\t",header).  
-00018d10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00018d20: 2054 7275 652c 2022 5265 7375 6c74 2066   True, "Result f
-00018d30: 696c 6520 6578 6973 7473 220a 0a20 2020  ile exists"..   
-00018d40: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-00018d50: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
-00018d60: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
-00018d70: 6973 7428 290a 2020 2020 2020 2020 6966  ist().        if
-00018d80: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-00018d90: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
-00018da0: 2020 2020 6f20 3d20 6f70 656e 2869 6e74      o = open(int
-00018db0: 5f61 6371 7569 7369 7469 6f6e 5365 7474  _acquisitionSett
-00018dc0: 696e 675f 6669 6c65 2c20 2277 2229 0a20  ing_file, "w"). 
-00018dd0: 2020 2020 2020 2020 2020 206f 2e77 7269             o.wri
-00018de0: 7465 286d 6971 7476 2e63 6f6c 5f68 6561  te(miqtv.col_hea
-00018df0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00018e00: 6d67 275d 202b 2022 5c74 222b 6d69 7174  mg'] + "\t"+miqt
-00018e10: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00018e20: 7269 7174 275d 5b27 6163 7175 6927 5d2b  riqt']['acqui']+
-00018e30: 225c 6e22 290a 200a 2020 2020 2020 2020  "\n"). .        
-00018e40: 2020 2020 696d 6167 6573 4578 6966 7320      imagesExifs 
-00018e50: 3d20 6d69 7174 692e 6765 7449 6d61 6765  = miqti.getImage
-00018e60: 7341 6c6c 4578 6966 5661 6c75 6573 2869  sAllExifValues(i
-00018e70: 6d61 6765 7349 6e52 6177 2c73 656c 662e  magesInRaw,self.
-00018e80: 7072 6f76 290a 2020 2020 2020 2020 2020  prov).          
-00018e90: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00018ea0: 6167 6573 4578 6966 733a 0a20 2020 2020  agesExifs:.     
-00018eb0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-00018ec0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-00018ed0: 6173 656e 616d 6528 6669 6c65 290a 2020  asename(file).  
-00018ee0: 2020 2020 2020 2020 2020 2020 2020 6f2e                o.
-00018ef0: 7772 6974 6528 6669 6c65 5f6e 616d 652b  write(file_name+
-00018f00: 225c 7422 2b73 7472 2869 6d61 6765 7345  "\t"+str(imagesE
-00018f10: 7869 6673 5b66 696c 655d 292b 225c 6e22  xifs[file])+"\n"
-00018f20: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
-00018f30: 2e63 6c6f 7365 2829 0a0a 2020 2020 2020  .close()..      
-00018f40: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
-00018f50: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
-00018f60: 6528 696e 745f 6163 7175 6973 6974 696f  e(int_acquisitio
-00018f70: 6e53 6574 7469 6e67 5f66 696c 652c 225c  nSetting_file,"\
-00018f80: 7422 2c68 6561 6465 7229 0a20 2020 2020  t",header).     
-00018f90: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00018fa0: 7565 2c20 2243 7265 6174 6564 2061 6371  ue, "Created acq
-00018fb0: 7569 7369 7469 6f6e 2073 6574 7469 6e67  uisition setting
-00018fc0: 7320 6669 6c65 220a 2020 2020 2020 2020  s file".        
-00018fd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00018fe0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
-00018ff0: 224e 6f20 696d 6167 6573 2066 6f75 6e64  "No images found
-00019000: 220a 0a0a 2020 2020 6465 6620 696d 6167  "...    def imag
-00019010: 6573 496e 496d 6167 6573 4469 7228 7365  esInImagesDir(se
-00019020: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00019030: 7572 6e20 636f 7079 2e64 6565 7063 6f70  urn copy.deepcop
-00019040: 7928 7365 6c66 2e5f 696d 6167 6573 496e  y(self._imagesIn
-00019050: 496d 6167 6573 4469 7229 0a0a 2020 2020  ImagesDir)..    
-00019060: 6465 6620 696d 6167 6573 496e 496d 6167  def imagesInImag
-00019070: 6573 4469 7253 6f72 7465 644c 6973 7428  esDirSortedList(
-00019080: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00019090: 6574 7572 6e20 636f 7079 2e64 6565 7063  eturn copy.deepc
-000190a0: 6f70 7928 7365 6c66 2e5f 696d 6167 6573  opy(self._images
-000190b0: 496e 496d 6167 6573 4469 7253 6f72 7465  InImagesDirSorte
-000190c0: 644c 6973 7429 0a0a 0a20 2020 2064 6566  dList)...    def
-000190d0: 2070 6172 7365 4974 656d 4461 7461 6672   parseItemDatafr
-000190e0: 6f6d 5461 6246 696c 6544 6174 6128 7365  omTabFileData(se
-000190f0: 6c66 2c20 6974 656d 733a 2064 6963 742c  lf, items: dict,
-00019100: 2066 696c 653a 2073 7472 2c20 636f 6c73   file: str, cols
-00019110: 3a20 6c69 7374 2c20 6f70 7469 6f6e 616c  : list, optional
-00019120: 3a20 6c69 7374 203d 205b 5d2c 2064 6174  : list = [], dat
-00019130: 6574 696d 655f 666f 726d 6174 3a73 7472  etime_format:str
-00019140: 3d6d 6971 7476 2e64 6174 655f 666f 726d  =miqtv.date_form
-00019150: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
-00019160: 2020 2020 2020 2020 2222 2220 7061 7273          """ pars
-00019170: 6573 2064 6174 6120 6672 6f6d 2063 6f6c  es data from col
-00019180: 756d 6e73 2069 6e20 636f 6c73 2061 6e64  umns in cols and
-00019190: 2077 7269 7465 7320 696e 666f 2074 6f20   writes info to 
-000191a0: 6974 656d 732e 2043 6f6c 756d 6e20 2769  items. Column 'i
-000191b0: 6d61 6765 2d66 696c 656e 616d 6527 206d  mage-filename' m
-000191c0: 7573 7420 6265 2069 6e20 6669 6c65 2061  ust be in file a
-000191d0: 6e64 2064 6f65 7320 6e6f 7420 6e65 6564  nd does not need
-000191e0: 2074 6f20 6265 2070 6173 7365 6420 696e   to be passed in
-000191f0: 2063 6f6c 732e 200a 2020 2020 2020 2020   cols. .        
-00019200: 2020 2020 4669 6c65 206d 7573 7420 6265      File must be
-00019210: 2074 6162 2073 6570 6172 6174 6564 2061   tab separated a
-00019220: 6e64 2063 6f6c 756d 6e73 206e 616d 6573  nd columns names
-00019230: 206d 7573 7420 6571 7561 6c20 6974 656d   must equal item
-00019240: 2066 6965 6c64 206e 616d 6573 2222 220a   field names""".
-00019250: 2020 2020 2020 2020 746d 705f 6461 7461          tmp_data
-00019260: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
-00019270: 4461 7461 2866 696c 652c 2063 6f6c 732b  Data(file, cols+
-00019280: 5b27 696d 6167 652d 6669 6c65 6e61 6d65  ['image-filename
-00019290: 275d 2b6f 7074 696f 6e61 6c2c 206b 6579  ']+optional, key
-000192a0: 5f63 6f6c 3d27 696d 6167 652d 6669 6c65  _col='image-file
-000192b0: 6e61 6d65 272c 206f 7074 696f 6e61 6c3d  name', optional=
-000192c0: 6f70 7469 6f6e 616c 2c63 6f6e 7665 7274  optional,convert
-000192d0: 3d54 7275 6529 0a20 2020 2020 2020 2073  =True).        s
-000192e0: 656c 662e 7772 6974 6550 6172 7365 6444  elf.writeParsedD
-000192f0: 6174 6154 6f49 7465 6d73 2874 6d70 5f64  ataToItems(tmp_d
-00019300: 6174 612c 6974 656d 732c 7365 6c66 2e69  ata,items,self.i
-00019310: 6664 6f5f 746d 705b 6d69 7174 762e 696d  fdo_tmp[miqtv.im
-00019320: 6167 655f 7365 745f 6865 6164 6572 5f6b  age_set_header_k
-00019330: 6579 5d2c 2064 6174 6574 696d 655f 666f  ey], datetime_fo
-00019340: 726d 6174 3d64 6174 6574 696d 655f 666f  rmat=datetime_fo
-00019350: 726d 6174 290a 0a0a 2020 2020 6465 6620  rmat)...    def 
-00019360: 7072 6173 6549 7465 6d44 6174 6146 726f  praseItemDataFro
-00019370: 6d46 696c 6528 7365 6c66 2c69 7465 6d73  mFile(self,items
-00019380: 3a64 6963 742c 6669 6c65 3a73 7472 2c73  :dict,file:str,s
-00019390: 6570 6172 6174 6f72 3a73 7472 2c68 6561  eparator:str,hea
-000193a0: 6465 723a 6469 6374 2c20 6461 7465 7469  der:dict, dateti
-000193b0: 6d65 5f66 6f72 6d61 743a 7374 723d 6d69  me_format:str=mi
-000193c0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-000193d0: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
-000193e0: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
-000193f0: 6461 7461 2066 726f 6d20 6672 6f6d 2066  data from from f
-00019400: 696c 6520 746f 2069 7465 6d73 2e20 6865  ile to items. he
-00019410: 6164 6572 2064 6963 7420 6d75 7374 2062  ader dict must b
-00019420: 6520 6f66 2073 7472 7563 7475 7265 3a20  e of structure: 
-00019430: 7b3c 6974 656d 2d66 6965 6c64 2d6e 616d  {<item-field-nam
-00019440: 653e 3a3c 636f 6c75 6d6e 2d6e 616d 653e  e>:<column-name>
-00019450: 7d0a 2020 2020 2020 2020 2020 2020 616e  }.            an
-00019460: 6420 6d75 7374 2063 6f6e 7461 696e 2065  d must contain e
-00019470: 6e74 7279 2027 696d 6167 652d 6669 6c65  ntry 'image-file
-00019480: 6e61 6d65 2720 2222 220a 2020 2020 2020  name' """.      
-00019490: 2020 6966 206e 6f74 2027 696d 6167 652d    if not 'image-
-000194a0: 6669 6c65 6e61 6d65 2720 696e 2068 6561  filename' in hea
-000194b0: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-000194c0: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-000194d0: 2822 6865 6164 6572 2064 6f65 7320 6e6f  ("header does no
-000194e0: 7420 636f 6e74 6169 6e20 2769 6d61 6765  t contain 'image
-000194f0: 2d66 696c 656e 616d 6527 2229 0a20 2020  -filename'").   
-00019500: 2020 2020 200a 2020 2020 2020 2020 746d       .        tm
-00019510: 705f 6461 7461 203d 206d 6971 7466 2e74  p_data = miqtf.t
-00019520: 6162 4669 6c65 4461 7461 2866 696c 652c  abFileData(file,
-00019530: 2068 6561 6465 722c 636f 6c5f 7365 7061   header,col_sepa
-00019540: 7261 746f 723d 7365 7061 7261 746f 722c  rator=separator,
-00019550: 206b 6579 5f63 6f6c 3d27 696d 6167 652d   key_col='image-
-00019560: 6669 6c65 6e61 6d65 272c 636f 6e76 6572  filename',conver
-00019570: 743d 5472 7565 290a 2020 2020 2020 2020  t=True).        
-00019580: 7365 6c66 2e77 7269 7465 5061 7273 6564  self.writeParsed
-00019590: 4461 7461 546f 4974 656d 7328 746d 705f  DataToItems(tmp_
-000195a0: 6461 7461 2c69 7465 6d73 2c73 656c 662e  data,items,self.
-000195b0: 6966 646f 5f74 6d70 5b6d 6971 7476 2e69  ifdo_tmp[miqtv.i
-000195c0: 6d61 6765 5f73 6574 5f68 6561 6465 725f  mage_set_header_
-000195d0: 6b65 795d 2c20 6461 7465 7469 6d65 5f66  key], datetime_f
-000195e0: 6f72 6d61 743d 6461 7465 7469 6d65 5f66  ormat=datetime_f
-000195f0: 6f72 6d61 7429 0a0a 0a20 2020 2064 6566  ormat)...    def
-00019600: 2077 7269 7465 5061 7273 6564 4461 7461   writeParsedData
-00019610: 546f 4974 656d 7328 7365 6c66 2c64 6174  ToItems(self,dat
-00019620: 613a 6469 6374 2c69 7465 6d73 3a64 6963  a:dict,items:dic
-00019630: 742c 6865 6164 6572 3a64 6963 742c 2064  t,header:dict, d
-00019640: 6174 6574 696d 655f 666f 726d 6174 3a73  atetime_format:s
-00019650: 7472 3d6d 6971 7476 2e64 6174 655f 666f  tr=miqtv.date_fo
-00019660: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
-00019670: 3a0a 0a20 2020 2020 2020 2023 2065 7661  :..        # eva
-00019680: 6c20 7374 7269 6e67 7320 6173 2064 6963  l strings as dic
-00019690: 7420 6f72 206c 6973 740a 2020 2020 2020  t or list.      
-000196a0: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
-000196b0: 6545 7661 6c28 6461 7461 290a 0a20 2020  eEval(data)..   
-000196c0: 2020 2020 2023 2070 6f74 656e 7461 696c       # potentail
-000196d0: 6c79 2072 656d 6f76 6520 636f 6e73 7420  ly remove const 
-000196e0: 6461 7461 2066 726f 6d20 6974 656d 7320  data from items 
-000196f0: 616e 6420 7075 7420 696e 2068 6561 6465  and put in heade
-00019700: 720a 2020 2020 2020 2020 7365 6c66 2e65  r.        self.e
-00019710: 7874 7261 6374 436f 6e73 7444 6174 6156  xtractConstDataV
-00019720: 616c 7565 7328 6461 7461 2c68 6561 6465  alues(data,heade
-00019730: 7229 0a0a 2020 2020 2020 2020 6461 7461  r)..        data
-00019740: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
-00019750: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
-00019760: 6965 6c64 7328 6461 7461 2c63 6f6e 7465  ields(data,conte
-00019770: 6e74 3262 6552 656d 6f76 6564 3d4e 6f6e  nt2beRemoved=Non
-00019780: 6529 0a0a 2020 2020 2020 2020 2320 6164  e)..        # ad
-00019790: 6420 2769 6d61 6765 2d66 696c 656e 616d  d 'image-filenam
-000197a0: 6527 2066 6965 6c64 0a20 2020 2020 2020  e' field.       
-000197b0: 2066 6f72 2069 6d67 2c20 656e 7472 7920   for img, entry 
-000197c0: 696e 2064 6174 612e 6974 656d 7328 293a  in data.items():
-000197d0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000197e0: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-000197f0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
-00019800: 6e74 7279 2c6c 6973 7429 3a0a 2020 2020  ntry,list):.    
-00019810: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00019820: 6c69 7374 4974 656d 2069 6e20 656e 7472  listItem in entr
-00019830: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00019840: 2020 2020 2020 206c 6973 7449 7465 6d5b         listItem[
-00019850: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-00019860: 5d20 3d20 696d 670a 2020 2020 2020 2020  ] = img.        
-00019870: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-00019880: 7665 7274 2064 6174 6574 696d 6520 7374  vert datetime st
-00019890: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-000198a0: 2020 2020 2020 2020 2069 6620 2769 6d61           if 'ima
-000198b0: 6765 2d64 6174 6574 696d 6527 2069 6e20  ge-datetime' in 
-000198c0: 6c69 7374 4974 656d 3a0a 2020 2020 2020  listItem:.      
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
-000198f0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-00019900: 6528 6c69 7374 4974 656d 5b27 696d 6167  e(listItem['imag
-00019910: 652d 6461 7465 7469 6d65 275d 2c20 6461  e-datetime'], da
-00019920: 7465 7469 6d65 5f66 6f72 6d61 7429 0a20  tetime_format). 
-00019930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019940: 2020 2020 2020 206c 6973 7449 7465 6d5b         listItem[
-00019950: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-00019960: 5d20 3d20 6474 2e73 7472 6674 696d 6528  ] = dt.strftime(
-00019970: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
-00019980: 7473 5b27 6d61 7269 7174 275d 290a 2020  ts['mariqt']).  
-00019990: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-000199a0: 7369 6e73 7461 6e63 6528 656e 7472 792c  sinstance(entry,
-000199b0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-000199c0: 2020 2020 2020 2065 6e74 7279 5b27 696d         entry['im
-000199d0: 6167 652d 6669 6c65 6e61 6d65 275d 203d  age-filename'] =
-000199e0: 2069 6d67 0a20 2020 2020 2020 2020 2020   img.           
-000199f0: 2020 2020 2023 2063 6f76 6572 7420 6461       # covert da
-00019a00: 7465 7469 6d65 2073 7472 696e 670a 2020  tetime string.  
-00019a10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019a20: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-00019a30: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
-00019a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019a50: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
-00019a60: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
-00019a70: 656e 7472 795b 2769 6d61 6765 2d64 6174  entry['image-dat
-00019a80: 6574 696d 6527 5d2c 2064 6174 6574 696d  etime'], datetim
-00019a90: 655f 666f 726d 6174 290a 2020 2020 2020  e_format).      
-00019aa0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-00019ab0: 7472 795b 2769 6d61 6765 2d64 6174 6574  try['image-datet
-00019ac0: 696d 6527 5d20 3d20 6474 2e73 7472 6674  ime'] = dt.strft
-00019ad0: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
-00019ae0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-00019af0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00019b00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00019b10: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
-00019b20: 4966 646f 4578 6365 7074 696f 6e28 2264  IfdoException("d
-00019b30: 6174 6120 656e 7472 6965 7320 6d75 7374  ata entries must
-00019b40: 2062 6520 6469 6374 206f 7220 6c69 7374   be dict or list
-00019b50: 2069 6620 6469 6374 7322 290a 0a20 2020   if dicts")..   
-00019b60: 2020 2020 206d 6971 7463 2e72 6563 7572       miqtc.recur
-00019b70: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
-00019b80: 7328 6974 656d 732c 6461 7461 290a 0a0a  s(items,data)...
-00019b90: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00019ba0: 640a 2020 2020 6465 6620 6578 7472 6163  d.    def extrac
-00019bb0: 7443 6f6e 7374 4461 7461 5661 6c75 6573  tConstDataValues
-00019bc0: 2864 6174 613a 6469 6374 2c68 6561 6465  (data:dict,heade
-00019bd0: 723a 6469 6374 293a 0a20 2020 2020 2020  r:dict):.       
-00019be0: 2022 2222 2052 656d 6f76 6573 2066 6965   """ Removes fie
-00019bf0: 6c64 7320 7468 6174 2061 7265 2063 6f6e  lds that are con
-00019c00: 7374 616e 7420 666f 7220 616c 6c20 656e  stant for all en
-00019c10: 7472 6965 7320 6672 6f6d 2064 6174 6120  tries from data 
-00019c20: 6469 6374 2061 6e64 2070 7574 2074 6865  dict and put the
-00019c30: 6d20 696e 2068 6561 6465 7220 6469 6374  m in header dict
-00019c40: 2e20 0a20 2020 2020 2020 2020 2020 2045  . .            E
-00019c50: 6163 6820 656e 7472 7920 6f66 2064 6174  ach entry of dat
-00019c60: 6120 6d75 7374 2062 6520 6120 6469 6374  a must be a dict
-00019c70: 2077 6974 6820 7468 6520 7361 6d65 2073   with the same s
-00019c80: 6574 206f 6620 6b65 7973 2e20 2222 220a  et of keys. """.
-00019c90: 2020 2020 0a20 2020 2020 2020 2066 6965      .        fie
-00019ca0: 6c64 7354 6f49 676e 6f72 6520 3d20 5b27  ldsToIgnore = ['
-00019cb0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-00019cc0: 0a20 2020 2020 2020 2063 6f6e 7374 4461  .        constDa
-00019cd0: 7461 203d 207b 7d0a 2020 2020 2020 2020  ta = {}.        
-00019ce0: 6669 7273 7449 6d61 6765 203d 2054 7275  firstImage = Tru
-00019cf0: 650a 2020 2020 2020 2020 666f 7220 696d  e.        for im
-00019d00: 6167 652c 696d 6167 655f 6461 7461 2069  age,image_data i
-00019d10: 6e20 6461 7461 2e69 7465 6d73 2829 3a0a  n data.items():.
-00019d20: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00019d30: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00019d40: 6973 696e 7374 616e 6365 2869 6d61 6765  isinstance(image
-00019d50: 5f64 6174 612c 6c69 7374 293a 0a20 2020  _data,list):.   
-00019d60: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-00019d70: 6765 5f64 6174 6120 3d20 5b69 6d61 6765  ge_data = [image
-00019d80: 5f64 6174 615d 0a0a 2020 2020 2020 2020  _data]..        
-00019d90: 2020 2020 6966 206e 6f74 2066 6972 7374      if not first
-00019da0: 496d 6167 6520 616e 6420 636f 6e73 7444  Image and constD
-00019db0: 6174 6120 3d3d 207b 7d3a 0a20 2020 2020  ata == {}:.     
-00019dc0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00019dd0: 0a20 2020 2020 2020 2020 2020 200a 2020  .            .  
-00019de0: 2020 2020 2020 2020 2020 6669 7273 7454            firstT
-00019df0: 696d 6550 6f69 6e74 203d 2054 7275 650a  imePoint = True.
-00019e00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00019e10: 696d 6167 655f 7470 5f64 6174 6120 696e  image_tp_data in
-00019e20: 2069 6d61 6765 5f64 6174 613a 0a20 2020   image_data:.   
-00019e30: 2020 2020 2020 2020 2020 2020 2023 2076               # v
-00019e40: 6572 7920 6669 7273 7420 6461 7461 2066  ery first data f
-00019e50: 6f72 2063 6f6d 7061 7269 736f 6e0a 2020  or comparison.  
-00019e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019e70: 2066 6972 7374 496d 6167 6520 616e 6420   firstImage and 
-00019e80: 6669 7273 7454 696d 6550 6f69 6e74 3a0a  firstTimePoint:.
-00019e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ea0: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
-00019eb0: 636f 7079 2e64 6565 7063 6f70 7928 696d  copy.deepcopy(im
-00019ec0: 6167 655f 7470 5f64 6174 6129 0a20 2020  age_tp_data).   
-00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ee0: 2066 6f72 2066 6965 6c64 2069 6e20 6669   for field in fi
-00019ef0: 656c 6473 546f 4967 6e6f 7265 3a0a 2020  eldsToIgnore:.  
-00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f10: 2020 2020 2020 6966 2066 6965 6c64 2069        if field i
-00019f20: 6e20 636f 6e73 7444 6174 613a 0a20 2020  n constData:.   
-00019f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f40: 2020 2020 2020 2020 2064 656c 2063 6f6e           del con
-00019f50: 7374 4461 7461 5b66 6965 6c64 5d0a 2020  stData[field].  
-00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f70: 2020 6669 7273 7454 696d 6550 6f69 6e74    firstTimePoint
-00019f80: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-00019f90: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00019fa0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
-00019fb0: 2020 2020 2020 2063 6f6e 7374 4461 7461         constData
-00019fc0: 203d 206d 6971 7463 2e66 696e 6443 6f6d   = miqtc.findCom
-00019fd0: 6d6f 6e44 6963 7445 6c65 6d65 6e74 7328  monDictElements(
-00019fe0: 696d 6167 655f 7470 5f64 6174 612c 636f  image_tp_data,co
-00019ff0: 6e73 7444 6174 6129 0a0a 2020 2020 2020  nstData)..      
-0001a000: 2020 2020 2020 6669 7273 7449 6d61 6765        firstImage
-0001a010: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-0001a020: 2020 2320 544f 444f 2063 6865 636b 2077    # TODO check w
-0001a030: 6974 6869 6e20 696d 6167 6520 7469 6d65  ithin image time
-0001a040: 7320 2d3e 2074 6f20 696d 6167 6520 6465  s -> to image de
-0001a050: 6661 756c 742e 2028 7472 6963 6b79 2073  fault. (tricky s
-0001a060: 696e 6365 2077 6520 646f 6e27 7420 6861  ince we don't ha
-0001a070: 7665 2074 6865 2064 6166 6175 6c74 2069  ve the dafault i
-0001a080: 6e64 6578 2068 6572 652e 204f 6e6c 7920  ndex here. Only 
-0001a090: 6120 7375 6273 6574 206d 6967 6874 2062  a subset might b
-0001a0a0: 6520 7570 6461 7465 2068 6572 6529 0a20  e update here). 
-0001a0b0: 2020 2020 2020 2023 2063 6865 636b 2077         # check w
-0001a0c0: 6974 6869 6e20 696d 6167 6520 6974 656d  ithin image item
-0001a0d0: 7320 2d3e 2068 6561 6465 720a 2020 2020  s -> header.    
-0001a0e0: 2020 2020 6865 6164 6572 5570 6461 7465      headerUpdate
-0001a0f0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-0001a100: 2863 6f6e 7374 4461 7461 290a 2020 2020  (constData).    
-0001a110: 2020 2020 6865 6164 6572 5570 6461 7465      headerUpdate
-0001a120: 6454 6573 7420 3d20 636f 7079 2e64 6565  dTest = copy.dee
-0001a130: 7063 6f70 7928 6865 6164 6572 290a 2020  pcopy(header).  
-0001a140: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
-0001a150: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0001a160: 7473 2868 6561 6465 7255 7064 6174 6564  ts(headerUpdated
-0001a170: 5465 7374 2c68 6561 6465 7255 7064 6174  Test,headerUpdat
-0001a180: 6529 0a20 2020 2020 2020 2075 7064 6174  e).        updat
-0001a190: 6544 6966 6620 3d20 4465 6570 4469 6666  eDiff = DeepDiff
-0001a1a0: 2868 6561 6465 722c 6865 6164 6572 5570  (header,headerUp
-0001a1b0: 6461 7465 6454 6573 7429 0a20 2020 2020  datedTest).     
-0001a1c0: 2020 2023 2063 6865 636b 2069 6620 6865     # check if he
-0001a1d0: 6164 6572 5570 6461 7465 2077 6f75 6c64  aderUpdate would
-0001a1e0: 206f 7665 7277 7269 7465 2061 6e79 7468   overwrite anyth
-0001a1f0: 696e 6720 6672 6f6d 2063 7572 7265 6e74  ing from current
-0001a200: 2068 6561 6465 7220 2873 686f 756c 6420   header (should 
-0001a210: 6e6f 7420 6861 7070 656e 292c 2069 6620  not happen), if 
-0001a220: 736f 2064 6f6e 7420 7265 6d6f 7665 2066  so dont remove f
-0001a230: 726f 6d20 6974 656d 730a 2020 2020 2020  rom items.      
-0001a240: 2020 6966 206e 6f74 2027 7661 6c75 6573    if not 'values
-0001a250: 5f63 6861 6e67 6564 2720 696e 2075 7064  _changed' in upd
-0001a260: 6174 6544 6966 6620 616e 6420 6e6f 7420  ateDiff and not 
-0001a270: 2774 7970 655f 6368 616e 6765 7327 2069  'type_changes' i
-0001a280: 6e20 7570 6461 7465 4469 6666 2061 6e64  n updateDiff and
-0001a290: 206e 6f74 2027 6469 6374 696f 6e61 7279   not 'dictionary
-0001a2a0: 5f69 7465 6d5f 7265 6d6f 7665 6427 2069  _item_removed' i
-0001a2b0: 6e20 7570 6461 7465 4469 6666 3a0a 2020  n updateDiff:.  
-0001a2c0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0001a2d0: 2e63 6c65 6172 2829 0a20 2020 2020 2020  .clear().       
-0001a2e0: 2020 2020 2068 6561 6465 722e 7570 6461       header.upda
-0001a2f0: 7465 2868 6561 6465 7255 7064 6174 6564  te(headerUpdated
-0001a300: 5465 7374 290a 0a20 2020 2020 2020 2020  Test)..         
-0001a310: 2020 2023 2072 656d 6f76 6520 636f 6e73     # remove cons
-0001a320: 7420 7661 6c75 6573 2066 726f 6d20 6461  t values from da
-0001a330: 7461 0a20 2020 2020 2020 2020 2020 206d  ta.            m
-0001a340: 6971 7463 2e72 6563 7572 7369 7665 4d61  iqtc.recursiveMa
-0001a350: 6b65 4e6f 6e65 4469 6374 4669 656c 6473  keNoneDictFields
-0001a360: 456d 7074 7953 7472 2863 6f6e 7374 4461  EmptyStr(constDa
-0001a370: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
-0001a380: 666f 7220 696d 6167 652c 696d 6167 655f  for image,image_
-0001a390: 6461 7461 2069 6e20 6461 7461 2e69 7465  data in data.ite
-0001a3a0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0001a3b0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0001a3c0: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
-0001a3d0: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
-0001a3e0: 2020 2020 2020 2020 2020 2020 2020 696d                im
-0001a3f0: 6167 655f 6461 7461 203d 205b 696d 6167  age_data = [imag
-0001a400: 655f 6461 7461 5d0a 2020 2020 2020 2020  e_data].        
-0001a410: 2020 2020 2020 2020 666f 7220 696d 6167          for imag
-0001a420: 655f 7470 5f64 6174 6120 696e 2069 6d61  e_tp_data in ima
-0001a430: 6765 5f64 6174 613a 0a20 2020 2020 2020  ge_data:.       
-0001a440: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-0001a450: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
-0001a460: 6461 7465 4469 6374 7328 696d 6167 655f  dateDicts(image_
-0001a470: 7470 5f64 6174 612c 636f 6e73 7444 6174  tp_data,constDat
-0001a480: 6129 2020 2020 2020 2020 2020 0a0a 2020  a)          ..  
-0001a490: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a4a0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-0001a4b0: 2020 2020 2020 2020 2023 2054 4f44 4f20           # TODO 
-0001a4c0: 6c6f 673f 0a20 2020 2020 0a0a 2020 2020  log?.     ..    
-0001a4d0: 6465 6620 696e 7465 726d 6564 6961 7465  def intermediate
-0001a4e0: 4e61 7646 696c 6545 7869 7374 7328 7365  NavFileExists(se
-0001a4f0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
-0001a500: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-0001a510: 656c 662e 6765 745f 696e 745f 6e61 765f  elf.get_int_nav_
-0001a520: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
-0001a530: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-0001a540: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001a550: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a560: 6e20 4661 6c73 650a 0a0a 2020 2020 6465  n False...    de
-0001a570: 6620 6865 6164 6572 4669 656c 6446 696c  f headerFieldFil
-0001a580: 6c65 6428 7365 6c66 2c66 6965 6c64 3a73  led(self,field:s
-0001a590: 7472 293a 0a20 2020 2020 2020 2069 6620  tr):.        if 
-0001a5a0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0001a5b0: 6432 2866 6965 6c64 2920 3d3d 2022 223a  d2(field) == "":
-0001a5c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001a5d0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0001a5e0: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-0001a5f0: 2020 2064 6566 2063 6f6e 7665 7274 546f     def convertTo
-0001a600: 4465 6661 756c 7444 6174 6554 696d 6546  DefaultDateTimeF
-0001a610: 6f72 6d61 7428 7365 6c66 2c69 6664 6f29  ormat(self,ifdo)
-0001a620: 3a0a 2020 2020 2020 2020 2222 2220 4368  :.        """ Ch
-0001a630: 6563 6b73 2069 6620 616c 6c20 6974 656d  ecks if all item
-0001a640: 7327 2027 696d 6167 652d 6461 7465 7469  s' 'image-dateti
-0001a650: 6d65 2720 6669 656c 6473 206d 6174 6368  me' fields match
-0001a660: 2064 6566 6175 6c74 2064 6174 6574 696d   default datetim
-0001a670: 6520 666f 726d 6174 206f 7220 6120 6375  e format or a cu
-0001a680: 7374 6f6d 206f 6e65 2064 6566 696e 6564  stom one defined
-0001a690: 2069 6e20 2769 6d61 6765 2d64 6174 6574   in 'image-datet
-0001a6a0: 696d 652d 666f 726d 6174 270a 2020 2020  ime-format'.    
-0001a6b0: 2020 2020 2020 2020 616e 6420 636f 6e76          and conv
-0001a6c0: 6572 7473 2074 6f20 6465 6661 756c 7420  erts to default 
-0001a6d0: 666f 726d 6174 2e20 5468 726f 7773 2065  format. Throws e
-0001a6e0: 7863 6570 7469 6f6e 2069 6620 6461 7465  xception if date
-0001a6f0: 7469 6d65 2063 616e 6e6f 7420 6265 2070  time cannot be p
-0001a700: 6172 7365 6420 2222 220a 2020 2020 2020  arsed """.      
-0001a710: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
-0001a720: 466f 726d 6174 466f 756e 6420 3d20 4661  FormatFound = Fa
-0001a730: 6c73 650a 2020 2020 2020 2020 6865 6164  lse.        head
-0001a740: 6572 4375 7374 6f6d 4461 7465 5469 6d65  erCustomDateTime
-0001a750: 466f 726d 6174 203d 2066 696e 6446 6965  Format = findFie
-0001a760: 6c64 2869 6664 6f5b 7365 6c66 2e69 6d61  ld(ifdo[self.ima
-0001a770: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0001a780: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
-0001a790: 666f 726d 6174 2729 0a20 2020 2020 2020  format').       
-0001a7a0: 2069 6620 6865 6164 6572 4375 7374 6f6d   if headerCustom
-0001a7b0: 4461 7465 5469 6d65 466f 726d 6174 2021  DateTimeFormat !
-0001a7c0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0001a7d0: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
-0001a7e0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0001a7f0: 696d 6167 652d 6461 7465 7469 6d65 2d66  image-datetime-f
-0001a800: 6f72 6d61 7427 5d20 3d20 2222 2023 2072  ormat'] = "" # r
-0001a810: 656d 6f76 6520 6375 7374 6f6d 2066 6f72  emove custom for
-0001a820: 6d61 740a 2020 2020 2020 2020 2020 2020  mat.            
-0001a830: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
-0001a840: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
-0001a850: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
-0001a860: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
-0001a870: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
-0001a880: 636b 696e 6720 6461 7465 7469 6d65 2066  cking datetime f
-0001a890: 6f72 6d61 7422 2c20 6c65 6e28 6966 646f  ormat", len(ifdo
-0001a8a0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0001a8b0: 656d 734b 6579 5d29 2c6d 6f64 756c 6f3d  emsKey]),modulo=
-0001a8c0: 3129 0a20 2020 2020 2020 2066 6f72 2066  1).        for f
-0001a8d0: 696c 652c 6974 656d 2069 6e20 6966 646f  ile,item in ifdo
-0001a8e0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0001a8f0: 656d 734b 6579 5d2e 6974 656d 7328 293a  emsKey].items():
-0001a900: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0001a910: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
-0001a920: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001a930: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
-0001a940: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-0001a950: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
-0001a960: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
-0001a970: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
-0001a980: 756c 7420 3d20 6974 656d 5b30 5d0a 2020  ult = item[0].  
-0001a990: 2020 2020 2020 2020 2020 6974 656d 4375            itemCu
-0001a9a0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
-0001a9b0: 6174 203d 2022 220a 2020 2020 2020 2020  at = "".        
-0001a9c0: 2020 2020 6966 2027 696d 6167 652d 6461      if 'image-da
-0001a9d0: 7465 7469 6d65 2d66 6f72 6d61 7427 2069  tetime-format' i
-0001a9e0: 6e20 7375 6249 7465 6d44 6566 6175 6c74  n subItemDefault
-0001a9f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001aa00: 2020 6974 656d 4375 7374 6f6d 4461 7465    itemCustomDate
-0001aa10: 5469 6d65 466f 726d 6174 203d 2073 7562  TimeFormat = sub
-0001aa20: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
-0001aa30: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
-0001aa40: 6174 275d 0a20 2020 2020 2020 2020 2020  at'].           
-0001aa50: 2020 2020 2073 7562 4974 656d 4465 6661       subItemDefa
-0001aa60: 756c 745b 2769 6d61 6765 2d64 6174 6574  ult['image-datet
-0001aa70: 696d 652d 666f 726d 6174 275d 203d 2022  ime-format'] = "
-0001aa80: 2220 2320 7265 6d6f 7665 2063 7573 746f  " # remove custo
-0001aa90: 6d20 666f 726d 6174 0a20 2020 2020 2020  m format.       
-0001aaa0: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
-0001aab0: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
-0001aac0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-0001aad0: 2020 2020 2020 666f 7220 7375 6249 7465        for subIte
-0001aae0: 6d20 696e 2069 7465 6d3a 0a20 2020 2020  m in item:.     
-0001aaf0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab10: 2020 2020 666f 726d 6174 203d 206d 6971      format = miq
-0001ab20: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-0001ab30: 276d 6172 6971 7427 5d0a 2020 2020 2020  'mariqt'].      
-0001ab40: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0001ab50: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-0001ab60: 7374 7270 7469 6d65 2873 7562 4974 656d  strptime(subItem
-0001ab70: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001ab80: 275d 2c66 6f72 6d61 7429 0a20 2020 2020  '],format).     
-0001ab90: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0001aba0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-0001abb0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abd0: 2020 2020 666f 726d 6174 203d 2068 6561      format = hea
-0001abe0: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
-0001abf0: 6546 6f72 6d61 740a 2020 2020 2020 2020  eFormat.        
-0001ac00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac10: 6474 203d 2064 6174 6574 696d 652e 6461  dt = datetime.da
-0001ac20: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
-0001ac30: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
-0001ac40: 6174 6574 696d 6527 5d2c 666f 726d 6174  atetime'],format
-0001ac50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ac60: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
-0001ac70: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001ac80: 6527 5d20 3d20 6461 7465 7469 6d65 2e64  e'] = datetime.d
-0001ac90: 6174 6574 696d 652e 7374 7266 7469 6d65  atetime.strftime
-0001aca0: 2864 742c 6d69 7174 762e 6461 7465 5f66  (dt,miqtv.date_f
-0001acb0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0001acc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001acd0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001acf0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad10: 2020 2020 2020 2066 6f72 6d61 7420 3d20         format = 
-0001ad20: 6974 656d 4375 7374 6f6d 4461 7465 5469  itemCustomDateTi
-0001ad30: 6d65 466f 726d 6174 0a20 2020 2020 2020  meFormat.       
-0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad50: 2020 2020 2064 7420 3d20 6461 7465 7469       dt = dateti
-0001ad60: 6d65 2e64 6174 6574 696d 652e 7374 7270  me.datetime.strp
-0001ad70: 7469 6d65 2873 7562 4974 656d 5b27 696d  time(subItem['im
-0001ad80: 6167 652d 6461 7465 7469 6d65 275d 2c66  age-datetime'],f
-0001ad90: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
-0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adb0: 2020 2073 7562 4974 656d 5b27 696d 6167     subItem['imag
-0001adc0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
-0001add0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-0001ade0: 2e73 7472 6674 696d 6528 6474 2c6d 6971  .strftime(dt,miq
-0001adf0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-0001ae00: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
-0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae20: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae40: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-0001ae50: 7228 290a 2020 2020 2020 2020 2020 2020  r().            
-0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae70: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0001ae80: 4578 6365 7074 696f 6e28 2749 6e76 616c  Exception('Inval
-0001ae90: 6964 2064 6174 6574 696d 6520 7661 6c75  id datetime valu
-0001aea0: 6527 2c73 7562 4974 656d 5b27 696d 6167  e',subItem['imag
-0001aeb0: 652d 6461 7465 7469 6d65 275d 2c20 2264  e-datetime'], "d
-0001aec0: 6f65 7320 6e6f 7420 6d61 7463 6820 666f  oes not match fo
-0001aed0: 726d 6174 2064 6566 6175 6c74 206f 7220  rmat default or 
-0001aee0: 6375 7374 6f6d 2066 6f72 6d61 7422 290a  custom format").
-0001aef0: 2020 2020 2020 2020 6966 2063 7573 746f          if custo
-0001af00: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
-0001af10: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-0001af20: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0001af30: 2243 7573 746f 6d20 6461 7465 7469 6d65  "Custom datetime
-0001af40: 2066 6f72 6d61 7473 2066 6f75 6e64 2e20   formats found. 
-0001af50: 5468 6579 2077 696c 6c20 6265 2072 6570  They will be rep
-0001af60: 6c61 6365 6420 6279 2074 6865 2064 6566  laced by the def
-0001af70: 6175 6c74 2066 6f72 6d61 742e 2229 2020  ault format.")  
-0001af80: 200a 2020 2020 2020 2020 7072 6f67 2e63   .        prog.c
-0001af90: 6c65 6172 2829 2020 2020 0a0a 0a20 2020  lear()    ...   
-0001afa0: 2064 6566 205f 5f69 6e69 7449 6e74 6572   def __initInter
-0001afb0: 6d65 6469 6174 6546 696c 6573 2873 656c  mediateFiles(sel
-0001afc0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
-0001afd0: 2e69 6e74 6572 6d65 6469 6174 6546 696c  .intermediateFil
-0001afe0: 6573 4465 665f 636f 7265 203d 207b 0a20  esDef_core = {. 
-0001aff0: 2020 2020 2020 2020 2020 2027 6861 7368             'hash
-0001b000: 6573 273a 207b 0a20 2020 2020 2020 2020  es': {.         
-0001b010: 2020 2020 2020 2027 6372 6561 7469 6f6e         'creation
-0001b020: 4663 7427 3a20 2763 7265 6174 655f 696d  Fct': 'create_im
-0001b030: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
-0001b040: 2927 2c0a 2020 2020 2020 2020 2020 2020  )',.            
-0001b050: 2020 2020 2773 7566 6669 7827 3a20 275f      'suffix': '_
-0001b060: 696d 6167 652d 6861 7368 6573 2e74 7874  image-hashes.txt
-0001b070: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0001b080: 2020 2027 636f 6c73 273a 205b 6d69 7174     'cols': [miqt
-0001b090: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001b0a0: 7269 7174 275d 5b27 6861 7368 275d 5d2c  riqt']['hash']],
-0001b0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b0c0: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
-0001b0d0: 2c0a 2020 2020 2020 2020 2020 2020 2775  ,.            'u
-0001b0e0: 7569 6473 273a 207b 0a20 2020 2020 2020  uids': {.       
-0001b0f0: 2020 2020 2020 2020 2027 6372 6561 7469           'creati
-0001b100: 6f6e 4663 7427 3a20 2763 7265 6174 655f  onFct': 'create_
-0001b110: 7575 6964 5f66 696c 6528 2927 2c0a 2020  uuid_file()',.  
-0001b120: 2020 2020 2020 2020 2020 2020 2020 2773                's
-0001b130: 7566 6669 7827 3a20 275f 696d 6167 652d  uffix': '_image-
-0001b140: 7575 6964 732e 7478 7427 2c0a 2020 2020  uuids.txt',.    
-0001b150: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
-0001b160: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
-0001b170: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001b180: 2775 7569 6427 5d5d 2c0a 2020 2020 2020  'uuid']],.      
-0001b190: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
-0001b1a0: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
-0001b1b0: 2020 2020 2020 2027 6461 7465 7469 6d65         'datetime
-0001b1c0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-0001b1d0: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
-0001b1e0: 7427 3a20 2763 7265 6174 655f 7374 6172  t': 'create_star
-0001b1f0: 745f 7469 6d65 5f66 696c 6528 2927 2c0a  t_time_file()',.
-0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b210: 2773 7566 6669 7827 3a20 275f 696d 6167  'suffix': '_imag
-0001b220: 652d 7374 6172 742d 7469 6d65 732e 7478  e-start-times.tx
-0001b230: 7427 2c0a 2020 2020 2020 2020 2020 2020  t',.            
-0001b240: 2020 2020 2763 6f6c 7327 3a20 5b6d 6971      'cols': [miq
-0001b250: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-0001b260: 6172 6971 7427 5d5b 2775 7463 275d 5d2c  ariqt']['utc']],
-0001b270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b280: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
-0001b290: 2c0a 2020 2020 2020 2020 2020 2020 276e  ,.            'n
-0001b2a0: 6176 6967 6174 696f 6e27 3a20 7b0a 2020  avigation': {.  
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0001b2c0: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
-0001b2d0: 6561 7465 5f69 6d61 6765 5f6e 6176 6967  eate_image_navig
-0001b2e0: 6174 696f 6e5f 6669 6c65 2829 272c 0a20  ation_file()',. 
-0001b2f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001b300: 7375 6666 6978 273a 2027 5f69 6d61 6765  suffix': '_image
-0001b310: 2d6e 6176 6967 6174 696f 6e2e 7478 7427  -navigation.txt'
-0001b320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b330: 2020 2763 6f6c 7327 3a20 5b6d 6971 7476    'cols': [miqtv
-0001b340: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001b350: 6971 7427 5d5b 2775 7463 275d 5d2c 0a20  iqt']['utc']],. 
-0001b360: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001b370: 6f70 7469 6f6e 616c 273a 205b 6d69 7174  optional': [miqt
-0001b380: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001b390: 7269 7174 275d 5b27 6c6f 6e27 5d2c 206d  riqt']['lon'], m
-0001b3a0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001b3b0: 276d 6172 6971 7427 5d5b 276c 6174 275d  'mariqt']['lat']
-0001b3c0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
-0001b3d0: 6572 5b27 6d61 7269 7174 275d 5b27 616c  er['mariqt']['al
-0001b3e0: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
-0001b3f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001b400: 2768 6774 275d 2c20 6d69 7174 762e 636f  'hgt'], miqtv.co
-0001b410: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001b420: 275d 5b27 756e 6365 7274 275d 5d7d 2c0a  ']['uncert']]},.
-0001b430: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0001b440: 2020 2073 656c 662e 6e6f 6e43 6f72 6546     self.nonCoreF
-0001b450: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
-0001b460: 4974 656d 496e 666f 4669 6c65 7320 3d20  ItemInfoFiles = 
-0001b470: 5b5d 0a0a 2020 2020 6465 6620 5f5f 6765  []..    def __ge
-0001b480: 745f 696e 745f 6669 6c65 5f70 7265 6669  t_int_file_prefi
-0001b490: 7828 7365 6c66 293a 0a20 2020 2020 2020  x(self):.       
-0001b4a0: 2022 2222 2064 6570 656e 6473 206f 6e20   """ depends on 
-0001b4b0: 2769 6d61 6765 2d65 7665 6e74 2720 616e  'image-event' an
-0001b4c0: 6420 2769 6d61 6765 2d73 656e 736f 7227  d 'image-sensor'
-0001b4d0: 2073 6f20 6974 2063 616e 2063 6861 6e67   so it can chang
-0001b4e0: 6520 6475 7269 6e67 2075 7061 7465 2022  e during upate "
-0001b4f0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0001b500: 6e20 6f73 2e70 6174 682e 6a6f 696e 2873  n os.path.join(s
-0001b510: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
-0001b520: 6469 722e 6474 2e69 6e74 6572 6d65 6469  dir.dt.intermedi
-0001b530: 6174 6529 2c20 7365 6c66 2e66 696e 6454  ate), self.findT
-0001b540: 6d70 4669 656c 6428 2769 6d61 6765 2d73  mpField('image-s
-0001b550: 6574 2d6e 616d 6527 2929 0a0a 2020 2020  et-name'))..    
-0001b560: 6465 6620 6765 745f 696e 745f 6861 7368  def get_int_hash
-0001b570: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
-0001b580: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001b590: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-0001b5a0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
-0001b5b0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
-0001b5c0: 7344 6566 5f63 6f72 655b 2768 6173 6865  sDef_core['hashe
-0001b5d0: 7327 5d5b 2773 7566 6669 7827 5d0a 0a20  s']['suffix'].. 
-0001b5e0: 2020 2064 6566 2067 6574 5f69 6e74 5f75     def get_int_u
-0001b5f0: 7569 645f 6669 6c65 2873 656c 6629 3a0a  uid_file(self):.
-0001b600: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001b610: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
-0001b620: 6c65 5f70 7265 6669 7828 2920 2b20 7365  le_prefix() + se
-0001b630: 6c66 2e69 6e74 6572 6d65 6469 6174 6546  lf.intermediateF
-0001b640: 696c 6573 4465 665f 636f 7265 5b27 7575  ilesDef_core['uu
-0001b650: 6964 7327 5d5b 2773 7566 6669 7827 5d0a  ids']['suffix'].
-0001b660: 0a20 2020 2064 6566 2067 6574 5f69 6e74  .    def get_int
-0001b670: 5f73 7461 7274 5469 6d65 735f 6669 6c65  _startTimes_file
-0001b680: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001b690: 7265 7475 726e 2073 656c 662e 5f5f 6765  return self.__ge
-0001b6a0: 745f 696e 745f 6669 6c65 5f70 7265 6669  t_int_file_prefi
-0001b6b0: 7828 2920 2b20 7365 6c66 2e69 6e74 6572  x() + self.inter
-0001b6c0: 6d65 6469 6174 6546 696c 6573 4465 665f  mediateFilesDef_
-0001b6d0: 636f 7265 5b27 6461 7465 7469 6d65 275d  core['datetime']
-0001b6e0: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
-0001b6f0: 6465 6620 6765 745f 696e 745f 6e61 765f  def get_int_nav_
-0001b700: 6669 6c65 2873 656c 6629 3a0a 2020 2020  file(self):.    
-0001b710: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001b720: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
-0001b730: 7265 6669 7828 2920 2b20 7365 6c66 2e69  refix() + self.i
-0001b740: 6e74 6572 6d65 6469 6174 6546 696c 6573  ntermediateFiles
-0001b750: 4465 665f 636f 7265 5b27 6e61 7669 6761  Def_core['naviga
-0001b760: 7469 6f6e 275d 5b27 7375 6666 6978 275d  tion']['suffix']
-0001b770: 0a0a                                     ..
+00017590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175a0: 205b 666c 6f61 7428 696d 6167 655f 6474   [float(image_dt
+000175b0: 735b 6669 6c65 5d5b 305d 2e6c 6f6e 292c  s[file][0].lon),
+000175c0: 2066 6c6f 6174 2869 6d61 6765 5f64 7473   float(image_dts
+000175d0: 5b66 696c 655d 5b30 5d2e 6c61 7429 2c20  [file][0].lat), 
+000175e0: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
+000175f0: 6669 6c65 5d5b 305d 2e64 6570 295d 0a20  file][0].dep)]. 
+00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017620: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00017630: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017650: 2020 2020 2020 2067 656f 6d65 7472 7920         geometry 
+00017660: 3d20 207b 2774 7970 6527 3a20 2250 6f69  =  {'type': "Poi
+00017670: 6e74 222c 2027 636f 6f72 6469 6e61 7465  nt", 'coordinate
+00017680: 7327 3a20 0a20 2020 2020 2020 2020 2020  s': .           
+00017690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176a0: 2020 2020 2020 2020 2020 2020 205b 666c               [fl
+000176b0: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
+000176c0: 6c65 5d5b 305d 2e6c 6f6e 292c 2066 6c6f  le][0].lon), flo
+000176d0: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
+000176e0: 655d 5b30 5d2e 6c61 7429 5d0a 2020 2020  e][0].lat)].    
+000176f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017710: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+00017720: 2020 2020 2020 6966 2054 7275 6520 696e        if True in
+00017730: 205b 6d61 7468 2e69 736e 616e 2878 2920   [math.isnan(x) 
+00017740: 666f 7220 7820 696e 2067 656f 6d65 7472  for x in geometr
+00017750: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
+00017760: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00017770: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00017780: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
+00017790: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
+000177a0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000177b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000177c0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
+000177d0: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
+000177e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177f0: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
+00017800: 7065 273a 2022 4d75 6c74 6950 6f69 6e74  pe': "MultiPoint
+00017810: 222c 2027 636f 6f72 6469 6e61 7465 7327  ", 'coordinates'
+00017820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017840: 2020 2020 2020 2020 2020 5b5b 666c 6f61            [[floa
+00017850: 7428 642e 6c6f 6e29 2c20 666c 6f61 7428  t(d.lon), float(
+00017860: 642e 6c61 7429 2c20 666c 6f61 7428 642e  d.lat), float(d.
+00017870: 6465 7029 5d20 666f 7220 6420 696e 2069  dep)] for d in i
+00017880: 6d61 6765 5f64 7473 5b66 696c 655d 5d0a  mage_dts[file]].
+00017890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178b0: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+000178c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000178e0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+000178f0: 203d 2020 7b27 7479 7065 273a 2022 4d75   =  {'type': "Mu
+00017900: 6c74 6950 6f69 6e74 222c 2027 636f 6f72  ltiPoint", 'coor
+00017910: 6469 6e61 7465 7327 3a0a 2020 2020 2020  dinates':.      
+00017920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017940: 2020 5b5b 666c 6f61 7428 642e 6c6f 6e29    [[float(d.lon)
+00017950: 2c20 666c 6f61 7428 642e 6c61 7429 5d20  , float(d.lat)] 
+00017960: 666f 7220 6420 696e 2069 6d61 6765 5f64  for d in image_d
+00017970: 7473 5b66 696c 655d 5d0a 2020 2020 2020  ts[file]].      
+00017980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017990: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
+000179a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179b0: 2020 2020 6966 2054 7275 6520 696e 205b      if True in [
+000179c0: 6d61 7468 2e69 736e 616e 2878 2920 666f  math.isnan(x) fo
+000179d0: 7220 7820 696e 205b 6974 656d 2066 6f72  r x in [item for
+000179e0: 2073 7562 6c69 7374 2069 6e20 6765 6f6d   sublist in geom
+000179f0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
+00017a00: 7327 5d20 666f 7220 6974 656d 2069 6e20  s'] for item in 
+00017a10: 7375 626c 6973 745d 5d3a 0a20 2020 2020  sublist]]:.     
+00017a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a30: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00017a40: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+00017a50: 6a73 6f6e 5b27 6665 6174 7572 6573 275d  json['features']
+00017a60: 2e61 7070 656e 6428 7b27 7479 7065 273a  .append({'type':
+00017a70: 2027 4665 6174 7572 6527 2c20 2770 726f   'Feature', 'pro
+00017a80: 7065 7274 6965 7327 3a20 7b27 6964 273a  perties': {'id':
+00017a90: 2066 696c 657d 2c20 2767 656f 6d65 7472   file}, 'geometr
+00017aa0: 7927 3a20 6765 6f6d 6574 7279 207d 290a  y': geometry }).
+00017ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017ac0: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
+00017ad0: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
+00017ae0: 6e74 5f6e 6176 5f66 696c 6528 292e 7265  nt_nav_file().re
+00017af0: 706c 6163 6528 222e 7478 7422 2c20 222e  place(".txt", ".
+00017b00: 6765 6f6a 736f 6e22 292c 0a20 2020 2020  geojson"),.     
+00017b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b20: 2277 222c 2065 7272 6f72 733d 2269 676e  "w", errors="ign
+00017b30: 6f72 6522 2c20 656e 636f 6469 6e67 3d27  ore", encoding='
+00017b40: 7574 662d 3827 290a 2020 2020 2020 2020  utf-8').        
+00017b50: 2020 2020 6a73 6f6e 2e64 756d 7028 6765      json.dump(ge
+00017b60: 6f6a 736f 6e2c 206f 2c20 656e 7375 7265  ojson, o, ensure
+00017b70: 5f61 7363 6969 3d46 616c 7365 2c20 696e  _ascii=False, in
+00017b80: 6465 6e74 3d34 290a 2020 2020 2020 2020  dent=4).        
+00017b90: 2020 2020 6f2e 636c 6f73 6528 290a 0a20      o.close().. 
+00017ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00017bb0: 7072 6f76 2e61 6464 4172 6775 6d65 6e74  prov.addArgument
+00017bc0: 2822 696e 7075 744e 6176 6967 6174 696f  ("inputNavigatio
+00017bd0: 6e46 696c 6522 2c6e 6176 5f70 6174 682c  nFile",nav_path,
+00017be0: 6f76 6572 7772 6974 653d 5472 7565 290a  overwrite=True).
+00017bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00017c00: 2e70 726f 762e 6c6f 6728 2270 6172 7365  .prov.log("parse
+00017c10: 6420 6672 6f6d 2069 6e70 7574 4e61 7669  d from inputNavi
+00017c20: 6761 7469 6f6e 4669 6c65 3a20 2220 2b20  gationFile: " + 
+00017c30: 7374 7228 6e61 765f 6865 6164 6572 292c  str(nav_header),
+00017c40: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+00017c50: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
+00017c60: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00017c70: 7265 7475 726e 2054 7275 652c 2022 4e61  return True, "Na
+00017c80: 7669 6761 7469 6f6e 2064 6174 6120 6372  vigation data cr
+00017c90: 6561 7465 6422 202b 2072 6574 7572 6e4d  eated" + returnM
+00017ca0: 7367 0a20 2020 2020 2020 2065 6c73 653a  sg.        else:
+00017cb0: 0a20 2020 2020 2020 2020 2020 2073 2e73  .            s.s
+00017cc0: 746f 7028 290a 2020 2020 2020 2020 2020  top().          
+00017cd0: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00017ce0: 224e 6f20 696d 6167 6520 636f 6f72 6469  "No image coordi
+00017cf0: 6e61 7465 7320 666f 756e 6422 202b 2072  nates found" + r
+00017d00: 6574 7572 6e4d 7367 0a0a 2020 2020 6465  eturnMsg..    de
+00017d10: 6620 6372 6561 7465 496d 6167 654e 6176  f createImageNav
+00017d20: 6967 6174 696f 6e46 696c 6528 7365 6c66  igationFile(self
+00017d30: 2c20 6e61 765f 7061 7468 3a20 7374 722c  , nav_path: str,
+00017d40: 206e 6176 5f68 6561 6465 723d 6d69 7174   nav_header=miqt
+00017d50: 762e 706f 735f 6865 6164 6572 5b27 7061  v.pos_header['pa
+00017d60: 6e67 6165 6127 5d2c 2064 6174 655f 666f  ngaea'], date_fo
+00017d70: 726d 6174 3d6d 6971 7476 2e64 6174 655f  rmat=miqtv.date_
+00017d80: 666f 726d 6174 735b 2770 616e 6761 6561  formats['pangaea
+00017d90: 275d 2c20 6f76 6572 7772 6974 653d 4661  '], overwrite=Fa
+00017da0: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
+00017db0: 6f72 203d 2022 5c74 222c 2076 6964 656f  or = "\t", video
+00017dc0: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
+00017dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017df0: 2020 2020 206f 6666 7365 745f 783d 302c       offset_x=0,
+00017e00: 206f 6666 7365 745f 793d 302c 206f 6666   offset_y=0, off
+00017e10: 7365 745f 7a3d 302c 616e 676c 6573 5f69  set_z=0,angles_i
+00017e20: 6e5f 7261 6420 3d20 4661 6c73 652c 2072  n_rad = False, r
+00017e30: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00017e40: 643d 5b5d 293a 0a20 2020 2020 2020 2022  d=[]):.        "
+00017e50: 2222 2044 6570 7265 6361 7465 6420 2d20  "" Deprecated - 
+00017e60: 7573 6520 6372 6561 7465 5f69 6d61 6765  use create_image
+00017e70: 5f6e 6176 6967 6174 696f 6e5f 6669 6c65  _navigation_file
+00017e80: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+00017e90: 662e 6372 6561 7465 5f69 6d61 6765 5f6e  f.create_image_n
+00017ea0: 6176 6967 6174 696f 6e5f 6669 6c65 286e  avigation_file(n
+00017eb0: 6176 5f70 6174 682c 206e 6176 5f68 6561  av_path, nav_hea
+00017ec0: 6465 722c 2064 6174 655f 666f 726d 6174  der, date_format
+00017ed0: 2c20 6f76 6572 7772 6974 652c 2063 6f6c  , overwrite, col
+00017ee0: 5f73 6570 6172 6174 6f72 2c20 7669 6465  _separator, vide
+00017ef0: 6f53 616d 706c 6553 6563 6f6e 6473 2c20  oSampleSeconds, 
+00017f00: 6f66 6673 6574 5f78 2c20 6f66 6673 6574  offset_x, offset
+00017f10: 5f79 2c20 6f66 6673 6574 5f7a 2c20 616e  _y, offset_z, an
+00017f20: 676c 6573 5f69 6e5f 7261 642c 2072 6563  gles_in_rad, rec
+00017f30: 6f72 6473 3262 6549 6e76 6572 7465 6429  ords2beInverted)
+00017f40: 0a0a 0a20 2020 2064 6566 2063 7265 6174  ...    def creat
+00017f50: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
+00017f60: 696c 6528 7365 6c66 2c72 6552 6561 6441  ile(self,reReadA
+00017f70: 6c6c 3d54 7275 6529 3a0a 2020 2020 2020  ll=True):.      
+00017f80: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
+00017f90: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
+00017fa0: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
+00017fb0: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
+00017fc0: 6974 7320 5348 4132 3536 2068 6173 682e  its SHA256 hash.
+00017fd0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00017fe0: 7265 5265 6164 416c 6c20 6973 2054 7275  reReadAll is Tru
+00017ff0: 6520 616c 6c20 696d 6167 6573 2720 6861  e all images' ha
+00018000: 7368 6573 2061 7265 2064 6574 6572 6d69  shes are determi
+00018010: 6e65 642e 204f 7468 6572 7769 7365 206f  ned. Otherwise o
+00018020: 6e6c 7920 666f 7220 7468 6f73 6520 6669  nly for those fi
+00018030: 6c65 730a 2020 2020 2020 2020 2020 2020  les.            
+00018040: 7768 6963 6820 6172 6520 6e6f 7420 7965  which are not ye
+00018050: 7420 696e 2074 6865 2069 6e74 6572 6d65  t in the interme
+00018060: 6469 6174 6520 6669 6c65 2063 6f6e 7461  diate file conta
+00018070: 696e 696e 6720 7468 6520 696d 6167 6520  ining the image 
+00018080: 6861 7368 6573 2020 2222 220a 2020 2020  hashes  """.    
+00018090: 2020 2020 6861 7368 6573 203d 207b 7d0a      hashes = {}.
+000180a0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
+000180b0: 7468 2e65 7869 7374 7328 7365 6c66 2e67  th.exists(self.g
+000180c0: 6574 5f69 6e74 5f68 6173 685f 6669 6c65  et_int_hash_file
+000180d0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+000180e0: 2068 6173 6865 7320 3d20 6d69 7174 662e   hashes = miqtf.
+000180f0: 7461 6246 696c 6544 6174 6128 7365 6c66  tabFileData(self
+00018100: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
+00018110: 6c65 2829 2c20 5b6d 6971 7476 2e63 6f6c  le(), [miqtv.col
+00018120: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00018130: 5d5b 2769 6d67 275d 2c20 6d69 7174 762e  ]['img'], miqtv.
+00018140: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00018150: 7174 275d 5b27 6861 7368 275d 5d2c 206b  qt']['hash']], k
+00018160: 6579 5f63 6f6c 3d6d 6971 7476 2e63 6f6c  ey_col=miqtv.col
+00018170: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00018180: 5d5b 2769 6d67 275d 290a 0a20 2020 2020  ]['img'])..     
+00018190: 2020 2069 6d61 6765 7349 6e52 6177 203d     imagesInRaw =
+000181a0: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
+000181b0: 6167 6573 4469 7228 290a 2020 2020 2020  agesDir().      
+000181c0: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
+000181d0: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
+000181e0: 2020 2020 2020 2020 6164 6465 645f 6861          added_ha
+000181f0: 7368 6573 203d 2030 0a20 2020 2020 2020  shes = 0.       
+00018200: 2020 2020 2070 726f 6720 3d20 6d69 7174       prog = miqt
+00018210: 632e 5072 696e 744b 6e6f 776e 5072 6f67  c.PrintKnownProg
+00018220: 7265 7373 4d73 6728 2243 6865 636b 696e  ressMsg("Checkin
+00018230: 6720 6861 7368 6573 222c 206c 656e 2869  g hashes", len(i
+00018240: 6d61 6765 7349 6e52 6177 292c 6d6f 6475  magesInRaw),modu
+00018250: 6c6f 3d35 290a 2020 2020 2020 2020 2020  lo=5).          
+00018260: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+00018270: 6167 6573 496e 5261 773a 0a20 2020 2020  agesInRaw:.     
+00018280: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
+00018290: 7072 6f67 7265 7373 2829 0a0a 2020 2020  progress()..    
+000182a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000182b0: 6f74 2073 656c 662e 5f5f 616c 6c55 5549  ot self.__allUUI
+000182c0: 4473 4368 6563 6b65 6420 616e 6420 6e6f  DsChecked and no
+000182d0: 7420 6d69 7174 692e 696d 6167 6543 6f6e  t miqti.imageCon
+000182e0: 7461 696e 7356 616c 6964 5555 4944 2866  tainsValidUUID(f
+000182f0: 696c 6529 5b30 5d3a 0a20 2020 2020 2020  ile)[0]:.       
+00018300: 2020 2020 2020 2020 2020 2020 2023 2072               # r
+00018310: 656d 6f76 6520 6672 6f6d 2075 7569 6420  emove from uuid 
+00018320: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00018330: 2020 2020 2020 2020 2069 6620 6f73 2e70           if os.p
+00018340: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+00018350: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
+00018360: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
+00018370: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00018380: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
+00018390: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+000183a0: 292c 2022 7222 290a 2020 2020 2020 2020  ), "r").        
+000183b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183c0: 6c69 6e65 7320 3d20 7265 732e 7265 6164  lines = res.read
+000183d0: 6c69 6e65 7328 290a 2020 2020 2020 2020  lines().        
+000183e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183f0: 7265 732e 636c 6f73 6528 290a 2020 2020  res.close().    
+00018400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018410: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018420: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+00018430: 6e65 7320 3d20 5b5d 0a20 2020 2020 2020  nes = [].       
+00018440: 2020 2020 2020 2020 2020 2020 2069 203d               i =
+00018450: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+00018460: 2020 2020 2020 206c 696e 654e 7220 3d20         lineNr = 
+00018470: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+00018480: 2020 2020 2020 666f 7220 6c69 6e65 2069        for line i
+00018490: 6e20 6c69 6e65 733a 0a20 2020 2020 2020  n lines:.       
+000184a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184b0: 2069 6620 6f73 2e70 6174 682e 6261 7365   if os.path.base
+000184c0: 6e61 6d65 2866 696c 6529 2069 6e20 6c69  name(file) in li
+000184d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184f0: 6c69 6e65 4e72 203d 2069 0a20 2020 2020  lineNr = i.     
+00018500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018510: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018530: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
+00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018550: 6966 206c 696e 654e 7220 213d 2030 3a0a  if lineNr != 0:.
+00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018570: 2020 2020 2020 2020 6465 6c20 6c69 6e65          del line
+00018580: 735b 6c69 6e65 4e72 5d0a 2020 2020 2020  s[lineNr].      
+00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185a0: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
+000185b0: 662e 6765 745f 696e 745f 7575 6964 5f66  f.get_int_uuid_f
+000185c0: 696c 6528 292c 2022 7722 290a 2020 2020  ile(), "w").    
+000185d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185e0: 2020 2020 7265 732e 7772 6974 656c 696e      res.writelin
+000185f0: 6573 286c 696e 6573 290a 2020 2020 2020  es(lines).      
+00018600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018610: 2020 7265 732e 636c 6f73 6528 290a 2020    res.close().  
+00018620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018630: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00018640: 6e28 2022 4669 6c65 2022 202b 2066 696c  n( "File " + fil
+00018650: 6520 2b20 2220 646f 6573 206e 6f74 2063  e + " does not c
+00018660: 6f74 6169 6e20 6120 7661 6c69 6420 5555  otain a valid UU
+00018670: 4944 2e20 5275 6e20 6372 6561 7465 5f75  ID. Run create_u
+00018680: 7569 645f 6669 6c65 2829 2066 6972 7374  uid_file() first
+00018690: 2122 290a 0a20 2020 2020 2020 2020 2020  !")..           
+000186a0: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+000186b0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+000186c0: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
+000186d0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+000186e0: 6552 6561 6441 6c6c 2061 6e64 2066 696c  eReadAll and fil
+000186f0: 655f 6e61 6d65 2069 6e20 6861 7368 6573  e_name in hashes
+00018700: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018710: 2020 2020 2020 6861 7368 6573 5b66 696c        hashes[fil
+00018720: 655f 6e61 6d65 5d20 3d20 6861 7368 6573  e_name] = hashes
+00018730: 5b66 696c 655f 6e61 6d65 5d5b 6d69 7174  [file_name][miqt
+00018740: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00018750: 7269 7174 275d 5b27 6861 7368 275d 5d0a  riqt']['hash']].
+00018760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018770: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018780: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
+00018790: 5b66 696c 655f 6e61 6d65 5d20 3d20 6d69  [file_name] = mi
+000187a0: 7174 632e 7368 6132 3536 4861 7368 4669  qtc.sha256HashFi
+000187b0: 6c65 2866 696c 6529 0a20 2020 2020 2020  le(file).       
+000187c0: 2020 2020 2020 2020 2020 2020 2061 6464               add
+000187d0: 6564 5f68 6173 6865 7320 2b3d 2031 0a20  ed_hashes += 1. 
+000187e0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
+000187f0: 636c 6561 7228 290a 0a20 2020 2020 2020  clear()..       
+00018800: 2020 2020 2069 6620 7265 5265 6164 416c       if reReadAl
+00018810: 6c20 6f72 2061 6464 6564 5f68 6173 6865  l or added_hashe
+00018820: 7320 3e20 303a 0a20 2020 2020 2020 2020  s > 0:.         
+00018830: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
+00018840: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
+00018850: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
+00018860: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
+00018870: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
+00018880: 2e77 7269 7465 2820 6d69 7174 762e 636f  .write( miqtv.co
+00018890: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000188a0: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
+000188b0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000188c0: 276d 6172 6971 7427 5d5b 2768 6173 6827  'mariqt']['hash'
+000188d0: 5d2b 225c 6e22 290a 2020 2020 2020 2020  ]+"\n").        
+000188e0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+000188f0: 5f6e 616d 6520 696e 2068 6173 6865 733a  _name in hashes:
+00018900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018910: 2020 2020 2068 6173 685f 6669 6c65 2e77       hash_file.w
+00018920: 7269 7465 2866 696c 655f 6e61 6d65 2b22  rite(file_name+"
+00018930: 5c74 222b 6861 7368 6573 5b66 696c 655f  \t"+hashes[file_
+00018940: 6e61 6d65 5d2b 225c 6e22 290a 0a20 2020  name]+"\n")..   
+00018950: 2020 2020 2020 2020 2020 2020 2068 6173               has
+00018960: 685f 6669 6c65 2e63 6c6f 7365 2829 0a20  h_file.close(). 
+00018970: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018980: 6574 7572 6e20 5472 7565 2c20 2241 6464  eturn True, "Add
+00018990: 6564 2022 2b73 7472 2861 6464 6564 5f68  ed "+str(added_h
+000189a0: 6173 6865 7329 2b22 2068 6173 6865 7320  ashes)+" hashes 
+000189b0: 746f 2068 6173 6820 6669 6c65 220a 2020  to hash file".  
+000189c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189e0: 7265 7475 726e 2054 7275 652c 2022 416c  return True, "Al
+000189f0: 6c20 6861 7368 6573 2065 7869 7374 220a  l hashes exist".
+00018a00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00018a10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00018a20: 6e20 4661 6c73 652c 2022 4e6f 2069 6d61  n False, "No ima
+00018a30: 6765 7320 666f 756e 6420 746f 2068 6173  ges found to has
+00018a40: 6822 0a20 2020 2020 2020 200a 2020 2020  h".        .    
+00018a50: 6465 6620 6372 6561 7465 496d 6167 6553  def createImageS
+00018a60: 4841 3235 3646 696c 6528 7365 6c66 2c72  HA256File(self,r
+00018a70: 6552 6561 6441 6c6c 3d54 7275 6529 3a0a  eReadAll=True):.
+00018a80: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
+00018a90: 6563 6174 6564 202d 2075 7365 2063 7265  ecated - use cre
+00018aa0: 6174 655f 696d 6167 655f 7368 6132 3536  ate_image_sha256
+00018ab0: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
+00018ac0: 2020 7265 7475 726e 2073 656c 662e 6372    return self.cr
+00018ad0: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+00018ae0: 365f 6669 6c65 2872 6552 6561 6441 6c6c  6_file(reReadAll
+00018af0: 290a 0a0a 2020 2020 6465 6620 6372 6561  )...    def crea
+00018b00: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
+00018b10: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+00018b20: 2020 2222 2220 4372 6561 7465 7320 696e    """ Creates in
+00018b30: 202f 696e 7465 726d 6564 6961 7465 2061   /intermediate a
+00018b40: 2074 6578 7420 6669 6c65 2063 6f6e 7461   text file conta
+00018b50: 696e 696e 6720 7065 7220 696d 6167 6520  ining per image 
+00018b60: 6974 7320 7374 6172 7420 7469 6d65 2070  its start time p
+00018b70: 6172 7365 6420 6672 6f6d 2074 6865 2066  arsed from the f
+00018b80: 696c 6520 6e61 6d65 2022 2222 0a0a 2020  ile name """..  
+00018b90: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+00018ba0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+00018bb0: 2243 7265 6174 696e 6720 696e 7465 726d  "Creating interm
+00018bc0: 6564 6961 7465 2073 7461 7274 7469 6d65  ediate starttime
+00018bd0: 2066 696c 6520 2229 0a20 2020 2020 2020   file ").       
+00018be0: 2069 6d61 6765 7349 6e52 6177 203d 2073   imagesInRaw = s
+00018bf0: 656c 662e 696d 6167 6573 496e 496d 6167  elf.imagesInImag
+00018c00: 6573 4469 7253 6f72 7465 644c 6973 7428  esDirSortedList(
+00018c10: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
+00018c20: 2869 6d61 6765 7349 6e52 6177 2920 3e20  (imagesInRaw) > 
+00018c30: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
+00018c40: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
+00018c50: 745f 696e 745f 7374 6172 7454 696d 6573  t_int_startTimes
+00018c60: 5f66 696c 6528 292c 2022 7722 290a 2020  _file(), "w").  
+00018c70: 2020 2020 2020 2020 2020 6f2e 7772 6974            o.writ
+00018c80: 6528 6d69 7174 762e 636f 6c5f 6865 6164  e(miqtv.col_head
+00018c90: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00018ca0: 6727 5d20 2b0a 2020 2020 2020 2020 2020  g'] +.          
+00018cb0: 2020 2020 2020 2020 2020 225c 7422 2b6d            "\t"+m
+00018cc0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00018cd0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
+00018ce0: 2b22 5c6e 2229 0a0a 2020 2020 2020 2020  +"\n")..        
+00018cf0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00018d00: 696d 6167 6573 496e 5261 773a 0a20 2020  imagesInRaw:.   
+00018d10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00018d20: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00018d30: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00018d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018d50: 2064 7420 3d20 6d69 7174 632e 7061 7273   dt = miqtc.pars
+00018d60: 6546 696c 6544 6174 6554 696d 6541 7355  eFileDateTimeAsU
+00018d70: 5443 2866 696c 655f 6e61 6d65 290a 2020  TC(file_name).  
+00018d80: 2020 2020 2020 2020 2020 2020 2020 6f2e                o.
+00018d90: 7772 6974 6528 6669 6c65 5f6e 616d 652b  write(file_name+
+00018da0: 225c 7422 202b 2064 742e 7374 7266 7469  "\t" + dt.strfti
+00018db0: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
+00018dc0: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
+00018dd0: 2b22 5c6e 2229 0a0a 2020 2020 2020 2020  +"\n")..        
+00018de0: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
+00018df0: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00018e00: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+00018e10: 6574 7572 6e20 5472 7565 2c20 2243 7265  eturn True, "Cre
+00018e20: 6174 6564 2073 7461 7274 2074 696d 6520  ated start time 
+00018e30: 6669 6c65 220a 2020 2020 2020 2020 656c  file".        el
+00018e40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018e50: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00018e60: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00018e70: 652c 2022 4e6f 2069 6d61 6765 7320 666f  e, "No images fo
+00018e80: 756e 6420 746f 2072 6561 6420 7374 6172  und to read star
+00018e90: 7420 7469 6d65 7322 0a20 2020 2020 2020  t times".       
+00018ea0: 200a 2020 2020 6465 6620 6372 6561 7465   .    def create
+00018eb0: 5374 6172 7454 696d 6546 696c 6528 7365  StartTimeFile(se
+00018ec0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00018ed0: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
+00018ee0: 6520 6372 6561 7465 5f73 7461 7274 5f74  e create_start_t
+00018ef0: 696d 655f 6669 6c65 2022 2222 0a20 2020  ime_file """.   
+00018f00: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00018f10: 2e63 7265 6174 655f 7374 6172 745f 7469  .create_start_ti
+00018f20: 6d65 5f66 696c 6528 290a 0a0a 2020 2020  me_file()...    
+00018f30: 6465 6620 6372 6561 7465 4163 7175 6973  def createAcquis
+00018f40: 6974 696f 6e53 6574 7469 6e67 7345 5849  itionSettingsEXI
+00018f50: 4646 696c 6528 7365 6c66 2c6f 7665 7272  FFile(self,overr
+00018f60: 6964 653d 4661 6c73 6529 3a0a 2020 2020  ide=False):.    
+00018f70: 2020 2020 2222 2220 4372 6561 7465 7320      """ Creates 
+00018f80: 696e 202f 696e 7465 726d 6564 6961 7465  in /intermediate
+00018f90: 2061 2074 6578 7420 6669 6c65 2063 6f6e   a text file con
+00018fa0: 7461 696e 696e 6720 7065 7220 696d 6167  taining per imag
+00018fb0: 6520 6120 6469 6374 206f 6620 6578 6966  e a dict of exif
+00018fc0: 2074 6167 7320 616e 6420 7468 6569 7220   tags and their 
+00018fd0: 7661 6c75 6573 2070 6172 7365 6420 6672  values parsed fr
+00018fe0: 6f6d 2074 6865 2069 6d61 6765 2022 2222  om the image """
+00018ff0: 0a0a 2020 2020 2020 2020 696e 745f 6163  ..        int_ac
+00019000: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
+00019010: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
+00019020: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+00019030: 6978 2829 202b 2027 5f69 6d61 6765 2d61  ix() + '_image-a
+00019040: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
+00019050: 6e67 732e 7478 7427 0a20 2020 2020 2020  ngs.txt'.       
+00019060: 2068 6561 6465 7220 3d20 7b20 206d 6971   header = {  miq
+00019070: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00019080: 6172 6971 7427 5d5b 2769 6d67 275d 3a20  ariqt']['img']: 
+00019090: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+000190a0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000190b0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+000190c0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+000190d0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000190e0: 275d 5b27 6163 7175 6927 5d3a 6d69 7174  ']['acqui']:miqt
+000190f0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00019100: 7269 7174 275d 5b27 6163 7175 6927 5d7d  riqt']['acqui']}
+00019110: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00019120: 6174 682e 6578 6973 7473 2869 6e74 5f61  ath.exists(int_a
+00019130: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
+00019140: 675f 6669 6c65 2920 616e 6420 6e6f 7420  g_file) and not 
+00019150: 6f76 6572 7269 6465 3a0a 2020 2020 2020  override:.      
+00019160: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
+00019170: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
+00019180: 6528 696e 745f 6163 7175 6973 6974 696f  e(int_acquisitio
+00019190: 6e53 6574 7469 6e67 5f66 696c 652c 225c  nSetting_file,"\
+000191a0: 7422 2c68 6561 6465 7229 0a20 2020 2020  t",header).     
+000191b0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+000191c0: 7565 2c20 2252 6573 756c 7420 6669 6c65  ue, "Result file
+000191d0: 2065 7869 7374 7322 0a0a 2020 2020 2020   exists"..      
+000191e0: 2020 696d 6167 6573 496e 5261 7720 3d20    imagesInRaw = 
+000191f0: 7365 6c66 2e69 6d61 6765 7349 6e49 6d61  self.imagesInIma
+00019200: 6765 7344 6972 536f 7274 6564 4c69 7374  gesDirSortedList
+00019210: 2829 0a20 2020 2020 2020 2069 6620 6c65  ().        if le
+00019220: 6e28 696d 6167 6573 496e 5261 7729 203e  n(imagesInRaw) >
+00019230: 2030 3a0a 0a20 2020 2020 2020 2020 2020   0:..           
+00019240: 206f 203d 206f 7065 6e28 696e 745f 6163   o = open(int_ac
+00019250: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
+00019260: 5f66 696c 652c 2022 7722 290a 2020 2020  _file, "w").    
+00019270: 2020 2020 2020 2020 6f2e 7772 6974 6528          o.write(
+00019280: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00019290: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
+000192a0: 5d20 2b20 225c 7422 2b6d 6971 7476 2e63  ] + "\t"+miqtv.c
+000192b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000192c0: 7427 5d5b 2761 6371 7569 275d 2b22 5c6e  t']['acqui']+"\n
+000192d0: 2229 0a20 0a20 2020 2020 2020 2020 2020  "). .           
+000192e0: 2069 6d61 6765 7345 7869 6673 203d 206d   imagesExifs = m
+000192f0: 6971 7469 2e67 6574 496d 6167 6573 416c  iqti.getImagesAl
+00019300: 6c45 7869 6656 616c 7565 7328 696d 6167  lExifValues(imag
+00019310: 6573 496e 5261 772c 7365 6c66 2e70 726f  esInRaw,self.pro
+00019320: 7629 0a20 2020 2020 2020 2020 2020 2066  v).            f
+00019330: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
+00019340: 7345 7869 6673 3a0a 2020 2020 2020 2020  sExifs:.        
+00019350: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+00019360: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+00019370: 6e61 6d65 2866 696c 6529 0a20 2020 2020  name(file).     
+00019380: 2020 2020 2020 2020 2020 206f 2e77 7269             o.wri
+00019390: 7465 2866 696c 655f 6e61 6d65 2b22 5c74  te(file_name+"\t
+000193a0: 222b 7374 7228 696d 6167 6573 4578 6966  "+str(imagesExif
+000193b0: 735b 6669 6c65 5d29 2b22 5c6e 2229 0a0a  s[file])+"\n")..
+000193c0: 2020 2020 2020 2020 2020 2020 6f2e 636c              o.cl
+000193d0: 6f73 6528 290a 0a20 2020 2020 2020 2020  ose()..         
+000193e0: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
+000193f0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2869  _info_tab_file(i
+00019400: 6e74 5f61 6371 7569 7369 7469 6f6e 5365  nt_acquisitionSe
+00019410: 7474 696e 675f 6669 6c65 2c22 5c74 222c  tting_file,"\t",
+00019420: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
+00019430: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00019440: 2022 4372 6561 7465 6420 6163 7175 6973   "Created acquis
+00019450: 6974 696f 6e20 7365 7474 696e 6773 2066  ition settings f
+00019460: 696c 6522 0a20 2020 2020 2020 2065 6c73  ile".        els
+00019470: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00019480: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
+00019490: 2069 6d61 6765 7320 666f 756e 6422 0a0a   images found"..
+000194a0: 0a20 2020 2064 6566 2069 6d61 6765 7349  .    def imagesI
+000194b0: 6e49 6d61 6765 7344 6972 2873 656c 6629  nImagesDir(self)
+000194c0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000194d0: 2063 6f70 792e 6465 6570 636f 7079 2873   copy.deepcopy(s
+000194e0: 656c 662e 5f69 6d61 6765 7349 6e49 6d61  elf._imagesInIma
+000194f0: 6765 7344 6972 290a 0a20 2020 2064 6566  gesDir)..    def
+00019500: 2069 6d61 6765 7349 6e49 6d61 6765 7344   imagesInImagesD
+00019510: 6972 536f 7274 6564 4c69 7374 2873 656c  irSortedList(sel
+00019520: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00019530: 726e 2063 6f70 792e 6465 6570 636f 7079  rn copy.deepcopy
+00019540: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
+00019550: 6d61 6765 7344 6972 536f 7274 6564 4c69  magesDirSortedLi
+00019560: 7374 290a 0a0a 2020 2020 6465 6620 7061  st)...    def pa
+00019570: 7273 6549 7465 6d44 6174 6166 726f 6d54  rseItemDatafromT
+00019580: 6162 4669 6c65 4461 7461 2873 656c 662c  abFileData(self,
+00019590: 2069 7465 6d73 3a20 6469 6374 2c20 6669   items: dict, fi
+000195a0: 6c65 3a20 7374 722c 2063 6f6c 733a 206c  le: str, cols: l
+000195b0: 6973 742c 206f 7074 696f 6e61 6c3a 206c  ist, optional: l
+000195c0: 6973 7420 3d20 5b5d 2c20 6461 7465 7469  ist = [], dateti
+000195d0: 6d65 5f66 6f72 6d61 743a 7374 723d 6d69  me_format:str=mi
+000195e0: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+000195f0: 5b27 6d61 7269 7174 275d 293a 0a20 2020  ['mariqt']):.   
+00019600: 2020 2020 2022 2222 2070 6172 7365 7320       """ parses 
+00019610: 6461 7461 2066 726f 6d20 636f 6c75 6d6e  data from column
+00019620: 7320 696e 2063 6f6c 7320 616e 6420 7772  s in cols and wr
+00019630: 6974 6573 2069 6e66 6f20 746f 2069 7465  ites info to ite
+00019640: 6d73 2e20 436f 6c75 6d6e 2027 696d 6167  ms. Column 'imag
+00019650: 652d 6669 6c65 6e61 6d65 2720 6d75 7374  e-filename' must
+00019660: 2062 6520 696e 2066 696c 6520 616e 6420   be in file and 
+00019670: 646f 6573 206e 6f74 206e 6565 6420 746f  does not need to
+00019680: 2062 6520 7061 7373 6564 2069 6e20 636f   be passed in co
+00019690: 6c73 2e20 0a20 2020 2020 2020 2020 2020  ls. .           
+000196a0: 2046 696c 6520 6d75 7374 2062 6520 7461   File must be ta
+000196b0: 6220 7365 7061 7261 7465 6420 616e 6420  b separated and 
+000196c0: 636f 6c75 6d6e 7320 6e61 6d65 7320 6d75  columns names mu
+000196d0: 7374 2065 7175 616c 2069 7465 6d20 6669  st equal item fi
+000196e0: 656c 6420 6e61 6d65 7322 2222 0a20 2020  eld names""".   
+000196f0: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
+00019700: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
+00019710: 6128 6669 6c65 2c20 636f 6c73 2b5b 2769  a(file, cols+['i
+00019720: 6d61 6765 2d66 696c 656e 616d 6527 5d2b  mage-filename']+
+00019730: 6f70 7469 6f6e 616c 2c20 6b65 795f 636f  optional, key_co
+00019740: 6c3d 2769 6d61 6765 2d66 696c 656e 616d  l='image-filenam
+00019750: 6527 2c20 6f70 7469 6f6e 616c 3d6f 7074  e', optional=opt
+00019760: 696f 6e61 6c2c 636f 6e76 6572 743d 5472  ional,convert=Tr
+00019770: 7565 290a 2020 2020 2020 2020 7365 6c66  ue).        self
+00019780: 2e77 7269 7465 5061 7273 6564 4461 7461  .writeParsedData
+00019790: 546f 4974 656d 7328 746d 705f 6461 7461  ToItems(tmp_data
+000197a0: 2c69 7465 6d73 2c73 656c 662e 6966 646f  ,items,self.ifdo
+000197b0: 5f74 6d70 5b6d 6971 7476 2e69 6d61 6765  _tmp[miqtv.image
+000197c0: 5f73 6574 5f68 6561 6465 725f 6b65 795d  _set_header_key]
+000197d0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+000197e0: 743d 6461 7465 7469 6d65 5f66 6f72 6d61  t=datetime_forma
+000197f0: 7429 0a0a 0a20 2020 2064 6566 2070 7261  t)...    def pra
+00019800: 7365 4974 656d 4461 7461 4672 6f6d 4669  seItemDataFromFi
+00019810: 6c65 2873 656c 662c 6974 656d 733a 6469  le(self,items:di
+00019820: 6374 2c66 696c 653a 7374 722c 7365 7061  ct,file:str,sepa
+00019830: 7261 746f 723a 7374 722c 6865 6164 6572  rator:str,header
+00019840: 3a64 6963 742c 2064 6174 6574 696d 655f  :dict, datetime_
+00019850: 666f 726d 6174 3a73 7472 3d6d 6971 7476  format:str=miqtv
+00019860: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+00019870: 6172 6971 7427 5d29 3a0a 2020 2020 2020  ariqt']):.      
+00019880: 2020 2222 2220 7061 7273 6573 2064 6174    """ parses dat
+00019890: 6120 6672 6f6d 2066 726f 6d20 6669 6c65  a from from file
+000198a0: 2074 6f20 6974 656d 732e 2068 6561 6465   to items. heade
+000198b0: 7220 6469 6374 206d 7573 7420 6265 206f  r dict must be o
+000198c0: 6620 7374 7275 6374 7572 653a 207b 3c69  f structure: {<i
+000198d0: 7465 6d2d 6669 656c 642d 6e61 6d65 3e3a  tem-field-name>:
+000198e0: 3c63 6f6c 756d 6e2d 6e61 6d65 3e7d 0a20  <column-name>}. 
+000198f0: 2020 2020 2020 2020 2020 2061 6e64 206d             and m
+00019900: 7573 7420 636f 6e74 6169 6e20 656e 7472  ust contain entr
+00019910: 7920 2769 6d61 6765 2d66 696c 656e 616d  y 'image-filenam
+00019920: 6527 2022 2222 0a20 2020 2020 2020 2069  e' """.        i
+00019930: 6620 6e6f 7420 2769 6d61 6765 2d66 696c  f not 'image-fil
+00019940: 656e 616d 6527 2069 6e20 6865 6164 6572  ename' in header
+00019950: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00019960: 6973 6520 4578 6365 7074 696f 6e28 2268  ise Exception("h
+00019970: 6561 6465 7220 646f 6573 206e 6f74 2063  eader does not c
+00019980: 6f6e 7461 696e 2027 696d 6167 652d 6669  ontain 'image-fi
+00019990: 6c65 6e61 6d65 2722 290a 2020 2020 2020  lename'").      
+000199a0: 2020 0a20 2020 2020 2020 2074 6d70 5f64    .        tmp_d
+000199b0: 6174 6120 3d20 6d69 7174 662e 7461 6246  ata = miqtf.tabF
+000199c0: 696c 6544 6174 6128 6669 6c65 2c20 6865  ileData(file, he
+000199d0: 6164 6572 2c63 6f6c 5f73 6570 6172 6174  ader,col_separat
+000199e0: 6f72 3d73 6570 6172 6174 6f72 2c20 6b65  or=separator, ke
+000199f0: 795f 636f 6c3d 2769 6d61 6765 2d66 696c  y_col='image-fil
+00019a00: 656e 616d 6527 2c63 6f6e 7665 7274 3d54  ename',convert=T
+00019a10: 7275 6529 0a20 2020 2020 2020 2073 656c  rue).        sel
+00019a20: 662e 7772 6974 6550 6172 7365 6444 6174  f.writeParsedDat
+00019a30: 6154 6f49 7465 6d73 2874 6d70 5f64 6174  aToItems(tmp_dat
+00019a40: 612c 6974 656d 732c 7365 6c66 2e69 6664  a,items,self.ifd
+00019a50: 6f5f 746d 705b 6d69 7174 762e 696d 6167  o_tmp[miqtv.imag
+00019a60: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
+00019a70: 5d2c 2064 6174 6574 696d 655f 666f 726d  ], datetime_form
+00019a80: 6174 3d64 6174 6574 696d 655f 666f 726d  at=datetime_form
+00019a90: 6174 290a 0a0a 2020 2020 6465 6620 7772  at)...    def wr
+00019aa0: 6974 6550 6172 7365 6444 6174 6154 6f49  iteParsedDataToI
+00019ab0: 7465 6d73 2873 656c 662c 6461 7461 3a64  tems(self,data:d
+00019ac0: 6963 742c 6974 656d 733a 6469 6374 2c68  ict,items:dict,h
+00019ad0: 6561 6465 723a 6469 6374 2c20 6461 7465  eader:dict, date
+00019ae0: 7469 6d65 5f66 6f72 6d61 743a 7374 723d  time_format:str=
+00019af0: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+00019b00: 7473 5b27 6d61 7269 7174 275d 293a 0a0a  ts['mariqt']):..
+00019b10: 2020 2020 2020 2020 2320 6576 616c 2073          # eval s
+00019b20: 7472 696e 6773 2061 7320 6469 6374 206f  trings as dict o
+00019b30: 7220 6c69 7374 0a20 2020 2020 2020 206d  r list.        m
+00019b40: 6971 7463 2e72 6563 7572 7369 7665 4576  iqtc.recursiveEv
+00019b50: 616c 2864 6174 6129 0a0a 2020 2020 2020  al(data)..      
+00019b60: 2020 2320 706f 7465 6e74 6169 6c6c 7920    # potentailly 
+00019b70: 7265 6d6f 7665 2063 6f6e 7374 2064 6174  remove const dat
+00019b80: 6120 6672 6f6d 2069 7465 6d73 2061 6e64  a from items and
+00019b90: 2070 7574 2069 6e20 6865 6164 6572 0a20   put in header. 
+00019ba0: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
+00019bb0: 6163 7443 6f6e 7374 4461 7461 5661 6c75  actConstDataValu
+00019bc0: 6573 2864 6174 612c 6865 6164 6572 290a  es(data,header).
+00019bd0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+00019be0: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
+00019bf0: 7952 656d 6f76 6545 6d70 7479 4669 656c  yRemoveEmptyFiel
+00019c00: 6473 2864 6174 612c 636f 6e74 656e 7432  ds(data,content2
+00019c10: 6265 5265 6d6f 7665 643d 4e6f 6e65 290a  beRemoved=None).
+00019c20: 0a20 2020 2020 2020 2023 2061 6464 2027  .        # add '
+00019c30: 696d 6167 652d 6669 6c65 6e61 6d65 2720  image-filename' 
+00019c40: 6669 656c 640a 2020 2020 2020 2020 666f  field.        fo
+00019c50: 7220 696d 672c 2065 6e74 7279 2069 6e20  r img, entry in 
+00019c60: 6461 7461 2e69 7465 6d73 2829 3a0a 0a20  data.items():.. 
+00019c70: 2020 2020 2020 2020 2020 2023 206c 6973             # lis
+00019c80: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
+00019c90: 2069 7369 6e73 7461 6e63 6528 656e 7472   isinstance(entr
+00019ca0: 792c 6c69 7374 293a 0a20 2020 2020 2020  y,list):.       
+00019cb0: 2020 2020 2020 2020 2066 6f72 206c 6973           for lis
+00019cc0: 7449 7465 6d20 696e 2065 6e74 7279 3a0a  tItem in entry:.
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ce0: 2020 2020 6c69 7374 4974 656d 5b27 696d      listItem['im
+00019cf0: 6167 652d 6669 6c65 6e61 6d65 275d 203d  age-filename'] =
+00019d00: 2069 6d67 0a20 2020 2020 2020 2020 2020   img.           
+00019d10: 2020 2020 2020 2020 2023 2063 6f76 6572           # cover
+00019d20: 7420 6461 7465 7469 6d65 2073 7472 696e  t datetime strin
+00019d30: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00019d40: 2020 2020 2020 6966 2027 696d 6167 652d        if 'image-
+00019d50: 6461 7465 7469 6d65 2720 696e 206c 6973  datetime' in lis
+00019d60: 7449 7465 6d3a 0a20 2020 2020 2020 2020  tItem:.         
+00019d70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00019d80: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
+00019d90: 6574 696d 652e 7374 7270 7469 6d65 286c  etime.strptime(l
+00019da0: 6973 7449 7465 6d5b 2769 6d61 6765 2d64  istItem['image-d
+00019db0: 6174 6574 696d 6527 5d2c 2064 6174 6574  atetime'], datet
+00019dc0: 696d 655f 666f 726d 6174 290a 2020 2020  ime_format).    
+00019dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019de0: 2020 2020 6c69 7374 4974 656d 5b27 696d      listItem['im
+00019df0: 6167 652d 6461 7465 7469 6d65 275d 203d  age-datetime'] =
+00019e00: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
+00019e10: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00019e20: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
+00019e30: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+00019e40: 7374 616e 6365 2865 6e74 7279 2c64 6963  stance(entry,dic
+00019e50: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00019e60: 2020 2020 656e 7472 795b 2769 6d61 6765      entry['image
+00019e70: 2d66 696c 656e 616d 6527 5d20 3d20 696d  -filename'] = im
+00019e80: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00019e90: 2020 2320 636f 7665 7274 2064 6174 6574    # covert datet
+00019ea0: 696d 6520 7374 7269 6e67 0a20 2020 2020  ime string.     
+00019eb0: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
+00019ec0: 6d61 6765 2d64 6174 6574 696d 6527 2069  mage-datetime' i
+00019ed0: 6e20 656e 7472 793a 0a20 2020 2020 2020  n entry:.       
+00019ee0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+00019ef0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
+00019f00: 696d 652e 7374 7270 7469 6d65 2865 6e74  ime.strptime(ent
+00019f10: 7279 5b27 696d 6167 652d 6461 7465 7469  ry['image-dateti
+00019f20: 6d65 275d 2c20 6461 7465 7469 6d65 5f66  me'], datetime_f
+00019f30: 6f72 6d61 7429 0a20 2020 2020 2020 2020  ormat).         
+00019f40: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00019f50: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+00019f60: 275d 203d 2064 742e 7374 7266 7469 6d65  '] = dt.strftime
+00019f70: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
+00019f80: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
+00019f90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00019fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019fb0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00019fc0: 6f45 7863 6570 7469 6f6e 2822 6461 7461  oException("data
+00019fd0: 2065 6e74 7269 6573 206d 7573 7420 6265   entries must be
+00019fe0: 2064 6963 7420 6f72 206c 6973 7420 6966   dict or list if
+00019ff0: 2064 6963 7473 2229 0a0a 2020 2020 2020   dicts")..      
+0001a000: 2020 6d69 7174 632e 7265 6375 7273 6976    miqtc.recursiv
+0001a010: 656c 7955 7064 6174 6544 6963 7473 2869  elyUpdateDicts(i
+0001a020: 7465 6d73 2c64 6174 6129 0a0a 0a20 2020  tems,data)...   
+0001a030: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
+0001a040: 2020 2064 6566 2065 7874 7261 6374 436f     def extractCo
+0001a050: 6e73 7444 6174 6156 616c 7565 7328 6461  nstDataValues(da
+0001a060: 7461 3a64 6963 742c 6865 6164 6572 3a64  ta:dict,header:d
+0001a070: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
+0001a080: 2220 5265 6d6f 7665 7320 6669 656c 6473  " Removes fields
+0001a090: 2074 6861 7420 6172 6520 636f 6e73 7461   that are consta
+0001a0a0: 6e74 2066 6f72 2061 6c6c 2065 6e74 7269  nt for all entri
+0001a0b0: 6573 2066 726f 6d20 6461 7461 2064 6963  es from data dic
+0001a0c0: 7420 616e 6420 7075 7420 7468 656d 2069  t and put them i
+0001a0d0: 6e20 6865 6164 6572 2064 6963 742e 200a  n header dict. .
+0001a0e0: 2020 2020 2020 2020 2020 2020 4561 6368              Each
+0001a0f0: 2065 6e74 7279 206f 6620 6461 7461 206d   entry of data m
+0001a100: 7573 7420 6265 2061 2064 6963 7420 7769  ust be a dict wi
+0001a110: 7468 2074 6865 2073 616d 6520 7365 7420  th the same set 
+0001a120: 6f66 206b 6579 732e 2022 2222 0a20 2020  of keys. """.   
+0001a130: 200a 2020 2020 2020 2020 6669 656c 6473   .        fields
+0001a140: 546f 4967 6e6f 7265 203d 205b 2769 6d61  ToIgnore = ['ima
+0001a150: 6765 2d64 6174 6574 696d 6527 5d0a 2020  ge-datetime'].  
+0001a160: 2020 2020 2020 636f 6e73 7444 6174 6120        constData 
+0001a170: 3d20 7b7d 0a20 2020 2020 2020 2066 6972  = {}.        fir
+0001a180: 7374 496d 6167 6520 3d20 5472 7565 0a20  stImage = True. 
+0001a190: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
+0001a1a0: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
+0001a1b0: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
+0001a1c0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
+0001a1d0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001a1e0: 6e73 7461 6e63 6528 696d 6167 655f 6461  nstance(image_da
+0001a1f0: 7461 2c6c 6973 7429 3a0a 2020 2020 2020  ta,list):.      
+0001a200: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+0001a210: 6461 7461 203d 205b 696d 6167 655f 6461  data = [image_da
+0001a220: 7461 5d0a 0a20 2020 2020 2020 2020 2020  ta]..           
+0001a230: 2069 6620 6e6f 7420 6669 7273 7449 6d61   if not firstIma
+0001a240: 6765 2061 6e64 2063 6f6e 7374 4461 7461  ge and constData
+0001a250: 203d 3d20 7b7d 3a0a 2020 2020 2020 2020   == {}:.        
+0001a260: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0001a270: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0001a280: 2020 2020 2020 2066 6972 7374 5469 6d65         firstTime
+0001a290: 506f 696e 7420 3d20 5472 7565 0a20 2020  Point = True.   
+0001a2a0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+0001a2b0: 6765 5f74 705f 6461 7461 2069 6e20 696d  ge_tp_data in im
+0001a2c0: 6167 655f 6461 7461 3a0a 2020 2020 2020  age_data:.      
+0001a2d0: 2020 2020 2020 2020 2020 2320 7665 7279            # very
+0001a2e0: 2066 6972 7374 2064 6174 6120 666f 7220   first data for 
+0001a2f0: 636f 6d70 6172 6973 6f6e 0a20 2020 2020  comparison.     
+0001a300: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+0001a310: 7273 7449 6d61 6765 2061 6e64 2066 6972  rstImage and fir
+0001a320: 7374 5469 6d65 506f 696e 743a 0a20 2020  stTimePoint:.   
+0001a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a340: 2063 6f6e 7374 4461 7461 203d 2063 6f70   constData = cop
+0001a350: 792e 6465 6570 636f 7079 2869 6d61 6765  y.deepcopy(image
+0001a360: 5f74 705f 6461 7461 290a 2020 2020 2020  _tp_data).      
+0001a370: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001a380: 7220 6669 656c 6420 696e 2066 6965 6c64  r field in field
+0001a390: 7354 6f49 676e 6f72 653a 0a20 2020 2020  sToIgnore:.     
+0001a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3b0: 2020 2069 6620 6669 656c 6420 696e 2063     if field in c
+0001a3c0: 6f6e 7374 4461 7461 3a0a 2020 2020 2020  onstData:.      
+0001a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a3e0: 2020 2020 2020 6465 6c20 636f 6e73 7444        del constD
+0001a3f0: 6174 615b 6669 656c 645d 0a20 2020 2020  ata[field].     
+0001a400: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001a410: 6972 7374 5469 6d65 506f 696e 7420 3d20  irstTimePoint = 
+0001a420: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0001a430: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+0001a440: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
+0001a450: 2020 2020 636f 6e73 7444 6174 6120 3d20      constData = 
+0001a460: 6d69 7174 632e 6669 6e64 436f 6d6d 6f6e  miqtc.findCommon
+0001a470: 4469 6374 456c 656d 656e 7473 2869 6d61  DictElements(ima
+0001a480: 6765 5f74 705f 6461 7461 2c63 6f6e 7374  ge_tp_data,const
+0001a490: 4461 7461 290a 0a20 2020 2020 2020 2020  Data)..         
+0001a4a0: 2020 2066 6972 7374 496d 6167 6520 3d20     firstImage = 
+0001a4b0: 4661 6c73 650a 0a20 2020 2020 2020 2023  False..        #
+0001a4c0: 2054 4f44 4f20 6368 6563 6b20 7769 7468   TODO check with
+0001a4d0: 696e 2069 6d61 6765 2074 696d 6573 202d  in image times -
+0001a4e0: 3e20 746f 2069 6d61 6765 2064 6566 6175  > to image defau
+0001a4f0: 6c74 2e20 2874 7269 636b 7920 7369 6e63  lt. (tricky sinc
+0001a500: 6520 7765 2064 6f6e 2774 2068 6176 6520  e we don't have 
+0001a510: 7468 6520 6461 6661 756c 7420 696e 6465  the dafault inde
+0001a520: 7820 6865 7265 2e20 4f6e 6c79 2061 2073  x here. Only a s
+0001a530: 7562 7365 7420 6d69 6768 7420 6265 2075  ubset might be u
+0001a540: 7064 6174 6520 6865 7265 290a 2020 2020  pdate here).    
+0001a550: 2020 2020 2320 6368 6563 6b20 7769 7468      # check with
+0001a560: 696e 2069 6d61 6765 2069 7465 6d73 202d  in image items -
+0001a570: 3e20 6865 6164 6572 0a20 2020 2020 2020  > header.       
+0001a580: 2068 6561 6465 7255 7064 6174 6520 3d20   headerUpdate = 
+0001a590: 636f 7079 2e64 6565 7063 6f70 7928 636f  copy.deepcopy(co
+0001a5a0: 6e73 7444 6174 6129 0a20 2020 2020 2020  nstData).       
+0001a5b0: 2068 6561 6465 7255 7064 6174 6564 5465   headerUpdatedTe
+0001a5c0: 7374 203d 2063 6f70 792e 6465 6570 636f  st = copy.deepco
+0001a5d0: 7079 2868 6561 6465 7229 0a20 2020 2020  py(header).     
+0001a5e0: 2020 206d 6971 7463 2e72 6563 7572 7369     miqtc.recursi
+0001a5f0: 7665 6c79 5570 6461 7465 4469 6374 7328  velyUpdateDicts(
+0001a600: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
+0001a610: 742c 6865 6164 6572 5570 6461 7465 290a  t,headerUpdate).
+0001a620: 2020 2020 2020 2020 7570 6461 7465 4469          updateDi
+0001a630: 6666 203d 2044 6565 7044 6966 6628 6865  ff = DeepDiff(he
+0001a640: 6164 6572 2c68 6561 6465 7255 7064 6174  ader,headerUpdat
+0001a650: 6564 5465 7374 290a 2020 2020 2020 2020  edTest).        
+0001a660: 2320 6368 6563 6b20 6966 2068 6561 6465  # check if heade
+0001a670: 7255 7064 6174 6520 776f 756c 6420 6f76  rUpdate would ov
+0001a680: 6572 7772 6974 6520 616e 7974 6869 6e67  erwrite anything
+0001a690: 2066 726f 6d20 6375 7272 656e 7420 6865   from current he
+0001a6a0: 6164 6572 2028 7368 6f75 6c64 206e 6f74  ader (should not
+0001a6b0: 2068 6170 7065 6e29 2c20 6966 2073 6f20   happen), if so 
+0001a6c0: 646f 6e74 2072 656d 6f76 6520 6672 6f6d  dont remove from
+0001a6d0: 2069 7465 6d73 0a20 2020 2020 2020 2069   items.        i
+0001a6e0: 6620 6e6f 7420 2776 616c 7565 735f 6368  f not 'values_ch
+0001a6f0: 616e 6765 6427 2069 6e20 7570 6461 7465  anged' in update
+0001a700: 4469 6666 2061 6e64 206e 6f74 2027 7479  Diff and not 'ty
+0001a710: 7065 5f63 6861 6e67 6573 2720 696e 2075  pe_changes' in u
+0001a720: 7064 6174 6544 6966 6620 616e 6420 6e6f  pdateDiff and no
+0001a730: 7420 2764 6963 7469 6f6e 6172 795f 6974  t 'dictionary_it
+0001a740: 656d 5f72 656d 6f76 6564 2720 696e 2075  em_removed' in u
+0001a750: 7064 6174 6544 6966 663a 0a20 2020 2020  pdateDiff:.     
+0001a760: 2020 2020 2020 2068 6561 6465 722e 636c         header.cl
+0001a770: 6561 7228 290a 2020 2020 2020 2020 2020  ear().          
+0001a780: 2020 6865 6164 6572 2e75 7064 6174 6528    header.update(
+0001a790: 6865 6164 6572 5570 6461 7465 6454 6573  headerUpdatedTes
+0001a7a0: 7429 0a0a 2020 2020 2020 2020 2020 2020  t)..            
+0001a7b0: 2320 7265 6d6f 7665 2063 6f6e 7374 2076  # remove const v
+0001a7c0: 616c 7565 7320 6672 6f6d 2064 6174 610a  alues from data.
+0001a7d0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
+0001a7e0: 632e 7265 6375 7273 6976 654d 616b 654e  c.recursiveMakeN
+0001a7f0: 6f6e 6544 6963 7446 6965 6c64 7345 6d70  oneDictFieldsEmp
+0001a800: 7479 5374 7228 636f 6e73 7444 6174 6129  tyStr(constData)
+0001a810: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001a820: 2069 6d61 6765 2c69 6d61 6765 5f64 6174   image,image_dat
+0001a830: 6120 696e 2064 6174 612e 6974 656d 7328  a in data.items(
+0001a840: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a850: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0001a860: 616e 6365 2869 6d61 6765 5f64 6174 612c  ance(image_data,
+0001a870: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+0001a880: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0001a890: 5f64 6174 6120 3d20 5b69 6d61 6765 5f64  _data = [image_d
+0001a8a0: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
+0001a8b0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
+0001a8c0: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
+0001a8d0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0001a8e0: 2020 2020 2020 2020 2020 6d69 7174 632e            miqtc.
+0001a8f0: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
+0001a900: 6544 6963 7473 2869 6d61 6765 5f74 705f  eDicts(image_tp_
+0001a910: 6461 7461 2c63 6f6e 7374 4461 7461 2920  data,constData) 
+0001a920: 2020 2020 2020 2020 200a 0a20 2020 2020           ..     
+0001a930: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001a940: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001a950: 2020 2020 2020 2320 544f 444f 206c 6f67        # TODO log
+0001a960: 3f0a 2020 2020 200a 0a20 2020 2064 6566  ?.     ..    def
+0001a970: 2069 6e74 6572 6d65 6469 6174 654e 6176   intermediateNav
+0001a980: 4669 6c65 4578 6973 7473 2873 656c 6629  FileExists(self)
+0001a990: 3a0a 2020 2020 2020 2020 6966 206f 732e  :.        if os.
+0001a9a0: 7061 7468 2e65 7869 7374 7328 7365 6c66  path.exists(self
+0001a9b0: 2e67 6574 5f69 6e74 5f6e 6176 5f66 696c  .get_int_nav_fil
+0001a9c0: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
+0001a9d0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0001a9e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001a9f0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+0001aa00: 616c 7365 0a0a 0a20 2020 2064 6566 2068  alse...    def h
+0001aa10: 6561 6465 7246 6965 6c64 4669 6c6c 6564  eaderFieldFilled
+0001aa20: 2873 656c 662c 6669 656c 643a 7374 7229  (self,field:str)
+0001aa30: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+0001aa40: 662e 6669 6e64 546d 7046 6965 6c64 3228  f.findTmpField2(
+0001aa50: 6669 656c 6429 203d 3d20 2222 3a0a 2020  field) == "":.  
+0001aa60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001aa70: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
+0001aa80: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
+0001aa90: 6465 6620 636f 6e76 6572 7454 6f44 6566  def convertToDef
+0001aaa0: 6175 6c74 4461 7465 5469 6d65 466f 726d  aultDateTimeForm
+0001aab0: 6174 2873 656c 662c 6966 646f 293a 0a20  at(self,ifdo):. 
+0001aac0: 2020 2020 2020 2022 2222 2043 6865 636b         """ Check
+0001aad0: 7320 6966 2061 6c6c 2069 7465 6d73 2720  s if all items' 
+0001aae0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0001aaf0: 2066 6965 6c64 7320 6d61 7463 6820 6465   fields match de
+0001ab00: 6661 756c 7420 6461 7465 7469 6d65 2066  fault datetime f
+0001ab10: 6f72 6d61 7420 6f72 2061 2063 7573 746f  ormat or a custo
+0001ab20: 6d20 6f6e 6520 6465 6669 6e65 6420 696e  m one defined in
+0001ab30: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+0001ab40: 2d66 6f72 6d61 7427 0a20 2020 2020 2020  -format'.       
+0001ab50: 2020 2020 2061 6e64 2063 6f6e 7665 7274       and convert
+0001ab60: 7320 746f 2064 6566 6175 6c74 2066 6f72  s to default for
+0001ab70: 6d61 742e 2054 6872 6f77 7320 6578 6365  mat. Throws exce
+0001ab80: 7074 696f 6e20 6966 2064 6174 6574 696d  ption if datetim
+0001ab90: 6520 6361 6e6e 6f74 2062 6520 7061 7273  e cannot be pars
+0001aba0: 6564 2022 2222 0a20 2020 2020 2020 2063  ed """.        c
+0001abb0: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
+0001abc0: 6d61 7446 6f75 6e64 203d 2046 616c 7365  matFound = False
+0001abd0: 0a20 2020 2020 2020 2068 6561 6465 7243  .        headerC
+0001abe0: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
+0001abf0: 6d61 7420 3d20 6669 6e64 4669 656c 6428  mat = findField(
+0001ac00: 6966 646f 5b73 656c 662e 696d 6167 6553  ifdo[self.imageS
+0001ac10: 6574 4865 6164 6572 4b65 795d 2c27 696d  etHeaderKey],'im
+0001ac20: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
+0001ac30: 6d61 7427 290a 2020 2020 2020 2020 6966  mat').        if
+0001ac40: 2068 6561 6465 7243 7573 746f 6d44 6174   headerCustomDat
+0001ac50: 6554 696d 6546 6f72 6d61 7420 213d 2022  eTimeFormat != "
+0001ac60: 223a 0a20 2020 2020 2020 2020 2020 2069  ":.            i
+0001ac70: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0001ac80: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0001ac90: 6765 2d64 6174 6574 696d 652d 666f 726d  ge-datetime-form
+0001aca0: 6174 275d 203d 2022 2220 2320 7265 6d6f  at'] = "" # remo
+0001acb0: 7665 2063 7573 746f 6d20 666f 726d 6174  ve custom format
+0001acc0: 0a20 2020 2020 2020 2020 2020 2063 7573  .            cus
+0001acd0: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
+0001ace0: 7446 6f75 6e64 203d 2054 7275 650a 2020  tFound = True.  
+0001acf0: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+0001ad00: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+0001ad10: 6772 6573 734d 7367 2822 4368 6563 6b69  gressMsg("Checki
+0001ad20: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
+0001ad30: 6174 222c 206c 656e 2869 6664 6f5b 7365  at", len(ifdo[se
+0001ad40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0001ad50: 4b65 795d 292c 6d6f 6475 6c6f 3d31 290a  Key]),modulo=1).
+0001ad60: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+0001ad70: 2c69 7465 6d20 696e 2069 6664 6f5b 7365  ,item in ifdo[se
+0001ad80: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
+0001ad90: 4b65 795d 2e69 7465 6d73 2829 3a0a 2020  Key].items():.  
+0001ada0: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
+0001adb0: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
+0001adc0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0001add0: 6e73 7461 6e63 6528 6974 656d 2c6c 6973  nstance(item,lis
+0001ade0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001adf0: 2020 2020 2020 2020 6974 656d 203d 205b          item = [
+0001ae00: 6974 656d 5d0a 2020 2020 2020 2020 2020  item].          
+0001ae10: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001ae20: 203d 2069 7465 6d5b 305d 0a20 2020 2020   = item[0].     
+0001ae30: 2020 2020 2020 2069 7465 6d43 7573 746f         itemCusto
+0001ae40: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001ae50: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
+0001ae60: 2069 6620 2769 6d61 6765 2d64 6174 6574   if 'image-datet
+0001ae70: 696d 652d 666f 726d 6174 2720 696e 2073  ime-format' in s
+0001ae80: 7562 4974 656d 4465 6661 756c 743a 0a20  ubItemDefault:. 
+0001ae90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001aea0: 7465 6d43 7573 746f 6d44 6174 6554 696d  temCustomDateTim
+0001aeb0: 6546 6f72 6d61 7420 3d20 7375 6249 7465  eFormat = subIte
+0001aec0: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
+0001aed0: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001aee0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001aef0: 2020 7375 6249 7465 6d44 6566 6175 6c74    subItemDefault
+0001af00: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
+0001af10: 2d66 6f72 6d61 7427 5d20 3d20 2222 2023  -format'] = "" #
+0001af20: 2072 656d 6f76 6520 6375 7374 6f6d 2066   remove custom f
+0001af30: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+0001af40: 2020 2020 2020 6375 7374 6f6d 4461 7465        customDate
+0001af50: 5469 6d65 466f 726d 6174 466f 756e 6420  TimeFormatFound 
+0001af60: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001af70: 2020 2066 6f72 2073 7562 4974 656d 2069     for subItem i
+0001af80: 6e20 6974 656d 3a0a 2020 2020 2020 2020  n item:.        
+0001af90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afb0: 2066 6f72 6d61 7420 3d20 6d69 7174 762e   format = miqtv.
+0001afc0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001afd0: 7269 7174 275d 0a20 2020 2020 2020 2020  riqt'].         
+0001afe0: 2020 2020 2020 2020 2020 2064 6174 6574             datet
+0001aff0: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
+0001b000: 7074 696d 6528 7375 6249 7465 6d5b 2769  ptime(subItem['i
+0001b010: 6d61 6765 2d64 6174 6574 696d 6527 5d2c  mage-datetime'],
+0001b020: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
+0001b030: 2020 2020 2020 2020 6578 6365 7074 3a0a          except:.
+0001b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b050: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b070: 2066 6f72 6d61 7420 3d20 6865 6164 6572   format = header
+0001b080: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
+0001b090: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
+0001b0a0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
+0001b0b0: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
+0001b0c0: 696d 652e 7374 7270 7469 6d65 2873 7562  ime.strptime(sub
+0001b0d0: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0001b0e0: 7469 6d65 275d 2c66 6f72 6d61 7429 0a20  time'],format). 
+0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b100: 2020 2020 2020 2073 7562 4974 656d 5b27         subItem['
+0001b110: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0001b120: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
+0001b130: 7469 6d65 2e73 7472 6674 696d 6528 6474  time.strftime(dt
+0001b140: 2c6d 6971 7476 2e64 6174 655f 666f 726d  ,miqtv.date_form
+0001b150: 6174 735b 276d 6172 6971 7427 5d29 0a20  ats['mariqt']). 
+0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b170: 2020 2065 7863 6570 743a 0a20 2020 2020     except:.     
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1b0: 2020 2020 666f 726d 6174 203d 2069 7465      format = ite
+0001b1c0: 6d43 7573 746f 6d44 6174 6554 696d 6546  mCustomDateTimeF
+0001b1d0: 6f72 6d61 740a 2020 2020 2020 2020 2020  ormat.          
+0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1f0: 2020 6474 203d 2064 6174 6574 696d 652e    dt = datetime.
+0001b200: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
+0001b210: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
+0001b220: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
+0001b230: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001b260: 6174 6574 696d 6527 5d20 3d20 6461 7465  atetime'] = date
+0001b270: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001b280: 7266 7469 6d65 2864 742c 6d69 7174 762e  rftime(dt,miqtv.
+0001b290: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001b2a0: 7269 7174 275d 290a 2020 2020 2020 2020  riqt']).        
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0001b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2e0: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+0001b2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b300: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001b310: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0001b320: 6570 7469 6f6e 2827 496e 7661 6c69 6420  eption('Invalid 
+0001b330: 6461 7465 7469 6d65 2076 616c 7565 272c  datetime value',
+0001b340: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001b350: 6174 6574 696d 6527 5d2c 2022 646f 6573  atetime'], "does
+0001b360: 206e 6f74 206d 6174 6368 2066 6f72 6d61   not match forma
+0001b370: 7420 6465 6661 756c 7420 6f72 2063 7573  t default or cus
+0001b380: 746f 6d20 666f 726d 6174 2229 0a20 2020  tom format").   
+0001b390: 2020 2020 2069 6620 6375 7374 6f6d 4461       if customDa
+0001b3a0: 7465 5469 6d65 466f 726d 6174 466f 756e  teTimeFormatFoun
+0001b3b0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+0001b3c0: 656c 662e 7072 6f76 2e6c 6f67 2822 4375  elf.prov.log("Cu
+0001b3d0: 7374 6f6d 2064 6174 6574 696d 6520 666f  stom datetime fo
+0001b3e0: 726d 6174 7320 666f 756e 642e 2054 6865  rmats found. The
+0001b3f0: 7920 7769 6c6c 2062 6520 7265 706c 6163  y will be replac
+0001b400: 6564 2062 7920 7468 6520 6465 6661 756c  ed by the defaul
+0001b410: 7420 666f 726d 6174 2e22 2920 2020 0a20  t format.")   . 
+0001b420: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0001b430: 7228 2920 2020 200a 0a0a 2020 2020 6465  r()    ...    de
+0001b440: 6620 5f5f 696e 6974 496e 7465 726d 6564  f __initIntermed
+0001b450: 6961 7465 4669 6c65 7328 7365 6c66 293a  iateFiles(self):
+0001b460: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+0001b470: 7465 726d 6564 6961 7465 4669 6c65 7344  termediateFilesD
+0001b480: 6566 5f63 6f72 6520 3d20 7b0a 2020 2020  ef_core = {.    
+0001b490: 2020 2020 2020 2020 2768 6173 6865 7327          'hashes'
+0001b4a0: 3a20 7b0a 2020 2020 2020 2020 2020 2020  : {.            
+0001b4b0: 2020 2020 2763 7265 6174 696f 6e46 6374      'creationFct
+0001b4c0: 273a 2027 6372 6561 7465 5f69 6d61 6765  ': 'create_image
+0001b4d0: 5f73 6861 3235 365f 6669 6c65 2829 272c  _sha256_file()',
+0001b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b4f0: 2027 7375 6666 6978 273a 2027 5f69 6d61   'suffix': '_ima
+0001b500: 6765 2d68 6173 6865 732e 7478 7427 2c0a  ge-hashes.txt',.
+0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b520: 2763 6f6c 7327 3a20 5b6d 6971 7476 2e63  'cols': [miqtv.c
+0001b530: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001b540: 7427 5d5b 2768 6173 6827 5d5d 2c0a 2020  t']['hash']],.  
+0001b550: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+0001b560: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+0001b570: 2020 2020 2020 2020 2020 2027 7575 6964             'uuid
+0001b580: 7327 3a20 7b0a 2020 2020 2020 2020 2020  s': {.          
+0001b590: 2020 2020 2020 2763 7265 6174 696f 6e46        'creationF
+0001b5a0: 6374 273a 2027 6372 6561 7465 5f75 7569  ct': 'create_uui
+0001b5b0: 645f 6669 6c65 2829 272c 0a20 2020 2020  d_file()',.     
+0001b5c0: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
+0001b5d0: 6978 273a 2027 5f69 6d61 6765 2d75 7569  ix': '_image-uui
+0001b5e0: 6473 2e74 7874 272c 0a20 2020 2020 2020  ds.txt',.       
+0001b5f0: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
+0001b600: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+0001b610: 6572 5b27 6d61 7269 7174 275d 5b27 7575  er['mariqt']['uu
+0001b620: 6964 275d 5d2c 0a20 2020 2020 2020 2020  id']],.         
+0001b630: 2020 2020 2020 2027 6f70 7469 6f6e 616c         'optional
+0001b640: 273a 205b 5d7d 2c0a 2020 2020 2020 2020  ': []},.        
+0001b650: 2020 2020 2764 6174 6574 696d 6527 3a20      'datetime': 
+0001b660: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001b670: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
+0001b680: 2027 6372 6561 7465 5f73 7461 7274 5f74   'create_start_t
+0001b690: 696d 655f 6669 6c65 2829 272c 0a20 2020  ime_file()',.   
+0001b6a0: 2020 2020 2020 2020 2020 2020 2027 7375               'su
+0001b6b0: 6666 6978 273a 2027 5f69 6d61 6765 2d73  ffix': '_image-s
+0001b6c0: 7461 7274 2d74 696d 6573 2e74 7874 272c  tart-times.txt',
+0001b6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b6e0: 2027 636f 6c73 273a 205b 6d69 7174 762e   'cols': [miqtv.
+0001b6f0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001b700: 7174 275d 5b27 7574 6327 5d5d 2c0a 2020  qt']['utc']],.  
+0001b710: 2020 2020 2020 2020 2020 2020 2020 276f                'o
+0001b720: 7074 696f 6e61 6c27 3a20 5b5d 7d2c 0a20  ptional': []},. 
+0001b730: 2020 2020 2020 2020 2020 2027 6e61 7669             'navi
+0001b740: 6761 7469 6f6e 273a 207b 0a20 2020 2020  gation': {.     
+0001b750: 2020 2020 2020 2020 2020 2027 6372 6561             'crea
+0001b760: 7469 6f6e 4663 7427 3a20 2763 7265 6174  tionFct': 'creat
+0001b770: 655f 696d 6167 655f 6e61 7669 6761 7469  e_image_navigati
+0001b780: 6f6e 5f66 696c 6528 2927 2c0a 2020 2020  on_file()',.    
+0001b790: 2020 2020 2020 2020 2020 2020 2773 7566              'suf
+0001b7a0: 6669 7827 3a20 275f 696d 6167 652d 6e61  fix': '_image-na
+0001b7b0: 7669 6761 7469 6f6e 2e74 7874 272c 0a20  vigation.txt',. 
+0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001b7d0: 636f 6c73 273a 205b 6d69 7174 762e 636f  cols': [miqtv.co
+0001b7e0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001b7f0: 275d 5b27 7574 6327 5d5d 2c0a 2020 2020  ']['utc']],.    
+0001b800: 2020 2020 2020 2020 2020 2020 276f 7074              'opt
+0001b810: 696f 6e61 6c27 3a20 5b6d 6971 7476 2e63  ional': [miqtv.c
+0001b820: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001b830: 7427 5d5b 276c 6f6e 275d 2c20 6d69 7174  t']['lon'], miqt
+0001b840: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001b850: 7269 7174 275d 5b27 6c61 7427 5d2c 206d  riqt']['lat'], m
+0001b860: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001b870: 276d 6172 6971 7427 5d5b 2761 6c74 275d  'mariqt']['alt']
+0001b880: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+0001b890: 6572 5b27 6d61 7269 7174 275d 5b27 6867  er['mariqt']['hg
+0001b8a0: 7427 5d2c 206d 6971 7476 2e63 6f6c 5f68  t'], miqtv.col_h
+0001b8b0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001b8c0: 2775 6e63 6572 7427 5d5d 7d2c 0a20 2020  'uncert']]},.   
+0001b8d0: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+0001b8e0: 7365 6c66 2e6e 6f6e 436f 7265 4669 656c  self.nonCoreFiel
+0001b8f0: 6449 6e74 6572 6d65 6469 6174 6549 7465  dIntermediateIte
+0001b900: 6d49 6e66 6f46 696c 6573 203d 205b 5d0a  mInfoFiles = [].
+0001b910: 0a20 2020 2064 6566 205f 5f67 6574 5f69  .    def __get_i
+0001b920: 6e74 5f66 696c 655f 7072 6566 6978 2873  nt_file_prefix(s
+0001b930: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0001b940: 2220 6465 7065 6e64 7320 6f6e 2027 696d  " depends on 'im
+0001b950: 6167 652d 6576 656e 7427 2061 6e64 2027  age-event' and '
+0001b960: 696d 6167 652d 7365 6e73 6f72 2720 736f  image-sensor' so
+0001b970: 2069 7420 6361 6e20 6368 616e 6765 2064   it can change d
+0001b980: 7572 696e 6720 7570 6174 6520 2222 220a  uring upate """.
+0001b990: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001b9a0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+0001b9b0: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+0001b9c0: 2e64 742e 696e 7465 726d 6564 6961 7465  .dt.intermediate
+0001b9d0: 292c 2073 656c 662e 6669 6e64 546d 7046  ), self.findTmpF
+0001b9e0: 6965 6c64 2827 696d 6167 652d 7365 742d  ield('image-set-
+0001b9f0: 6e61 6d65 2729 290a 0a20 2020 2064 6566  name'))..    def
+0001ba00: 2067 6574 5f69 6e74 5f68 6173 685f 6669   get_int_hash_fi
+0001ba10: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+0001ba20: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+0001ba30: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+0001ba40: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
+0001ba50: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
+0001ba60: 665f 636f 7265 5b27 6861 7368 6573 275d  f_core['hashes']
+0001ba70: 5b27 7375 6666 6978 275d 0a0a 2020 2020  ['suffix']..    
+0001ba80: 6465 6620 6765 745f 696e 745f 7575 6964  def get_int_uuid
+0001ba90: 5f66 696c 6528 7365 6c66 293a 0a20 2020  _file(self):.   
+0001baa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001bab0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0001bac0: 7072 6566 6978 2829 202b 2073 656c 662e  prefix() + self.
+0001bad0: 696e 7465 726d 6564 6961 7465 4669 6c65  intermediateFile
+0001bae0: 7344 6566 5f63 6f72 655b 2775 7569 6473  sDef_core['uuids
+0001baf0: 275d 5b27 7375 6666 6978 275d 0a0a 2020  ']['suffix']..  
+0001bb00: 2020 6465 6620 6765 745f 696e 745f 7374    def get_int_st
+0001bb10: 6172 7454 696d 6573 5f66 696c 6528 7365  artTimes_file(se
+0001bb20: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001bb30: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
+0001bb40: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
+0001bb50: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
+0001bb60: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+0001bb70: 655b 2764 6174 6574 696d 6527 5d5b 2773  e['datetime']['s
+0001bb80: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
+0001bb90: 2067 6574 5f69 6e74 5f6e 6176 5f66 696c   get_int_nav_fil
+0001bba0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001bbb0: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
+0001bbc0: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+0001bbd0: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
+0001bbe0: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
+0001bbf0: 5f63 6f72 655b 276e 6176 6967 6174 696f  _core['navigatio
+0001bc00: 6e27 5d5b 2773 7566 6669 7827 5d0a 0a    n']['suffix']..
```

## Comparing `mariqt-0.5.1.dist-info/LICENSE` & `mariqt-0.5.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.1.dist-info/METADATA` & `mariqt-0.5.2.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.1
+Version: 0.5.2
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.1.dist-info/RECORD` & `mariqt-0.5.2.dist-info/RECORD`

 * *Files 6% similar despite different names*

```diff
@@ -8,24 +8,24 @@
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
 mariqt/navigation.py,sha256=kYKHzibCKJNtXlDaIqzqZ7rmvjzFvpCUnFfz6yR7QJI,40059
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=ot38MXI2Gybe8uk3SHIeU9fHN_Tj1M_NBr9vSEDzz0o,21
+mariqt/version.py,sha256=LADBavpB8x-lrtqob-7SCQZXFPfLZCu34A0lBsgTGGI,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=VoLc-YMD4Elwz0YpCFMy8mz0QQnKI0AJHPUHzQX9kJg,4586
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=DMaBCn0hkKvom5qjNXPnfAD__l35CoT3UNj-3ZogX7w,112498
+mariqt/sources/ifdo.py,sha256=uhgMAk60q_yLj2n2_2Vj-v3VcL8RpztXpnZw4J9TVtM,113679
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.1.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.1.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.1.dist-info/METADATA,sha256=CBcwWhopCZDTYgGe5v__Bru7hZ3SKfeZWKGmiXAHSTY,1133
-mariqt-0.5.1.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-mariqt-0.5.1.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.1.dist-info/RECORD,,
+mariqt-0.5.2.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.2.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.2.dist-info/METADATA,sha256=B1NM209V0Tm5Bp6X3O7wqwA6M3WSFd-O1Pila48P18Y,1133
+mariqt-0.5.2.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+mariqt-0.5.2.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.2.dist-info/RECORD,,
```

